import{u as he,S as ye,_ as De,E as Ce}from"./EditorMenubar-CkkChCsc.js";import{u as $e}from"./demands-Dy6BKoEP.js";import{u as Se}from"./eventType-ClFPuv80.js";import{u as ke}from"./customers-Dsj_DINc.js";import{u as we}from"./hall-C7cB23wV.js";import{a as Te}from"./BaseBreadcrumb-BTU6PUKi.js";import{r as Y}from"./validators-BPi-vT8z.js";import{a as Ee}from"./formatters-DCCWVJxZ.js";import{a6 as Ue,aD as y,aC as Pe,r as n,av as Ae,h as Ne,e as D,g as Be,q as Ie,o as c,_ as E,w as o,V as C,n as F,d as v,t as i,b as a,$ as Fe,a as Z,a8 as V,c as x,X as je,a4 as ee}from"./index-CM0D4_qI.js";import{F as Le,V as Oe}from"./vee-validate.esm-Cr45sfAl.js";import{V as ae}from"./VDialog-BmmbiiJ_.js";import{d as Me,b as He,i as j}from"./VSpacer-D4AWtNAJ.js";import{V as qe}from"./VAvatar-D1rEUekq.js";import{b as ze,V as Ke,c as Re,a as Xe}from"./VCard-SRqtCCz8.js";import{V as Ge}from"./VContainer-DXk4of46.js";import{a as Je,V as s}from"./VRow-B_5CRJ_N.js";import{V as L}from"./VAutocomplete-gV03piQG.js";import{V as p}from"./VTextField-BfcsYLCK.js";import{V as Qe}from"./VLocaleProvider-CTK-iw_Q.js";import{V as We}from"./VDatePicker-DFxCwPFd.js";const Ye={class:"text-h5"},Ze={key:0,class:"mt-2"},_a=Ue({__name:"DemandForm",props:{modelValue:Object,isNew:{type:Boolean,default:!0},showCustomer:{type:Boolean,default:!0},title:y("Service"),buttonText:{type:String,default:y("Ajouter une demande")}},emits:["update:modelValue","update:item"],setup($,{emit:te}){const g=Pe(),O=n(),M=Ae(),le=Se(),oe=ke(),re=we(),ue=$,H=te,ne=n([]),q=n([]),U=n([]),z=n([]),K=$e();Ne(()=>{W(),Ve(),re.fetchItems({per_page:1e3}).then(t=>{z.value=t.data.data})});const R=n(!1),b=n(!1),X=n(null),S=n(!1),de=n(100),P=n(2),A=n(2),se=n(0),G=n(!1),k=n(!1),J=n(""),w=n([{key:"event_date",order:"ASC"}]),m=n({search:null,status:null,date:null,event_type:null}),N=n({itemsPerPage:100,rowsPerPage:100,page:1,sortDesc:[!0],sortBy:[{key:"event_date",order:"ASC"}]});n(-1);const l=D({get:()=>ue.modelValue||{id:null,customer:{}},set:t=>H("update:modelValue",t)}),B=he({extensions:[ye],content:l.value.commentaire}),me=D(()=>l.value.event_date?g.format(l.value.event_date,"shortDate"):null),Q=D(()=>l.value.event_date?Ee(l.value.event_date):null);function ie(){k.value=!1,l.value.id==null&&setTimeout(()=>{l.value=Object.assign({customer:{}},{customer:{id:null,customer:{}}})},300)}function ve(t,{setErrors:e}){var u;console.log(l.value),(u=O.value)==null||u.validate().then(({valid:f})=>{var r;f&&(b.value=!0,K.addItem({...l.value,event_date:me.value,commentaire:(r=B.value)==null?void 0:r.getHTML()}).then(d=>{if(d.data.error){e({apiError:d.data.message}),M.showError(d.data.message);return}const _=d.data.event_date!=null?new Date(d.data.event_date):null,T={...d.data,event_date:_};H("saved",T),b.value=!1,k.value=!1,M.showSuccess(y("Demande enregistrée avec succès")),W()}).catch(d=>{b.value=!1,e({apiError:d})}).then(()=>{b.value=!1,e({apiError:null})}))})}const pe=D(()=>l.value.id==null?"Nouvelle demande":"Modifier la demande"),fe=D(()=>m.value.date&&m.value.date.length?m.value.date.length>1?[g.format(m.value.date[0],"shortDate"),g.format(m.value.date[m.value.date.length-1],"shortDate")]:[g.format(m.value.date[0],"shortDate"),g.format(m.value.date[0],"shortDate")]:null);function ce(){try{clearTimeout(X.value)}catch{}X.value=setTimeout(()=>{R.value=!0;let t="id",e="desc";console.log(w.value),w.value.length>0&&(t=w.value[0].key,e=w.value[0].order),K.fetchItems({term:J.value,paginate:de.value,current_page:P.value,direction:e,order_by:t,page:N.value.page,per_page:N.value.itemsPerPage,...m.value,date:fe.value}).then(u=>{if(u.data){const{data:f,current_page:r,next_page_url:d,total:_,per_page:T,to:h,last_page:be}=u.data;ne.value=f.map(I=>{const _e=I.event_date!=null?new Date(I.event_date):null;return{...I,event_date:_e}}),A.value=be,se.value=_}}).catch(u=>{console.error(u)}).then(()=>{R.value=!1})},1e3)}function W(){le.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(t=>{if(t.data){const{data:e,current_page:u,next_page_url:f,total:r,per_page:d,to:_,last_page:T}=t.data;q.value=e}}).catch(t=>{console.error(t)}).then(()=>{})}function Ve(){oe.fetchItems({term:"",paginate:5e3,current_page:1,direction:"asc",order_by:"firstname",page:1,per_page:5e3}).then(t=>{if(t.data){const{data:e,current_page:u,next_page_url:f,total:r,per_page:d,to:_,last_page:T}=t.data;U.value=e.map(h=>({...h,name:h.firstname+" "+h.lastname+" ("+(h.is_customer?y("Client"):y("Prospect"))+")"}))}}).catch(t=>{console.error(t)}).then(()=>{})}Be([J,N,m],()=>{ce()},{deep:!0}),Ie(()=>{P.value>A.value&&(P.value=A.value)});function ge(t){if(t){const e=U.value.find(u=>u.id==t);e&&(l.value.customer=e)}}return(t,e)=>(c(),E(ae,{modelValue:k.value,"onUpdate:modelValue":e[18]||(e[18]=u=>k.value=u),"max-width":"1000px"},{activator:o(({props:u})=>[$.isNew?(c(),E(C,F({key:0,color:"primary",class:"align-self-end float-end mx-2",variant:"flat",dark:""},u),{default:o(()=>[v(i($.buttonText),1)]),_:2},1040)):(c(),E(Me,F({key:1,value:"action","hide-details":"","min-height":"38"},u),{default:o(()=>[a(He,null,{default:o(()=>[a(qe,{size:"20",class:"mr-2"},{default:o(()=>[(c(),E(Fe("EditIcon"),{"stroke-width":"2",size:"20"}))]),_:1}),v(" "+i(t.$t("Modifier")),1)]),_:1})]),_:2},1040))]),default:o(()=>[a(Xe,null,{default:o(()=>[a(ze,{class:"pa-4 bg-secondary"},{default:o(()=>[Z("span",Ye,i(pe.value),1)]),_:1}),a(V(Le),{ref_key:"refForm",ref:O,modelValue:G.value,"onUpdate:modelValue":e[17]||(e[17]=u=>G.value=u),onSubmit:ve},{default:o(({errors:u,isSubmitting:f})=>[a(Ke,null,{default:o(()=>[a(Ge,{class:"px-0"},{default:o(()=>[a(Je,null,{default:o(()=>[$.showCustomer?(c(),x(je,{key:0},[a(s,{cols:"12"},{default:o(()=>[a(L,{modelValue:l.value.customer_id,"onUpdate:modelValue":[e[0]||(e[0]=r=>l.value.customer_id=r),ge],placeholder:t.$t("Client"),label:t.$t("Client"),items:U.value,"item-value":"id","item-title":"name",clearable:"","hide-details":"",variant:"outlined"},null,8,["modelValue","placeholder","label","items"])]),_:1}),a(s,{cols:"12",md:"6"},{default:o(()=>[a(p,{modelValue:l.value.customer.firstname,"onUpdate:modelValue":e[1]||(e[1]=r=>l.value.customer.firstname=r),rules:[V(Y)],label:t.$t("Prénom")},null,8,["modelValue","rules","label"])]),_:1}),a(s,{cols:"12",md:"6"},{default:o(()=>[a(p,{modelValue:l.value.customer.lastname,"onUpdate:modelValue":e[2]||(e[2]=r=>l.value.customer.lastname=r),rules:[V(Y)],label:t.$t("Nom")},null,8,["modelValue","rules","label"])]),_:1}),a(s,{cols:"12",md:"6"},{default:o(()=>[a(p,{modelValue:l.value.customer.email,"onUpdate:modelValue":e[3]||(e[3]=r=>l.value.customer.email=r),label:t.$t("Email")},null,8,["modelValue","label"])]),_:1}),a(s,{cols:"12",md:"6"},{default:o(()=>[a(p,{modelValue:l.value.customer.phone,"onUpdate:modelValue":e[4]||(e[4]=r=>l.value.customer.phone=r),label:t.$t("Téléphone")},null,8,["modelValue","label"])]),_:1})],64)):ee("",!0),a(s,{cols:"12",md:"6"},{default:o(()=>[a(L,{modelValue:l.value.event_type_id,"onUpdate:modelValue":e[5]||(e[5]=r=>l.value.event_type_id=r),placeholder:t.$t("Type d'événement"),items:q.value,"item-value":"id","item-title":"name",clearable:"","hide-details":"",variant:"outlined"},null,8,["modelValue","placeholder","items"])]),_:1}),a(s,{cols:"12",md:"6"},{default:o(()=>[a(ae,{ref:"dialogDemandDate",modelValue:S.value,"onUpdate:modelValue":e[11]||(e[11]=r=>S.value=r),"return-value":l.value.event_date,"onUpdate:returnValue":e[12]||(e[12]=r=>l.value.event_date=r),persistent:"",width:"290px"},{activator:o(({props:r})=>[a(p,F({modelValue:Q.value,"onUpdate:modelValue":e[6]||(e[6]=d=>Q.value=d),"prepend-inner-icon":"bx-calendar"},r,{placeholder:t.$t("Date de l'évènement"),"hide-details":"",clearable:"",readonly:"","onClick:clear":e[7]||(e[7]=d=>l.value.event_date=null)}),null,16,["modelValue","placeholder"])]),default:o(({isActive:r})=>[a(Qe,{locale:"fr"},{default:o(()=>[a(We,{modelValue:l.value.event_date,"onUpdate:modelValue":e[10]||(e[10]=d=>l.value.event_date=d),"hide-header":""},{actions:o(()=>[a(C,{color:"primary",onClick:e[8]||(e[8]=d=>S.value=!1)},{default:o(()=>[v(i(t.$t("Annuler")),1)]),_:1}),a(j),a(C,{variant:"elevated",color:"primary",onClick:e[9]||(e[9]=d=>S.value=!1)},{default:o(()=>[v(i(t.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),a(s,{cols:"12",md:"6"},{default:o(()=>[a(Te,{modelValue:l.value.reception_period,"onUpdate:modelValue":e[13]||(e[13]=r=>l.value.reception_period=r),"hide-details":"",items:[t.$t("En matiné"),t.$t("Le midi"),t.$t("En soirée")],label:t.$t("La réception se déroulera plutôt"),clearable:""},null,8,["modelValue","items","label"])]),_:1}),a(s,{cols:"12",md:"6"},{default:o(()=>[a(p,{modelValue:l.value.reception_start_time,"onUpdate:modelValue":e[14]||(e[14]=r=>l.value.reception_start_time=r),"hide-details":"",label:t.$t("Heure de réception"),clearable:""},null,8,["modelValue","label"])]),_:1}),a(s,{cols:"12",md:"6"},{default:o(()=>[a(L,{modelValue:l.value.hall_id,"onUpdate:modelValue":e[15]||(e[15]=r=>l.value.hall_id=r),items:z.value,"item-value":"id","item-title":"name","hide-details":"",variant:"outlined",label:t.$t("Salle liée")},null,8,["modelValue","items","label"])]),_:1}),a(s,{cols:"12",md:"6"},{default:o(()=>[a(p,{modelValue:l.value.number_people,"onUpdate:modelValue":e[16]||(e[16]=r=>l.value.number_people=r),"hide-details":"",type:"number",label:t.$t("Nombre de convives")},null,8,["modelValue","label"])]),_:1}),a(s,{cols:"12"},{default:o(()=>[Z("label",null,i(t.$t("Commentaire")),1),a(De,{editor:V(B)},null,8,["editor"]),a(V(Ce),{editor:V(B)},null,8,["editor"])]),_:1})]),_:1}),u.apiError?(c(),x("div",Ze,[a(Oe,{color:"error"},{default:o(()=>[v(i(u.apiError),1)]),_:2},1024)])):ee("",!0)]),_:2},1024)]),_:2},1024),a(Re,null,{default:o(()=>[a(j),a(C,{color:"error",variant:"flat",dark:"",onClick:ie},{default:o(()=>[v(i(t.$t("Annuler")),1)]),_:1}),a(C,{color:"success",variant:"flat",loading:b.value,type:"submit"},{default:o(()=>[v(i(t.$t("Sauvegarder")),1)]),_:1},8,["loading"]),a(j)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]))}});export{_a as _};
