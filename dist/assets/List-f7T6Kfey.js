import{u as fe}from"./Controller-Ccpa4Fck.js";import{u as ce}from"./eventType-CYFMVToW.js";import{u as ge}from"./hall-B587Wjpx.js";import{a6 as ye,aJ as he,r as u,av as be,aK as l,aL as Ve,h as Z,e as $,g as Q,q as _e,Z as ke,o as T,c as N,b as s,w as o,a8 as f,n as Pe,V as w,d as p,t as d,a4 as R,_ as $e,a as we,X as Ce}from"./index-CRCKgVmq.js";import{_ as De}from"./BaseBreadcrumb-vtR23IL1.js";import{f as W,a as j}from"./formatters-DFmKRZND.js";import{_ as xe}from"./ChangeHall.vue_vue_type_script_setup_true_lang-DtQvjLHt.js";import"./demands-C6nPiw7i.js";import{V as h,a as Y}from"./VRow-DezjXr9Z.js";import{V as Se}from"./VDataTableServer-XG9LBK41.js";import{V as Ue}from"./VToolbar-DytiyXH8.js";import{V as ee}from"./VTextField-DjVRWgjd.js";import{b as E}from"./VSelect-C7c1KwxF.js";import{V as te}from"./VDialog-C6VdqkiG.js";import{V as Te}from"./VLocaleProvider-DuQhCwWi.js";import{V as Ee}from"./VDatePicker-DbdKW0xH.js";import{a as H,V as ae}from"./VSpacer-Biqb10ux.js";import{a as Ie,b as Ae,c as Le}from"./VCard-DwblneJy.js";import"./VMenu-C0BfXMOe.js";import"./VAvatar-vkCDtegD.js";import"./filter-K4rby175.js";import"./VSheet-asqlbYFm.js";const Me={key:0,class:"text-error font-weight-bold"},Be={key:0},nt=ye({__name:"List",setup(Ne){const b=he();u();const le=be(),se=ce(),oe=ge(),n=u({title:l("Prestations")}),v=u([{text:l("Dashboard"),disabled:!1,href:"/"},{text:l("Prestations"),disabled:!0,href:"#"}]),c=u([]),K=u([]),O=u([]),i=fe(),z=Ve(),g=u(0);Z(()=>{oe.fetchItems({per_page:1e3}).then(a=>{O.value=a.data.data}),J(),M(),me()});const C=u(!1);u(!1);const F=u(null),D=u(!1),I=u(25),_=u(2),x=u(2),k=u(0),re=u(!1),A=u("");u(["primary","secondary","error","success","warning"]);const V=u([{key:"demand_date",order:"DESC"}]);u(0);const r=u({search:null,date:null,event_type:null,status:i.statuses.validated}),P=u({itemsPerPage:25,rowsPerPage:25,page:1,sortDesc:[!0],sortBy:[{key:"demand_date",order:"DESC"}]}),ue=u(-1),q=u({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});u({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});const S=u(!1),U=u([{title:l("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:l("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:l("Email"),align:"start",key:"customer.email",sortable:!1},{title:l("Téléphone"),align:"start",key:"customer.phone",sortable:!1},{title:l("Prestation"),align:"start",key:"event_type"},{title:l("Date de la prestation"),align:"start",key:"event_date"},{title:l("La réception se déroulera plutôt"),key:"reception_period"},{title:l("Heure"),key:"reception_start_time"},{title:l("Lieu"),key:"demand.event_location"},{title:l("Convives"),key:"demand.number_people"},{title:l("En attente de règlement"),align:"start",key:"amount_left",sortable:!1},{title:l("Montant total"),align:"start",key:"services_sum_total",sortable:!1},{title:l("Actions"),key:"actions",sortable:!1}]),L=u([{title:l("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:l("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:l("Email"),align:"start",key:"customer.email",sortable:!1},{title:l("Tél."),align:"start",key:"customer.phone",sortable:!1},{title:l("Date prest."),align:"start",key:"event_date"},{title:l("Moment"),key:"reception_period"},{title:l("Heure"),key:"reception_start_time"},{title:l("Con."),key:"demand.number_people"},{title:l("Salle"),key:"hall"},{title:l("Reste à payer"),align:"start",key:"amount_left",sortable:!1},{title:l("Montant total"),align:"start",key:"services_sum_total",sortable:!1},{title:l("Actions"),key:"actions",sortable:!1}]),ne=$(()=>z.params.status),G=$(()=>r.value.date&&r.value.date.length>0?b.format(r.value.date[0],"shortDate")+" - "+b.format(r.value.date[r.value.date.length-1],"shortDate"):null);Q(ne,(a,t)=>{a!=t&&(J(),M())},{deep:!0}),$(()=>i.items.data.filter(a=>a.email.toLowerCase().includes(A.value.toLowerCase())));function ie(){i.deleteItem(q.value.id);const a=c.value.findIndex(t=>t.id==q.value.id);c.value.splice(a,1),S.value=!1,le.showSuccess(l("Utilisateur supprimé avec succès"))}$(()=>ue.value===-1?"Nouvel administrateur":"Modifier l’administrateur");const de=$(()=>r.value.date&&r.value.date.length?r.value.date.length>1?[b.format(r.value.date[0],"shortDate"),b.format(r.value.date[r.value.date.length-1],"shortDate")]:[b.format(r.value.date[0],"shortDate"),b.format(r.value.date[0],"shortDate")]:null);function J(){switch(v.value=[{text:l("Dashboard"),disabled:!1,href:"/"}],c.value=[],k.value=0,U.value=L.value,z.params.status){case"started":n.value={title:l("Prestations en attente de validation")},v.value.push({text:n.value.title,disabled:!0,href:"#"}),g.value=i.statuses.started,U.value=L.value.filter(a=>a.key!="services_sum_total"&&a.key!="amount_left");break;case"validated":n.value={title:l("Prestations validées")},v.value.push({text:n.value.title,disabled:!0,href:"#"}),g.value=i.statuses.validated,U.value=L.value;break;case"processing":n.value={title:l("Prestations en cours")},v.value.push({text:n.value.title,disabled:!0,href:"#"}),g.value=i.statuses.processing;break;case"closed":n.value={title:l("Prestations clôturées")},v.value.push({text:n.value.title,disabled:!0,href:"#"}),g.value=i.statuses.closed;break;case"cancelled":n.value={title:l("Prestations annulées")},v.value.push({text:n.value.title,disabled:!0,href:"#"}),g.value=i.statuses.cancelled;break;default:n.value={title:`${l("Prestations")}`},v.value.push({text:n.value.title,disabled:!0,href:"#"}),g.value=i.statuses.started;break}}function M(){try{clearTimeout(F.value)}catch{}F.value=setTimeout(()=>{C.value=!0;let a="id",t="desc";console.log(V.value),V.value.length>0&&(a=V.value[0].key,t=V.value[0].order),i.fetchItems({term:A.value,paginate:I.value,current_page:_.value,status:g.value,direction:t,order_by:a,page:P.value.page,per_page:P.value.itemsPerPage,...r.value,date:de.value}).then(y=>{if(y.data){const{data:e,current_page:m,next_page_url:B,total:X,per_page:pe,to:Re,last_page:ve}=y.data;c.value=e,x.value=ve,k.value=X}}).catch(y=>{console.error(y)}).then(()=>{C.value=!1})},1e3)}function me(){se.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(a=>{if(a.data){const{data:t,current_page:y,next_page_url:e,total:m,per_page:B,to:X,last_page:pe}=a.data;K.value=t}}).catch(a=>{console.error(a)}).then(()=>{C.value=!1})}return Q([A,P,r],()=>{M()},{deep:!0}),_e(()=>{_.value>x.value&&(_.value=x.value)}),Z(()=>{}),(a,t)=>{const y=ke("EyeIcon");return T(),N(Ce,null,[s(De,{title:`${n.value.title}(${k.value})`,breadcrumbs:v.value},null,8,["title","breadcrumbs"]),s(Y,null,{default:o(()=>[s(h,{cols:"12"},{default:o(()=>[s(Se,{class:"border rounded-md",headers:U.value,loading:C.value,items:c.value,"multi-sort":!1,"items-per-page":I.value,"onUpdate:itemsPerPage":t[14]||(t[14]=e=>I.value=e),"items-per-page-text":a.$t("Articles par page"),options:P.value,"onUpdate:options":t[15]||(t[15]=e=>P.value=e),"sort-by":V.value,"onUpdate:sortBy":t[16]||(t[16]=e=>V.value=e),page:_.value,"onUpdate:page":t[17]||(t[17]=e=>_.value=e),"items-length":k.value,"onUpdate:itemsLength":t[18]||(t[18]=e=>k.value=e),"show-select":!1,"loading-text":a.$t("Chargement des éléments"),"no-data-text":a.$t("Pas de données"),"no-results-text":a.$t("Aucun résultat"),onPageCount:t[19]||(t[19]=e=>x.value=e)},{top:o(()=>[s(Ue,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:o(()=>[s(Y,null,{default:o(()=>[s(h,null,{default:o(()=>[s(ee,{density:"compact",modelValue:r.value.search,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value.search=e),placeholder:a.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),s(h,null,{default:o(()=>[s(E,{density:"compact",modelValue:r.value.event_type,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value.event_type=e),placeholder:a.$t("Prestation"),items:K.value,"item-value":"name","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),s(h,null,{default:o(()=>[s(E,{density:"compact",modelValue:r.value.hall,"onUpdate:modelValue":t[2]||(t[2]=e=>r.value.hall=e),placeholder:a.$t("Salle"),items:O.value,"item-value":"id","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),s(h,null,{default:o(()=>[s(E,{density:"compact",modelValue:r.value.payment_status,"onUpdate:modelValue":t[3]||(t[3]=e=>r.value.payment_status=e),placeholder:a.$t("Reste à payer"),items:[{id:"waiting",label:a.$t("En attente")},{id:"completed",label:a.$t("Soldé")}],"item-value":"id","item-title":"label","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),s(h,null,{default:o(()=>[s(E,{density:"compact",modelValue:r.value.status,"onUpdate:modelValue":t[4]||(t[4]=e=>r.value.status=e),placeholder:a.$t("Statut"),items:f(i).statusesList,"item-value":"id","item-title":"label",clearable:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","items"])]),_:1}),s(h,null,{default:o(()=>[s(te,{ref_key:"dialog",ref:re,modelValue:D.value,"onUpdate:modelValue":t[10]||(t[10]=e=>D.value=e),"return-value":r.value.date,"onUpdate:returnValue":t[11]||(t[11]=e=>r.value.date=e),persistent:"",width:"290px"},{activator:o(({props:e})=>[s(ee,Pe({modelValue:G.value,"onUpdate:modelValue":t[5]||(t[5]=m=>G.value=m),"prepend-inner-icon":"bx-calendar",readonly:""},e,{density:"compact",placeholder:a.$t("Date"),"hide-details":"",variant:"solo",flat:"",clearable:"","onClick:clear":t[6]||(t[6]=m=>r.value.date=null)}),null,16,["modelValue","placeholder"])]),default:o(({isActive:e})=>[s(Te,{locale:"fr"},{default:o(()=>[s(Ee,{modelValue:r.value.date,"onUpdate:modelValue":t[9]||(t[9]=m=>r.value.date=m),"hide-header":"",multiple:"range"},{actions:o(()=>[s(w,{color:"primary",onClick:t[7]||(t[7]=m=>D.value=!1)},{default:o(()=>[p(d(a.$t("Annuler")),1)]),_:1}),s(H),s(w,{variant:"elevated",color:"primary",onClick:t[8]||(t[8]=m=>D.value=!1)},{default:o(()=>[p(d(a.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1}),s(te,{modelValue:S.value,"onUpdate:modelValue":t[13]||(t[13]=e=>S.value=e),"max-width":"500px"},{default:o(()=>[s(Ie,null,{default:o(()=>[s(Ae,{class:"text-h5 text-center py-6"},{default:o(()=>[p(d(a.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),s(Le,null,{default:o(()=>[s(H),s(w,{color:"error",variant:"flat",dark:"",onClick:t[12]||(t[12]=e=>S.value=!1)},{default:o(()=>[p(d(a.$t("Annuler")),1)]),_:1}),s(w,{color:"success",variant:"flat",dark:"",onClick:ie},{default:o(()=>[p(d(a.$t("OK")),1)]),_:1}),s(H)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.demand_date":o(({item:e})=>[p(d(f(W)(e.demand_date)),1)]),"item.event_date":o(({item:e})=>[p(d(f(W)(e.event_date)),1)]),"item.amount_left":o(({item:e})=>[Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?(T(),N("span",Me,d(f(j)(Math.max(e.services_sum_total-e.payments_sum_amount,0))),1)):R("",!0)]),"item.services_sum_total":o(({item:e})=>[s(ae,{variant:"tonal",color:Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?"error":"success",class:"font-weight-bold"},{default:o(()=>[p(d(f(j)(e.payments_sum_amount||0))+" / "+d(f(j)(e.services_sum_total||0)),1)]),_:2},1032,["color"])]),"item.status":o(({item:e})=>[s(ae,{color:f(i).statusColor(e.status),size:"small",label:""},{default:o(()=>[p(d(f(i).statusText(e.status)),1)]),_:2},1032,["color"])]),"item.hall":o(({index:e,item:m})=>[m.hall?(T(),N("span",Be,d(m.hall.name),1)):R("",!0),m.hall?R("",!0):(T(),$e(xe,{key:1,modelValue:c.value[e],"onUpdate:modelValue":B=>c.value[e]=B,"show-demand-info":""},null,8,["modelValue","onUpdate:modelValue"]))]),"item.actions":o(({item:e})=>[s(w,{icon:"",flat:"",density:"compact",class:"mx-2",to:"/prestations/"+e.id},{default:o(()=>[s(y,{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1032,["to"])]),"no-data":o(()=>[we("span",null,d(a.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64)}}});export{nt as default};
