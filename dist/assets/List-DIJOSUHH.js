import{u as _e}from"./Controller-BxXGpcEM.js";import{u as be}from"./eventType-DjGqDcem.js";import{u as Ve}from"./hall-BR4LrXDH.js";import{a6 as ke,aJ as $e,r as u,av as Pe,aK as r,aL as Ce,h as we,e as D,g as Y,q as xe,Z as De,o as $,c as N,b as o,w as l,a8 as f,n as Ue,V as U,d as y,t as i,a as S,ae as ee,af as te,_ as z,a4 as A,X as Se}from"./index-h10VwvxX.js";import{_ as Ae}from"./BaseBreadcrumb-D1qOTCVJ.js";import{a as ae,f as H}from"./formatters-ChhyeSK0.js";import{_ as Ie,a as Te,b as Ee}from"./PaymentForm.vue_vue_type_script_setup_true_lang-C5mqe56-.js";import"./demands-CwhYTrm1.js";import{V as b,a as le}from"./VRow-BgUR1jT6.js";import{V as Me}from"./VDataTableServer-DdvL5mqf.js";import{V as qe}from"./VToolbar-BkDZSntF.js";import{V as se}from"./VTextField-D8dBTZbl.js";import{b as L}from"./VSelect-gfH_aH7y.js";import{V as oe}from"./VDialog-D7uODJgv.js";import{V as Le}from"./VLocaleProvider-FIH8L2Ey.js";import{V as Re}from"./VDatePicker-aPSbzZcX.js";import{a as K,V as re}from"./VSpacer-F9kYomq2.js";import{a as je,b as Be,c as Ne}from"./VCard-H_mlGdt1.js";import{V as ue}from"./VTooltip-B4o_zCxu.js";import"./VMenu-y3tC03OP.js";import"./VAvatar-DoqaIa0V.js";import"./paymentMethod-Dy_iZ_N_.js";import"./VAutocomplete-D1Nwcsp8.js";import"./filter-f_vm2mpL.js";import"./VSheet-CKRhl9Ap.js";const ze=["onClick"],He=["onClick"],Ke={key:0,class:"text-error font-weight-bold"},Oe={key:0},_t=ke({__name:"List",setup(Fe){const V=$e();u();const ne=Pe(),ie=be(),de=Ve(),m=u({title:r("Prestations")}),g=u([{text:r("Dashboard"),disabled:!1,href:"/"},{text:r("Prestations"),disabled:!0,href:"#"}]),p=u([]),O=u([]),F=u([]),d=_e(),v=Ce(),h=u(0);we(()=>{if(v.query.status&&(s.value.status=parseInt(v.query.status||0),s.value.status==-1&&(s.value.status=null)),v.query.date){const a=v.query.date.split(","),t=new Date(a[0]),c=new Date(a[1]);s.value.date=[t,c],s.value.status=null}v.query.hall&&(s.value.hall=[parseInt(v.query.hall||0)],s.value.status=null),v.query.event_type&&(s.value.event_type=[v.query.event_type],s.value.status=null),de.fetchItems({per_page:1e3}).then(a=>{F.value=a.data.data}),Q(),x(),ye()});const I=u(!1);u(!1);const G=u(null),T=u(!1),R=u(100),P=u(2),E=u(2),C=u(0),me=u(!1),j=u("");u(["primary","secondary","error","success","warning"]);const k=u([{key:"event_date",order:"ASC"}]);u(0);const s=u({search:null,date:null,event_type:null,status:d.statuses.validated}),w=u({itemsPerPage:100,rowsPerPage:100,page:1,sortDesc:[!0],sortBy:[{key:"event_date",order:"ASC"}]}),pe=u(-1),J=u({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});u({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});const M=u(!1),q=u([{title:r("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:r("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:r("Email"),align:"start",key:"customer.email",sortable:!1},{title:r("Téléphone"),align:"start",key:"customer.phone",sortable:!1},{title:r("Prest"),align:"start",key:"event_type"},{title:r("Date de la prestation"),align:"start",key:"event_date"},{title:r("La réception se déroulera plutôt"),key:"reception_period"},{title:r("Heure"),key:"reception_start_time"},{title:r("Lieu"),key:"demand.event_location"},{title:r("Convives"),key:"demand.number_people"},{title:r("En attente de règlement"),align:"start",key:"amount_left",sortable:!1},{title:r("Montant total"),align:"start",key:"services_sum_total",sortable:!1},{title:r("Actions"),key:"actions",sortable:!1}]),B=u([{title:r("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:r("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:r("Email"),align:"start",key:"customer.email",sortable:!1},{title:r("Tél."),align:"start",key:"customer.phone",sortable:!1},{title:r("Prest."),align:"start",key:"event_type"},{title:r("Date prest."),align:"start",key:"event_date"},{title:r("Moment"),key:"reception_period"},{title:r("Heure"),key:"reception_start_time"},{title:r("Con."),key:"demand.number_people"},{title:r("Salle"),key:"hall"},{title:r("Reste à payer"),align:"start",key:"amount_left",sortable:!1},{title:r("Montant total"),align:"start",key:"services_sum_total",sortable:!1},{title:r("Actions"),key:"actions",sortable:!1}]),ve=D(()=>v.params.status),X=D(()=>s.value.date&&s.value.date.length>0?V.format(s.value.date[0],"shortDate")+" - "+V.format(s.value.date[s.value.date.length-1],"shortDate"):null);Y(ve,(a,t)=>{a!=t&&(Q(),x())},{deep:!0}),D(()=>d.items.data.filter(a=>a.email.toLowerCase().includes(j.value.toLowerCase())));function ce(){d.deleteItem(J.value.id);const a=p.value.findIndex(t=>t.id==J.value.id);p.value.splice(a,1),M.value=!1,ne.showSuccess(r("Utilisateur supprimé avec succès"))}const Z=u({id:null,prestation_id:null,amount:0});D(()=>pe.value===-1?"Nouvel administrateur":"Modifier l’administrateur");const fe=D(()=>s.value.date&&s.value.date.length?s.value.date.length>1?[V.format(s.value.date[0],"shortDate"),V.format(s.value.date[s.value.date.length-1],"shortDate")]:[V.format(s.value.date[0],"shortDate"),V.format(s.value.date[0],"shortDate")]:null);function Q(){switch(g.value=[{text:r("Dashboard"),disabled:!1,href:"/"}],p.value=[],C.value=0,q.value=B.value,v.params.status){case"started":m.value={title:r("Prestations en attente de validation")},g.value.push({text:m.value.title,disabled:!0,href:"#"}),h.value=d.statuses.started,q.value=B.value.filter(a=>a.key!="services_sum_total"&&a.key!="amount_left");break;case"validated":m.value={title:r("Prestations validées")},g.value.push({text:m.value.title,disabled:!0,href:"#"}),h.value=d.statuses.validated,q.value=B.value;break;case"processing":m.value={title:r("Prestations en cours")},g.value.push({text:m.value.title,disabled:!0,href:"#"}),h.value=d.statuses.processing;break;case"closed":m.value={title:r("Prestations clôturées")},g.value.push({text:m.value.title,disabled:!0,href:"#"}),h.value=d.statuses.closed;break;case"cancelled":m.value={title:r("Prestations annulées")},g.value.push({text:m.value.title,disabled:!0,href:"#"}),h.value=d.statuses.cancelled;break;default:m.value={title:`${r("Prestations")}`},g.value.push({text:m.value.title,disabled:!0,href:"#"}),h.value=d.statuses.started;break}}function x(){try{clearTimeout(G.value)}catch{}G.value=setTimeout(()=>{I.value=!0;let a="id",t="desc";console.log(k.value),k.value.length>0&&(a=k.value[0].key,t=k.value[0].order),d.fetchItems({term:j.value,paginate:R.value,current_page:P.value,status:h.value,direction:t,order_by:a,page:w.value.page,per_page:w.value.itemsPerPage,...s.value,date:fe.value}).then(c=>{if(c.data){const{data:e,current_page:n,next_page_url:_,total:W,per_page:ge,to:Ge,last_page:he}=c.data;p.value=e,E.value=he,C.value=W}}).catch(c=>{console.error(c)}).then(()=>{I.value=!1})},1e3)}function ye(){ie.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(a=>{if(a.data){const{data:t,current_page:c,next_page_url:e,total:n,per_page:_,to:W,last_page:ge}=a.data;O.value=t}}).catch(a=>{console.error(a)}).then(()=>{I.value=!1})}return Y([j,w,s],()=>{x()},{deep:!0}),xe(()=>{P.value>E.value&&(P.value=E.value)}),(a,t)=>{const c=De("EyeIcon");return $(),N(Se,null,[o(Ae,{title:`${m.value.title}(${C.value})`,breadcrumbs:g.value},null,8,["title","breadcrumbs"]),o(le,null,{default:l(()=>[o(b,{cols:"12"},{default:l(()=>[o(Me,{class:"border rounded-md",headers:q.value,loading:I.value,items:p.value,"multi-sort":!1,"items-per-page":R.value,"onUpdate:itemsPerPage":t[15]||(t[15]=e=>R.value=e),"items-per-page-text":a.$t("Articles par page"),options:w.value,"onUpdate:options":t[16]||(t[16]=e=>w.value=e),"sort-by":k.value,"onUpdate:sortBy":t[17]||(t[17]=e=>k.value=e),page:P.value,"onUpdate:page":t[18]||(t[18]=e=>P.value=e),"items-length":C.value,"onUpdate:itemsLength":t[19]||(t[19]=e=>C.value=e),"show-select":!1,"loading-text":a.$t("Chargement des éléments"),"no-data-text":a.$t("Pas de données"),"no-results-text":a.$t("Aucun résultat"),onPageCount:t[20]||(t[20]=e=>E.value=e)},{top:l(()=>[o(qe,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:l(()=>[o(le,null,{default:l(()=>[o(b,null,{default:l(()=>[o(se,{density:"compact",modelValue:s.value.search,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value.search=e),placeholder:a.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),o(b,null,{default:l(()=>[o(L,{density:"compact",modelValue:s.value.event_type,"onUpdate:modelValue":t[1]||(t[1]=e=>s.value.event_type=e),placeholder:a.$t("Prestation"),items:O.value,"item-value":"name","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),o(b,null,{default:l(()=>[o(L,{density:"compact",modelValue:s.value.hall,"onUpdate:modelValue":t[2]||(t[2]=e=>s.value.hall=e),placeholder:a.$t("Salle"),items:F.value,"item-value":"id","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),o(b,null,{default:l(()=>[o(L,{density:"compact",modelValue:s.value.payment_status,"onUpdate:modelValue":t[3]||(t[3]=e=>s.value.payment_status=e),placeholder:a.$t("Reste à payer"),items:[{id:"waiting",label:a.$t("En attente")},{id:"completed",label:a.$t("Soldé")}],"item-value":"id","item-title":"label","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),o(b,null,{default:l(()=>[o(L,{density:"compact",modelValue:s.value.status,"onUpdate:modelValue":t[4]||(t[4]=e=>s.value.status=e),placeholder:a.$t("Statut"),items:f(d).statusesList,"item-value":"id","item-title":"label",clearable:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","items"])]),_:1}),o(b,null,{default:l(()=>[o(oe,{ref_key:"dialog",ref:me,modelValue:T.value,"onUpdate:modelValue":t[10]||(t[10]=e=>T.value=e),"return-value":s.value.date,"onUpdate:returnValue":t[11]||(t[11]=e=>s.value.date=e),persistent:"",width:"290px"},{activator:l(({props:e})=>[o(se,Ue({modelValue:X.value,"onUpdate:modelValue":t[5]||(t[5]=n=>X.value=n),"prepend-inner-icon":"bx-calendar",readonly:""},e,{density:"compact",placeholder:a.$t("Date"),"hide-details":"",variant:"solo",flat:"",clearable:"","onClick:clear":t[6]||(t[6]=n=>s.value.date=null)}),null,16,["modelValue","placeholder"])]),default:l(({isActive:e})=>[o(Le,{locale:"fr"},{default:l(()=>[o(Re,{modelValue:s.value.date,"onUpdate:modelValue":t[9]||(t[9]=n=>s.value.date=n),"hide-header":"",multiple:"range"},{actions:l(()=>[o(U,{color:"primary",onClick:t[7]||(t[7]=n=>T.value=!1)},{default:l(()=>[y(i(a.$t("Annuler")),1)]),_:1}),o(K),o(U,{variant:"elevated",color:"primary",onClick:t[8]||(t[8]=n=>T.value=!1)},{default:l(()=>[y(i(a.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1}),o(oe,{modelValue:M.value,"onUpdate:modelValue":t[13]||(t[13]=e=>M.value=e),"max-width":"500px"},{default:l(()=>[o(je,null,{default:l(()=>[o(Be,{class:"text-h5 text-center py-6"},{default:l(()=>[y(i(a.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),o(Ne,null,{default:l(()=>[o(K),o(U,{color:"error",variant:"flat",dark:"",onClick:t[12]||(t[12]=e=>M.value=!1)},{default:l(()=>[y(i(a.$t("Annuler")),1)]),_:1}),o(U,{color:"success",variant:"flat",dark:"",onClick:ce},{default:l(()=>[y(i(a.$t("OK")),1)]),_:1}),o(K)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.customer.firstname":l(({item:e})=>[S("span",{class:"cursor-pointer",onClick:n=>a.$router.push("/prestations/"+e.id)},i(e.customer?e.customer.firstname:""),9,ze)]),"item.customer.lastname":l(({item:e})=>[S("span",{class:"cursor-pointer",onClick:n=>a.$router.push("/prestations/"+e.id)},i(e.customer?e.customer.lastname:""),9,He)]),"item.customer.email":l(({item:e})=>[o(ue,{text:e.customer.email},{activator:l(({props:n})=>[S("span",ee(te(n)),i(!e.customer||e.customer.email==null||e.customer.email.length<7?e.customer.email:`${e.customer.email.replace(`
`," ").slice(0,6)}...`),17)]),_:2},1032,["text"])]),"item.demand_date":l(({item:e})=>[y(i(f(ae)(e.demand_date)),1)]),"item.event_date":l(({item:e})=>[y(i(f(ae)(e.event_date)),1)]),"item.event_type":l(({item:e})=>[o(ue,{text:e.event_type},{activator:l(({props:n})=>[S("span",ee(te(n)),i(e.event_type==null||e.event_type.length<10?e.event_type:`${e.event_type.replace(`
`," ").slice(0,9)}...`),17)]),_:2},1032,["text"])]),"item.amount_left":l(({index:e,item:n})=>[Math.max(n.services_sum_total-n.payments_sum_amount,0)>0?($(),z(Ie,{key:0,modelValue:Z.value,"onUpdate:modelValue":t[14]||(t[14]=_=>Z.value=_),prestation:p.value[e],"onUpdate:item":x,"button-text":a.$t("Ajouter un paiement"),title:a.$t("Ajouter un paiement"),variant:"text"},{default:l(()=>[Math.max(n.services_sum_total-n.payments_sum_amount,0)>0?($(),N("span",Ke,i(f(H)(Math.max(n.services_sum_total-n.payments_sum_amount,0))),1)):A("",!0)]),_:2},1032,["modelValue","prestation","button-text","title"])):A("",!0)]),"item.services_sum_total":l(({item:e})=>[o(re,{variant:"tonal",color:Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?"error":"success",class:"font-weight-bold"},{default:l(()=>[y(i(f(H)(e.payments_sum_amount||0))+" / "+i(f(H)(e.services_sum_total||0)),1)]),_:2},1032,["color"])]),"item.status":l(({item:e})=>[o(re,{color:f(d).statusColor(e.status),size:"small",label:""},{default:l(()=>[y(i(f(d).statusText(e.status)),1)]),_:2},1032,["color"])]),"item.hall":l(({index:e,item:n})=>[n.hall?($(),N("span",Oe,i(n.hall.name),1)):A("",!0),n.hall?A("",!0):($(),z(Te,{key:1,modelValue:p.value[e],"onUpdate:modelValue":_=>p.value[e]=_,"show-demand-info":""},null,8,["modelValue","onUpdate:modelValue"]))]),"item.actions":l(({index:e,item:n})=>[n.status==f(d).statuses.validated?($(),z(Ee,{key:0,onRefresh:x,modelValue:p.value[e],"onUpdate:modelValue":_=>p.value[e]=_,icon:""},null,8,["modelValue","onUpdate:modelValue"])):A("",!0),o(U,{icon:"",flat:"",density:"compact",class:"mx-2",to:"/prestations/"+n.id},{default:l(()=>[o(c,{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1032,["to"])]),"no-data":l(()=>[S("span",null,i(a.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64)}}});export{_t as default};
