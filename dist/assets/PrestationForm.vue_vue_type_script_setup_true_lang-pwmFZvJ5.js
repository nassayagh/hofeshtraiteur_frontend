import{a6 as re,av as de,e as h,r as s,aD as S,Z as $e,o as C,_ as M,w as a,b as e,d as c,t as v,a4 as le,n as H,V as _,aC as he,h as ke,g as Ce,ba as je,c as oe,q as Ne,$ as Be,a as ye,a8 as q,X as Le}from"./index-BjFWTEr_.js";import{u as se}from"./Controller-BM4W5AOG.js";import{b as ie,V as me,c as ve,a as fe}from"./VCard-Ds3PvDnC.js";import{g as ne,i as F,d as ze,b as qe}from"./VSpacer-zVSMWsYI.js";import{a as pe,V as g}from"./VRow-CeV0ez7H.js";import{V as G}from"./VDialog-suZyWcBK.js";import{u as He}from"./paymentMethod-D59Q9bgV.js";import{a as De}from"./formatters-DCCWVJxZ.js";import{V as ue}from"./VAutocomplete-DDFPuflg.js";import{V as E}from"./VTextField-CWkQ8t64.js";import{V as Se}from"./VLocaleProvider-eWe5UfUW.js";import{V as Pe}from"./VDatePicker-Cd8bpmXq.js";import{u as Ke,S as Re,_ as Xe,E as Ze}from"./EditorMenubar-PVE4sB2i.js";import{u as xe}from"./eventType-BiPypW0S.js";import{u as Ge}from"./customers-CMuiMTIa.js";import{u as Je}from"./hall-Dq7HmS3W.js";import{a as be}from"./BaseBreadcrumb-SFhi0e60.js";import{r as _e}from"./validators-BPi-vT8z.js";import{F as Qe,V as We}from"./vee-validate.esm-D2e16B8d.js";import{V as Ye}from"./VAvatar-XjD8XNVT.js";import{V as ea}from"./VContainer-yHGJ-PEc.js";const Da=re({__name:"ClosePrestation",props:{modelValue:Object,icon:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(V,{emit:K}){const P=se(),A=de(),R=V,j=K,b=h({get:()=>R.modelValue,set:f=>j("update:modelValue",f)}),w=s(!1),U=s(!1);s(""),h(()=>`${S("Terminer la prestation")}`);function n(){U.value=!0,P.closeItem(b.value.id).then(f=>{b.value=f.data,w.value=!1,A.showSuccess(S("Prestation clôturée avec succès")),j("refresh")}).catch(f=>{U.value=!1,A.showError(f.message)}).then(()=>{U.value=!1})}return(f,y)=>{const k=$e("CheckIcon");return C(),M(G,{modelValue:w.value,"onUpdate:modelValue":y[2]||(y[2]=$=>w.value=$),"max-width":"500px"},{activator:a(({props:$})=>[e(_,H({dark:""},$,{variant:"elevated",color:"primary",onClick:y[0]||(y[0]=N=>U.value=!1),icon:V.icon}),{default:a(()=>[c(v(V.icon?"":f.$t("Terminer la prestation"))+" ",1),V.icon?(C(),M(k,{key:0,"stroke-width":"1.5",size:"20"})):le("",!0)]),_:2},1040,["icon"])]),default:a(()=>[e(fe,null,{default:a(()=>[e(ie,{class:"text-h5 text-center py-6"},{default:a(()=>[c(v(f.$t("Terminer la prestation")),1)]),_:1}),e(ne),e(me,null,{default:a(()=>[e(pe,null,{default:a(()=>[e(g,{cols:"12",class:"text-center"},{default:a(()=>[c(v(f.$t("Êtes-vous sûr de vouloir terminer la prestation?")),1)]),_:1})]),_:1})]),_:1}),e(ne),e(ve,null,{default:a(()=>[e(F),e(_,{color:"error",variant:"flat",dark:"",onClick:y[1]||(y[1]=$=>w.value=!1)},{default:a(()=>[c(v(f.$t("Non")),1)]),_:1}),e(_,{color:"success",variant:"flat",loading:U.value,dark:"",onClick:n},{default:a(()=>[c(v(f.$t("Oui")),1)]),_:1},8,["loading"]),e(F)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),aa={key:1},Sa=re({__name:"PaymentForm",props:{modelValue:Object,prestation:Object,title:S("PaymentMethod"),variant:{type:String,default:"elevated"},density:{type:String,default:"default"},classes:{type:String,default:""},buttonText:S("Ajouter un paymentMethod")},emits:["update:modelValue","update:item"],setup(V,{emit:K}){const P=se(),A=de(),R=He(),j=he(),b=V,w=K,U=h({get:()=>b.modelValue,set:d=>w("update:modelValue",d)}),n=s(U.value||{id:null,prestation_id:null,amount:0,payment_date:new Date}),f=s(!1),y=s(!1),k=s(!1),$=s([]);ke(()=>{R.fetchItems({per_page:500}).then(d=>{$.value=d.data.data,console.log($.value)}),n.value.id||(n.value.amount=I.value)});const N=h(()=>b.prestation.services?b.prestation.services.reduce((d,u)=>(console.log(u.total,d),parseFloat(u.total)+parseFloat(d)),0):0),I=h(()=>b.prestation.payments&&b.prestation.payments.length?N.value-b.prestation.payments.reduce((d,u)=>parseFloat(u.amount)+parseFloat(d),0):N.value);function O(){k.value=!0,P.savePayment(b.prestation.id,{...n.value,payment_date:B.value}).then(d=>{f.value=!1,w("update:item",d.data),A.showSuccess(S("Paiement enregistré avec succès"))}).catch(d=>{k.value=!1,A.showError(d.message)}).then(()=>{k.value=!1})}function J(d){if(console.log(I.value),d){const u=$.value.find(L=>L.id==d);u&&(n.value.payment_method=u.name||null,n.value.id||(n.value.amount=I.value))}}const B=h(()=>n.value.payment_date?j.format(n.value.payment_date,"shortDate"):null),Q=h(()=>n.value.payment_date?De(n.value.payment_date):null);function X(){k.value=!1,n.value.id||(n.value={payment_date:new Date,amount:I.value})}return Ce([b.prestation],d=>{console.log("prestat",d),n.value.id||(n.value.amount=I.value)},{deep:!0}),(d,u)=>{const L=$e("EditIcon");return C(),M(G,{modelValue:f.value,"onUpdate:modelValue":u[10]||(u[10]=m=>f.value=m),"max-width":"500px"},{activator:a(({props:m})=>[e(_,H({dark:""},m,{icon:n.value.id!=null,flat:n.value.id!=null,variant:V.variant,density:V.density,color:n.value.id!=null?null:"primary",class:V.classes,onClick:X}),{default:a(()=>[je(d.$slots,"default",{},()=>[n.value.id?(C(),M(L,{key:0,"stroke-width":"1.5",size:"20",class:"text-primary"})):(C(),oe("span",aa,v(V.buttonText),1))])]),_:2},1040,["icon","flat","variant","density","color","class"])]),default:a(()=>[e(fe,null,{default:a(()=>[e(ie,{class:"text-h5 text-center py-6"},{default:a(()=>[c(v(V.title),1)]),_:1}),e(ne),e(me,null,{default:a(()=>[e(pe,null,{default:a(()=>[e(g,{cols:"12"},{default:a(()=>[e(ue,{modelValue:n.value.payment_method_id,"onUpdate:modelValue":[u[0]||(u[0]=m=>n.value.payment_method_id=m),J],label:d.$t("PaymentMethod"),clearable:"",items:$.value,"item-title":"name","item-value":"id",filled:!1,variant:"outlined",required:""},null,8,["modelValue","label","items"])]),_:1}),e(g,{cols:"12",md:"6"},{default:a(()=>[e(G,{ref:"dialogDemandDate",modelValue:y.value,"onUpdate:modelValue":u[6]||(u[6]=m=>y.value=m),"return-value":n.value.payment_date,"onUpdate:returnValue":u[7]||(u[7]=m=>n.value.payment_date=m),persistent:"",width:"290px"},{activator:a(({props:m})=>[e(E,H({modelValue:Q.value,"onUpdate:modelValue":u[1]||(u[1]=T=>Q.value=T)},m,{placeholder:d.$t("Date de la demande"),"hide-details":"",clearable:"",readonly:"","onClick:clear":u[2]||(u[2]=T=>n.value.payment_date=null)}),null,16,["modelValue","placeholder"])]),default:a(({isActive:m})=>[e(Se,{locale:"fr"},{default:a(()=>[e(Pe,{modelValue:n.value.payment_date,"onUpdate:modelValue":u[5]||(u[5]=T=>n.value.payment_date=T),"hide-header":""},{actions:a(()=>[e(_,{color:"primary",onClick:u[3]||(u[3]=T=>y.value=!1)},{default:a(()=>[c(v(d.$t("Annuler")),1)]),_:1}),e(F),e(_,{variant:"elevated",color:"primary",onClick:u[4]||(u[4]=T=>y.value=!1)},{default:a(()=>[c(v(d.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),e(g,{cols:"12",md:"6"},{default:a(()=>[e(E,{min:0,modelValue:n.value.amount,"onUpdate:modelValue":u[8]||(u[8]=m=>n.value.amount=m),type:"number",label:d.$t("Montant")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),e(ve,null,{default:a(()=>[e(F),e(_,{color:"error",variant:"flat",dark:"",onClick:u[9]||(u[9]=m=>f.value=!1)},{default:a(()=>[c(v(d.$t("Annuler")),1)]),_:1}),e(_,{color:"success",variant:"flat",loading:k.value,dark:"",onClick:O},{default:a(()=>[c(v(d.$t("Ajouter")),1)]),_:1},8,["loading"]),e(F)]),_:1})]),_:1})]),_:3},8,["modelValue"])}}}),ta={class:"text-h5"},la={key:0,class:"mt-2"},Pa=re({__name:"PrestationForm",props:{modelValue:Object,isNew:{type:Boolean,default:!0},showCustomer:{type:Boolean,default:!1},title:S("Service"),buttonText:{type:String,default:S("Modifier La Prestation")}},emits:["update:modelValue","update:item"],setup(V,{emit:K}){const P=he(),A=s(),R=de(),j=xe(),b=Ge(),w=Je(),U=V,n=K,f=s([]),y=s([]),k=s([]),$=s([]),N=se();ke(()=>{ge(),Ie(),w.fetchItems({per_page:1e3}).then(l=>{$.value=l.data.data})});const I=s(!1),O=s(!1),J=s(null),B=s(!1),Q=s(100),X=s(2),d=s(2),u=s(0),L=s(!1),m=s(!1),T=s(""),W=s([{key:"event_date",order:"ASC"}]),D=s({search:null,status:null,date:null,event_type:null}),ee=s({itemsPerPage:100,rowsPerPage:100,page:1,sortDesc:[!0],sortBy:[{key:"event_date",order:"ASC"}]});s(-1);const o=h({get:()=>U.modelValue||{id:null,customer:{}},set:l=>n("update:modelValue",l)}),ae=Ke({extensions:[Re],content:o.value.comment}),we=h(()=>o.value.event_date?P.format(o.value.event_date,"shortDate"):null),ce=h(()=>o.value.event_date?De(o.value.event_date):null);function Ue(){m.value=!1}function Te(l,{setErrors:t}){var i;console.log(o.value),(i=A.value)==null||i.validate().then(({valid:z})=>{var r;z&&(O.value=!0,N.addItem({...o.value,event_date:we.value,comment:(r=ae.value)==null?void 0:r.getHTML()}).then(p=>{if(p.data.error){t({apiError:p.data.message});return}const Z=p.data.event_date!=null?new Date(p.data.event_date):null,Y={...p.data,event_date:Z};n("saved",Y),O.value=!1,m.value=!1,R.showSuccess(S("Prestation enregistrée avec succès")),ge(),Ve()}).catch(p=>{O.value=!1,t({apiError:p})}).then(()=>{O.value=!1,t({apiError:null})}))})}const Ee=h(()=>o.value.id==null?"Nouvelle prestation":"Modifier la prestation"),Ae=h(()=>D.value.date&&D.value.date.length?D.value.date.length>1?[P.format(D.value.date[0],"shortDate"),P.format(D.value.date[D.value.date.length-1],"shortDate")]:[P.format(D.value.date[0],"shortDate"),P.format(D.value.date[0],"shortDate")]:null);function Ve(){try{clearTimeout(J.value)}catch{}J.value=setTimeout(()=>{I.value=!0;let l="id",t="desc";console.log(W.value),W.value.length>0&&(l=W.value[0].key,t=W.value[0].order),N.fetchItems({term:T.value,paginate:Q.value,current_page:X.value,direction:t,order_by:l,page:ee.value.page,per_page:ee.value.itemsPerPage,...D.value,date:Ae.value}).then(i=>{if(i.data){const{data:z,current_page:r,next_page_url:p,total:Z,per_page:Y,to:x,last_page:Fe}=i.data;f.value=z.map(te=>{const Oe=te.event_date!=null?new Date(te.event_date):null;return{...te,event_date:Oe}}),d.value=Fe,u.value=Z}}).catch(i=>{console.error(i)}).then(()=>{I.value=!1})},1e3)}function ge(){j.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(l=>{if(l.data){const{data:t,current_page:i,next_page_url:z,total:r,per_page:p,to:Z,last_page:Y}=l.data;y.value=t}}).catch(l=>{console.error(l)}).then(()=>{})}function Ie(){b.fetchItems({term:"",paginate:5e3,current_page:1,direction:"asc",order_by:"firstname",page:1,per_page:5e3}).then(l=>{if(l.data){const{data:t,current_page:i,next_page_url:z,total:r,per_page:p,to:Z,last_page:Y}=l.data;k.value=t.map(x=>({...x,name:x.firstname+" "+x.lastname+" ("+(x.is_customer?S("Client"):S("Prospect"))+")"}))}}).catch(l=>{console.error(l)}).then(()=>{})}Ce([T,ee,D],()=>{Ve()},{deep:!0}),Ne(()=>{X.value>d.value&&(X.value=d.value)});function Me(l){if(l){const t=k.value.find(i=>i.id==l);t&&(o.value.customer=t)}}return(l,t)=>(C(),M(G,{modelValue:m.value,"onUpdate:modelValue":t[18]||(t[18]=i=>m.value=i),"max-width":"1000px"},{activator:a(({props:i})=>[V.isNew?(C(),M(_,H({key:0,color:"primary",class:"align-self-end float-end mx-2",variant:"flat",dark:""},i),{default:a(()=>[c(v(V.buttonText),1)]),_:2},1040)):(C(),M(ze,H({key:1,value:"action","hide-details":"","min-height":"38"},i),{default:a(()=>[e(qe,null,{default:a(()=>[e(Ye,{size:"20",class:"mr-2"},{default:a(()=>[(C(),M(Be("EditIcon"),{"stroke-width":"2",size:"20"}))]),_:1}),c(" "+v(l.$t("Modifier")),1)]),_:1})]),_:2},1040))]),default:a(()=>[e(fe,null,{default:a(()=>[e(ie,{class:"pa-4 bg-secondary"},{default:a(()=>[ye("span",ta,v(Ee.value),1)]),_:1}),e(q(Qe),{ref_key:"refForm",ref:A,modelValue:L.value,"onUpdate:modelValue":t[17]||(t[17]=i=>L.value=i),onSubmit:Te},{default:a(({errors:i,isSubmitting:z})=>[e(me,null,{default:a(()=>[e(ea,{class:"px-0"},{default:a(()=>[e(pe,null,{default:a(()=>[V.showCustomer?(C(),oe(Le,{key:0},[e(g,{cols:"12"},{default:a(()=>[e(ue,{modelValue:o.value.customer_id,"onUpdate:modelValue":[t[0]||(t[0]=r=>o.value.customer_id=r),Me],placeholder:l.$t("Client"),label:l.$t("Client"),items:k.value,"item-value":"id","item-title":"name",clearable:"","hide-details":"",variant:"outlined"},null,8,["modelValue","placeholder","label","items"])]),_:1}),e(g,{cols:"12",md:"6"},{default:a(()=>[e(E,{modelValue:o.value.customer.firstname,"onUpdate:modelValue":t[1]||(t[1]=r=>o.value.customer.firstname=r),rules:[q(_e)],label:l.$t("Prénom")},null,8,["modelValue","rules","label"])]),_:1}),e(g,{cols:"12",md:"6"},{default:a(()=>[e(E,{modelValue:o.value.customer.lastname,"onUpdate:modelValue":t[2]||(t[2]=r=>o.value.customer.lastname=r),rules:[q(_e)],label:l.$t("Nom")},null,8,["modelValue","rules","label"])]),_:1}),e(g,{cols:"12",md:"6"},{default:a(()=>[e(E,{modelValue:o.value.customer.email,"onUpdate:modelValue":t[3]||(t[3]=r=>o.value.customer.email=r),label:l.$t("Email")},null,8,["modelValue","label"])]),_:1}),e(g,{cols:"12",md:"6"},{default:a(()=>[e(E,{modelValue:o.value.customer.phone,"onUpdate:modelValue":t[4]||(t[4]=r=>o.value.customer.phone=r),label:l.$t("Téléphone")},null,8,["modelValue","label"])]),_:1})],64)):le("",!0),e(g,{cols:"12",md:"6"},{default:a(()=>[e(ue,{modelValue:o.value.event_type_id,"onUpdate:modelValue":t[5]||(t[5]=r=>o.value.event_type_id=r),placeholder:l.$t("Type d'événement"),items:y.value,"item-value":"id","item-title":"name",clearable:"","hide-details":"",variant:"outlined"},null,8,["modelValue","placeholder","items"])]),_:1}),e(g,{cols:"12",md:"6"},{default:a(()=>[e(G,{ref:"dialogDemandDate",modelValue:B.value,"onUpdate:modelValue":t[11]||(t[11]=r=>B.value=r),"return-value":o.value.event_date,"onUpdate:returnValue":t[12]||(t[12]=r=>o.value.event_date=r),persistent:"",width:"290px"},{activator:a(({props:r})=>[e(E,H({modelValue:ce.value,"onUpdate:modelValue":t[6]||(t[6]=p=>ce.value=p),"prepend-inner-icon":"bx-calendar"},r,{placeholder:l.$t("Date de l'évènement"),"hide-details":"",clearable:"",readonly:"","onClick:clear":t[7]||(t[7]=p=>o.value.event_date=null)}),null,16,["modelValue","placeholder"])]),default:a(({isActive:r})=>[e(Se,{locale:"fr"},{default:a(()=>[e(Pe,{modelValue:o.value.event_date,"onUpdate:modelValue":t[10]||(t[10]=p=>o.value.event_date=p),"hide-header":""},{actions:a(()=>[e(_,{color:"primary",onClick:t[8]||(t[8]=p=>B.value=!1)},{default:a(()=>[c(v(l.$t("Annuler")),1)]),_:1}),e(F),e(_,{variant:"elevated",color:"primary",onClick:t[9]||(t[9]=p=>B.value=!1)},{default:a(()=>[c(v(l.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),e(g,{cols:"12",md:"6"},{default:a(()=>[e(be,{modelValue:o.value.reception_period,"onUpdate:modelValue":t[13]||(t[13]=r=>o.value.reception_period=r),"hide-details":"",items:[l.$t("En matiné"),l.$t("Le midi"),l.$t("En soirée")],label:l.$t("La réception se déroulera plutôt"),clearable:""},null,8,["modelValue","items","label"])]),_:1}),e(g,{cols:"12",md:"6"},{default:a(()=>[e(E,{modelValue:o.value.reception_start_time,"onUpdate:modelValue":t[14]||(t[14]=r=>o.value.reception_start_time=r),"hide-details":"",label:l.$t("Heure de réception"),clearable:""},null,8,["modelValue","label"])]),_:1}),e(g,{cols:"12",md:"6"},{default:a(()=>[e(be,{modelValue:o.value.hall_id,"onUpdate:modelValue":t[15]||(t[15]=r=>o.value.hall_id=r),items:$.value,"item-value":"id","item-title":"name",label:l.$t("Salle liée")},null,8,["modelValue","items","label"])]),_:1}),e(g,{cols:"12",md:"6"},{default:a(()=>[e(E,{modelValue:o.value.number_people,"onUpdate:modelValue":t[16]||(t[16]=r=>o.value.number_people=r),"hide-details":"",type:"number",label:l.$t("Nombre de convives")},null,8,["modelValue","label"])]),_:1}),e(g,{cols:"12"},{default:a(()=>[ye("label",null,v(l.$t("Commentaire")),1),e(Xe,{editor:q(ae)},null,8,["editor"]),e(q(Ze),{editor:q(ae)},null,8,["editor"])]),_:1})]),_:1}),i.apiError?(C(),oe("div",la,[e(We,{color:"error"},{default:a(()=>[c(v(i.apiError),1)]),_:2},1024)])):le("",!0)]),_:2},1024)]),_:2},1024),e(ve,null,{default:a(()=>[e(F),e(_,{color:"error",variant:"flat",dark:"",onClick:Ue},{default:a(()=>[c(v(l.$t("Annuler")),1)]),_:1}),e(_,{color:"success",variant:"flat",loading:O.value,type:"submit"},{default:a(()=>[c(v(l.$t("Sauvegarder")),1)]),_:1},8,["loading"]),e(F)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]))}});export{Sa as _,Pa as a,Da as b};
