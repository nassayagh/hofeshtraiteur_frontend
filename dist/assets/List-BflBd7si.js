import{u as ye}from"./demands-CLrZgVO3.js";import{u as ke}from"./eventType-CZMhoidC.js";import{u as be}from"./customers-Dz8ZtajH.js";import{u as $e}from"./hall-6z3V0lXB.js";import{_ as Ce}from"./BaseBreadcrumb-CaIIjwv5.js";import{a as P}from"./formatters-DCCWVJxZ.js";import{a6 as De,aC as Pe,r as o,av as Se,aD as u,h as we,e as _,g as Ue,q as Ie,Z as Te,o as f,c as Z,b as l,w as a,n as Ae,V as S,d as m,t as d,a4 as x,_ as w,a as h,ae as j,af as O,a8 as z,$ as J,X as xe}from"./index-CnqdZ6bH.js";import{_ as ze}from"./ValidateDemand.vue_vue_type_script_setup_true_lang-DBTKOM_4.js";import{_ as Le}from"./ChangeHall.vue_vue_type_script_setup_true_lang-C60gfyyb.js";import"./Controller-p4fNbWHW.js";import{_ as Q}from"./DemandForm.vue_vue_type_script_setup_true_lang-DoCBu6Iy.js";import{V as U,a as W}from"./VRow-DNBD6FjZ.js";import{V as Be}from"./VDataTableServer-C-0mgUQm.js";import{V as Ee}from"./VToolbar-BpcRSOOU.js";import{V as Y}from"./VTextField-BCk_q3zb.js";import{V as Ne}from"./VAutocomplete-BGq7kTXb.js";import{V as ee}from"./VDialog-lQkbc7Zg.js";import{V as Me}from"./VLocaleProvider-Dfy5JTur.js";import{V as je}from"./VDatePicker-fIXaz-qc.js";import{i as R,a as Oe,h as Re,f as Fe,d as te,b as ae}from"./VSpacer-CpZAU8TI.js";import{a as Ge,b as He,c as Ke}from"./VCard-BZmd4FKQ.js";import{V as F}from"./VTooltip-BTkdanM2.js";import{V as G}from"./VAvatar-DMdepK6E.js";import"./EditorMenubar-CCyD4SmZ.js";import"./validators-BPi-vT8z.js";import"./vee-validate.esm-nTMicVF0.js";import"./VContainer-nfGnC2is.js";import"./VSheet-Beb1Gt-6.js";const qe={key:0},Xe=["onClick"],Ze=["onClick"],Dt=De({__name:"List",setup(Je){const y=Pe();o();const le=Se(),oe=ke(),ne=be(),re=$e(),se=o({title:u("Gestion des demandes")}),ue=o([{text:u("Dashboard"),disabled:!1,href:"/"},{text:u("Gestion des demandes"),disabled:!0,href:"#"}]),i=o([]),H=o([]),de=o([]),ie=o([]),g=ye();we(()=>{C(),ge(),Ve(),re.fetchItems({per_page:1e3}).then(n=>{ie.value=n.data.data})}),o(!1);const L=o(!1);o(!1),o(!1),o(!1),o(!1),o(""),o(),o(!1);const K=o(null);o(null),o(null),o(null);const I=o(!1);o(!1),o();const B=o(100),k=o(2),T=o(2),A=o(0);o(!1),o(!1),o(null);const E=o("");o(["primary","secondary","error","success","warning"]);const V=o([{key:"event_date",order:"ASC"}]);o(0),o({total:0,validated:0,unvalidated:0});const s=o({search:null,status:null,date:null,event_type:null}),b=o({itemsPerPage:100,rowsPerPage:100,page:1,sortDesc:[!0],sortBy:[{key:"event_date",order:"ASC"}]}),me=o(-1),p=o({id:null,event_type_id:null,hall_id:null,customer:{}});o({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:"",customer:{}});const $=o(!1),pe=o([{title:"Act",key:"actions",sortable:!1},{title:u("ID"),align:"start",key:"id",sortable:!0},{title:u("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:u("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:u("Email"),align:"start",key:"customer.email",sortable:!1},{title:u("Tél."),align:"start",key:"customer.phone",sortable:!1},{title:u("Prest."),align:"start",key:"eventtype.name"},{title:u("Source"),align:"start",key:"source"},{title:u("Date 'évén"),key:"event_date"},{title:u("Moment"),key:"reception_period"},{title:u("Heure"),key:"reception_start_time"},{title:u("Lieu"),key:"event_location"},{title:u("Salle"),key:"hall.name"},{title:u("Conv"),key:"number_people"}]),q=_(()=>s.value.date&&s.value.date.length>0?P(s.value.date[0])+" - "+P(s.value.date[s.value.date.length-1]):null);_(()=>p.value.event_date?y.format(p.value.event_date,"shortDate"):null),_(()=>p.value.event_date?P(p.value.event_date):null),_(()=>g.demands.data.filter(n=>n.email.toLowerCase().includes(E.value.toLowerCase())));function ve(n,t){p.value=n,$.value=!0}function ce(){g.deleteItem(p.value.id);const n=i.value.findIndex(t=>t.id==p.value.id);i.value.splice(n,1),$.value=!1,le.showSuccess(u("Demande supprimée avec succès")),g.fetchStatistics()}_(()=>me.value===-1?"Nouvelle demande":"Modifier la demande");const fe=_(()=>s.value.date&&s.value.date.length?s.value.date.length>1?[y.format(s.value.date[0],"shortDate"),y.format(s.value.date[s.value.date.length-1],"shortDate")]:[y.format(s.value.date[0],"shortDate"),y.format(s.value.date[0],"shortDate")]:null);function C(){try{clearTimeout(K.value)}catch{}K.value=setTimeout(()=>{L.value=!0;let n="id",t="desc";console.log(V.value),V.value.length>0&&(n=V.value[0].key,t=V.value[0].order),g.fetchItems({term:E.value,paginate:B.value,current_page:k.value,direction:t,order_by:n,page:b.value.page,per_page:b.value.itemsPerPage,...s.value,date:fe.value}).then(c=>{if(c.data){const{data:e,current_page:r,next_page_url:v,total:N,per_page:X,to:D,last_page:_e}=c.data;i.value=e.map(M=>{const he=M.event_date!=null?new Date(M.event_date):null;return{...M,event_date:he}}),T.value=_e,A.value=N}}).catch(c=>{console.error(c)}).then(()=>{L.value=!1})},1e3)}function ge(){oe.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(n=>{if(n.data){const{data:t,current_page:c,next_page_url:e,total:r,per_page:v,to:N,last_page:X}=n.data;H.value=t}}).catch(n=>{console.error(n)}).then(()=>{})}function Ve(){ne.fetchItems({term:"",paginate:5e3,current_page:1,direction:"asc",order_by:"firstname",page:1,per_page:5e3}).then(n=>{if(n.data){const{data:t,current_page:c,next_page_url:e,total:r,per_page:v,to:N,last_page:X}=n.data;de.value=t.map(D=>({...D,name:D.firstname+" "+D.lastname+" ("+(D.is_customer?u("Client"):u("Prospect"))+")"}))}}).catch(n=>{console.error(n)}).then(()=>{})}return Ue([E,b,s],()=>{C()},{deep:!0}),Ie(()=>{k.value>T.value&&(k.value=T.value)}),(n,t)=>{const c=Te("DotsVerticalIcon");return f(),Z(xe,null,[l(Ce,{title:`${se.value.title}(${A.value})`,breadcrumbs:ue.value},null,8,["title","breadcrumbs"]),l(W,null,{default:a(()=>[l(U,{cols:"12"},{default:a(()=>[l(Be,{class:"border rounded-md",headers:pe.value,loading:L.value,items:i.value,"multi-sort":!1,"items-per-page":B.value,"onUpdate:itemsPerPage":t[12]||(t[12]=e=>B.value=e),"items-per-page-text":n.$t("Articles par page"),options:b.value,"onUpdate:options":t[13]||(t[13]=e=>b.value=e),"sort-by":V.value,"onUpdate:sortBy":t[14]||(t[14]=e=>V.value=e),page:k.value,"onUpdate:page":t[15]||(t[15]=e=>k.value=e),"items-length":A.value,"onUpdate:itemsLength":t[16]||(t[16]=e=>A.value=e),"show-select":!1,"loading-text":n.$t("Chargement des éléments"),"no-data-text":n.$t("Pas de données"),"no-results-text":n.$t("Aucun résultat"),onPageCount:t[17]||(t[17]=e=>T.value=e)},{top:a(()=>[l(Ee,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:a(()=>[l(W,null,{default:a(()=>[l(U,null,{default:a(()=>[l(Y,{density:"compact",modelValue:s.value.search,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value.search=e),placeholder:n.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),l(U,null,{default:a(()=>[l(Ne,{density:"compact",modelValue:s.value.event_type_id,"onUpdate:modelValue":t[1]||(t[1]=e=>s.value.event_type_id=e),placeholder:n.$t("Prestation"),label:n.$t("Prestation"),items:H.value,"item-value":"id","item-title":"name",clearable:"",multiple:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","label","items"])]),_:1}),l(U,null,{default:a(()=>[l(ee,{ref:"dialog",modelValue:I.value,"onUpdate:modelValue":t[7]||(t[7]=e=>I.value=e),"return-value":s.value.date,"onUpdate:returnValue":t[8]||(t[8]=e=>s.value.date=e),persistent:"",width:"290px"},{activator:a(({props:e})=>[l(Y,Ae({modelValue:q.value,"onUpdate:modelValue":t[2]||(t[2]=r=>q.value=r),"prepend-inner-icon":"bx-calendar"},e,{density:"compact",placeholder:n.$t("Date"),label:n.$t("Date"),"hide-details":"",variant:"solo",clearable:"",readonly:"","onClick:clear":t[3]||(t[3]=r=>s.value.date=null)}),null,16,["modelValue","placeholder","label"])]),default:a(({isActive:e})=>[l(Me,{locale:"fr"},{default:a(()=>[l(je,{modelValue:s.value.date,"onUpdate:modelValue":t[6]||(t[6]=r=>s.value.date=r),"hide-header":"",multiple:"range"},{actions:a(()=>[l(S,{color:"primary",onClick:t[4]||(t[4]=r=>I.value=!1)},{default:a(()=>[m(d(n.$t("Annuler")),1)]),_:1}),l(R),l(S,{variant:"elevated",color:"primary",onClick:t[5]||(t[5]=r=>I.value=!1)},{default:a(()=>[m(d(n.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),l(U,{class:""},{default:a(()=>[l(Q,{modelValue:p.value,"onUpdate:modelValue":t[9]||(t[9]=e=>p.value=e),onSaved:C},null,8,["modelValue"])]),_:1})]),_:1}),l(ee,{modelValue:$.value,"onUpdate:modelValue":t[11]||(t[11]=e=>$.value=e),"max-width":"500px"},{default:a(()=>[l(Ge,null,{default:a(()=>[l(He,{class:"text-h5 text-center py-6"},{default:a(()=>[m(d(n.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),l(Ke,null,{default:a(()=>[l(R),l(S,{color:"error",variant:"flat",dark:"",onClick:t[10]||(t[10]=e=>$.value=!1)},{default:a(()=>[m(d(n.$t("Annuler")),1)]),_:1}),l(S,{color:"success",variant:"flat",dark:"",onClick:ce},{default:a(()=>[m(d(n.$t("OK")),1)]),_:1}),l(R)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.hall.name":a(({index:e,item:r})=>[r.hall?(f(),Z("span",qe,d(r.hall.name),1)):x("",!0),r.hall?x("",!0):(f(),w(Le,{key:1,modelValue:i.value[e],"onUpdate:modelValue":v=>i.value[e]=v,"show-demand-info":"",type:"demand"},null,8,["modelValue","onUpdate:modelValue"]))]),"item.customer.firstname":a(({item:e})=>[h("span",{class:"cursor-pointer",onClick:r=>n.$router.push("/demands/"+e.id)},d(e.customer?e.customer.firstname:""),9,Xe)]),"item.customer.lastname":a(({item:e})=>[h("span",{class:"cursor-pointer",onClick:r=>n.$router.push("/demands/"+e.id)},d(e.customer?e.customer.lastname:""),9,Ze)]),"item.customer.email":a(({item:e})=>[l(F,{text:e.customer.email},{activator:a(({props:r})=>[h("span",j(O(r)),d(!e.customer||e.customer.email==null||e.customer.email.length<7?e.customer.email:`${e.customer.email.replace(`
`," ").slice(0,6)}...`),17)]),_:2},1032,["text"])]),"item.demand_date":a(({item:e})=>[m(d(z(P)(e.demand_date)),1)]),"item.event_date":a(({item:e})=>[m(d(z(P)(e.event_date)),1)]),"item.event_location":a(({item:e})=>[l(F,{text:e.event_location},{activator:a(({props:r})=>[h("span",j(O(r)),d(!e.event_location||e.event_location.length<10?e.event_location:`${e.event_location.slice(0,9)}...`),17)]),_:2},1032,["text"])]),"item.eventtype":a(({item:e})=>[e.eventtype?(f(),w(F,{key:0,text:e.eventtype?e.eventtype.name:""},{activator:a(({props:r})=>[h("span",j(O(r)),d(!e.eventtype.name||e.eventtype.name.length<10?e.eventtype.name:`${e.eventtype.name.slice(0,9)}...`),17)]),_:2},1032,["text"])):x("",!0)]),"item.status":a(({item:e})=>[l(Oe,{color:z(g).statusColor(e.status),size:"small",label:""},{default:a(()=>[m(d(z(g).statusText(e.status)),1)]),_:2},1032,["color"])]),"item.actions":a(({index:e,item:r})=>[l(S,{size:"30",icon:"",variant:"flat",class:"grey100"},{default:a(()=>[l(G,{size:"22"},{default:a(()=>[l(c,{size:"20",color:"grey100"})]),_:1}),l(Re,{activator:"parent","close-on-content-click":""},{default:a(()=>[l(Fe,null,{default:a(()=>[r.prestation?x("",!0):(f(),w(ze,{key:0,modelValue:i.value[e],"onUpdate:modelValue":v=>i.value[e]=v,onSaved:C},null,8,["modelValue","onUpdate:modelValue"])),l(Q,{modelValue:i.value[e],"onUpdate:modelValue":v=>i.value[e]=v,"is-new":!1,onSaved:C},null,8,["modelValue","onUpdate:modelValue"]),l(te,{value:"action","hide-details":"","min-height":"38",to:"/demands/"+r.id},{default:a(()=>[l(ae,null,{default:a(()=>[l(G,{size:"20",class:"mr-2"},{default:a(()=>[(f(),w(J("EyeIcon"),{"stroke-width":"2",size:"20"}))]),_:1}),m(" "+d(n.$t("Voir")),1)]),_:1})]),_:2},1032,["to"]),l(te,{value:"action","hide-details":"","min-height":"38",onClick:v=>ve(r,e)},{default:a(()=>[l(ae,null,{default:a(()=>[l(G,{size:"20",class:"mr-2"},{default:a(()=>[(f(),w(J("TrashIcon"),{"stroke-width":"2",size:"20"}))]),_:1}),m(" "+d(n.$t("Supprimer")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"no-data":a(()=>[h("span",null,d(n.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64)}}});export{Dt as default};
