import{u as O}from"./demands-Dy6BKoEP.js";import{a6 as F,av as G,e as P,r,o as d,_ as v,w as a,V as x,n as X,d as n,t,a4 as V,b as l,aD as $,a as s,a8 as h,aE as W,h as Y,g as Z,q as ee,c as A,aF as te,X as z,a5 as K}from"./index-CM0D4_qI.js";import{_ as ae,V as R}from"./BaseBreadcrumb-BTU6PUKi.js";import{a as L}from"./formatters-DCCWVJxZ.js";import{b as B,c as J,a as C,V as D,d as N}from"./VCard-SRqtCCz8.js";import{i as H,g as q,a as M}from"./VSpacer-D4AWtNAJ.js";import{V as Q}from"./VDialog-BmmbiiJ_.js";import{_ as le}from"./ValidateDemand.vue_vue_type_script_setup_true_lang-DLszj6Qv.js";import{u as se,S as oe,_ as ne,E as ue}from"./EditorMenubar-CkkChCsc.js";import{a as U,V as b}from"./VRow-B_5CRJ_N.js";import"./Controller-DzX8YMxl.js";import{_ as re}from"./HallWidget.vue_vue_type_script_setup_true_lang-DuLSNSEw.js";import{_ as de}from"./DemandForm.vue_vue_type_script_setup_true_lang-Ch5-PEYO.js";import"./VTextField-BfcsYLCK.js";import"./VAvatar-D1rEUekq.js";import"./hall-C7cB23wV.js";import"./ChangeHall.vue_vue_type_script_setup_true_lang-Cc1VtG6v.js";import"./VAutocomplete-gV03piQG.js";import"./vee-validate.esm-Cr45sfAl.js";import"./eventType-ClFPuv80.js";import"./customers-Dsj_DINc.js";import"./validators-BPi-vT8z.js";import"./VContainer-DXk4of46.js";import"./VLocaleProvider-CTK-iw_Q.js";import"./VDatePicker-DFxCwPFd.js";import"./VSheet-Cb2HEvpJ.js";const ie=F({__name:"CancelDemand",props:{modelValue:Object},emits:["update:modelValue"],setup(I,{emit:e}){const T=O(),w=G(),E=I,p=e,f=P({get:()=>E.modelValue,set:y=>p("update:modelValue",y)}),i=r(!1),_=r(!1);function k(){_.value=!0,T.cancelItem(f.value.id).then(y=>{f.value=y.data,i.value=!1,w.showSuccess($("Devis annulé avec succès"))}).then(()=>{_.value=!1})}return(y,m)=>(d(),v(Q,{modelValue:i.value,"onUpdate:modelValue":m[1]||(m[1]=c=>i.value=c),"max-width":"350px"},{activator:a(({props:c})=>[f.value.status==0?(d(),v(x,X({key:0,color:"error",class:"ml-3",variant:"outlined",dark:""},c),{default:a(()=>[n(t(y.$t("Annuler la demande")),1)]),_:2},1040)):V("",!0)]),default:a(()=>[l(C,null,{default:a(()=>[l(B,{class:"text-h5 text-center py-6"},{default:a(()=>[n(t(y.$t("Êtes-vous sûr de vouloir annuller la demande?")),1)]),_:1}),l(J,null,{default:a(()=>[l(H),l(x,{color:"error",variant:"flat",dark:"",onClick:m[0]||(m[0]=c=>i.value=!1)},{default:a(()=>[n(t(y.$t("Annuler")),1)]),_:1}),l(x,{color:"success",variant:"flat",loading:_.value,dark:"",onClick:k},{default:a(()=>[n(t(y.$t("OK")),1)]),_:1},8,["loading"]),l(H)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),me=F({__name:"CommentDemand",props:{modelValue:Object},emits:["update:modelValue"],setup(I,{emit:e}){const T=O(),w=G(),E=I,p=e,f=P({get:()=>E.modelValue,set:m=>p("update:modelValue",m)}),i=r(!1),_=r(!1);r(f.value.commentaire||"");const k=se({extensions:[oe],content:f.value.commentaire});P(()=>`${$("Commentaire")}`);function y(){var m;_.value=!0,T.addComment(f.value.id,(m=k.value)==null?void 0:m.getHTML()).then(c=>{f.value=c.data,i.value=!1,w.showSuccess($("Commentaire ajouté avec succès")),p("saved",c.data)}).catch(c=>{_.value=!1,w.showError(c.message)}).then(()=>{_.value=!1})}return(m,c)=>(d(),v(Q,{modelValue:i.value,"onUpdate:modelValue":c[2]||(c[2]=S=>i.value=S),"max-width":"1000px"},{activator:a(({props:S})=>[l(x,X({density:"compact",dark:""},S,{variant:"outlined",color:"primary",onClick:c[0]||(c[0]=j=>_.value=!1)}),{default:a(()=>[n(t(!f.value.commentaire||f.value.commentaire.length==0?m.$t("Ajouter"):m.$t("Modifier")),1)]),_:2},1040)]),default:a(()=>[l(C,null,{default:a(()=>[l(B,{class:"text-h5 text-center py-6"},{default:a(()=>[n(t(!f.value.commentaire||f.value.commentaire.length==0?m.$t("Ajouter un commentaire"):m.$t("Modifier le commentaire")),1)]),_:1}),l(q),l(D,null,{default:a(()=>[l(U,null,{default:a(()=>[l(b,{cols:"12"},{default:a(()=>[s("label",null,t(m.$t("Commentaire")),1),l(ne,{editor:h(k)},null,8,["editor"]),l(h(ue),{editor:h(k)},null,8,["editor"])]),_:1})]),_:1})]),_:1}),l(q),l(J,null,{default:a(()=>[l(H),l(x,{color:"error",variant:"flat",dark:"",onClick:c[1]||(c[1]=S=>i.value=!1)},{default:a(()=>[n(t(m.$t("Annuler")),1)]),_:1}),l(x,{color:"success",variant:"flat",loading:_.value,dark:"",onClick:y},{default:a(()=>[n(t(m.$t("Enregistrer")),1)]),_:1},8,["loading"]),l(H)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ce={class:"text-h6"},fe={class:"text-subtitle-1 textSecondary mt-3"},ve={class:"text-subtitle-1 textSecondary mt-3"},pe={class:"text-subtitle-1 textSecondary mt-3"},he={class:"text-subtitle-1 textSecondary mt-3"},_e={class:"text-subtitle-1 textSecondary mt-3"},ye={class:"text-h6"},ge={class:"text-subtitle-1 textSecondary mt-3"},be={class:"text-subtitle-1 textSecondary mt-3"},Ve={class:"text-subtitle-1 textSecondary mt-3"},$e={class:"text-subtitle-1 textSecondary mt-3"},xe={class:"text-subtitle-1 textSecondary mt-3"},ke={class:"text-subtitle-1 textSecondary mt-3"},Ce={class:"text-subtitle-1 textSecondary mt-3"},we={class:"text-subtitle-1 textSecondary mt-3"},Se={class:"text-h6"},De=s("thead",null,[s("tr",null,[s("th",{class:"text-h6"},"ID"),s("th",{class:"text-h6"},"Prestation"),s("th",{class:"text-h6"},"Date de la demande"),s("th",{class:"text-h6"},"Status"),s("th",{class:"text-h6"},"Action")])],-1),Pe={class:"text-h6 font-weight-medium text-medium-emphasis"},Te={class:"text-h6"},je=s("thead",null,[s("tr",null,[s("th",{class:"text-h6"},"ID"),s("th",{class:"text-h6"},"Prestation"),s("th",{class:"text-h6"},"Date de la demande"),s("th",{class:"text-h6"},"Status"),s("th",{class:"text-h6"},"Action")])],-1),Ee={class:"text-h6 font-weight-medium text-medium-emphasis"},ot=F({__name:"View",setup(I){r(),G();const e=r({id:null,status:0,service:"",demand_date:null,customer_id:null,prestation_id:null,customer:{id:null,firstname:"",lastname:"",email:"",phone:"",is_customer:!1,created_at:null,demands:[],prestations:[]}}),T=r({title:$("Détails de la demande")+" "+(e.value.eventtype&&e.value.eventtype.name||"")+" "+(e.value.customer||{firstname:""}).firstname+" "+(e.value.customer||{lastname:""}).lastname+" "+(L(e.value.demand_date)||"")}),w=r([{text:$("Dashboard"),disabled:!1,href:"/"},{text:$("Gestion des demandes"),disabled:!1,href:"/demands"},{text:e.value.eventtype?e.value.eventtype.name:"",disabled:!0,href:"#"}]);function E(){T.value={title:$("Détails de la demande")+" "+(e.value.eventtype&&e.value.eventtype.name||"")+" ("+(e.value.customer||{firstname:""}).firstname+" "+(e.value.customer||{lastname:""}).lastname+" "+(L(e.value.demand_date)||"")+")"},w.value=[{text:$("Dashboard"),disabled:!1,href:"/"},{text:$("Gestion des demandes"),disabled:!1,href:"/demands"},{text:e.value.eventtype?e.value.eventtype.name:"",disabled:!0,href:"#"}]}const p=O(),f=W();Y(()=>{j()});const i=r(!1);r(!1),r(10);const _=r(2),k=r(2);r(!1),r(!1),r(null);const y=r("");r(["primary","secondary","error","success","warning"]),r([{key:"demand_date",order:"DESC"}]),r(0),r({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"demand_date",order:"DESC"}]});const m=r(-1);r({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),r({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),r(!1),r([{title:"Prénom",align:"start",key:"customer.firstname",sortable:!1},{title:"Nom",align:"start",key:"customer.lastname",sortable:!1},{title:"Email",align:"start",key:"customer.email",sortable:!1},{title:"Téléphone",align:"start",key:"customer.phone",sortable:!1},{title:"Prestation",align:"start",key:"eventtype.name"},{title:"Date de la demande",align:"start",key:"demand_date"},{title:"Status",align:"start",key:"status"},{title:"Actions",key:"actions",sortable:!1}]),P(()=>p.demands.data.filter(o=>o.email.toLowerCase().includes(y.value.toLowerCase())));const c=P(()=>f.params.id),S=P(()=>e.value.customer.demands?e.value.customer.demands.filter(o=>o.id!=e.value.id):[]);P(()=>m.value===-1?"Nouvel administrateur":"Modifier l’administrateur");function j(){i.value=!0,p.fetchItem(f.params.id).then(o=>{o.data.error||(i.value=!1,e.value=o.data,E())}).catch(o=>{i.value=!1}).then(()=>{i.value=!1})}return Z(c,(o,g)=>{o!=g&&j()},{deep:!0}),ee(()=>{_.value>k.value&&(_.value=k.value)}),(o,g)=>(d(),A(z,null,[i.value?V("",!0):(d(),v(ae,{key:0,title:T.value.title,breadcrumbs:w.value},null,8,["title","breadcrumbs"])),i.value?(d(),v(U,{key:1,justify:"center",align:"center","align-content":"center"},{default:a(()=>[l(b,{cols:"12",justify:"center",align:"center","align-content":"center"},{default:a(()=>[l(te,{indeterminate:"",color:"primary",size:"150"})]),_:1})]),_:1})):(d(),v(U,{key:2},{default:a(()=>[l(b,{cols:"12",md:"3"},{default:a(()=>[n(t(o.$t("Status :"))+" ",1),l(M,{rounded:"md",class:"font-weight-bold",color:h(p).statusColor(e.value.status),size:"small",label:""},{default:a(()=>[n(t(h(p).statusText(e.value.status)),1)]),_:1},8,["color"])]),_:1}),l(b,{cols:"12",md:"9",justify:"end","align-content":"end",align:"end"},{default:a(()=>[i.value?V("",!0):(d(),v(de,{key:0,modelValue:e.value,"onUpdate:modelValue":g[0]||(g[0]=u=>e.value=u),onSaved:j,"button-text":o.$t("Modifier La Demande")},null,8,["modelValue","button-text"])),!e.value.prestation&&e.value.status==h(p).statuses.started&&!i.value?(d(),v(le,{key:1,modelValue:e.value,"onUpdate:modelValue":g[1]||(g[1]=u=>e.value=u),onSaved:j},null,8,["modelValue"])):V("",!0),e.value.prestation&&e.value.prestation.id?(d(),v(x,{key:2,variant:"elevated",color:"primary",to:"/prestations/"+e.value.prestation.id},{default:a(()=>[n(t(o.$t("Voir la prestation liée")),1)]),_:1},8,["to"])):V("",!0),e.value.prestation?V("",!0):(d(),v(ie,{key:3,modelValue:e.value,"onUpdate:modelValue":g[2]||(g[2]=u=>e.value=u)},null,8,["modelValue"]))]),_:1}),l(b,{cols:"12",md:"3"},{default:a(()=>[l(C,{elevation:"10",class:"overflow-hidden h-100"},{default:a(()=>[l(N,{class:"py-4 px-6 text-white bg-primary"},{default:a(()=>[s("h4",ce,t(o.$t("Identification du demandeur")),1)]),_:1}),l(D,{class:"pa-6"},{default:a(()=>[s("p",fe,[n(t(o.$t("Prénom :"))+" ",1),s("strong",null,t(e.value.customer.firstname||""),1)]),s("p",ve,[n(t(o.$t("Nom :"))+" ",1),s("strong",null,t(e.value.customer.lastname||""),1)]),s("p",pe,[n(t(o.$t("Email :"))+" ",1),s("strong",null,t(e.value.customer.email||""),1)]),s("p",he,[n(t(o.$t("Téléphone :"))+" ",1),s("strong",null,t(e.value.customer.phone||""),1)]),s("p",_e,[n(t(o.$t("Type :"))+" ",1),e.value.customer&&e.value.customer.is_customer?(d(),v(M,{key:0,color:"success"},{default:a(()=>[n(t(o.$t("Client")),1)]),_:1})):(d(),v(M,{key:1,color:"error"},{default:a(()=>[n(t(o.$t("Prospect")),1)]),_:1}))])]),_:1})]),_:1})]),_:1}),l(b,{cols:"12",md:"3"},{default:a(()=>[l(re,{modelValue:e.value,"onUpdate:modelValue":g[3]||(g[3]=u=>e.value=u),type:"demand","show-demand-info":""},null,8,["modelValue"])]),_:1}),l(b,{cols:"12",md:"6",class:"justify-end align-end"},{default:a(()=>[l(C,{elevation:"10",class:"overflow-hidden h-100"},{default:a(()=>[l(N,{class:"py-4 px-6 text-white bg-info"},{default:a(()=>[s("h4",ye,t(o.$t("Détails de la demande")),1)]),_:1}),l(D,{class:"pa-6"},{default:a(()=>[l(U,null,{default:a(()=>[l(b,{cols:"12",md:"6",lg:"5"},{default:a(()=>[s("p",ge,[n(t(o.$t("Type événement :"))+" ",1),s("strong",null,t(e.value.eventtype?e.value.eventtype.name:""),1)]),s("p",be,[n(t(o.$t("Date de l'événement :"))+" ",1),s("strong",null,t(h(L)(e.value.event_date)||""),1)]),s("p",Ve,[n(t(o.$t("La réception se déroulera plutôt :"))+" ",1),s("strong",null,t(e.value.reception_period||""),1)]),s("p",$e,[n(t(o.$t("Heure de réception :"))+" ",1),s("strong",null,t(e.value.reception_start_time||""),1)]),s("p",xe,[n(t(o.$t("Lieu de l'événement :"))+" ",1),s("strong",null,t(e.value.event_location||""),1)]),s("p",ke,[n(t(o.$t("Nombre de convives :"))+" ",1),s("strong",null,t(e.value.number_people||""),1)]),s("p",Ce,[n(t(o.$t("Nombre de jours restants :"))+" ",1),s("strong",null,t(e.value.days_left||""),1)]),s("p",we,[n(t(o.$t("Source :"))+" ",1),s("strong",null,t(e.value.source||""),1)])]),_:1}),l(b,{cols:"12",md:"6",lg:"7"},{default:a(()=>[l(C,{flat:"",variant:"outlined",density:"compact"},{default:a(()=>[l(B,null,{default:a(()=>[n(t(o.$t("Commentaire client")),1)]),_:1}),l(D,{class:"formatted-text",innerHTML:(e.value.comment||"").replace(/\n/g,"<br/>")},null,8,["innerHTML"])]),_:1})]),_:1}),l(b,{cols:"12"},{default:a(()=>[l(C,{flat:"",variant:"outlined",class:"mt-1",density:"compact"},{default:a(()=>[l(B,null,{default:a(()=>[n(t(o.$t("Commentaire"))+" ",1),i.value?V("",!0):(d(),v(me,{key:0,modelValue:e.value,"onUpdate:modelValue":g[4]||(g[4]=u=>e.value=u),onSaved:j},null,8,["modelValue"]))]),_:1}),l(D,{class:"formatted-text",innerHTML:e.value.commentaire},null,8,["innerHTML"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e.value.customer&&S.value?(d(),v(b,{key:0,cols:"12"},{default:a(()=>[l(C,{elevation:"10",class:"overflow-hidden h-100"},{default:a(()=>[l(N,{class:"py-4 px-6 text-white bg-info"},{default:a(()=>[s("h4",Se,t(o.$t("Autre demandes de devis de"))+" "+t(e.value.customer.firstname||"")+" "+t(e.value.customer.lastname||""),1)]),_:1}),l(D,{class:"pa-6"},{default:a(()=>[l(R,{class:"month-table"},{default:a(()=>[De,s("tbody",null,[(d(!0),A(z,null,K(S.value,u=>(d(),A("tr",{key:u.id,class:"month-item"},[s("td",null,t(u.id),1),s("td",null,[s("h6",Pe,t(u.eventtype?u.eventtype.name:""),1)]),s("td",null,t(h(L)(u.demand_date)),1),s("td",null,[l(M,{rounded:"md",class:"font-weight-bold",color:h(p).statusColor(u.status),size:"small",label:""},{default:a(()=>[n(t(h(p).statusText(u.status)),1)]),_:2},1032,["color"])]),s("td",null,[l(x,{variant:"outlined",density:"compact",color:"info",to:"/demands/"+u.id},{default:a(()=>[n(t(o.$t("Voir")),1)]),_:2},1032,["to"])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})):V("",!0),e.value.customer&&e.value.customer.prestations?(d(),v(b,{key:1,cols:"12"},{default:a(()=>[l(C,{elevation:"10",class:"overflow-hidden h-100"},{default:a(()=>[l(N,{class:"py-4 px-6 text-white bg-info"},{default:a(()=>[s("h4",Te,t(o.$t("Autre prestations de devis de"))+" "+t(e.value.customer.firstname||"")+" "+t(e.value.customer.lastname||""),1)]),_:1}),l(D,{class:"pa-6"},{default:a(()=>[l(R,{class:"month-table"},{default:a(()=>[je,s("tbody",null,[(d(!0),A(z,null,K(e.value.customer.prestations,u=>(d(),A("tr",{key:u.id,class:"month-item"},[s("td",null,t(u.id),1),s("td",null,[s("h6",Ee,t(u.eventtype?u.eventtype.name:""),1)]),s("td",null,t(h(L)(u.demand_date)),1),s("td",null,[l(M,{rounded:"md",class:"font-weight-bold",color:h(p).statusColor(u.status),size:"small",label:""},{default:a(()=>[n(t(h(p).statusText(u.status)),1)]),_:2},1032,["color"])]),s("td",null,[l(x,{variant:"outlined",density:"compact",color:"info",to:"/prestations/"+u.id},{default:a(()=>[n(t(o.$t("Voir")),1)]),_:2},1032,["to"])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})):V("",!0)]),_:1}))],64))}});export{ot as default};
