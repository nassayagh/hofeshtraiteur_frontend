import{u as ee}from"./demands-LIJMz0Kv.js";import{u as te}from"./eventType-D4EGyJ89.js";import{_ as ae}from"./BaseBreadcrumb-BtmJPFx7.js";import{f as L}from"./formatters-Dv1Ro_l4.js";import{a6 as le,ay as oe,r as a,av as re,az as n,h as se,e as C,g as ne,q as ue,o as de,c as ie,b as l,w as o,a8 as V,n as me,V as y,d as i,t as u,a as pe,X as ve}from"./index-BXBYVBfQ.js";import{_ as fe}from"./DemandsDashboard.vue_vue_type_script_setup_true_lang-BENP-Xyy.js";import{V as f,a as B}from"./VRow-2EsU4kUY.js";import{V as ce}from"./VDataTableServer-CAEHSCvP.js";import{V as ge}from"./VToolbar-DVUd2pAu.js";import{V as j}from"./VTextField-BClL2Z5q.js";import{V as N}from"./filter-B7SjDAPx.js";import{V as M}from"./VDialog-DP_HEk-s.js";import{V as Ve}from"./VLocaleProvider-C5oPs9vR.js";import{V as ye}from"./VDatePicker-BVqun9IE.js";import{V as S}from"./VSpacer-CcEOxlqv.js";import{V as be,a as he,b as ke}from"./VCard-DDRyYk5Y.js";import{V as De}from"./VChip-CMEvba1b.js";import"./VTable-BIm0cbye.js";import"./VDivider-U3R6LiAg.js";import"./index-Iw3IPOsb.js";import"./VAvatar-8uoTWrfj.js";import"./VField-BeTNhqWJ.js";import"./VMenu-Co1IYTEO.js";import"./createSimpleFunctional-CwhZkEih.js";import"./VSheet-CD9vZSeE.js";const Qe=le({__name:"List",setup(Pe){const m=oe();a();const O=re(),R=te(),z=a({title:n("Gestion des demandes")}),F=a([{text:n("Dashboard"),disabled:!1,href:"/"},{text:n("Gestion des demandes"),disabled:!0,href:"#"}]),b=a([]),U=a([]),p=ee();se(()=>{E(),J()}),a(!1);const h=a(!1);a(!1),a(!1),a(!1),a(!1),a(""),a(),a(!1);const x=a(null);a(null),a(null),a(null);const k=a(!1);a();const $=a(10),c=a(2),D=a(2),_=a(0);a(!1);const G=a(!1);a(null);const w=a("");a(["primary","secondary","error","success","warning"]);const v=a([{key:"demand_date",order:"DESC"}]);a(0),a({total:0,validated:0,unvalidated:0});const s=a({search:null,status:null,date:null,event_type:null}),g=a({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"demand_date",order:"DESC"}]}),K=a(-1),T=a({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});a({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});const P=a(!1),q=a([{title:n("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:n("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:n("Email"),align:"start",key:"customer.email",sortable:!1},{title:n("Téléphone"),align:"start",key:"customer.phone",sortable:!1},{title:n("Prestation"),align:"start",key:"event_type"},{title:n("Date de la demande"),align:"start",key:"demand_date"},{title:n("Statut"),align:"start",key:"status"},{title:n("Date de l'événement "),key:"event_date"},{title:n("Heure"),key:"reception_start_time"},{title:n("Lieu"),key:"event_location"},{title:n("Convives"),key:"number_people"},{title:"Actions",key:"actions",sortable:!1}]),A=C(()=>s.value.date&&s.value.date.length>0?m.format(s.value.date[0],"shortDate")+" - "+m.format(s.value.date[s.value.date.length-1],"shortDate"):null);C(()=>p.demands.data.filter(r=>r.email.toLowerCase().includes(w.value.toLowerCase())));function H(){p.deleteItem(T.value.id);const r=b.value.findIndex(e=>e.id==T.value.id);b.value.splice(r,1),P.value=!1,O.showSuccess(n("Utilisateur supprimé avec succès"))}C(()=>K.value===-1?"Nouvel administrateur":"Modifier l’administrateur");const X=C(()=>s.value.date&&s.value.date.length?s.value.date.length>1?[m.format(s.value.date[0],"shortDate"),m.format(s.value.date[s.value.date.length-1],"shortDate")]:[m.format(s.value.date[0],"shortDate"),m.format(s.value.date[0],"shortDate")]:null);function E(){try{clearTimeout(x.value)}catch{}x.value=setTimeout(()=>{h.value=!0;let r="id",e="desc";console.log(v.value),v.value.length>0&&(r=v.value[0].key,e=v.value[0].order),p.fetchItems({term:w.value,paginate:$.value,current_page:c.value,direction:e,order_by:r,page:g.value.page,per_page:g.value.itemsPerPage,...s.value,date:X.value}).then(t=>{if(t.data){const{data:d,current_page:Q,next_page_url:W,total:I,per_page:Y,to:Ce,last_page:Z}=t.data;b.value=d,D.value=Z,_.value=I}}).catch(t=>{console.error(t)}).then(()=>{h.value=!1})},1e3)}function J(){R.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(r=>{if(r.data){const{data:e,current_page:t,next_page_url:d,total:Q,per_page:W,to:I,last_page:Y}=r.data;U.value=e}}).catch(r=>{console.error(r)}).then(()=>{h.value=!1})}return ne([w,g,s],()=>{E()},{deep:!0}),ue(()=>{c.value>D.value&&(c.value=D.value)}),(r,e)=>(de(),ie(ve,null,[l(ae,{title:z.value.title,breadcrumbs:F.value},null,8,["title","breadcrumbs"]),l(B,null,{default:o(()=>[l(f,{cols:"12"},{default:o(()=>[l(fe)]),_:1}),l(f,{cols:"12"},{default:o(()=>[l(ce,{class:"border rounded-md",headers:q.value,loading:h.value,items:b.value,"multi-sort":!1,"items-per-page":$.value,"onUpdate:itemsPerPage":e[12]||(e[12]=t=>$.value=t),"items-per-page-text":r.$t("Articles par page"),options:g.value,"onUpdate:options":e[13]||(e[13]=t=>g.value=t),"sort-by":v.value,"onUpdate:sortBy":e[14]||(e[14]=t=>v.value=t),page:c.value,"onUpdate:page":e[15]||(e[15]=t=>c.value=t),"items-length":_.value,"onUpdate:itemsLength":e[16]||(e[16]=t=>_.value=t),"show-select":!1,"loading-text":r.$t("Chargement des éléments"),"no-data-text":r.$t("Pas de données"),"no-results-text":r.$t("Aucun résultat"),onPageCount:e[17]||(e[17]=t=>D.value=t)},{top:o(()=>[l(ge,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:o(()=>[l(B,null,{default:o(()=>[l(f,null,{default:o(()=>[l(j,{density:"compact",modelValue:s.value.search,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.search=t),placeholder:r.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),l(f,null,{default:o(()=>[l(N,{density:"compact",modelValue:s.value.event_type,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.event_type=t),placeholder:r.$t("Prestation"),items:U.value,"item-value":"name","item-title":"name",clearable:"",multiple:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","items"])]),_:1}),l(f,null,{default:o(()=>[l(N,{density:"compact",modelValue:s.value.status,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.status=t),placeholder:r.$t("Statut"),items:V(p).statusesList,"item-value":"id","item-title":"label",clearable:"",multiple:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","items"])]),_:1}),l(f,null,{default:o(()=>[l(M,{ref_key:"dialog",ref:G,modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=t=>k.value=t),"return-value":s.value.date,"onUpdate:returnValue":e[9]||(e[9]=t=>s.value.date=t),persistent:"",width:"290px"},{activator:o(({props:t})=>[l(j,me({modelValue:A.value,"onUpdate:modelValue":e[3]||(e[3]=d=>A.value=d),"prepend-inner-icon":"bx-calendar"},t,{density:"compact",placeholder:r.$t("Date"),"hide-details":"",variant:"solo",clearable:"",readonly:"","onClick:clear":e[4]||(e[4]=d=>s.value.date=null)}),null,16,["modelValue","placeholder"])]),default:o(({isActive:t})=>[l(Ve,{locale:"fr"},{default:o(()=>[l(ye,{modelValue:s.value.date,"onUpdate:modelValue":e[7]||(e[7]=d=>s.value.date=d),"hide-header":"",multiple:"range"},{actions:o(()=>[l(y,{color:"primary",onClick:e[5]||(e[5]=d=>k.value=!1)},{default:o(()=>[i(u(r.$t("Annuler")),1)]),_:1}),l(S),l(y,{variant:"elevated",color:"primary",onClick:e[6]||(e[6]=d=>k.value=!1)},{default:o(()=>[i(u(r.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1}),l(M,{modelValue:P.value,"onUpdate:modelValue":e[11]||(e[11]=t=>P.value=t),"max-width":"500px"},{default:o(()=>[l(be,null,{default:o(()=>[l(he,{class:"text-h5 text-center py-6"},{default:o(()=>[i(u(r.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),l(ke,null,{default:o(()=>[l(S),l(y,{color:"error",variant:"flat",dark:"",onClick:e[10]||(e[10]=t=>P.value=!1)},{default:o(()=>[i(u(r.$t("Annuler")),1)]),_:1}),l(y,{color:"success",variant:"flat",dark:"",onClick:H},{default:o(()=>[i(u(r.$t("OK")),1)]),_:1}),l(S)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.demand_date":o(({item:t})=>[i(u(V(L)(t.demand_date)),1)]),"item.event_date":o(({item:t})=>[i(u(V(L)(t.event_date)),1)]),"item.status":o(({item:t})=>[l(De,{color:V(p).statusColor(t.status),size:"small",label:""},{default:o(()=>[i(u(V(p).statusText(t.status)),1)]),_:2},1032,["color"])]),"item.actions":o(({item:t})=>[l(y,{density:"compact",color:"primary",variant:"outlined",to:"/demands/"+t.id},{default:o(()=>[i(u(r.$t("Voir")),1)]),_:2},1032,["to"])]),"no-data":o(()=>[pe("span",null,u(r.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64))}});export{Qe as default};
