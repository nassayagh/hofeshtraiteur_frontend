import{a9 as ve,aa as x,a6 as fe,r as s,av as pe,aD as E,h as ce,e as O,g as ge,q as Ve,Z as K,o as X,c as Z,b as a,w as r,V as g,n as M,d as V,t as v,a as L,a8 as T,a4 as he,X as be}from"./index-D3DdXZdG.js";import{_ as we}from"./BaseBreadcrumb-DYaFDkdC.js";import{r as q,e as ye}from"./validators-BPi-vT8z.js";import{F as Pe,V as ke}from"./vee-validate.esm-DezKAZlh.js";import{s as m}from"./sidebarItem-5KuHAgsW.js";import{V as A,a as H}from"./VRow-Bx-LvG9A.js";import{V as $e}from"./VDataTableServer-BNqi7y0T.js";import{V as Ue,a as Ce}from"./VToolbar-BCTsoXo1.js";import{V as N}from"./VTextField-DLykypQv.js";import{i as I}from"./VSpacer-DdAD-FGi.js";import{V as J}from"./VDialog-BHPx_cIy.js";import{a as Q,b as W,V as xe,c as Y}from"./VCard-1m9q3-_R.js";import{V as Te}from"./VContainer-7XyaLTnU.js";import{V as Ae}from"./VAutocomplete-D4CQMLo9.js";import{V as ee}from"./VTooltip-Bont2L7V.js";import"./VAvatar-D6zO78xn.js";const Ie=ve({id:"Authuser",state:()=>({users:{data:[],loading:!1,error:null}}),actions:{async getAll(){this.users.loading=!0,x.get("/users").then(i=>this.users.data=i.data).catch(i=>this.users.error=i)},fetchUsers(i){return x.get("/users",{params:i})},async addUser(i){return new Promise((f,p)=>{x.post("/users",i).then(n=>f(n)).catch(n=>p(n))})},fetchUser(i){return new Promise((f,p)=>{x.get(`/users/${i}`).then(n=>f(n)).catch(n=>p(n))})},deleteUser(i){return new Promise((f,p)=>{x.delete(`/users/${i}`).then(n=>f(n)).catch(n=>p(n))})}}}),Se={class:"text-h5"},_e={key:0,class:"mt-2"},je={class:"d-flex align-center"},We=fe({__name:"AdminsTable",setup(i){const f=s(),p=pe(),n=s({title:"Gestions des administrateurs"}),ae=s([{text:E("Dashboard"),disabled:!1,href:"/"},{text:E("Administrateurs"),disabled:!0,href:"#"}]),c=s([]),S=Ie();ce(()=>{G()});const h=s(!1),B=s(!1);s(!1),s(!1),s(!1),s(""),s(),s(!1);const z=s(null);s(null),s(null),s(null),s(!1),s();const F=s(100),y=s(2),_=s(2),j=s(0),R=s(!1),P=s(!1);s(null);const k=s("");s(["primary","secondary","error","success","warning"]);const b=s([{key:"name",order:"asc"}]);s(0);const $=s({itemsPerPage:100,rowsPerPage:100,page:1,sortDesc:[!0],sortBy:[{key:"name",order:"desc"}]}),D=s(-1),o=s({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:"",roles:[]}),le=s({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:"",roles:[]}),U=s(!1),te=s([{title:"Actions",key:"actions",sortable:!1},{title:"Nom",align:"start",key:"name"},{title:"Email",key:"email"}]);O(()=>S.users.data.filter(l=>l.email.toLowerCase().includes(k.value.toLowerCase())));const se=O(()=>{const l=[];for(let e=0;e<m.length;e++)if(m[e].children!=null&&m[e].children.length>0){l.push(m[e]);for(let u=0;u<m[e].children.length;u++)m[e].children[u].header||l.push({...m[e].children[u],title:m[e].title+" "+m[e].children[u].title})}else m[e].header||l.push(m[e]);return l});function re(l){h.value=!1,D.value=c.value.indexOf(l),o.value=Object.assign({},{...l,roles:l.roles||[]}),P.value=!0}function oe(l){o.value=l,U.value=!0}function ue(){P.value=!1,setTimeout(()=>{o.value=Object.assign({},le.value),D.value=-1},300)}function ne(l,{setErrors:e}){var u;(u=f.value)==null||u.validate().then(({valid:C})=>{C&&(B.value=!0,S.addUser(o.value).then(t=>{if(t.data.error){e({apiError:t.data.message});return}o.value.id!=null?Object.assign(c.value[D.value],t.data):c.value.unshift(t.data),h.value=!1,P.value=!1,o.value={changePassword:!0},p.showSuccess(E("Utilisateur enregistreé avec succès"))}).catch(t=>{B.value=!1,e({apiError:t})}).then(()=>{B.value=!1,e({apiError:null})}))})}function ie(){S.deleteUser(o.value.id);const l=c.value.findIndex(e=>e.id==o.value.id);c.value.splice(l,1),U.value=!1,p.showSuccess(E("Utilisateur supprimé avec succès"))}const de=O(()=>D.value===-1?"Nouvel administrateur":"Modifier l’administrateur");function G(){try{clearTimeout(z.value)}catch{}z.value=setTimeout(()=>{h.value=!0;let l="id",e="desc";console.log(b.value),b.value.length>0&&(l=b.value[0].key,e=b.value[0].order),S.fetchUsers({term:k.value,paginate:F.value,current_page:y.value,direction:e,order_by:l,page:$.value.page,per_page:$.value.itemsPerPage}).then(u=>{if(u.data){const{data:C,current_page:t,next_page_url:w,total:d,per_page:De,to:Ee,last_page:me}=u.data;c.value=C,_.value=me,j.value=d}}).catch(u=>{console.error(u)}).then(()=>{h.value=!1})},1e3)}return ge([k,$],()=>{G()},{deep:!0}),Ve(()=>{y.value>_.value&&(y.value=_.value)}),(l,e)=>{const u=K("PencilIcon"),C=K("TrashIcon");return X(),Z(be,null,[a(we,{title:`${n.value.title}(${j.value})`,breadcrumbs:ae.value},null,8,["title","breadcrumbs"]),a(H,null,{default:r(()=>[a(A,{cols:"12"},{default:r(()=>[a($e,{class:"border rounded-md",headers:te.value,loading:h.value,items:c.value,"multi-sort":!1,"items-per-page":F.value,"onUpdate:itemsPerPage":e[11]||(e[11]=t=>F.value=t),"items-per-page-text":l.$t("Articles par page"),options:$.value,"onUpdate:options":e[12]||(e[12]=t=>$.value=t),"sort-by":b.value,"onUpdate:sortBy":e[13]||(e[13]=t=>b.value=t),page:y.value,"onUpdate:page":e[14]||(e[14]=t=>y.value=t),"items-length":j.value,"onUpdate:itemsLength":e[15]||(e[15]=t=>j.value=t),"show-select":!1,"loading-text":l.$t("Chargement des éléments"),"no-data-text":l.$t("Pas de données"),"no-results-text":l.$t("Aucun résultat"),onPageCount:e[16]||(e[16]=t=>_.value=t)},{top:r(()=>[a(Ue,{class:"rounded-t-md",flat:""},{default:r(()=>[a(Ce,null,{default:r(()=>[a(N,{density:"compact",modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),placeholder:l.$t("Rechercher..."),"hide-details":"",variant:"solo"},null,8,["modelValue","placeholder"])]),_:1}),a(I),a(J,{modelValue:P.value,"onUpdate:modelValue":e[8]||(e[8]=t=>P.value=t),"max-width":"550px"},{activator:r(({props:t})=>[a(g,M({color:"primary",variant:"flat",onClick:e[1]||(e[1]=w=>o.value={roles:[]}),dark:""},t),{default:r(()=>[V(v(l.$t("Ajouter un administrateur")),1)]),_:2},1040)]),default:r(()=>[a(Q,null,{default:r(()=>[a(W,{class:"pa-4 bg-secondary"},{default:r(()=>[L("span",Se,v(de.value),1)]),_:1}),a(T(Pe),{ref_key:"refForm",ref:f,modelValue:R.value,"onUpdate:modelValue":e[7]||(e[7]=t=>R.value=t),onSubmit:ne},{default:r(({errors:t,isSubmitting:w})=>[a(xe,null,{default:r(()=>[a(Te,{class:"px-0"},{default:r(()=>[a(H,null,{default:r(()=>[a(A,{cols:"12"},{default:r(()=>[a(N,{modelValue:o.value.name,"onUpdate:modelValue":e[2]||(e[2]=d=>o.value.name=d),rules:[T(q)],label:l.$t("Nom")},null,8,["modelValue","rules","label"])]),_:1}),a(A,{cols:"12"},{default:r(()=>[a(N,{modelValue:o.value.email,"onUpdate:modelValue":e[3]||(e[3]=d=>o.value.email=d),label:l.$t("Email"),rules:[T(q),T(ye)]},null,8,["modelValue","label","rules"])]),_:1}),a(A,{cols:"12"},{default:r(()=>[a(N,{modelValue:o.value.password,"onUpdate:modelValue":e[4]||(e[4]=d=>o.value.password=d),label:l.$t("Mot de passe"),placeholder:"············","append-inner-icon":o.value.id&&o.value.changePassword?"mdi-eye-off":"mdi-eye",rules:[o.value.id&&o.value.changePassword||!o.value.id?T(q):!0],readonly:!o.value.changePassword,"onClick:appendInner":e[5]||(e[5]=d=>o.value.changePassword=!o.value.changePassword)},null,8,["modelValue","label","append-inner-icon","rules","readonly"])]),_:1}),a(A,{cols:"12"},{default:r(()=>[a(Ae,{modelValue:o.value.roles,"onUpdate:modelValue":e[6]||(e[6]=d=>o.value.roles=d),items:se.value,"item-value":"to","item-title":"title",multiple:"",clearable:"",variant:"outlined"},null,8,["modelValue","items"])]),_:1})]),_:1}),t.apiError?(X(),Z("div",_e,[a(ke,{color:"error"},{default:r(()=>[V(v(t.apiError),1)]),_:2},1024)])):he("",!0)]),_:2},1024)]),_:2},1024),a(Y,null,{default:r(()=>[a(I),a(g,{color:"error",variant:"flat",dark:"",onClick:ue},{default:r(()=>[V(v(l.$t("Annuler")),1)]),_:1}),a(g,{color:"success",variant:"flat",loading:h.value,type:"submit"},{default:r(()=>[V(v(l.$t("Sauvegarder")),1)]),_:1},8,["loading"]),a(I)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),a(J,{modelValue:U.value,"onUpdate:modelValue":e[10]||(e[10]=t=>U.value=t),"max-width":"500px"},{default:r(()=>[a(Q,null,{default:r(()=>[a(W,{class:"text-h5 text-center py-6"},{default:r(()=>[V(v(l.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),a(Y,null,{default:r(()=>[a(I),a(g,{color:"error",variant:"flat",dark:"",onClick:e[9]||(e[9]=t=>U.value=!1)},{default:r(()=>[V(v(l.$t("Annuler")),1)]),_:1}),a(g,{color:"success",variant:"flat",dark:"",onClick:ie},{default:r(()=>[V(v(l.$t("OK")),1)]),_:1}),a(I)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.actions":r(({item:t})=>[L("div",je,[a(ee,{text:l.$t("Modifier")},{activator:r(({props:w})=>[a(g,M({icon:"",flat:"",onClick:d=>re(t)},w),{default:r(()=>[a(u,{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1032,["text"]),a(ee,{text:l.$t("Supprimer")},{activator:r(({props:w})=>[a(g,M({icon:"",flat:"",onClick:d=>oe(t)},w),{default:r(()=>[a(C,{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040,["onClick"])]),_:2},1032,["text"])])]),"no-data":r(()=>[L("span",null,v(l.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64)}}});export{We as default};
