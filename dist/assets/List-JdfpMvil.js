import{u as ie}from"./Controller-C26ts-uQ.js";import{u as me}from"./eventType-DTGFgA5e.js";import{a6 as pe,aJ as ve,r as o,av as ce,aK as n,aM as fe,h as K,e as P,g as O,q as ge,o as F,c as q,b as a,w as l,a8 as m,n as he,V,d as p,t as d,a4 as be,a as Ve,X as ye}from"./index-meFKwxxO.js";import{_ as _e}from"./BaseBreadcrumb-CrZTWZiG.js";import{f as z,a as G}from"./formatters-Dv1Ro_l4.js";import{_ as H}from"./PrespationDashboard.vue_vue_type_script_setup_true_lang-BrqXwWna.js";import{V as y,a as J}from"./VRow-DyDbiBBb.js";import{V as ke}from"./VDataTableServer-D-mh1jje.js";import{V as we}from"./VToolbar-CsP7p-Pc.js";import{V as X}from"./VTextField-DsNp1D7s.js";import{d as Pe}from"./filter-CHihZCDg.js";import{V as Q}from"./VDialog-CoujRa0l.js";import{V as xe}from"./VLocaleProvider-DqYnHM9u.js";import{V as Ce}from"./VDatePicker-Cv651BRN.js";import{V as E}from"./VSpacer-BWwAOBZh.js";import{V as De,a as $e,c as Se}from"./VCard-CHwsKVWf.js";import{V as W}from"./VChip-BwjXrkCh.js";import"./VTable-DAf6Ok7t.js";import"./VDivider-CQIP3RYY.js";import"./index-C9Tw67Gz.js";import"./VAvatar-Df_m3yp-.js";import"./VField-Blabgkfx.js";import"./VMenu-DToA7K4l.js";import"./createSimpleFunctional-9j9kXJB9.js";import"./VSheet-CasTnRI_.js";const Ue={key:0,class:"text-error font-weight-bold"},st=pe({__name:"List",setup(Te){const h=ve();o();const Y=ce(),Z=me(),u=o({title:""}),c=o([{text:n("Dashboard"),disabled:!1,href:"/"},{text:n("Prestations"),disabled:!0,href:"#"}]),_=o([]),M=o([]),i=ie(),f=fe(),g=o(0);K(()=>{j(),I(),oe()});const x=o(!1);o(!1);const B=o(null),C=o(!1),U=o(10),k=o(2),D=o(2),$=o(0),ee=o(!1),T=o("");o(["primary","secondary","error","success","warning"]);const b=o([{key:"demand_date",order:"DESC"}]);o(0);const r=o({search:null,date:null,event_type:null}),w=o({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"demand_date",order:"DESC"}]}),te=o(-1),L=o({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});o({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});const S=o(!1),A=o([{title:n("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:n("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:n("Email"),align:"start",key:"customer.email",sortable:!1},{title:n("Téléphone"),align:"start",key:"customer.phone",sortable:!1},{title:n("Prestation"),align:"start",key:"event_type"},{title:n("Date de la prestation"),align:"start",key:"event_date"},{title:n("Heure"),key:"demand.reception_start_time"},{title:n("Lieu"),key:"demand.event_location"},{title:n("Convives"),key:"demand.number_people"}]),ae=P(()=>f.params.status),N=P(()=>r.value.date&&r.value.date.length>0?h.format(r.value.date[0],"shortDate")+" - "+h.format(r.value.date[r.value.date.length-1],"shortDate"):null);O(ae,(s,t)=>{s!=t&&(j(),I())},{deep:!0}),P(()=>i.items.data.filter(s=>s.email.toLowerCase().includes(T.value.toLowerCase())));function le(){i.deleteItem(L.value.id);const s=_.value.findIndex(t=>t.id==L.value.id);_.value.splice(s,1),S.value=!1,Y.showSuccess(n("Utilisateur supprimé avec succès"))}P(()=>te.value===-1?"Nouvel administrateur":"Modifier l’administrateur");const se=P(()=>r.value.date&&r.value.date.length?r.value.date.length>1?[h.format(r.value.date[0],"shortDate"),h.format(r.value.date[r.value.date.length-1],"shortDate")]:[h.format(r.value.date[0],"shortDate"),h.format(r.value.date[0],"shortDate")]:null);function j(){switch(c.value=[{text:n("Dashboard"),disabled:!1,href:"/"}],_.value=[],$.value=0,f.params.status){case"started":u.value={title:n("Prestations en attente de validation")},c.value.push({text:u.value.title,disabled:!0,href:"#"}),g.value=i.statuses.started;break;case"validated":u.value={title:n("Prestations validées")},c.value.push({text:u.value.title,disabled:!0,href:"#"}),g.value=i.statuses.validated;break;case"processing":u.value={title:n("Prestations en cours")},c.value.push({text:u.value.title,disabled:!0,href:"#"}),g.value=i.statuses.processing;break;case"closed":u.value={title:n("Prestations clôturées")},c.value.push({text:u.value.title,disabled:!0,href:"#"}),g.value=i.statuses.closed;break;case"cancelled":u.value={title:n("Prestations annulées")},c.value.push({text:u.value.title,disabled:!0,href:"#"}),g.value=i.statuses.cancelled;break;default:u.value={title:n("Prestations en attente de validation")},c.value.push({text:u.value.title,disabled:!0,href:"#"}),g.value=i.statuses.started;break}}function I(){try{clearTimeout(B.value)}catch{}B.value=setTimeout(()=>{x.value=!0;let s="id",t="desc";console.log(b.value),b.value.length>0&&(s=b.value[0].key,t=b.value[0].order),i.fetchItems({term:T.value,paginate:U.value,current_page:k.value,status:g.value,direction:t,order_by:s,page:w.value.page,per_page:w.value.itemsPerPage,...r.value,date:se.value}).then(e=>{if(e.data){const{data:v,current_page:re,next_page_url:ne,total:R,per_page:ue,to:Ae,last_page:de}=e.data;_.value=v,D.value=de,$.value=R}}).catch(e=>{console.error(e)}).then(()=>{x.value=!1})},1e3)}function oe(){Z.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(s=>{if(s.data){const{data:t,current_page:e,next_page_url:v,total:re,per_page:ne,to:R,last_page:ue}=s.data;M.value=t}}).catch(s=>{console.error(s)}).then(()=>{x.value=!1})}return O([T,w,r],()=>{I()},{deep:!0}),ge(()=>{k.value>D.value&&(k.value=D.value)}),K(()=>{f.params.status!="started"?A.value.push({title:n("En attente de règlement"),align:"start",key:"amount_left",sortable:!1},{title:n("Montant total"),align:"start",key:"services_sum_total",sortable:!1},{title:n("Actions"),key:"actions",sortable:!1}):A.value.push({title:n("Actions"),key:"actions",sortable:!1})}),(s,t)=>(F(),q(ye,null,[a(_e,{title:u.value.title,breadcrumbs:c.value},null,8,["title","breadcrumbs"]),a(J,null,{default:l(()=>[a(y,{cols:"12",md:"6"},{default:l(()=>[a(H,{md:"6","show-validation":m(f).params.status=="started","show-validated":m(f).params.status=="validated","show-processing":m(f).params.status=="processing","show-closed":m(f).params.status=="closed","show-cancelled":m(f).params.status=="cancelled","show-description":""},null,8,["show-validation","show-validated","show-processing","show-closed","show-cancelled"])]),_:1}),a(y,{cols:"12",md:"6"},{default:l(()=>[a(H,{"show-payments":"","show-description":""})]),_:1}),a(y,{cols:"12"},{default:l(()=>[a(ke,{class:"border rounded-md",headers:A.value,loading:x.value,items:_.value,"multi-sort":!1,"items-per-page":U.value,"onUpdate:itemsPerPage":t[11]||(t[11]=e=>U.value=e),"items-per-page-text":s.$t("Articles par page"),options:w.value,"onUpdate:options":t[12]||(t[12]=e=>w.value=e),"sort-by":b.value,"onUpdate:sortBy":t[13]||(t[13]=e=>b.value=e),page:k.value,"onUpdate:page":t[14]||(t[14]=e=>k.value=e),"items-length":$.value,"onUpdate:itemsLength":t[15]||(t[15]=e=>$.value=e),"show-select":!1,"loading-text":s.$t("Chargement des éléments"),"no-data-text":s.$t("Pas de données"),"no-results-text":s.$t("Aucun résultat"),onPageCount:t[16]||(t[16]=e=>D.value=e)},{top:l(()=>[a(we,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:l(()=>[a(J,null,{default:l(()=>[a(y,null,{default:l(()=>[a(X,{density:"compact",modelValue:r.value.search,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value.search=e),placeholder:s.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),a(y,null,{default:l(()=>[a(Pe,{density:"compact",modelValue:r.value.event_type,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value.event_type=e),placeholder:s.$t("Prestation"),items:M.value,"item-value":"name","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),a(y,null,{default:l(()=>[a(Q,{ref_key:"dialog",ref:ee,modelValue:C.value,"onUpdate:modelValue":t[7]||(t[7]=e=>C.value=e),"return-value":r.value.date,"onUpdate:returnValue":t[8]||(t[8]=e=>r.value.date=e),persistent:"",width:"290px"},{activator:l(({props:e})=>[a(X,he({modelValue:N.value,"onUpdate:modelValue":t[2]||(t[2]=v=>N.value=v),"prepend-inner-icon":"bx-calendar",readonly:""},e,{density:"compact",placeholder:s.$t("Date"),"hide-details":"",variant:"solo",flat:"",clearable:"","onClick:clear":t[3]||(t[3]=v=>r.value.date=null)}),null,16,["modelValue","placeholder"])]),default:l(({isActive:e})=>[a(xe,{locale:"fr"},{default:l(()=>[a(Ce,{modelValue:r.value.date,"onUpdate:modelValue":t[6]||(t[6]=v=>r.value.date=v),"hide-header":"",multiple:"range"},{actions:l(()=>[a(V,{color:"primary",onClick:t[4]||(t[4]=v=>C.value=!1)},{default:l(()=>[p(d(s.$t("Annuler")),1)]),_:1}),a(E),a(V,{variant:"elevated",color:"primary",onClick:t[5]||(t[5]=v=>C.value=!1)},{default:l(()=>[p(d(s.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1}),a(Q,{modelValue:S.value,"onUpdate:modelValue":t[10]||(t[10]=e=>S.value=e),"max-width":"500px"},{default:l(()=>[a(De,null,{default:l(()=>[a($e,{class:"text-h5 text-center py-6"},{default:l(()=>[p(d(s.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),a(Se,null,{default:l(()=>[a(E),a(V,{color:"error",variant:"flat",dark:"",onClick:t[9]||(t[9]=e=>S.value=!1)},{default:l(()=>[p(d(s.$t("Annuler")),1)]),_:1}),a(V,{color:"success",variant:"flat",dark:"",onClick:le},{default:l(()=>[p(d(s.$t("OK")),1)]),_:1}),a(E)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.demand_date":l(({item:e})=>[p(d(m(z)(e.demand_date)),1)]),"item.event_date":l(({item:e})=>[p(d(m(z)(e.event_date)),1)]),"item.amount_left":l(({item:e})=>[Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?(F(),q("span",Ue,d(m(G)(Math.max(e.services_sum_total-e.payments_sum_amount,0))),1)):be("",!0)]),"item.services_sum_total":l(({item:e})=>[a(W,{variant:"tonal",color:Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?"error":"success",class:"font-weight-bold"},{default:l(()=>[p(d(m(G)(e.services_sum_total||0)),1)]),_:2},1032,["color"])]),"item.status":l(({item:e})=>[a(W,{color:m(i).statusColor(e.status),size:"small",label:""},{default:l(()=>[p(d(m(i).statusText(e.status)),1)]),_:2},1032,["color"])]),"item.actions":l(({item:e})=>[a(V,{density:"compact",color:"primary",variant:"elevated",to:"/prestations/"+e.id},{default:l(()=>[p(d(s.$t("Détails de la prestation")),1)]),_:2},1032,["to"]),a(V,{density:"compact",color:"info",variant:"outlined",class:"ml-4",to:"/demands/"+e.demand_id},{default:l(()=>[p(d(s.$t("Voir la demande")),1)]),_:2},1032,["to"])]),"no-data":l(()=>[Ve("span",null,d(s.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64))}});export{st as default};
