import{u as ce}from"./Controller-C73kWedE.js";import{u as fe}from"./eventType-VVY0XtAE.js";import{u as ge}from"./hall-C2GPRTNG.js";import{a6 as he,aJ as ye,r,av as be,aK as l,aL as _e,h as F,e as w,g as q,q as Ve,o as z,c as G,b as s,w as o,a8 as d,n as ke,V as P,d as v,t as i,a4 as we,a as Pe,X as xe}from"./index-Cz0fh-rQ.js";import{_ as Ce}from"./BaseBreadcrumb-Cyljszm-.js";import{f as J,a as L}from"./formatters-Dv1Ro_l4.js";import{_ as X}from"./PrespationDashboard.vue_vue_type_script_setup_true_lang-BKvdLZip.js";import{V as h,a as Q}from"./VRow-DC1biBZO.js";import{V as De}from"./VDataTableServer-rt69HdaH.js";import{V as $e}from"./VToolbar-D4SI_ixq.js";import{V as W}from"./VTextField-B8B0kSD7.js";import{b as Y,c as Z}from"./VDialog-D2X5bJvY.js";import{V as Se}from"./VLocaleProvider-B4gtzt1P.js";import{V as Ue}from"./VDatePicker-7SOcB2I1.js";import{V as M}from"./VSpacer-Da5mWwKf.js";import{V as Te,a as Ae,c as Ee}from"./VCard-B2BEu3j4.js";import{V as ee}from"./VChip-caXGoU2d.js";import"./VTable-CWZFcakl.js";import"./filter-DxbwZh6J.js";import"./VMenu-CFK77uO-.js";import"./index-BGAWEMdH.js";import"./VAvatar-B-1rNAx7.js";import"./VSheet-DxifOf0W.js";const Ie={key:0,class:"text-error font-weight-bold"},rt=he({__name:"List",setup(Le){const y=ye();r();const te=be(),ae=fe(),le=ge(),u=r({title:""}),c=r([{text:l("Dashboard"),disabled:!1,href:"/"},{text:l("Prestations"),disabled:!0,href:"#"}]),_=r([]),N=r([]),B=r([]),m=ce(),f=_e(),g=r(0);F(()=>{le.fetchItems({per_page:1e3}).then(a=>{B.value=a.data.data}),K(),I(),ie()});const x=r(!1);r(!1);const j=r(null),C=r(!1),T=r(10),V=r(2),D=r(2),$=r(0),se=r(!1),A=r("");r(["primary","secondary","error","success","warning"]);const b=r([{key:"demand_date",order:"DESC"}]);r(0);const n=r({search:null,date:null,event_type:null}),k=r({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"demand_date",order:"DESC"}]}),oe=r(-1),R=r({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});r({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});const S=r(!1),U=r([{title:l("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:l("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:l("Email"),align:"start",key:"customer.email",sortable:!1},{title:l("Téléphone"),align:"start",key:"customer.phone",sortable:!1},{title:l("Prestation"),align:"start",key:"event_type"},{title:l("Date de la prestation"),align:"start",key:"event_date"},{title:l("Heure"),key:"demand.reception_start_time"},{title:l("Lieu"),key:"demand.event_location"},{title:l("Convives"),key:"demand.number_people"},{title:l("En attente de règlement"),align:"start",key:"amount_left",sortable:!1},{title:l("Montant total"),align:"start",key:"services_sum_total",sortable:!1},{title:l("Actions"),key:"actions",sortable:!1}]),E=r([{title:l("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:l("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:l("Email"),align:"start",key:"customer.email",sortable:!1},{title:l("Téléphone"),align:"start",key:"customer.phone",sortable:!1},{title:l("Prestation"),align:"start",key:"event_type"},{title:l("Date de la prestation"),align:"start",key:"event_date"},{title:l("Heure"),key:"demand.reception_start_time"},{title:l("Lieu"),key:"demand.event_location"},{title:l("Convives"),key:"demand.number_people"},{title:l("Salle"),key:"hall.name"},{title:l("En attente de règlement"),align:"start",key:"amount_left",sortable:!1},{title:l("Montant total"),align:"start",key:"services_sum_total",sortable:!1},{title:l("Actions"),key:"actions",sortable:!1}]),re=w(()=>f.params.status),H=w(()=>n.value.date&&n.value.date.length>0?y.format(n.value.date[0],"shortDate")+" - "+y.format(n.value.date[n.value.date.length-1],"shortDate"):null);q(re,(a,t)=>{a!=t&&(K(),I())},{deep:!0}),w(()=>m.items.data.filter(a=>a.email.toLowerCase().includes(A.value.toLowerCase())));function ne(){m.deleteItem(R.value.id);const a=_.value.findIndex(t=>t.id==R.value.id);_.value.splice(a,1),S.value=!1,te.showSuccess(l("Utilisateur supprimé avec succès"))}w(()=>oe.value===-1?"Nouvel administrateur":"Modifier l’administrateur");const ue=w(()=>n.value.date&&n.value.date.length?n.value.date.length>1?[y.format(n.value.date[0],"shortDate"),y.format(n.value.date[n.value.date.length-1],"shortDate")]:[y.format(n.value.date[0],"shortDate"),y.format(n.value.date[0],"shortDate")]:null);function K(){switch(c.value=[{text:l("Dashboard"),disabled:!1,href:"/"}],_.value=[],$.value=0,U.value=E.value,f.params.status){case"started":u.value={title:l("Prestations en attente de validation")},c.value.push({text:u.value.title,disabled:!0,href:"#"}),g.value=m.statuses.started,U.value=E.value.filter(a=>a.key!="services_sum_total"&&a.key!="amount_left");break;case"validated":u.value={title:l("Prestations validées")},c.value.push({text:u.value.title,disabled:!0,href:"#"}),g.value=m.statuses.validated,U.value=E.value;break;case"processing":u.value={title:l("Prestations en cours")},c.value.push({text:u.value.title,disabled:!0,href:"#"}),g.value=m.statuses.processing;break;case"closed":u.value={title:l("Prestations clôturées")},c.value.push({text:u.value.title,disabled:!0,href:"#"}),g.value=m.statuses.closed;break;case"cancelled":u.value={title:l("Prestations annulées")},c.value.push({text:u.value.title,disabled:!0,href:"#"}),g.value=m.statuses.cancelled;break;default:u.value={title:l("Prestations en attente de validation")},c.value.push({text:u.value.title,disabled:!0,href:"#"}),g.value=m.statuses.started;break}}function I(){try{clearTimeout(j.value)}catch{}j.value=setTimeout(()=>{x.value=!0;let a="id",t="desc";console.log(b.value),b.value.length>0&&(a=b.value[0].key,t=b.value[0].order),m.fetchItems({term:A.value,paginate:T.value,current_page:V.value,status:g.value,direction:t,order_by:a,page:k.value.page,per_page:k.value.itemsPerPage,...n.value,date:ue.value}).then(e=>{if(e.data){const{data:p,current_page:de,next_page_url:me,total:O,per_page:ve,to:Me,last_page:pe}=e.data;_.value=p,D.value=pe,$.value=O}}).catch(e=>{console.error(e)}).then(()=>{x.value=!1})},1e3)}function ie(){ae.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(a=>{if(a.data){const{data:t,current_page:e,next_page_url:p,total:de,per_page:me,to:O,last_page:ve}=a.data;N.value=t}}).catch(a=>{console.error(a)}).then(()=>{x.value=!1})}return q([A,k,n],()=>{I()},{deep:!0}),Ve(()=>{V.value>D.value&&(V.value=D.value)}),F(()=>{}),(a,t)=>(z(),G(xe,null,[s(Ce,{title:u.value.title,breadcrumbs:c.value},null,8,["title","breadcrumbs"]),s(Q,null,{default:o(()=>[s(h,{cols:"12",md:"6"},{default:o(()=>[s(X,{md:"6","show-validation":d(f).params.status=="started","show-validated":d(f).params.status=="validated","show-processing":d(f).params.status=="processing","show-closed":d(f).params.status=="closed","show-cancelled":d(f).params.status=="cancelled","show-description":""},null,8,["show-validation","show-validated","show-processing","show-closed","show-cancelled"])]),_:1}),s(h,{cols:"12",md:"6"},{default:o(()=>[s(X,{"show-payments":"","show-description":""})]),_:1}),s(h,{cols:"12"},{default:o(()=>[s(De,{class:"border rounded-md",headers:U.value,loading:x.value,items:_.value,"multi-sort":!1,"items-per-page":T.value,"onUpdate:itemsPerPage":t[12]||(t[12]=e=>T.value=e),"items-per-page-text":a.$t("Articles par page"),options:k.value,"onUpdate:options":t[13]||(t[13]=e=>k.value=e),"sort-by":b.value,"onUpdate:sortBy":t[14]||(t[14]=e=>b.value=e),page:V.value,"onUpdate:page":t[15]||(t[15]=e=>V.value=e),"items-length":$.value,"onUpdate:itemsLength":t[16]||(t[16]=e=>$.value=e),"show-select":!1,"loading-text":a.$t("Chargement des éléments"),"no-data-text":a.$t("Pas de données"),"no-results-text":a.$t("Aucun résultat"),onPageCount:t[17]||(t[17]=e=>D.value=e)},{top:o(()=>[s($e,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:o(()=>[s(Q,null,{default:o(()=>[s(h,null,{default:o(()=>[s(W,{density:"compact",modelValue:n.value.search,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value.search=e),placeholder:a.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),s(h,null,{default:o(()=>[s(Y,{density:"compact",modelValue:n.value.event_type,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value.event_type=e),placeholder:a.$t("Prestation"),items:N.value,"item-value":"name","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),s(h,null,{default:o(()=>[s(Y,{density:"compact",modelValue:n.value.hall,"onUpdate:modelValue":t[2]||(t[2]=e=>n.value.hall=e),placeholder:a.$t("Salle"),items:B.value,"item-value":"id","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),s(h,null,{default:o(()=>[s(Z,{ref_key:"dialog",ref:se,modelValue:C.value,"onUpdate:modelValue":t[8]||(t[8]=e=>C.value=e),"return-value":n.value.date,"onUpdate:returnValue":t[9]||(t[9]=e=>n.value.date=e),persistent:"",width:"290px"},{activator:o(({props:e})=>[s(W,ke({modelValue:H.value,"onUpdate:modelValue":t[3]||(t[3]=p=>H.value=p),"prepend-inner-icon":"bx-calendar",readonly:""},e,{density:"compact",placeholder:a.$t("Date"),"hide-details":"",variant:"solo",flat:"",clearable:"","onClick:clear":t[4]||(t[4]=p=>n.value.date=null)}),null,16,["modelValue","placeholder"])]),default:o(({isActive:e})=>[s(Se,{locale:"fr"},{default:o(()=>[s(Ue,{modelValue:n.value.date,"onUpdate:modelValue":t[7]||(t[7]=p=>n.value.date=p),"hide-header":"",multiple:"range"},{actions:o(()=>[s(P,{color:"primary",onClick:t[5]||(t[5]=p=>C.value=!1)},{default:o(()=>[v(i(a.$t("Annuler")),1)]),_:1}),s(M),s(P,{variant:"elevated",color:"primary",onClick:t[6]||(t[6]=p=>C.value=!1)},{default:o(()=>[v(i(a.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1}),s(Z,{modelValue:S.value,"onUpdate:modelValue":t[11]||(t[11]=e=>S.value=e),"max-width":"500px"},{default:o(()=>[s(Te,null,{default:o(()=>[s(Ae,{class:"text-h5 text-center py-6"},{default:o(()=>[v(i(a.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),s(Ee,null,{default:o(()=>[s(M),s(P,{color:"error",variant:"flat",dark:"",onClick:t[10]||(t[10]=e=>S.value=!1)},{default:o(()=>[v(i(a.$t("Annuler")),1)]),_:1}),s(P,{color:"success",variant:"flat",dark:"",onClick:ne},{default:o(()=>[v(i(a.$t("OK")),1)]),_:1}),s(M)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.demand_date":o(({item:e})=>[v(i(d(J)(e.demand_date)),1)]),"item.event_date":o(({item:e})=>[v(i(d(J)(e.event_date)),1)]),"item.amount_left":o(({item:e})=>[Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?(z(),G("span",Ie,i(d(L)(Math.max(e.services_sum_total-e.payments_sum_amount,0))),1)):we("",!0)]),"item.services_sum_total":o(({item:e})=>[s(ee,{variant:"tonal",color:Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?"error":"success",class:"font-weight-bold"},{default:o(()=>[v(i(d(L)(e.payments_sum_amount||0))+" / "+i(d(L)(e.services_sum_total||0)),1)]),_:2},1032,["color"])]),"item.status":o(({item:e})=>[s(ee,{color:d(m).statusColor(e.status),size:"small",label:""},{default:o(()=>[v(i(d(m).statusText(e.status)),1)]),_:2},1032,["color"])]),"item.actions":o(({item:e})=>[s(P,{density:"compact",color:"primary",class:"mx-2",variant:"outlined",to:"/prestations/"+e.id},{default:o(()=>[v(i(a.$t("Voir")),1)]),_:2},1032,["to"])]),"no-data":o(()=>[Pe("span",null,i(a.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64))}});export{rt as default};
