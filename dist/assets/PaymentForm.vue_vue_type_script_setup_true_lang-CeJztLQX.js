import{a6 as B,av as E,e as k,r as f,aD as b,Z as N,o as h,_ as S,w as t,b as e,d as m,t as i,a4 as W,n as U,V as p,aC as X,h as Y,g as ee,bi as ae,c as te}from"./index-BSU_9Tr2.js";import{u as z}from"./Controller-Biu-2sMs.js";import{b as L,V as q,c as K,a as R}from"./VCard-DdG4wEel.js";import{f as x}from"./VMenu-D31jhW-Z.js";import{a as Z,V as P}from"./VRow-BAz3yy4W.js";import{a as D}from"./VSpacer-CaxT7gq-.js";import{V as F}from"./VDialog-DCiS52yG.js";import{u as le}from"./paymentMethod-D3olFOew.js";import{a as oe}from"./formatters-DCCWVJxZ.js";import{V as ne}from"./VAutocomplete-Ba1XRT5E.js";import{V as O}from"./VTextField-WEnT98sY.js";import{V as ue}from"./VLocaleProvider-BCOFEcRy.js";import{V as re}from"./VDatePicker-BiLRqvvv.js";const be=B({__name:"ClosePrestation",props:{modelValue:Object,icon:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(r,{emit:M}){const A=z(),C=E(),T=r,w=M,s=k({get:()=>T.modelValue,set:n=>w("update:modelValue",n)}),c=f(!1),V=f(!1);f(""),k(()=>`${b("Terminer la prestation")}`);function l(){V.value=!0,A.closeItem(s.value.id).then(n=>{s.value=n.data,c.value=!1,C.showSuccess(b("Prestation clôturée avec succès")),w("refresh")}).catch(n=>{V.value=!1,C.showError(n.message)}).then(()=>{V.value=!1})}return(n,d)=>{const y=N("CheckIcon");return h(),S(F,{modelValue:c.value,"onUpdate:modelValue":d[2]||(d[2]=v=>c.value=v),"max-width":"500px"},{activator:t(({props:v})=>[e(p,U({dark:""},v,{variant:"elevated",color:"primary",onClick:d[0]||(d[0]=_=>V.value=!1),icon:r.icon}),{default:t(()=>[m(i(r.icon?"":n.$t("Terminer la prestation"))+" ",1),r.icon?(h(),S(y,{key:0,"stroke-width":"1.5",size:"20"})):W("",!0)]),_:2},1040,["icon"])]),default:t(()=>[e(R,null,{default:t(()=>[e(L,{class:"text-h5 text-center py-6"},{default:t(()=>[m(i(n.$t("Terminer la prestation")),1)]),_:1}),e(x),e(q,null,{default:t(()=>[e(Z,null,{default:t(()=>[e(P,{cols:"12",class:"text-center"},{default:t(()=>[m(i(n.$t("Êtes-vous sûr de vouloir terminer la prestation?")),1)]),_:1})]),_:1})]),_:1}),e(x),e(K,null,{default:t(()=>[e(D),e(p,{color:"error",variant:"flat",dark:"",onClick:d[1]||(d[1]=v=>c.value=!1)},{default:t(()=>[m(i(n.$t("Non")),1)]),_:1}),e(p,{color:"success",variant:"flat",loading:V.value,dark:"",onClick:l},{default:t(()=>[m(i(n.$t("Oui")),1)]),_:1},8,["loading"]),e(D)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),se={key:1},he=B({__name:"PaymentForm",props:{modelValue:Object,prestation:Object,title:b("PaymentMethod"),variant:{type:String,default:"elevated"},density:{type:String,default:"default"},classes:{type:String,default:""},buttonText:b("Ajouter un paymentMethod")},emits:["update:modelValue","update:item"],setup(r,{emit:M}){const A=z(),C=E(),T=le(),w=X(),s=r,c=M,V=k({get:()=>s.modelValue,set:o=>c("update:modelValue",o)}),l=f(V.value||{id:null,prestation_id:null,amount:0,payment_date:new Date}),n=f(!1),d=f(!1),y=f(!1),v=f([]);Y(()=>{T.fetchItems({per_page:500}).then(o=>{v.value=o.data.data,console.log(v.value)}),l.value.id||(l.value.amount=$.value)});const _=k(()=>s.prestation.services?s.prestation.services.reduce((o,a)=>(console.log(a.total,o),parseFloat(a.total)+parseFloat(o)),0):0),$=k(()=>s.prestation.payments&&s.prestation.payments.length?_.value-s.prestation.payments.reduce((o,a)=>parseFloat(a.amount)+parseFloat(o),0):_.value);function G(){y.value=!0,A.savePayment(s.prestation.id,{...l.value,payment_date:J.value}).then(o=>{n.value=!1,c("update:item",o.data),C.showSuccess(b("Paiement enregistré avec succès"))}).catch(o=>{y.value=!1,C.showError(o.message)}).then(()=>{y.value=!1})}function H(o){if(console.log($.value),o){const a=v.value.find(I=>I.id==o);a&&(l.value.payment_method=a.name||null,l.value.id||(l.value.amount=$.value))}}const J=k(()=>l.value.payment_date?w.format(l.value.payment_date,"shortDate"):null),j=k(()=>l.value.payment_date?oe(l.value.payment_date):null);function Q(){y.value=!1,l.value.id||(l.value={payment_date:new Date,amount:$.value})}return ee([s.prestation],o=>{console.log("prestat",o),l.value.id||(l.value.amount=$.value)},{deep:!0}),(o,a)=>{const I=N("EditIcon");return h(),S(F,{modelValue:n.value,"onUpdate:modelValue":a[10]||(a[10]=u=>n.value=u),"max-width":"500px"},{activator:t(({props:u})=>[e(p,U({dark:""},u,{icon:l.value.id!=null,flat:l.value.id!=null,variant:r.variant,density:r.density,color:l.value.id!=null?null:"primary",class:r.classes,onClick:Q}),{default:t(()=>[ae(o.$slots,"default",{},()=>[l.value.id?(h(),S(I,{key:0,"stroke-width":"1.5",size:"20",class:"text-primary"})):(h(),te("span",se,i(r.buttonText),1))])]),_:2},1040,["icon","flat","variant","density","color","class"])]),default:t(()=>[e(R,null,{default:t(()=>[e(L,{class:"text-h5 text-center py-6"},{default:t(()=>[m(i(r.title),1)]),_:1}),e(x),e(q,null,{default:t(()=>[e(Z,null,{default:t(()=>[e(P,{cols:"12"},{default:t(()=>[e(ne,{modelValue:l.value.payment_method_id,"onUpdate:modelValue":[a[0]||(a[0]=u=>l.value.payment_method_id=u),H],label:o.$t("PaymentMethod"),clearable:"",items:v.value,"item-title":"name","item-value":"id",filled:!1,variant:"outlined",required:""},null,8,["modelValue","label","items"])]),_:1}),e(P,{cols:"12",md:"6"},{default:t(()=>[e(F,{ref:"dialogDemandDate",modelValue:d.value,"onUpdate:modelValue":a[6]||(a[6]=u=>d.value=u),"return-value":l.value.payment_date,"onUpdate:returnValue":a[7]||(a[7]=u=>l.value.payment_date=u),persistent:"",width:"290px"},{activator:t(({props:u})=>[e(O,U({modelValue:j.value,"onUpdate:modelValue":a[1]||(a[1]=g=>j.value=g)},u,{placeholder:o.$t("Date de la demande"),"hide-details":"",clearable:"",readonly:"","onClick:clear":a[2]||(a[2]=g=>l.value.payment_date=null)}),null,16,["modelValue","placeholder"])]),default:t(({isActive:u})=>[e(ue,{locale:"fr"},{default:t(()=>[e(re,{modelValue:l.value.payment_date,"onUpdate:modelValue":a[5]||(a[5]=g=>l.value.payment_date=g),"hide-header":""},{actions:t(()=>[e(p,{color:"primary",onClick:a[3]||(a[3]=g=>d.value=!1)},{default:t(()=>[m(i(o.$t("Annuler")),1)]),_:1}),e(D),e(p,{variant:"elevated",color:"primary",onClick:a[4]||(a[4]=g=>d.value=!1)},{default:t(()=>[m(i(o.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),e(P,{cols:"12",md:"6"},{default:t(()=>[e(O,{min:0,modelValue:l.value.amount,"onUpdate:modelValue":a[8]||(a[8]=u=>l.value.amount=u),type:"number",label:o.$t("Montant")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),e(K,null,{default:t(()=>[e(D),e(p,{color:"error",variant:"flat",dark:"",onClick:a[9]||(a[9]=u=>n.value=!1)},{default:t(()=>[m(i(o.$t("Annuler")),1)]),_:1}),e(p,{color:"success",variant:"flat",loading:y.value,dark:"",onClick:G},{default:t(()=>[m(i(o.$t("Ajouter")),1)]),_:1},8,["loading"]),e(D)]),_:1})]),_:1})]),_:3},8,["modelValue"])}}});export{he as _,be as a};
