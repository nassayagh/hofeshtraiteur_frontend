import{a9 as ee,aa as g,az as d,a6 as te,ay as ae,r as a,av as le,h as re,e as C,g as oe,q as se,o as ne,c as ue,b as l,w as o,n as ie,V as P,d as f,t as p,a8 as L,a as de,X as me}from"./index-BJHM7gAy.js";import{u as pe}from"./eventType-CVjiJMC0.js";import{_ as ve}from"./BaseBreadcrumb-DnGwAJ0g.js";import{a as fe,f as ce}from"./formatters-Dv1Ro_l4.js";import{_ as ge}from"./PrespationDashboard.vue_vue_type_script_setup_true_lang-BNcR0XWy.js";import{V as _,a as M}from"./VRow-DaH2-4tX.js";import{V as ye}from"./VDataTableServer-HF-5z8-L.js";import{V as he}from"./VToolbar-vej033f8.js";import{V as O}from"./VTextField-DZFvITyZ.js";import{V as Ve}from"./filter-DewXPuM-.js";import{V as R}from"./VDialog-DWoX183J.js";import{V as Pe}from"./VLocaleProvider-BvqD0Ko2.js";import{V as be}from"./VDatePicker-B-XDH8Zh.js";import{V as U}from"./VSpacer-Bpz83XCP.js";import{V as we,a as ke,b as $e}from"./VCard-CaJ5j7gp.js";import"./Controller-DjakKQ6s.js";import"./VTable-C630wu6p.js";import"./VDivider-Bfst1i1T.js";import"./index-CUixWq4_.js";import"./VAvatar-DmrmHn3w.js";import"./VField-BKzd96f8.js";import"./VMenu-DeUjaQEK.js";import"./createSimpleFunctional-DlxeIP2p.js";import"./VChip-LZF3RSku.js";import"./VSheet-DIl2hYRP.js";const De=ee({id:"Payments",state:()=>({payments:{data:[],loading:!1,error:null}}),actions:{fetchItems(n){return g.get("/payments",{params:n})},async addItem(n){return new Promise((i,m)=>{g.post("/payments",n).then(u=>i(u)).catch(u=>m(u))})},fetchItem(n){return new Promise((i,m)=>{g.get(`/payments/${n}`).then(u=>i(u)).catch(u=>m(u))})},deleteItem(n){return new Promise((i,m)=>{g.delete(`/payments/${n}`).then(u=>i(u)).catch(u=>m(u))})},cancelItem(n){return new Promise((i,m)=>{g.post(`/payments/cancel/${n}`).then(u=>i(u)).catch(u=>m(u))})},validateItem(n,i){return new Promise((m,u)=>{g.post(`/payments/validate/${n}`,{comment:i}).then(y=>m(y)).catch(y=>u(y))})},statusColor(n){return n==-1?"#FA896B":n==1?"#1f9007":n==2?"#5D87FF":"#FFAE1F"},statusText(n){return n==-1?d("Annulé"):n==1?d("Validé"):n==2?d("Terminé"):d("Nouvelle demande")}}}),Ye=te({__name:"List",setup(n){const i=ae();a();const m=le(),u=pe(),y=a({title:"Gestion des devis"}),G=a([{text:d("Dashboard"),disabled:!1,href:"/"},{text:d("Gestion des devis"),disabled:!0,href:"#"}]),b=a([]),A=a([]),x=De();re(()=>{N(),J()});const w=a(!1);a(!1),a(!1),a(!1),a(!1),a(""),a(),a(!1);const E=a(null);a(null),a(null),a(null);const k=a(!1);a();const S=a(10),h=a(2),$=a(2),I=a(0);a(!1);const K=a(!1);a(null);const T=a("");a(["primary","secondary","error","success","warning"]);const c=a([{key:"created_at",order:"DESC"}]);a(0);const s=a({search:null,status:null,date:null,event_type:null}),V=a({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"created_at",order:"DESC"}]}),q=a(-1),F=a({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});a({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});const D=a(!1),z=a([{title:d("Prénom"),align:"start",key:"prestation.customer.firstname",sortable:!1},{title:d("Nom"),align:"start",key:"prestation.customer.lastname",sortable:!1},{title:d("Email"),align:"start",key:"prestation.customer.email",sortable:!1},{title:d("Téléphone"),align:"start",key:"prestation.customer.phone",sortable:!1},{title:d("Prestation"),align:"start",key:"prestation.event_type"},{title:d("Mode de paiement"),align:"start",key:"payment_method"},{title:d("Montant payé"),align:"start",key:"amount"},{title:d("Date du paiement"),align:"start",key:"created_at"},{title:"Actions",key:"actions",sortable:!1}]),B=C(()=>s.value.date&&s.value.date.length>0?i.format(s.value.date[0],"shortDate")+" - "+i.format(s.value.date[s.value.date.length-1],"shortDate"):null);C(()=>x.payments.data.filter(r=>r.email.toLowerCase().includes(T.value.toLowerCase())));function X(){x.deleteItem(F.value.id);const r=b.value.findIndex(e=>e.id==F.value.id);b.value.splice(r,1),D.value=!1,m.showSuccess(d("Utilisateur supprimé avec succès"))}C(()=>q.value===-1?"Nouvel administrateur":"Modifier l’administrateur");const H=C(()=>s.value.date&&s.value.date.length?s.value.date.length>1?[i.format(s.value.date[0],"shortDate"),i.format(s.value.date[s.value.date.length-1],"shortDate")]:[i.format(s.value.date[0],"shortDate"),i.format(s.value.date[0],"shortDate")]:null);function N(){try{clearTimeout(E.value)}catch{}E.value=setTimeout(()=>{w.value=!0;let r="id",e="desc";console.log(c.value),c.value.length>0&&(r=c.value[0].key,e=c.value[0].order),x.fetchItems({term:T.value,paginate:S.value,current_page:h.value,direction:e,order_by:r,page:V.value.page,per_page:V.value.itemsPerPage,...s.value,date:H.value}).then(t=>{if(t.data){const{data:v,current_page:Q,next_page_url:W,total:j,per_page:Y,to:Ce,last_page:Z}=t.data;b.value=v,$.value=Z,I.value=j}}).catch(t=>{console.error(t)}).then(()=>{w.value=!1})},1e3)}function J(){u.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(r=>{if(r.data){const{data:e,current_page:t,next_page_url:v,total:Q,per_page:W,to:j,last_page:Y}=r.data;A.value=e}}).catch(r=>{console.error(r)}).then(()=>{w.value=!1})}return oe([T,V,s],()=>{N()},{deep:!0}),se(()=>{h.value>$.value&&(h.value=$.value)}),(r,e)=>(ne(),ue(me,null,[l(ve,{title:y.value.title,breadcrumbs:G.value},null,8,["title","breadcrumbs"]),l(ge,{"show-payments":"","show-description":"","show-total-payments":""}),l(M,null,{default:o(()=>[l(_,{cols:"12"},{default:o(()=>[l(ye,{class:"border rounded-md",headers:z.value,loading:w.value,items:b.value,"multi-sort":!1,"items-per-page":S.value,"onUpdate:itemsPerPage":e[10]||(e[10]=t=>S.value=t),"items-per-page-text":r.$t("Articles par page"),options:V.value,"onUpdate:options":e[11]||(e[11]=t=>V.value=t),"sort-by":c.value,"onUpdate:sortBy":e[12]||(e[12]=t=>c.value=t),page:h.value,"onUpdate:page":e[13]||(e[13]=t=>h.value=t),"items-length":I.value,"onUpdate:itemsLength":e[14]||(e[14]=t=>I.value=t),"show-select":!1,"loading-text":r.$t("Chargement des éléments"),"no-data-text":r.$t("Pas de données"),"no-results-text":r.$t("Aucun résultat"),onPageCount:e[15]||(e[15]=t=>$.value=t)},{top:o(()=>[l(he,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:o(()=>[l(M,null,{default:o(()=>[l(_,null,{default:o(()=>[l(O,{density:"compact",modelValue:s.value.search,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.search=t),placeholder:r.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo"},null,8,["modelValue","placeholder"])]),_:1}),l(_,null,{default:o(()=>[l(Ve,{density:"compact",modelValue:s.value.event_type,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.event_type=t),placeholder:r.$t("Prestation"),items:A.value,"item-value":"name","item-title":"name",multiple:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","items"])]),_:1}),l(_,null,{default:o(()=>[l(R,{ref_key:"dialog",ref:K,modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=t=>k.value=t),"return-value":s.value.date,"onUpdate:returnValue":e[7]||(e[7]=t=>s.value.date=t),persistent:"",width:"290px"},{activator:o(({props:t})=>[l(O,ie({modelValue:B.value,"onUpdate:modelValue":e[2]||(e[2]=v=>B.value=v),"prepend-inner-icon":"bx-calendar",readonly:""},t,{density:"compact",placeholder:r.$t("Date"),"hide-details":"",variant:"solo"}),null,16,["modelValue","placeholder"])]),default:o(({isActive:t})=>[l(Pe,{locale:"fr"},{default:o(()=>[l(be,{modelValue:s.value.date,"onUpdate:modelValue":e[5]||(e[5]=v=>s.value.date=v),"hide-header":"",multiple:"range"},{actions:o(()=>[l(P,{color:"primary",onClick:e[3]||(e[3]=v=>k.value=!1)},{default:o(()=>[f(p(r.$t("Annuler")),1)]),_:1}),l(U),l(P,{variant:"elevated",color:"primary",onClick:e[4]||(e[4]=v=>k.value=!1)},{default:o(()=>[f(p(r.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1}),l(R,{modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=t=>D.value=t),"max-width":"500px"},{default:o(()=>[l(we,null,{default:o(()=>[l(ke,{class:"text-h5 text-center py-6"},{default:o(()=>[f(p(r.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),l($e,null,{default:o(()=>[l(U),l(P,{color:"error",variant:"flat",dark:"",onClick:e[8]||(e[8]=t=>D.value=!1)},{default:o(()=>[f(p(r.$t("Annuler")),1)]),_:1}),l(P,{color:"success",variant:"flat",dark:"",onClick:X},{default:o(()=>[f(p(r.$t("OK")),1)]),_:1}),l(U)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.amount":o(({item:t})=>[f(p(L(fe)(t.amount)),1)]),"item.created_at":o(({item:t})=>[f(p(L(ce)(t.created_at)),1)]),"item.actions":o(({item:t})=>[l(P,{density:"compact",color:"primary",variant:"outlined",to:"/prestations/"+t.prestation_id},{default:o(()=>[f(p(r.$t("Voir la prestation liée")),1)]),_:2},1032,["to"])]),"no-data":o(()=>[de("span",null,p(r.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64))}});export{Ye as default};
