import{u as ue}from"./customers-DxOFblPC.js";import{u as _e}from"./eventType-Con-M3dj.js";import{_ as Ce,a as ye}from"./BaseBreadcrumb-BLYW9dWU.js";import{r as le}from"./validators-BPi-vT8z.js";import{a as Z}from"./formatters-DCCWVJxZ.js";import{a6 as ne,Z as de,o as x,_ as ke,w as a,b as e,a as i,t as n,V as p,a8 as _,c as F,a4 as Q,aC as we,r as s,av as Pe,aD as h,h as Ue,e as L,g as Se,q as De,n as se,d as c,X as xe}from"./index-CTWWqwFB.js";import{F as Te,V as Ie}from"./vee-validate.esm-fRPIiQPH.js";import{a as O,V as W,b as oe,c as re}from"./VCard-C-APrnZS.js";import{i as C,a as Ae}from"./VSpacer-CpXg8B4f.js";import{V as v,a as N}from"./VRow-BmCUl3Bv.js";import{_ as H}from"./CustomerForm.vue_vue_type_script_setup_true_lang-C8HHmRP1.js";import{V as je}from"./VDataTableServer-BRTWA4M4.js";import{V as Ee}from"./VToolbar-NGepkY2W.js";import{V as k}from"./VTextField-C4Wk-boL.js";import{V as J}from"./VDialog-Csg4ZvwQ.js";import{V as Be}from"./VLocaleProvider-BMs7zZDk.js";import{V as Le}from"./VDatePicker-xaEEPToe.js";import{V as Ne}from"./VContainer-D1Fh9kIV.js";import{V as Fe}from"./VTooltip-DrUA0_zW.js";import"./VAvatar-DDLJ7Omq.js";import"./VSheet-C1yuEtxl.js";const Oe={class:"d-flex align-start"},Me={class:"text-h4"},Re={class:"ml-auto"},qe={class:"mt-2"},ze={class:"text-h4 font-weight-regular"},Ge={key:0,class:"text-subtitle-1"},Ke={class:"d-flex align-start"},Xe={class:"text-h4"},Ze={class:"ml-auto"},He={class:"mt-2"},Je={class:"text-h4 font-weight-regular"},Qe={key:0,class:"text-subtitle-1"},We=ne({__name:"CustomerDashboard",props:{showDescription:{type:Boolean,default:!1}},setup(M){const g=ue();return g.fetchStatistics({}),(b,T)=>{const I=de("UsersGroupIcon");return x(),ke(N,null,{default:a(()=>[e(v,{class:"h-100",cols:"12",md:"6"},{default:a(()=>[e(O,{elevation:"10",class:"bg-info h-100"},{default:a(()=>[e(W,null,{default:a(()=>[i("div",Oe,[i("h2",Me,n(b.$t("Prospets")),1),e(C),i("div",Re,[e(p,{depressed:"",color:"white",class:"btn-custom-sm",small:"",icon:""},{default:a(()=>[e(I,{class:"text-info"})]),_:1})])]),i("div",qe,[i("h2",ze,n(_(g).statistics.prospects||0),1),M.showDescription?(x(),F("span",Ge,n(b.$t("Personnes sans prestations")),1)):Q("",!0)])]),_:1})]),_:1})]),_:1}),e(v,{class:"h-100",cols:"12",md:"6"},{default:a(()=>[e(O,{elevation:"10",class:"bg-success h-100"},{default:a(()=>[e(W,null,{default:a(()=>[i("div",Ke,[i("h2",Xe,n(b.$t("Clients")),1),e(C),i("div",Ze,[e(p,{depressed:"",color:"white",class:"btn-custom-sm",small:"",icon:""},{default:a(()=>[e(I,{class:"text-success"})]),_:1})])]),i("div",He,[i("h2",Je,n(_(g).statistics.customers||0),1),M.showDescription?(x(),F("span",Qe,n(b.$t("Personnes avec des prestations")),1)):Q("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})}}}),Ye={class:"text-h5"},et={key:0,class:"mt-2"},tt=["onClick"],at=["onClick"],lt={class:"d-flex align-center"},Ut=ne({__name:"List",setup(M){const g=we(),b=s(),T=Pe();_e();const I=s({title:"Clients"}),ie=s([{text:h("Dashboard"),disabled:!1,href:"/"},{text:h("Clients"),disabled:!0,href:"#"}]),V=s([]);s([]);const $=ue();Ue(()=>{D()});const R=s(!1),w=s(!1);s(!1),s(!1),s(!1),s(""),s(),s(!1);const Y=s(null);s(null),s(null),s(null);const A=s(!1);s();const q=s(100),P=s(2),j=s(2),E=s(0),ee=s(!1),me=s(!1),B=s(!1);s(null);const z=s("");s(["primary","secondary","error","success","warning"]);const y=s([{key:"firstname",order:"asc"}]);s(0);const G=s({}),K=s({is_customer:!0}),r=s({search:null,status:null,date:null,event_type:null}),U=s({itemsPerPage:100,rowsPerPage:100,page:1,sortDesc:[!0],sortBy:[{key:"firstname",order:"asc"}]}),X=s(-1),d=s({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),ve=s({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),S=s(!1),ce=s([{title:"Actions",key:"actions",sortable:!1},{title:"Prénom",align:"start",key:"firstname"},{title:"Nom",align:"start",key:"lastname"},{title:"Email",align:"start",key:"email"},{title:"Téléphone",align:"start",key:"phone"},{title:"Date de creation",align:"start",key:"created_at"},{title:"Status",align:"start",key:"is_customer"}]),te=L(()=>r.value.date&&r.value.date.length>0?Z(r.value.date[0])+" - "+Z(r.value.date[r.value.date.length-1]):null);L(()=>$.customers.data.filter(o=>o.email.toLowerCase().includes(z.value.toLowerCase())));function pe(o){d.value=o,S.value=!0}function fe(){B.value=!1,setTimeout(()=>{d.value=Object.assign({},ve.value),X.value=-1},300)}function ge(o,{setErrors:t}){var f;(f=b.value)==null||f.validate().then(({valid:l})=>{l&&(w.value=!0,$.addItem(d.value).then(u=>{if(u.data.error){t({apiError:u.data.message}),T.showError(u.data.message);return}d.value.id!=null?Object.assign(V.value[X.value],u.data):V.value.unshift(u.data),w.value=!1,B.value=!1,T.showSuccess(h("Client enregistré avec succès")),$.fetchStatistics()}).catch(u=>{w.value=!1,t({apiError:u})}).then(()=>{w.value=!1,t({apiError:null})}))})}function Ve(){$.deleteItem(d.value.id);const o=V.value.findIndex(t=>t.id==d.value.id);V.value.splice(o,1),S.value=!1,T.showSuccess(h("Client supprimé avec succès")),$.fetchStatistics()}const he=L(()=>X.value===-1?d.value.is_customer?h("Nouvel Client"):h("Nouvel Prospect"):d.value.is_customer?h("Modifier Le Client"):h("Modifier Le Prospect")),be=L(()=>r.value.date&&r.value.date.length?r.value.date.length>1?[g.format(r.value.date[0],"shortDate"),g.format(r.value.date[r.value.date.length-1],"shortDate")]:[g.format(r.value.date[0],"shortDate"),g.format(r.value.date[0],"shortDate")]:null);function D(){try{clearTimeout(Y.value)}catch{}K.value={is_customer:!0},G.value={},Y.value=setTimeout(()=>{R.value=!0;let o="firstname",t="asc";console.log(y.value),y.value.length>0&&(o=y.value[0].key,t=y.value[0].order),$.fetchItems({term:z.value,paginate:q.value,current_page:P.value,direction:t,order_by:o,page:U.value.page,per_page:U.value.itemsPerPage,...r.value,date:be.value}).then(f=>{if(f.data){const{data:l,current_page:u,next_page_url:m,total:ae,per_page:st,to:ot,last_page:$e}=f.data;V.value=l,j.value=$e,E.value=ae}}).catch(f=>{console.error(f)}).then(()=>{R.value=!1})},1e3)}return Se([z,U,r],()=>{D()},{deep:!0}),De(()=>{P.value>j.value&&(P.value=j.value)}),(o,t)=>{const f=de("TrashIcon");return x(),F(xe,null,[e(Ce,{title:`${I.value.title}(${E.value})`,breadcrumbs:ie.value},null,8,["title","breadcrumbs"]),e(N,null,{default:a(()=>[e(v,{cols:"12"},{default:a(()=>[e(We)]),_:1}),e(v,{cols:"12"},{default:a(()=>[e(je,{class:"border rounded-md",headers:ce.value,loading:R.value,items:V.value,"multi-sort":!1,"items-per-page":q.value,"onUpdate:itemsPerPage":t[19]||(t[19]=l=>q.value=l),"items-per-page-text":o.$t("Articles par page"),options:U.value,"onUpdate:options":t[20]||(t[20]=l=>U.value=l),"sort-by":y.value,"onUpdate:sortBy":t[21]||(t[21]=l=>y.value=l),page:P.value,"onUpdate:page":t[22]||(t[22]=l=>P.value=l),"items-length":E.value,"onUpdate:itemsLength":t[23]||(t[23]=l=>E.value=l),"show-select":!1,"loading-text":o.$t("Chargement des éléments"),"no-data-text":o.$t("Pas de données"),"no-results-text":o.$t("Aucun résultat"),onPageCount:t[24]||(t[24]=l=>j.value=l)},{top:a(()=>[e(Ee,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:a(()=>[e(N,null,{default:a(()=>[e(v,null,{default:a(()=>[e(k,{density:"compact",modelValue:r.value.search,"onUpdate:modelValue":t[0]||(t[0]=l=>r.value.search=l),placeholder:o.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),e(v,null,{default:a(()=>[e(ye,{density:"compact",modelValue:r.value.status,"onUpdate:modelValue":t[1]||(t[1]=l=>r.value.status=l),placeholder:o.$t("Statut"),items:_($).statusesList,"item-value":"id","item-title":"label",clearable:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","items"])]),_:1}),e(v,null,{default:a(()=>[e(J,{ref_key:"dialog",ref:me,modelValue:A.value,"onUpdate:modelValue":t[7]||(t[7]=l=>A.value=l),"return-value":r.value.date,"onUpdate:returnValue":t[8]||(t[8]=l=>r.value.date=l),persistent:"",width:"290px"},{activator:a(({props:l})=>[e(k,se({modelValue:te.value,"onUpdate:modelValue":t[2]||(t[2]=u=>te.value=u),"prepend-inner-icon":"bx-calendar"},l,{density:"compact",placeholder:o.$t("Date"),"hide-details":"",variant:"solo",clearable:"",readonly:"","onClick:clear":t[3]||(t[3]=u=>r.value.date=null)}),null,16,["modelValue","placeholder"])]),default:a(({isActive:l})=>[e(Be,{locale:"fr"},{default:a(()=>[e(Le,{modelValue:r.value.date,"onUpdate:modelValue":t[6]||(t[6]=u=>r.value.date=u),"hide-header":"",multiple:"range"},{actions:a(()=>[e(p,{color:"primary",onClick:t[4]||(t[4]=u=>A.value=!1)},{default:a(()=>[c(n(o.$t("Annuler")),1)]),_:1}),e(C),e(p,{variant:"elevated",color:"primary",onClick:t[5]||(t[5]=u=>A.value=!1)},{default:a(()=>[c(n(o.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),e(v,{class:"d-flex gap-2 justify-space-between"},{default:a(()=>[e(H,{modelValue:G.value,"onUpdate:modelValue":t[9]||(t[9]=l=>G.value=l),"button-text":o.$t("Ajouter un Prospect"),onSaved:D},null,8,["modelValue","button-text"]),e(H,{modelValue:K.value,"onUpdate:modelValue":t[10]||(t[10]=l=>K.value=l),"button-text":o.$t("Ajouter un client"),onSaved:D},null,8,["modelValue","button-text"]),e(J,{modelValue:B.value,"onUpdate:modelValue":t[16]||(t[16]=l=>B.value=l),"max-width":"600px"},{default:a(()=>[e(O,null,{default:a(()=>[e(oe,{class:"pa-4 bg-secondary"},{default:a(()=>[i("span",Ye,n(he.value),1)]),_:1}),e(_(Te),{ref_key:"refForm",ref:b,modelValue:ee.value,"onUpdate:modelValue":t[15]||(t[15]=l=>ee.value=l),onSubmit:ge},{default:a(({errors:l,isSubmitting:u})=>[e(W,null,{default:a(()=>[e(Ne,{class:"px-0"},{default:a(()=>[e(N,null,{default:a(()=>[e(v,{cols:"12",md:"6"},{default:a(()=>[e(k,{modelValue:d.value.firstname,"onUpdate:modelValue":t[11]||(t[11]=m=>d.value.firstname=m),rules:[_(le)],label:o.$t("Prénom")},null,8,["modelValue","rules","label"])]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[e(k,{modelValue:d.value.lastname,"onUpdate:modelValue":t[12]||(t[12]=m=>d.value.lastname=m),rules:[_(le)],label:o.$t("Nom")},null,8,["modelValue","rules","label"])]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[e(k,{modelValue:d.value.email,"onUpdate:modelValue":t[13]||(t[13]=m=>d.value.email=m),label:o.$t("Email")},null,8,["modelValue","label"])]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[e(k,{modelValue:d.value.phone,"onUpdate:modelValue":t[14]||(t[14]=m=>d.value.phone=m),label:o.$t("Téléphone")},null,8,["modelValue","label"])]),_:1})]),_:1}),l.apiError?(x(),F("div",et,[e(Ie,{color:"error"},{default:a(()=>[c(n(l.apiError),1)]),_:2},1024)])):Q("",!0)]),_:2},1024)]),_:2},1024),e(re,null,{default:a(()=>[e(C),e(p,{color:"error",variant:"flat",dark:"",onClick:fe},{default:a(()=>[c(n(o.$t("Annuler")),1)]),_:1}),e(p,{color:"success",variant:"flat",loading:w.value,type:"submit"},{default:a(()=>[c(n(o.$t("Sauvegarder")),1)]),_:1},8,["loading"]),e(C)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(J,{modelValue:S.value,"onUpdate:modelValue":t[18]||(t[18]=l=>S.value=l),"max-width":"500px"},{default:a(()=>[e(O,null,{default:a(()=>[e(oe,{class:"text-h5 text-center py-6"},{default:a(()=>[c(n(o.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),e(re,null,{default:a(()=>[e(C),e(p,{color:"error",variant:"flat",dark:"",onClick:t[17]||(t[17]=l=>S.value=!1)},{default:a(()=>[c(n(o.$t("Annuler")),1)]),_:1}),e(p,{color:"success",variant:"flat",dark:"",onClick:Ve},{default:a(()=>[c(n(o.$t("OK")),1)]),_:1}),e(C)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.firstname":a(({item:l})=>[i("span",{class:"cursor-pointer",onClick:u=>o.$router.push("/customers/"+l.id)},n(l.firstname),9,tt)]),"item.lastname":a(({item:l})=>[i("span",{class:"cursor-pointer",onClick:u=>o.$router.push("/customers/"+l.id)},n(l.lastname),9,at)]),"item.created_at":a(({item:l})=>[c(n(_(Z)(l.created_at)),1)]),"item.is_customer":a(({item:l})=>[e(Ae,{color:l.is_customer==1?"success":"warning",size:"small",label:""},{default:a(()=>[c(n(l.is_customer==1?o.$t("Client"):o.$t("Prospet")),1)]),_:2},1032,["color"])]),"item.actions":a(({index:l,item:u})=>[i("div",lt,[e(p,{density:"compact",color:"primary",variant:"outlined",to:"/customers/"+u.id},{default:a(()=>[c(n(o.$t("Voir")),1)]),_:2},1032,["to"]),e(H,{modelValue:V.value[l],"onUpdate:modelValue":m=>V.value[l]=m,"is-new":!1,onSaved:D},null,8,["modelValue","onUpdate:modelValue"]),e(Fe,{text:o.$t("Supprimer")},{activator:a(({props:m})=>[e(p,se({icon:"",flat:"",onClick:ae=>pe(u)},m),{default:a(()=>[e(f,{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040,["onClick"])]),_:2},1032,["text"])])]),"no-data":a(()=>[i("span",null,n(o.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64)}}});export{Ut as default};
