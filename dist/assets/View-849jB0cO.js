import{u as L}from"./Controller-BYygQIxl.js";import{a6 as B,e as I,o as c,_ as b,w as t,b as e,a as u,d as V,t as a,c as O,a4 as U,av as R,r as d,aK as M,n as z,V as A,a8 as g,h as ae,Z,aL as me,g as ce,aM as ve,X as Y,a5 as oe}from"./index-CfYHWYZq.js";import{_ as fe}from"./BaseBreadcrumb-BOd56rua.js";import{f as q,a as K}from"./formatters-Dv1Ro_l4.js";import{d as X,a as D,V as E,b as H,c as G}from"./VCard-Dcy8KbWZ.js";import{f as N}from"./VMenu-BDTGSksr.js";import{a as F,V as S}from"./VRow-CdijmP0y.js";import{V as le}from"./VTextarea-CSRgCF6r.js";import{V as T}from"./VSpacer-DLo5Oi9t.js";import{c as Q}from"./VDialog-WAHa-LM4.js";import{V as ee}from"./VChip-DtMbUV1S.js";import{u as pe}from"./service-C_SNqmMw.js";import{V as de}from"./VAutocomplete-ClZOiOOL.js";import{V as te}from"./VTextField-CKZHfJFg.js";import{u as he}from"./paymentMethod-DVpXUdUe.js";import{_ as ue}from"./ChangeHall.vue_vue_type_script_setup_true_lang-BhatCSZX.js";import{V as _e}from"./VAlert-Dt20aOKY.js";import{V as ne}from"./VTable-Dvq9ZZlz.js";import{V as Ve}from"./VTooltip-DMp6fyz0.js";import"./VAvatar-D4e20FOe.js";import"./index-I5jEJkIR.js";import"./filter-DXOcWSNv.js";import"./hall-edCu7j-2.js";const $e={class:"text-h6 d-flex align-content-center align-center"},ye=u("br",null,null,-1),ge={class:"text-subtitle-1 textSecondary mt-3"},be={class:"text-subtitle-1 textSecondary mt-3"},ke={class:"text-subtitle-1 textSecondary mt-3"},Ce={class:"text-subtitle-1 textSecondary mt-3"},Se={class:"text-subtitle-1 textSecondary mt-3"},xe={key:0,class:"text-subtitle-1 textSecondary mt-3"},we={key:1,class:"text-subtitle-1 textSecondary mt-3"},je={key:2,class:"text-subtitle-1 textSecondary mt-3"},Pe={key:3,class:"text-subtitle-1 textSecondary mt-3"},Ae={key:4,class:"text-subtitle-1 textSecondary mt-3"},Ue={key:5,class:"text-subtitle-1 textSecondary mt-3"},Ie={class:"text-subtitle-1 textSecondary mt-3"},Me=["innerHTML"],Te=B({__name:"HallWidget",props:{modelValue:Object,showDemandInfo:Boolean},emits:["update:modelValue"],setup(P,{emit:l}){L();const v=P,x=l,p=I({get:()=>v.modelValue,set:n=>x("update:modelValue",n)});return(n,r)=>(c(),b(E,{elevation:"10",class:"overflow-hidden h-100"},{default:t(()=>[e(X,{class:"py-4 px-6 text-white bg-info"},{default:t(()=>[u("h4",$e,[V(a(n.$t("Information de la salle"))+" ",1),e(T),e(ue,{modelValue:p.value,"onUpdate:modelValue":r[0]||(r[0]=s=>p.value=s)},null,8,["modelValue"])])]),_:1}),p.value.hall?(c(),b(D,{key:1,class:"pl-6 pr-6"},{default:t(()=>[u("p",ge,a(n.$t("Nom :"))+" "+a(p.value.hall.name||""),1),u("p",be,a(n.$t("Adresse :"))+" "+a(p.value.hall.address||""),1),u("p",ke,a(n.$t("Nom du régisseur :"))+" "+a(p.value.hall.manager_name||""),1),u("p",Ce,a(n.$t("Téléphone du régisseur :"))+" "+a(p.value.hall.manager_phone||""),1),u("p",Se,a(n.$t("Mail du régisseur :"))+" "+a(p.value.hall.manager_email||""),1),p.value.hall.packing?(c(),O("p",xe,a(n.$t("Parking :"))+" "+a("Oui"),1)):U("",!0),p.value.hall.kitchen?(c(),O("p",we,a(n.$t("Cuisine :"))+" "+a("Oui"),1)):U("",!0),p.value.hall.cold_rooom?(c(),O("p",je,a(n.$t("Chambre froidre :"))+" "+a("Oui"),1)):U("",!0),p.value.hall.ladder?(c(),O("p",Pe,a(n.$t("Escalier pour déchargement :"))+" "+a("Oui"),1)):U("",!0),p.value.hall.transportation_fee?(c(),O("p",Ae,a(n.$t("Frais de déplacement à prévoir :"))+" "+a("Oui"),1)):U("",!0),p.value.hall.table?(c(),O("p",Ue,a(n.$t("Table de buffet :"))+" "+a("Oui"),1)):U("",!0),u("p",Ie,a(n.$t("Bac de poubelle :"))+" "+a(p.value.hall.bin=="salle"?n.$t("Géré par la salle"):n.$t("Géré par le client")),1),u("p",{class:"text-subtitle-1 textSecondary mt-3",innerHTML:p.value.hall.comment?p.value.hall.comment:""},null,8,Me)]),_:1})):(c(),b(D,{key:0,class:"pl-6 pr-6 pt-6"},{default:t(()=>[e(_e,{type:"info"},{default:t(()=>[V(a(n.$t("Aucune salle n'a été attribuée. Veuillez attribuer une salle."))+" ",1),ye,e(ue,{modelValue:p.value,"onUpdate:modelValue":r[1]||(r[1]=s=>p.value=s)},null,8,["modelValue"])]),_:1})]),_:1}))]),_:1}))}}),De=B({__name:"CancelPrestation",props:{modelValue:Object},emits:["update:modelValue"],setup(P,{emit:l}){const v=L(),x=R(),p=P,n=l,r=I({get:()=>p.modelValue,set:o=>n("update:modelValue",o)}),s=d(!1),h=d(!1),k=d("");I(()=>`${M("Annuler la prestation")}`);function _(){h.value=!0,v.cancelItem(r.value.id,k.value).then(o=>{r.value=o.data,s.value=!1,x.showSuccess(M("Prestation annulée avec succès"))}).catch(o=>{h.value=!1,x.showError(o.message)}).then(()=>{h.value=!1})}return(o,f)=>(c(),b(Q,{modelValue:s.value,"onUpdate:modelValue":f[3]||(f[3]=m=>s.value=m),"max-width":"500px"},{activator:t(({props:m})=>[e(A,z({class:"ml-2",dark:""},m,{variant:"outlined",color:"primary",onClick:f[0]||(f[0]=j=>h.value=!1)}),{default:t(()=>[V(a(o.$t("Annuler la prestation")),1)]),_:2},1040)]),default:t(()=>[e(E,null,{default:t(()=>[e(H,{class:"text-h5 text-center py-6"},{default:t(()=>[V(a(o.$t("Annuler la prestation")),1)]),_:1}),e(N),e(D,null,{default:t(()=>[e(F,null,{default:t(()=>[e(S,{cols:"12",class:"text-center"},{default:t(()=>[V(a(o.$t("Êtes-vous sûr de vouloir Annuler la prestation?")),1)]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(le,{modelValue:k.value,"onUpdate:modelValue":f[1]||(f[1]=m=>k.value=m),placeholder:o.$t("Commentaire"),label:o.$t("Commentaire")},null,8,["modelValue","placeholder","label"])]),_:1})]),_:1})]),_:1}),e(N),e(G,null,{default:t(()=>[e(T),e(A,{color:"error",variant:"flat",dark:"",onClick:f[2]||(f[2]=m=>s.value=!1)},{default:t(()=>[V(a(o.$t("Non")),1)]),_:1}),e(A,{color:"success",variant:"flat",loading:h.value,dark:"",onClick:_},{default:t(()=>[V(a(o.$t("Oui")),1)]),_:1},8,["loading"]),e(T)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Oe=B({__name:"ValidatePrestation",props:{modelValue:Object},emits:["update:modelValue"],setup(P,{emit:l}){const v=L(),x=R(),p=P,n=l,r=I({get:()=>p.modelValue,set:o=>n("update:modelValue",o)}),s=d(!1),h=d(!1),k=d("");I(()=>`${M("Valider la prestation")}`);function _(){h.value=!0,v.validateItem(r.value.id,k.value).then(o=>{r.value=o.data,s.value=!1,x.showSuccess(M("Prestation validée avec succès"))}).catch(o=>{h.value=!1,x.showError(o.message)}).then(()=>{h.value=!1})}return(o,f)=>(c(),b(Q,{modelValue:s.value,"onUpdate:modelValue":f[3]||(f[3]=m=>s.value=m),"max-width":"500px"},{activator:t(({props:m})=>[e(A,z({dark:""},m,{variant:"elevated",color:"primary",onClick:f[0]||(f[0]=j=>h.value=!1)}),{default:t(()=>[V(a(r.value.status==g(v).statuses.cancelled?o.$t("Rouvrir la prestation"):o.$t("Valider la prestation")),1)]),_:2},1040)]),default:t(()=>[e(E,null,{default:t(()=>[e(H,{class:"text-h5 text-center py-6"},{default:t(()=>[V(a(r.value.status==g(v).statuses.cancelled?o.$t("Rouvrir la prestation"):o.$t("Valider la prestation")),1)]),_:1}),e(N),e(D,null,{default:t(()=>[e(F,null,{default:t(()=>[e(S,{cols:"12",class:"text-center"},{default:t(()=>[V(a(r.value.status==g(v).statuses.cancelled?o.$t("Êtes-vous sûr de vouloir Rouvrir la prestation"):o.$t("Êtes-vous sûr de vouloir Valider la prestation?")),1)]),_:1}),r.value.status==g(v).statuses.cancelled?(c(),b(S,{key:0,cols:"12"},{default:t(()=>[e(le,{modelValue:k.value,"onUpdate:modelValue":f[1]||(f[1]=m=>k.value=m),placeholder:o.$t("Commentaire"),label:o.$t("Commentaire")},null,8,["modelValue","placeholder","label"])]),_:1})):U("",!0)]),_:1})]),_:1}),e(N),e(G,null,{default:t(()=>[e(T),e(A,{color:"error",variant:"flat",dark:"",onClick:f[2]||(f[2]=m=>s.value=!1)},{default:t(()=>[V(a(o.$t("Non")),1)]),_:1}),e(A,{color:"success",variant:"flat",loading:h.value,dark:"",onClick:_},{default:t(()=>[V(a(o.$t("Oui")),1)]),_:1},8,["loading"]),e(T)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ee={class:"text-h6"},Fe={class:"text-subtitle-1 textSecondary mt-3"},Ne={class:"text-subtitle-1 textSecondary mt-3"},Le={class:"text-subtitle-1 textSecondary mt-3"},Be={class:"text-subtitle-1 textSecondary mt-3"},qe={class:"text-subtitle-1 textSecondary mt-3"},Re={class:"text-subtitle-1 textSecondary mt-3"},ze={class:"text-subtitle-1 textSecondary mt-3"},He={class:"text-subtitle-1 textSecondary mt-3"},Ge={key:0,class:"text-subtitle-1 textSecondary mt-3"},Qe={key:1,class:"text-subtitle-1 textSecondary mt-3"},We=B({__name:"CustomerWidget",props:{modelValue:Object,showDemandInfo:Boolean},emits:["update:modelValue"],setup(P,{emit:l}){const v=L(),x=P,p=l,n=I({get:()=>x.modelValue,set:r=>p("update:modelValue",r)});return(r,s)=>(c(),b(E,{elevation:"10",class:"overflow-hidden h-100"},{default:t(()=>[e(X,{class:"py-4 px-6 text-white bg-primary"},{default:t(()=>[u("h4",Ee,a(r.$t("Identification du demandeur")),1)]),_:1}),e(D,{class:"pl-6 pr-6"},{default:t(()=>[u("p",Fe,a(r.$t("Prénom :"))+" "+a(n.value.customer.firstname||""),1),u("p",Ne,a(r.$t("Nom :"))+" "+a(n.value.customer.lastname||""),1),u("p",Le,a(r.$t("Email :"))+" "+a(n.value.customer.email||""),1),u("p",Be,a(r.$t("Téléphone :"))+" "+a(n.value.customer.phone||""),1),u("p",qe,a(r.$t("Date d'enregistrement :"))+" "+a(g(q)(n.value.customer.created_at)||""),1),u("p",Re,[V(a(r.$t("Type :"))+" ",1),n.value.customer&&n.value.customer.is_customer?(c(),b(ee,{key:0,color:"success"},{default:t(()=>[V(a(r.$t("Client")),1)]),_:1})):(c(),b(ee,{key:1,color:"error"},{default:t(()=>[V(a(r.$t("Prospect")),1)]),_:1}))])]),_:1}),P.showDemandInfo?(c(),b(D,{key:0,class:"pt-0 pb-0"},{default:t(()=>[e(N)]),_:1})):U("",!0),P.showDemandInfo?(c(),b(D,{key:1,class:"pl-6 pr-6"},{default:t(()=>[u("p",ze,a(r.$t("Date de la demande :"))+" "+a(g(q)(n.value.demand_date)||""),1),u("p",He,a(r.$t("Date création de la prestation :"))+" "+a(g(q)(n.value.created_at)||""),1),n.value.status>=g(v).statuses.processing?(c(),O("p",Ge,a(r.$t("Date lancement de la prestation :"))+" "+a(g(q)(n.value.start_date)||""),1)):U("",!0),n.value.status>=g(v).statuses.closed?(c(),O("p",Qe,a(r.$t("Date clôture de la prestation :"))+" "+a(g(q)(n.value.closed_date)||""),1)):U("",!0)]),_:1})):U("",!0)]),_:1}))}}),Ke={key:1},re=B({__name:"ServiceForm",props:{modelValue:Object,prestation:Object,title:M("Service"),buttonText:M("Ajouter un service")},emits:["update:modelValue","update:item"],setup(P,{emit:l}){const v=L(),x=R(),p=pe(),n=P,r=l,s=I({get:()=>n.modelValue,set:m=>r("update:modelValue",m)}),h=d(!1),k=d(!1),_=d([]);ae(()=>{p.fetchItems({per_page:500}).then(m=>{_.value=m.data.data,console.log(_.value)})});function o(){k.value=!0,v.saveService(n.prestation.id,s.value).then(m=>{h.value=!1,r("update:item",m.data),s.value={},s.value={},x.showSuccess(M("Service enregistré avec succès"))}).catch(m=>{k.value=!1,x.showError(m.message)}).then(()=>{k.value=!1})}function f(m){if(m){const j=_.value.find(C=>C.name==m);j&&(s.value.quantity=s.value.quantity||1,s.value.service_id=j.id||null,s.value.price=j.price||0,s.value.total=(s.value.quantity||1)*(j.price||0))}}return(m,j)=>{const C=Z("EditIcon");return c(),b(Q,{modelValue:h.value,"onUpdate:modelValue":j[5]||(j[5]=y=>h.value=y),"max-width":"500px"},{activator:t(({props:y})=>[e(A,z({dark:""},y,{icon:s.value.id!=null,flat:s.value.id!=null,variant:"elevated",color:s.value.id!=null?null:"primary",onClick:j[0]||(j[0]=i=>k.value=!1)}),{default:t(()=>[s.value.id?(c(),b(C,{key:0,"stroke-width":"1.5",size:"20",class:"text-primary"})):(c(),O("span",Ke,a(P.buttonText),1))]),_:2},1040,["icon","flat","color"])]),default:t(()=>[e(E,null,{default:t(()=>[e(H,{class:"text-h5 text-center py-6"},{default:t(()=>[V(a(P.title),1)]),_:1}),e(N),e(D,null,{default:t(()=>[e(F,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(de,{modelValue:s.value.name,"onUpdate:modelValue":[j[1]||(j[1]=y=>s.value.name=y),f],label:m.$t("Service"),clearable:"",items:_.value,"item-title":"name","item-value":"name",filled:!1,variant:"outlined"},null,8,["modelValue","label","items"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(te,{min:1,modelValue:s.value.quantity,"onUpdate:modelValue":j[2]||(j[2]=y=>s.value.quantity=y),type:"number",label:m.$t("Quantité")},null,8,["modelValue","label"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(te,{min:0,modelValue:s.value.price,"onUpdate:modelValue":j[3]||(j[3]=y=>s.value.price=y),type:"number",label:m.$t("Prix")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),e(G,null,{default:t(()=>[e(T),e(A,{color:"error",variant:"flat",dark:"",onClick:j[4]||(j[4]=y=>h.value=!1)},{default:t(()=>[V(a(m.$t("Annuler")),1)]),_:1}),e(A,{color:"success",variant:"flat",loading:k.value,dark:"",onClick:o},{default:t(()=>[V(a(m.$t("Ajouter")),1)]),_:1},8,["loading"]),e(T)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Xe=B({__name:"DeleteService",props:{modelValue:Object,service:Object},emits:["update:modelValue"],setup(P,{emit:l}){const v=L(),x=R(),p=P,n=l,r=I({get:()=>p.modelValue,set:_=>n("update:modelValue",_)}),s=d(!1),h=d(!1);function k(){h.value=!0,v.deleteService(r.value.id,p.service.id).then(_=>{r.value=_.data,s.value=!1,x.showSuccess(M("Service supprimé avec succès"))}).then(()=>{s.value=!1,h.value=!1})}return(_,o)=>{const f=Z("TrashIcon");return c(),b(Q,{modelValue:s.value,"onUpdate:modelValue":o[2]||(o[2]=m=>s.value=m),"max-width":"350px"},{activator:t(({props:m})=>[e(A,z({icon:"",flat:"",class:"ml-3",dark:""},m,{onClick:o[0]||(o[0]=j=>h.value=!1)}),{default:t(()=>[e(f,{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040)]),default:t(()=>[e(E,null,{default:t(()=>[e(H,{class:"text-h5 text-center py-6"},{default:t(()=>[V(a(_.$t("Êtes-vous sûr de vouloir supprimer le service?")),1)]),_:1}),e(G,null,{default:t(()=>[e(T),e(A,{color:"error",variant:"flat",dark:"",onClick:o[1]||(o[1]=m=>s.value=!1)},{default:t(()=>[V(a(_.$t("Non")),1)]),_:1}),e(A,{color:"success",variant:"flat",loading:h.value,dark:"",onClick:k},{default:t(()=>[V(a(_.$t("Oui")),1)]),_:1},8,["loading"]),e(T)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Ze={key:1},Je=B({__name:"PaymentForm",props:{modelValue:Object,prestation:Object,title:M("PaymentMethod"),buttonText:M("Ajouter un paymentMethod")},emits:["update:modelValue","update:item"],setup(P,{emit:l}){const v=L(),x=R(),p=he(),n=P,r=l,s=I({get:()=>n.modelValue,set:C=>r("update:modelValue",C)}),h=d(!1),k=d(!1),_=d([]);ae(()=>{p.fetchItems({per_page:500}).then(C=>{_.value=C.data.data,console.log(_.value)}),s.value.amount=f.value});const o=I(()=>n.prestation.services?n.prestation.services.reduce((C,y)=>(console.log(y.total,C),parseFloat(y.total)+parseFloat(C)),0):0),f=I(()=>n.prestation.payments&&n.prestation.payments.length?o.value-n.prestation.payments.reduce((C,y)=>parseFloat(y.amount)+parseFloat(C),0):o.value);function m(){k.value=!0,v.savePayment(n.prestation.id,s.value).then(C=>{h.value=!1,r("update:item",C.data),s.value={},s.value={},x.showSuccess(M("PaymentMethod enregistré avec succès"))}).catch(C=>{k.value=!1,x.showError(C.message)}).then(()=>{k.value=!1})}function j(C){if(console.log(f.value),C){const y=_.value.find(i=>i.id==C);y&&(s.value.payment_method=y.name||null,s.value.amount=f.value)}}return(C,y)=>{const i=Z("EditIcon");return c(),b(Q,{modelValue:h.value,"onUpdate:modelValue":y[4]||(y[4]=$=>h.value=$),"max-width":"500px"},{activator:t(({props:$})=>[f.value>0?(c(),b(A,z({key:0,dark:""},$,{icon:s.value.id!=null,flat:s.value.id!=null,variant:"elevated",color:s.value.id!=null?null:"primary",onClick:y[0]||(y[0]=J=>k.value=!1)}),{default:t(()=>[s.value.id?(c(),b(i,{key:0,"stroke-width":"1.5",size:"20",class:"text-primary"})):(c(),O("span",Ze,a(P.buttonText),1))]),_:2},1040,["icon","flat","color"])):U("",!0)]),default:t(()=>[e(E,null,{default:t(()=>[e(H,{class:"text-h5 text-center py-6"},{default:t(()=>[V(a(P.title),1)]),_:1}),e(N),e(D,null,{default:t(()=>[e(F,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(de,{modelValue:s.value.payment_method_id,"onUpdate:modelValue":[y[1]||(y[1]=$=>s.value.payment_method_id=$),j],label:C.$t("PaymentMethod"),clearable:"",items:_.value,"item-title":"name","item-value":"id",filled:!1,variant:"outlined"},null,8,["modelValue","label","items"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(te,{min:0,modelValue:s.value.amount,"onUpdate:modelValue":y[2]||(y[2]=$=>s.value.amount=$),type:"number",label:C.$t("Montant")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),e(G,null,{default:t(()=>[e(T),e(A,{color:"error",variant:"flat",dark:"",onClick:y[3]||(y[3]=$=>h.value=!1)},{default:t(()=>[V(a(C.$t("Annuler")),1)]),_:1}),e(A,{color:"success",variant:"flat",loading:k.value,dark:"",onClick:m},{default:t(()=>[V(a(C.$t("Ajouter")),1)]),_:1},8,["loading"]),e(T)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Ye=B({__name:"ClosePrestation",props:{modelValue:Object},emits:["update:modelValue"],setup(P,{emit:l}){const v=L(),x=R(),p=P,n=l,r=I({get:()=>p.modelValue,set:_=>n("update:modelValue",_)}),s=d(!1),h=d(!1);d(""),I(()=>`${M("Terminer la prestation")}`);function k(){h.value=!0,v.closeItem(r.value.id).then(_=>{r.value=_.data,s.value=!1,x.showSuccess(M("Prestation clôturée avec succès"))}).catch(_=>{h.value=!1,x.showError(_.message)}).then(()=>{h.value=!1})}return(_,o)=>(c(),b(Q,{modelValue:s.value,"onUpdate:modelValue":o[2]||(o[2]=f=>s.value=f),"max-width":"500px"},{activator:t(({props:f})=>[e(A,z({dark:""},f,{variant:"elevated",color:"primary",onClick:o[0]||(o[0]=m=>h.value=!1)}),{default:t(()=>[V(a(_.$t("Terminer la prestation")),1)]),_:2},1040)]),default:t(()=>[e(E,null,{default:t(()=>[e(H,{class:"text-h5 text-center py-6"},{default:t(()=>[V(a(_.$t("Terminer la prestation")),1)]),_:1}),e(N),e(D,null,{default:t(()=>[e(F,null,{default:t(()=>[e(S,{cols:"12",class:"text-center"},{default:t(()=>[V(a(_.$t("Êtes-vous sûr de vouloir terminer la prestation?")),1)]),_:1})]),_:1})]),_:1}),e(N),e(G,null,{default:t(()=>[e(T),e(A,{color:"error",variant:"flat",dark:"",onClick:o[1]||(o[1]=f=>s.value=!1)},{default:t(()=>[V(a(_.$t("Non")),1)]),_:1}),e(A,{color:"success",variant:"flat",loading:h.value,dark:"",onClick:k},{default:t(()=>[V(a(_.$t("Oui")),1)]),_:1},8,["loading"]),e(T)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),et=B({__name:"CommentPrestation",props:{modelValue:Object},emits:["update:modelValue"],setup(P,{emit:l}){const v=L(),x=R(),p=P,n=l,r=I({get:()=>p.modelValue,set:o=>n("update:modelValue",o)}),s=d(!1),h=d(!1),k=d(r.value.commentaire||"");I(()=>`${M("Commentaire")}`);function _(){h.value=!0,v.addComment(r.value.id,k.value).then(o=>{r.value=o.data,s.value=!1,x.showSuccess(M("Commentaire ajouté avec succès"))}).catch(o=>{h.value=!1,x.showError(o.message)}).then(()=>{h.value=!1})}return(o,f)=>(c(),b(Q,{modelValue:s.value,"onUpdate:modelValue":f[3]||(f[3]=m=>s.value=m),"max-width":"500px"},{activator:t(({props:m})=>[e(A,z({density:"compact",dark:""},m,{variant:"outlined",color:"primary",onClick:f[0]||(f[0]=j=>h.value=!1)}),{default:t(()=>[V(a(!r.value.commentaire||r.value.commentaire.length==0?o.$t("Ajouter"):o.$t("Modifier")),1)]),_:2},1040)]),default:t(()=>[e(E,null,{default:t(()=>[e(H,{class:"text-h5 text-center py-6"},{default:t(()=>[V(a(!r.value.commentaire||r.value.commentaire.length==0?o.$t("Ajouter un commentaire"):o.$t("Modifier le commentaire")),1)]),_:1}),e(N),e(D,null,{default:t(()=>[e(F,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(le,{modelValue:k.value,"onUpdate:modelValue":f[1]||(f[1]=m=>k.value=m),placeholder:o.$t("Commentaire"),label:o.$t("Commentaire")},null,8,["modelValue","placeholder","label"])]),_:1})]),_:1})]),_:1}),e(N),e(G,null,{default:t(()=>[e(T),e(A,{color:"error",variant:"flat",dark:"",onClick:f[2]||(f[2]=m=>s.value=!1)},{default:t(()=>[V(a(o.$t("Annuler")),1)]),_:1}),e(A,{color:"success",variant:"flat",loading:h.value,dark:"",onClick:_},{default:t(()=>[V(a(o.$t("Enregistrer")),1)]),_:1},8,["loading"]),e(T)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),tt={key:0,class:"ml-2"},at={class:"d-flex align-start"},lt={class:"text-h4 mt-1"},st={class:"ml-auto"},ot={class:"mt-9"},ut={class:"text-h4 font-weight-semibold mb-1"},nt={class:"d-flex align-start"},rt={class:"text-h4 mt-1"},dt={class:"ml-auto"},it={class:"mt-9"},mt={class:"text-h4 font-weight-semibold mb-1"},ct={class:"d-flex align-start"},vt={class:"text-h4 mt-1"},ft={class:"mt-4"},pt={class:"mb-1"},ht={class:"d-flex align-start"},_t={class:"text-h4 mt-1"},Vt={class:"mt-4"},$t={class:"mb-1"},yt={class:"d-flex align-start"},gt={class:"text-h4 mt-1"},bt={class:"mt-4"},kt={class:"mb-1"},Ct={class:"text-h6 d-flex align-center"},St={class:"text-h6"},xt={class:"text-h6"},wt={class:"text-h6"},jt={class:"text-h6"},Pt={class:"text-h6"},At={key:0,class:"d-flex align-center"},Ut={class:"text-h6 d-flex align-center"},It={class:"text-h6"},Mt={class:"text-h6"},Tt={class:"text-h6"},sa=B({__name:"View",setup(P){d(),R();const l=d({id:null,status:0,service:"",demand_date:null,customer_id:null,demand_id:null,payments:[],services:[],customer:{id:null,firstname:"",lastname:"",email:"",phone:"",is_customer:!1,created_at:null,demands:[],prestations:[]}}),v=L(),x=me(),p=d({title:M("Détails du devis")+" "+(l.value.event_type||"")+" "+(l.value.customer||{firstname:""}).firstname+" "+(l.value.customer||{lastname:""}).lastname+" "+(q(l.value.demand_date)||"")}),n=d([{text:M("Dashboard"),disabled:!1,href:"/"},{text:v.pageTitle(l.value.status),disabled:!1,href:v.pageLink(l.value.status)},{text:l.value.event_type||"",disabled:!0,href:"#"}]);function r(){p.value={title:M("Prestation")+" "+(l.value.demand.event_type||"")+" ("+(l.value.customer||{firstname:""}).firstname+" "+(l.value.customer||{lastname:""}).lastname+" "+(q(l.value.demand_date)||"")+")"},n.value=[{text:M("Dashboard"),disabled:!1,href:"/"},{text:v.pageTitle(l.value.status),disabled:!1,href:v.pageLink(l.value.status)},{text:p.value.title,disabled:!0,href:"#"}]}ae(()=>{C()});const s=d(!1);d(!1),d(!1),d(!1),d(!1),d(!1),d(!1),d({}),d({}),d(!1),d(10),d(2),d(2),d(!1),d(!1),d(null);const h=d("");d(["primary","secondary","error","success","warning"]),d([{key:"demand_date",order:"DESC"}]),d(0),d({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"demand_date",order:"DESC"}]});const k=d(-1);d({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});const _=d({id:null,service_id:null,name:"",price:0,total:0,quantity:0}),o=d({id:null,prestation_id:null,amount:0});d({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),d(!1),d([{title:"Prestation",align:"start",key:"event_type"},{title:"Date de la prestation",align:"start",key:"demand_date"},{title:"Status",align:"start",key:"status"},{title:"Actions",key:"actions",sortable:!1}]),I(()=>v.prestations.data.filter(i=>i.email.toLowerCase().includes(h.value.toLowerCase())));const f=I(()=>x.params.id);I(()=>l.value.customer.prestations?l.value.customer.prestations.filter(i=>i.id!=l.value.id):[]);const m=I(()=>l.value.services&&l.value.services.length?l.value.services.reduce((i,$)=>(console.log($.total,i),parseFloat($.total)+parseFloat(i)),0):0),j=I(()=>l.value.payments&&l.value.payments.length?m.value-l.value.payments.reduce((i,$)=>parseFloat($.amount)+parseFloat(i),0):m.value);I(()=>k.value===-1?"Nouvel administrateur":"Modifier l’administrateur");function C(){s.value=!0,v.fetchItem(x.params.id).then(i=>{i.data.error||(s.value=!1,l.value=i.data,r())}).catch(i=>{s.value=!1}).then(()=>{s.value=!1})}function y(i){l.value=i}return ce(f,(i,$)=>{i!=$&&C()},{deep:!0}),(i,$)=>{const J=Z("CurrencyEuroIcon");return c(),O(Y,null,[s.value?U("",!0):(c(),b(fe,{key:0,title:p.value.title,breadcrumbs:n.value},null,8,["title","breadcrumbs"])),s.value?(c(),b(F,{key:1,justify:"center",align:"center","align-content":"center"},{default:t(()=>[e(S,{cols:"12",justify:"center",align:"center","align-content":"center"},{default:t(()=>[e(ve,{indeterminate:"",color:"primary",size:"150"})]),_:1})]),_:1})):(c(),b(F,{key:2},{default:t(()=>[e(S,{cols:"12",md:"4"},{default:t(()=>[V(a(i.$t("Status :"))+" ",1),e(ee,{rounded:"md",class:"font-weight-bold",color:g(v).statusColor(l.value.status),size:"small",label:""},{default:t(()=>[V(a(g(v).statusText(l.value.status)),1)]),_:1},8,["color"]),l.value.status==g(v).statuses.cancelled?(c(),O("span",tt,a(i.$t("Le"))+" "+a(g(q)(l.value.cancelled_date)||""),1)):U("",!0)]),_:1}),e(S,{cols:"12",md:"8",justify:"end","align-content":"end",align:"end"},{default:t(()=>[l.value.status==g(v).statuses.started||l.value.status==g(v).statuses.cancelled?(c(),b(Oe,{key:0,modelValue:l.value,"onUpdate:modelValue":$[0]||($[0]=w=>l.value=w)},null,8,["modelValue"])):U("",!0),l.value.status==g(v).statuses.validated?(c(),b(Ye,{key:1,modelValue:l.value,"onUpdate:modelValue":$[1]||($[1]=w=>l.value=w)},null,8,["modelValue"])):U("",!0),l.value.status!=g(v).statuses.cancelled?(c(),b(De,{key:2,modelValue:l.value,"onUpdate:modelValue":$[2]||($[2]=w=>l.value=w)},null,8,["modelValue"])):U("",!0),e(N,{vertical:""}),e(A,{variant:"elevated",color:"success",class:"ml-2",to:"/customers/"+l.value.customer_id},{default:t(()=>[V(a(i.$t("Voir le Client")),1)]),_:1},8,["to"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(We,{modelValue:l.value,"onUpdate:modelValue":$[3]||($[3]=w=>l.value=w),"show-demand-info":""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Te,{modelValue:l.value,"onUpdate:modelValue":$[4]||($[4]=w=>l.value=w),"show-demand-info":""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"6",class:"justify-end align-end"},{default:t(()=>[e(F,{class:"align-end justify-end align-content-end"},{default:t(()=>[e(S,{cols:"12",class:"align-end justify-end align-content-end"},{default:t(()=>[e(F,{class:"align-end justify-end align-content-end"},{default:t(()=>[l.value.status>=g(v).statuses.validated?(c(),b(S,{key:0,cols:"12",md:"6",class:""},{default:t(()=>[e(E,{elevation:"10"},{default:t(()=>[e(D,null,{default:t(()=>[u("div",at,[u("h2",lt,a(i.$t("Reste à payer")),1),e(T),u("div",st,[e(A,{color:"primary",icon:"",flat:""},{default:t(()=>[e(J)]),_:1})])]),u("div",ot,[u("h2",ut,a(g(K)(j.value)),1)])]),_:1})]),_:1})]),_:1})):U("",!0),e(S,{cols:"12",md:"6"},{default:t(()=>[e(E,{elevation:"10"},{default:t(()=>[e(D,null,{default:t(()=>[u("div",nt,[u("h2",rt,a(i.$t("Montant total")),1),e(T),u("div",dt,[e(A,{color:"primary",icon:"",flat:""},{default:t(()=>[e(J)]),_:1})])]),u("div",it,[u("h2",mt,a(g(K)(m.value||0)),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{cols:"12",class:"align-end justify-end align-content-end"},{default:t(()=>[e(F,{class:"align-end justify-end align-content-end"},{default:t(()=>[e(S,{class:"h-100",cols:"12"},{default:t(()=>[e(F,null,{default:t(()=>[e(S,{cols:"12",md:"6"},{default:t(()=>[e(E,{elevation:"10",class:"h-100"},{default:t(()=>[e(D,null,{default:t(()=>[u("div",ct,[u("h2",vt,a(i.$t("Note liée à la prestation")),1)]),u("div",ft,[u("p",pt,a(l.value.comment||i.$t("Aucun note")),1)])]),_:1})]),_:1})]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(E,{elevation:"10",class:"h-100"},{default:t(()=>[e(D,null,{default:t(()=>[u("div",ht,[u("h2",_t,a(i.$t("Commentaire")),1),e(et,{modelValue:l.value,"onUpdate:modelValue":$[5]||($[5]=w=>l.value=w)},null,8,["modelValue"])]),u("div",Vt,[u("p",$t,a(l.value.commentaire||i.$t("Aucun commentaire")),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l.value.status==g(v).statuses.cancelled?(c(),b(S,{key:0,cols:"12"},{default:t(()=>[e(E,{elevation:"10",class:"h-100"},{default:t(()=>[e(D,null,{default:t(()=>[u("div",yt,[u("h2",gt,a(i.$t("Raison de l'annulation")),1)]),u("div",bt,[u("p",kt,a(l.value.cancel_comment||i.$t("Aucun commentaire")),1)])]),_:1})]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{cols:"12",lg:l.value.status>g(v).statuses.started?"6":"12"},{default:t(()=>[e(E,{elevation:"10",class:"overflow-hidden h-100"},{default:t(()=>[e(X,{class:"py-4 px-6 text-white bg-info"},{default:t(()=>[u("h4",Ct,[u("span",null,a(i.$t("Désignation des services attendus")),1),e(T),l.value.status<g(v).statuses.processing?(c(),b(re,{key:0,modelValue:_.value,"onUpdate:modelValue":$[6]||($[6]=w=>_.value=w),prestation:l.value,"onUpdate:item":y,"button-text":i.$t("Ajouter un service"),title:i.$t("Ajouter un service")},null,8,["modelValue","prestation","button-text","title"])):U("",!0)])]),_:1}),e(D,{class:"pa-6"},{default:t(()=>[e(ne,{class:"month-table"},{default:t(()=>[u("thead",null,[u("tr",null,[u("th",St,a(i.$t("Désignation")),1),u("th",xt,a(i.$t("Quantité")),1),u("th",wt,a(i.$t("Prix unitaire")),1),u("th",jt,a(i.$t("Prix total")),1),u("th",Pt,a(i.$t("Actions")),1)])]),u("tbody",null,[(c(!0),O(Y,null,oe(l.value.services,(w,W)=>(c(),O("tr",{key:w.id,class:"month-item"},[u("td",null,a(w.name),1),u("td",null,a(w.quantity),1),u("td",null,a(g(K)(w.price)),1),u("td",null,a(g(K)(w.total)),1),u("td",null,[l.value.status<g(v).statuses.processing?(c(),O("div",At,[e(Ve,{text:i.$t("Modifier")},{activator:t(({props:se})=>[e(re,{modelValue:l.value.services[W],"onUpdate:modelValue":ie=>l.value.services[W]=ie,prestation:l.value,"onUpdate:item":y,"button-text":i.$t("Modifier le service"),title:i.$t("Modifier le service")},null,8,["modelValue","onUpdate:modelValue","prestation","button-text","title"])]),_:2},1032,["text"]),e(Xe,{modelValue:l.value,"onUpdate:modelValue":$[7]||($[7]=se=>l.value=se),service:l.value.services[W]},null,8,["modelValue","service"])])):U("",!0)])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["lg"]),l.value.status>g(v).statuses.started?(c(),b(S,{key:0,cols:"12",lg:l.value.status>g(v).statuses.started?"6":"12"},{default:t(()=>[e(E,{elevation:"10",class:"overflow-hidden h-100"},{default:t(()=>[e(X,{class:"py-4 px-6 text-white bg-info"},{default:t(()=>[u("h4",Ut,[u("span",null,a(i.$t("Paiements")),1),e(T),l.value.status<g(v).statuses.closed?(c(),b(Je,{key:0,modelValue:o.value,"onUpdate:modelValue":$[8]||($[8]=w=>o.value=w),prestation:l.value,"onUpdate:item":y,"button-text":i.$t("Ajouter un paiement"),title:i.$t("Ajouter un paiement")},null,8,["modelValue","prestation","button-text","title"])):U("",!0)])]),_:1}),e(D,{class:"pa-6"},{default:t(()=>[e(ne,{class:"month-table"},{default:t(()=>[u("thead",null,[u("tr",null,[u("th",It,a(i.$t("Mode de paiement")),1),u("th",Mt,a(i.$t("Montant payé")),1),u("th",Tt,a(i.$t("Date du paiement")),1)])]),u("tbody",null,[(c(!0),O(Y,null,oe(l.value.payments,(w,W)=>(c(),O("tr",{key:w.id},[u("td",null,a(w.payment_method),1),u("td",null,a(w.amount),1),u("td",null,a(g(q)(w.created_at)),1)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["lg"])):U("",!0)]),_:1}))],64)}}});export{sa as default};
