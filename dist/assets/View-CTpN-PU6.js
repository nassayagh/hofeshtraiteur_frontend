import{u as q}from"./Controller-affsgHRo.js";import{a6 as R,e as A,o as p,_ as k,w as t,b as e,a as o,d as $,t as a,c as T,a4 as U,av as Q,r as d,aK as D,n as G,V as P,a8 as g,h as le,Z as ee,aJ as me,aL as ce,g as ve,aM as pe,X as te,a5 as oe}from"./index-ByVbuanv.js";import{_ as fe,V as ne}from"./BaseBreadcrumb-EI-uaaPh.js";import{a as z,f as X}from"./formatters-ChhyeSK0.js";import{d as Z,V as O,a as F,b as W,c as J}from"./VCard-D8jqdyHr.js";import{f as L}from"./VMenu-B4xZ6Nzt.js";import{a as N,V as w}from"./VRow-DE7XMKPg.js";import{V as se}from"./VTextarea-Hz4Umd_D.js";import{a as M,V as ae}from"./VSpacer-nS6bYtKg.js";import{V as K}from"./VDialog-B8J_jI9q.js";import{u as he}from"./service-CsJdKso3.js";import{V as de}from"./VAutocomplete-DaU6w5D5.js";import{V as Y}from"./VTextField-W8WSSoQI.js";import{u as _e}from"./paymentMethod-DIA5LABm.js";import{V as Ve}from"./VLocaleProvider-DW3qm9KL.js";import{V as $e}from"./VDatePicker-DVnGp5qH.js";import{_ as ue}from"./ChangeHall.vue_vue_type_script_setup_true_lang-CdTDDduD.js";import{V as ye}from"./VAlert-D6_V-cW5.js";import{V as ge}from"./VTooltip-g8FPqHdg.js";import"./VAvatar-DdFp7Ur3.js";import"./VSelect-D-nEYc66.js";import"./filter-D6wZfKUE.js";import"./VSheet-BtCIXRa_.js";import"./hall-Fvnfzwtm.js";const be={class:"text-h6 d-flex align-content-center align-center"},ke=o("br",null,null,-1),Ce={class:"text-subtitle-1 textSecondary mt-3"},Se={class:"text-subtitle-1 textSecondary mt-3"},we={class:"text-subtitle-1 textSecondary mt-3"},xe={class:"text-subtitle-1 textSecondary mt-3"},Pe={class:"text-subtitle-1 textSecondary mt-3"},je={key:0,class:"text-subtitle-1 textSecondary mt-3"},Ue={key:1,class:"text-subtitle-1 textSecondary mt-3"},Ae={key:2,class:"text-subtitle-1 textSecondary mt-3"},De={key:3,class:"text-subtitle-1 textSecondary mt-3"},Ie={key:4,class:"text-subtitle-1 textSecondary mt-3"},Me={key:5,class:"text-subtitle-1 textSecondary mt-3"},Oe={class:"text-subtitle-1 textSecondary mt-3"},Te=["innerHTML"],Ee=R({__name:"HallWidget",props:{modelValue:Object,showDemandInfo:Boolean},emits:["update:modelValue"],setup(j,{emit:l}){q();const h=j,x=l,_=A({get:()=>h.modelValue,set:i=>x("update:modelValue",i)});return(i,u)=>(p(),k(F,{elevation:"10",class:"overflow-hidden h-100"},{default:t(()=>[e(Z,{class:"py-4 px-6 text-white bg-info"},{default:t(()=>[o("h4",be,[$(a(i.$t("Information de la salle"))+" ",1),e(M),e(ue,{modelValue:_.value,"onUpdate:modelValue":u[0]||(u[0]=n=>_.value=n)},null,8,["modelValue"])])]),_:1}),_.value.hall?(p(),k(O,{key:1,class:"pl-6 pr-6"},{default:t(()=>[o("p",Ce,a(i.$t("Nom :"))+" "+a(_.value.hall.name||""),1),o("p",Se,a(i.$t("Adresse :"))+" "+a(_.value.hall.address||""),1),o("p",we,a(i.$t("Nom du régisseur :"))+" "+a(_.value.hall.manager_name||""),1),o("p",xe,a(i.$t("Téléphone du régisseur :"))+" "+a(_.value.hall.manager_phone||""),1),o("p",Pe,a(i.$t("Mail du régisseur :"))+" "+a(_.value.hall.manager_email||""),1),_.value.hall.packing?(p(),T("p",je,a(i.$t("Parking :"))+" "+a("Oui"),1)):U("",!0),_.value.hall.kitchen?(p(),T("p",Ue,a(i.$t("Cuisine :"))+" "+a("Oui"),1)):U("",!0),_.value.hall.cold_rooom?(p(),T("p",Ae,a(i.$t("Chambre froidre :"))+" "+a("Oui"),1)):U("",!0),_.value.hall.ladder?(p(),T("p",De,a(i.$t("Escalier pour déchargement :"))+" "+a("Oui"),1)):U("",!0),_.value.hall.transportation_fee?(p(),T("p",Ie,a(i.$t("Frais de déplacement à prévoir :"))+" "+a("Oui"),1)):U("",!0),_.value.hall.table?(p(),T("p",Me,a(i.$t("Table de buffet :"))+" "+a("Oui"),1)):U("",!0),o("p",Oe,a(i.$t("Bac de poubelle :"))+" "+a(_.value.hall.bin=="salle"?i.$t("Géré par la salle"):i.$t("Géré par le client")),1),o("p",{class:"text-subtitle-1 textSecondary mt-3",innerHTML:_.value.hall.comment?_.value.hall.comment:""},null,8,Te)]),_:1})):(p(),k(O,{key:0,class:"pl-6 pr-6 pt-6"},{default:t(()=>[e(ye,{type:"info"},{default:t(()=>[$(a(i.$t("Aucune salle n'a été attribuée. Veuillez attribuer une salle."))+" ",1),ke,e(ue,{modelValue:_.value,"onUpdate:modelValue":u[1]||(u[1]=n=>_.value=n)},null,8,["modelValue"])]),_:1})]),_:1}))]),_:1}))}}),Fe=R({__name:"CancelPrestation",props:{modelValue:Object},emits:["update:modelValue"],setup(j,{emit:l}){const h=q(),x=Q(),_=j,i=l,u=A({get:()=>_.modelValue,set:s=>i("update:modelValue",s)}),n=d(!1),r=d(!1),C=d("");A(()=>`${D("Annuler la prestation")}`);function V(){r.value=!0,h.cancelItem(u.value.id,C.value).then(s=>{u.value=s.data,n.value=!1,x.showSuccess(D("Prestation annulée avec succès"))}).catch(s=>{r.value=!1,x.showError(s.message)}).then(()=>{r.value=!1})}return(s,f)=>(p(),k(K,{modelValue:n.value,"onUpdate:modelValue":f[3]||(f[3]=m=>n.value=m),"max-width":"500px"},{activator:t(({props:m})=>[e(P,G({class:"ml-2",dark:""},m,{variant:"outlined",color:"primary",onClick:f[0]||(f[0]=S=>r.value=!1)}),{default:t(()=>[$(a(s.$t("Annuler la prestation")),1)]),_:2},1040)]),default:t(()=>[e(F,null,{default:t(()=>[e(W,{class:"text-h5 text-center py-6"},{default:t(()=>[$(a(s.$t("Annuler la prestation")),1)]),_:1}),e(L),e(O,null,{default:t(()=>[e(N,null,{default:t(()=>[e(w,{cols:"12",class:"text-center"},{default:t(()=>[$(a(s.$t("Êtes-vous sûr de vouloir Annuler la prestation?")),1)]),_:1}),e(w,{cols:"12"},{default:t(()=>[e(se,{modelValue:C.value,"onUpdate:modelValue":f[1]||(f[1]=m=>C.value=m),placeholder:s.$t("Commentaire"),label:s.$t("Commentaire")},null,8,["modelValue","placeholder","label"])]),_:1})]),_:1})]),_:1}),e(L),e(J,null,{default:t(()=>[e(M),e(P,{color:"error",variant:"flat",dark:"",onClick:f[2]||(f[2]=m=>n.value=!1)},{default:t(()=>[$(a(s.$t("Non")),1)]),_:1}),e(P,{color:"success",variant:"flat",loading:r.value,dark:"",onClick:V},{default:t(()=>[$(a(s.$t("Oui")),1)]),_:1},8,["loading"]),e(M)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ne=R({__name:"ValidatePrestation",props:{modelValue:Object},emits:["update:modelValue"],setup(j,{emit:l}){const h=q(),x=Q(),_=j,i=l,u=A({get:()=>_.modelValue,set:s=>i("update:modelValue",s)}),n=d(!1),r=d(!1),C=d("");A(()=>`${D("Valider la prestation")}`);function V(){r.value=!0,h.validateItem(u.value.id,C.value).then(s=>{u.value=s.data,n.value=!1,x.showSuccess(D("Prestation validée avec succès"))}).catch(s=>{r.value=!1,x.showError(s.message)}).then(()=>{r.value=!1})}return(s,f)=>(p(),k(K,{modelValue:n.value,"onUpdate:modelValue":f[3]||(f[3]=m=>n.value=m),"max-width":"500px"},{activator:t(({props:m})=>[e(P,G({dark:""},m,{variant:"elevated",color:"primary",onClick:f[0]||(f[0]=S=>r.value=!1)}),{default:t(()=>[$(a(u.value.status==g(h).statuses.cancelled?s.$t("Rouvrir la prestation"):s.$t("Valider la prestation")),1)]),_:2},1040)]),default:t(()=>[e(F,null,{default:t(()=>[e(W,{class:"text-h5 text-center py-6"},{default:t(()=>[$(a(u.value.status==g(h).statuses.cancelled?s.$t("Rouvrir la prestation"):s.$t("Valider la prestation")),1)]),_:1}),e(L),e(O,null,{default:t(()=>[e(N,null,{default:t(()=>[e(w,{cols:"12",class:"text-center"},{default:t(()=>[$(a(u.value.status==g(h).statuses.cancelled?s.$t("Êtes-vous sûr de vouloir Rouvrir la prestation"):s.$t("Êtes-vous sûr de vouloir Valider la prestation?")),1)]),_:1}),u.value.status==g(h).statuses.cancelled?(p(),k(w,{key:0,cols:"12"},{default:t(()=>[e(se,{modelValue:C.value,"onUpdate:modelValue":f[1]||(f[1]=m=>C.value=m),placeholder:s.$t("Commentaire"),label:s.$t("Commentaire")},null,8,["modelValue","placeholder","label"])]),_:1})):U("",!0)]),_:1})]),_:1}),e(L),e(J,null,{default:t(()=>[e(M),e(P,{color:"error",variant:"flat",dark:"",onClick:f[2]||(f[2]=m=>n.value=!1)},{default:t(()=>[$(a(s.$t("Non")),1)]),_:1}),e(P,{color:"success",variant:"flat",loading:r.value,dark:"",onClick:V},{default:t(()=>[$(a(s.$t("Oui")),1)]),_:1},8,["loading"]),e(M)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Le={class:"text-h6"},Be={class:"text-subtitle-1 textSecondary mt-3"},qe={class:"text-subtitle-1 textSecondary mt-3"},Re={class:"text-subtitle-1 textSecondary mt-3"},ze={class:"text-subtitle-1 textSecondary mt-3"},He={class:"text-subtitle-1 textSecondary mt-3"},Ge={class:"text-subtitle-1 textSecondary mt-3"},Ke={class:"text-subtitle-1 textSecondary mt-3"},Qe={class:"text-subtitle-1 textSecondary mt-3"},We={key:0,class:"text-subtitle-1 textSecondary mt-3"},Je={key:1,class:"text-subtitle-1 textSecondary mt-3"},Xe=R({__name:"CustomerWidget",props:{modelValue:Object,showDemandInfo:Boolean},emits:["update:modelValue"],setup(j,{emit:l}){const h=q(),x=j,_=l,i=A({get:()=>x.modelValue,set:u=>_("update:modelValue",u)});return(u,n)=>(p(),k(F,{elevation:"10",class:"overflow-hidden h-100"},{default:t(()=>[e(Z,{class:"py-4 px-6 text-white bg-primary"},{default:t(()=>[o("h4",Le,a(u.$t("Identification du demandeur")),1)]),_:1}),e(O,{class:"pl-6 pr-6"},{default:t(()=>[o("p",Be,a(u.$t("Prénom :"))+" "+a(i.value.customer.firstname||""),1),o("p",qe,a(u.$t("Nom :"))+" "+a(i.value.customer.lastname||""),1),o("p",Re,a(u.$t("Email :"))+" "+a(i.value.customer.email||""),1),o("p",ze,a(u.$t("Téléphone :"))+" "+a(i.value.customer.phone||""),1),o("p",He,a(u.$t("Date d'enregistrement :"))+" "+a(g(z)(i.value.customer.created_at)||""),1),o("p",Ge,[$(a(u.$t("Type :"))+" ",1),i.value.customer&&i.value.customer.is_customer?(p(),k(ae,{key:0,color:"success"},{default:t(()=>[$(a(u.$t("Client")),1)]),_:1})):(p(),k(ae,{key:1,color:"error"},{default:t(()=>[$(a(u.$t("Prospect")),1)]),_:1}))])]),_:1}),j.showDemandInfo?(p(),k(O,{key:0,class:"pt-0 pb-0"},{default:t(()=>[e(L)]),_:1})):U("",!0),j.showDemandInfo?(p(),k(O,{key:1,class:"pl-6 pr-6"},{default:t(()=>[o("p",Ke,a(u.$t("Date de la demande :"))+" "+a(g(z)(i.value.demand_date)||""),1),o("p",Qe,a(u.$t("Date création de la prestation :"))+" "+a(g(z)(i.value.created_at)||""),1),i.value.status>=g(h).statuses.processing?(p(),T("p",We,a(u.$t("Date lancement de la prestation :"))+" "+a(g(z)(i.value.start_date)||""),1)):U("",!0),i.value.status>=g(h).statuses.closed?(p(),T("p",Je,a(u.$t("Date clôture de la prestation :"))+" "+a(g(z)(i.value.closed_date)||""),1)):U("",!0)]),_:1})):U("",!0)]),_:1}))}}),Ze={key:1},re=R({__name:"ServiceForm",props:{modelValue:Object,prestation:Object,title:D("Service"),buttonText:D("Ajouter un service")},emits:["update:modelValue","update:item"],setup(j,{emit:l}){const h=q(),x=Q(),_=he(),i=j,u=l,n=A({get:()=>i.modelValue,set:m=>u("update:modelValue",m)}),r=d(!1),C=d(!1),V=d([]);le(()=>{_.fetchItems({per_page:500}).then(m=>{V.value=m.data.data,console.log(V.value)})});function s(){C.value=!0,h.saveService(i.prestation.id,n.value).then(m=>{r.value=!1,u("update:item",m.data),n.value={},n.value={},x.showSuccess(D("Service enregistré avec succès"))}).catch(m=>{C.value=!1,x.showError(m.message)}).then(()=>{C.value=!1})}function f(m){if(m){const S=V.value.find(H=>H.name==m);S&&(n.value.quantity=n.value.quantity||1,n.value.service_id=S.id||null,n.value.price=S.price||0,n.value.total=(n.value.quantity||1)*(S.price||0))}}return(m,S)=>{const H=ee("EditIcon");return p(),k(K,{modelValue:r.value,"onUpdate:modelValue":S[5]||(S[5]=E=>r.value=E),"max-width":"500px"},{activator:t(({props:E})=>[e(P,G({dark:""},E,{icon:n.value.id!=null,flat:n.value.id!=null,variant:"elevated",color:n.value.id!=null?null:"primary",onClick:S[0]||(S[0]=c=>C.value=!1)}),{default:t(()=>[n.value.id?(p(),k(H,{key:0,"stroke-width":"1.5",size:"20",class:"text-primary"})):(p(),T("span",Ze,a(j.buttonText),1))]),_:2},1040,["icon","flat","color"])]),default:t(()=>[e(F,null,{default:t(()=>[e(W,{class:"text-h5 text-center py-6"},{default:t(()=>[$(a(j.title),1)]),_:1}),e(L),e(O,null,{default:t(()=>[e(N,null,{default:t(()=>[e(w,{cols:"12"},{default:t(()=>[e(de,{modelValue:n.value.name,"onUpdate:modelValue":[S[1]||(S[1]=E=>n.value.name=E),f],label:m.$t("Service"),clearable:"",items:V.value,"item-title":"name","item-value":"name",filled:!1,variant:"outlined"},null,8,["modelValue","label","items"])]),_:1}),e(w,{cols:"12",md:"6"},{default:t(()=>[e(Y,{min:1,modelValue:n.value.quantity,"onUpdate:modelValue":S[2]||(S[2]=E=>n.value.quantity=E),type:"number",label:m.$t("Quantité")},null,8,["modelValue","label"])]),_:1}),e(w,{cols:"12",md:"6"},{default:t(()=>[e(Y,{min:0,modelValue:n.value.price,"onUpdate:modelValue":S[3]||(S[3]=E=>n.value.price=E),type:"number",label:m.$t("Prix")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),e(J,null,{default:t(()=>[e(M),e(P,{color:"error",variant:"flat",dark:"",onClick:S[4]||(S[4]=E=>r.value=!1)},{default:t(()=>[$(a(m.$t("Annuler")),1)]),_:1}),e(P,{color:"success",variant:"flat",loading:C.value,dark:"",onClick:s},{default:t(()=>[$(a(m.$t("Ajouter")),1)]),_:1},8,["loading"]),e(M)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Ye=R({__name:"DeleteService",props:{modelValue:Object,service:Object},emits:["update:modelValue"],setup(j,{emit:l}){const h=q(),x=Q(),_=j,i=l,u=A({get:()=>_.modelValue,set:V=>i("update:modelValue",V)}),n=d(!1),r=d(!1);function C(){r.value=!0,h.deleteService(u.value.id,_.service.id).then(V=>{u.value=V.data,n.value=!1,x.showSuccess(D("Service supprimé avec succès"))}).then(()=>{n.value=!1,r.value=!1})}return(V,s)=>{const f=ee("TrashIcon");return p(),k(K,{modelValue:n.value,"onUpdate:modelValue":s[2]||(s[2]=m=>n.value=m),"max-width":"350px"},{activator:t(({props:m})=>[e(P,G({icon:"",flat:"",class:"ml-3",dark:""},m,{onClick:s[0]||(s[0]=S=>r.value=!1)}),{default:t(()=>[e(f,{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040)]),default:t(()=>[e(F,null,{default:t(()=>[e(W,{class:"text-h5 text-center py-6"},{default:t(()=>[$(a(V.$t("Êtes-vous sûr de vouloir supprimer le service?")),1)]),_:1}),e(J,null,{default:t(()=>[e(M),e(P,{color:"error",variant:"flat",dark:"",onClick:s[1]||(s[1]=m=>n.value=!1)},{default:t(()=>[$(a(V.$t("Non")),1)]),_:1}),e(P,{color:"success",variant:"flat",loading:r.value,dark:"",onClick:C},{default:t(()=>[$(a(V.$t("Oui")),1)]),_:1},8,["loading"]),e(M)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),et={key:1},tt=R({__name:"PaymentForm",props:{modelValue:Object,prestation:Object,title:D("PaymentMethod"),buttonText:D("Ajouter un paymentMethod")},emits:["update:modelValue","update:item"],setup(j,{emit:l}){const h=q(),x=Q(),_=_e(),i=me(),u=j,n=l,r=A({get:()=>u.modelValue,set:v=>n("update:modelValue",v)}),C=d(!1),V=d(!1),s=d(!1),f=d([]);le(()=>{_.fetchItems({per_page:500}).then(v=>{f.value=v.data.data,console.log(f.value)}),r.value.amount=S.value});const m=A(()=>u.prestation.services?u.prestation.services.reduce((v,y)=>(console.log(y.total,v),parseFloat(y.total)+parseFloat(v)),0):0),S=A(()=>u.prestation.payments&&u.prestation.payments.length?m.value-u.prestation.payments.reduce((v,y)=>parseFloat(y.amount)+parseFloat(v),0):m.value);function H(){s.value=!0,h.savePayment(u.prestation.id,r.value).then(v=>{C.value=!1,n("update:item",v.data),r.value={},r.value={},x.showSuccess(D("PaymentMethod enregistré avec succès"))}).catch(v=>{s.value=!1,x.showError(v.message)}).then(()=>{s.value=!1})}function E(v){if(console.log(S.value),v){const y=f.value.find(b=>b.id==v);y&&(r.value.payment_method=y.name||null,r.value.amount=S.value)}}const c=A(()=>r.value.payment_date?i.format(r.value.payment_date,"shortDate"):null);return(v,y)=>{const b=ee("EditIcon");return p(),k(K,{modelValue:C.value,"onUpdate:modelValue":y[11]||(y[11]=I=>C.value=I),"max-width":"500px"},{activator:t(({props:I})=>[S.value>0?(p(),k(P,G({key:0,dark:""},I,{icon:r.value.id!=null,flat:r.value.id!=null,variant:"elevated",color:r.value.id!=null?null:"primary",onClick:y[0]||(y[0]=B=>s.value=!1)}),{default:t(()=>[r.value.id?(p(),k(b,{key:0,"stroke-width":"1.5",size:"20",class:"text-primary"})):(p(),T("span",et,a(j.buttonText),1))]),_:2},1040,["icon","flat","color"])):U("",!0)]),default:t(()=>[e(F,null,{default:t(()=>[e(W,{class:"text-h5 text-center py-6"},{default:t(()=>[$(a(j.title),1)]),_:1}),e(L),e(O,null,{default:t(()=>[e(N,null,{default:t(()=>[e(w,{cols:"12"},{default:t(()=>[e(de,{modelValue:r.value.payment_method_id,"onUpdate:modelValue":[y[1]||(y[1]=I=>r.value.payment_method_id=I),E],label:v.$t("PaymentMethod"),clearable:"",items:f.value,"item-title":"name","item-value":"id",filled:!1,variant:"outlined",required:""},null,8,["modelValue","label","items"])]),_:1}),e(w,{cols:"12",md:"6"},{default:t(()=>[e(K,{ref:"dialogDemandDate",modelValue:V.value,"onUpdate:modelValue":y[7]||(y[7]=I=>V.value=I),"return-value":r.value.payment_date,"onUpdate:returnValue":y[8]||(y[8]=I=>r.value.payment_date=I),persistent:"",width:"290px"},{activator:t(({props:I})=>[e(Y,G({modelValue:c.value,"onUpdate:modelValue":y[2]||(y[2]=B=>c.value=B)},I,{placeholder:v.$t("Date de la demande"),"hide-details":"",clearable:"",readonly:"","onClick:clear":y[3]||(y[3]=B=>r.value.payment_date=null)}),null,16,["modelValue","placeholder"])]),default:t(({isActive:I})=>[e(Ve,{locale:"fr"},{default:t(()=>[e($e,{modelValue:r.value.payment_date,"onUpdate:modelValue":y[6]||(y[6]=B=>r.value.payment_date=B),"hide-header":""},{actions:t(()=>[e(P,{color:"primary",onClick:y[4]||(y[4]=B=>V.value=!1)},{default:t(()=>[$(a(v.$t("Annuler")),1)]),_:1}),e(M),e(P,{variant:"elevated",color:"primary",onClick:y[5]||(y[5]=B=>V.value=!1)},{default:t(()=>[$(a(v.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),e(w,{cols:"12",md:"6"},{default:t(()=>[e(Y,{min:0,modelValue:r.value.amount,"onUpdate:modelValue":y[9]||(y[9]=I=>r.value.amount=I),type:"number",label:v.$t("Montant")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),e(J,null,{default:t(()=>[e(M),e(P,{color:"error",variant:"flat",dark:"",onClick:y[10]||(y[10]=I=>C.value=!1)},{default:t(()=>[$(a(v.$t("Annuler")),1)]),_:1}),e(P,{color:"success",variant:"flat",loading:s.value,dark:"",onClick:H},{default:t(()=>[$(a(v.$t("Ajouter")),1)]),_:1},8,["loading"]),e(M)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),at=R({__name:"ClosePrestation",props:{modelValue:Object},emits:["update:modelValue"],setup(j,{emit:l}){const h=q(),x=Q(),_=j,i=l,u=A({get:()=>_.modelValue,set:V=>i("update:modelValue",V)}),n=d(!1),r=d(!1);d(""),A(()=>`${D("Terminer la prestation")}`);function C(){r.value=!0,h.closeItem(u.value.id).then(V=>{u.value=V.data,n.value=!1,x.showSuccess(D("Prestation clôturée avec succès"))}).catch(V=>{r.value=!1,x.showError(V.message)}).then(()=>{r.value=!1})}return(V,s)=>(p(),k(K,{modelValue:n.value,"onUpdate:modelValue":s[2]||(s[2]=f=>n.value=f),"max-width":"500px"},{activator:t(({props:f})=>[e(P,G({dark:""},f,{variant:"elevated",color:"primary",onClick:s[0]||(s[0]=m=>r.value=!1)}),{default:t(()=>[$(a(V.$t("Terminer la prestation")),1)]),_:2},1040)]),default:t(()=>[e(F,null,{default:t(()=>[e(W,{class:"text-h5 text-center py-6"},{default:t(()=>[$(a(V.$t("Terminer la prestation")),1)]),_:1}),e(L),e(O,null,{default:t(()=>[e(N,null,{default:t(()=>[e(w,{cols:"12",class:"text-center"},{default:t(()=>[$(a(V.$t("Êtes-vous sûr de vouloir terminer la prestation?")),1)]),_:1})]),_:1})]),_:1}),e(L),e(J,null,{default:t(()=>[e(M),e(P,{color:"error",variant:"flat",dark:"",onClick:s[1]||(s[1]=f=>n.value=!1)},{default:t(()=>[$(a(V.$t("Non")),1)]),_:1}),e(P,{color:"success",variant:"flat",loading:r.value,dark:"",onClick:C},{default:t(()=>[$(a(V.$t("Oui")),1)]),_:1},8,["loading"]),e(M)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),lt=R({__name:"CommentPrestation",props:{modelValue:Object},emits:["update:modelValue"],setup(j,{emit:l}){const h=q(),x=Q(),_=j,i=l,u=A({get:()=>_.modelValue,set:s=>i("update:modelValue",s)}),n=d(!1),r=d(!1),C=d(u.value.commentaire||"");A(()=>`${D("Commentaire")}`);function V(){r.value=!0,h.addComment(u.value.id,C.value).then(s=>{u.value=s.data,n.value=!1,x.showSuccess(D("Commentaire ajouté avec succès"))}).catch(s=>{r.value=!1,x.showError(s.message)}).then(()=>{r.value=!1})}return(s,f)=>(p(),k(K,{modelValue:n.value,"onUpdate:modelValue":f[3]||(f[3]=m=>n.value=m),"max-width":"500px"},{activator:t(({props:m})=>[e(P,G({density:"compact",dark:""},m,{variant:"outlined",color:"primary",onClick:f[0]||(f[0]=S=>r.value=!1)}),{default:t(()=>[$(a(!u.value.commentaire||u.value.commentaire.length==0?s.$t("Ajouter"):s.$t("Modifier")),1)]),_:2},1040)]),default:t(()=>[e(F,null,{default:t(()=>[e(W,{class:"text-h5 text-center py-6"},{default:t(()=>[$(a(!u.value.commentaire||u.value.commentaire.length==0?s.$t("Ajouter un commentaire"):s.$t("Modifier le commentaire")),1)]),_:1}),e(L),e(O,null,{default:t(()=>[e(N,null,{default:t(()=>[e(w,{cols:"12"},{default:t(()=>[e(se,{modelValue:C.value,"onUpdate:modelValue":f[1]||(f[1]=m=>C.value=m),placeholder:s.$t("Commentaire"),label:s.$t("Commentaire")},null,8,["modelValue","placeholder","label"])]),_:1})]),_:1})]),_:1}),e(L),e(J,null,{default:t(()=>[e(M),e(P,{color:"error",variant:"flat",dark:"",onClick:f[2]||(f[2]=m=>n.value=!1)},{default:t(()=>[$(a(s.$t("Annuler")),1)]),_:1}),e(P,{color:"success",variant:"flat",loading:r.value,dark:"",onClick:V},{default:t(()=>[$(a(s.$t("Enregistrer")),1)]),_:1},8,["loading"]),e(M)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),st={key:0,class:"ml-2"},ot={class:"d-flex align-start"},nt={class:"text-h4 mt-1"},ut={class:"ml-auto"},rt={class:"mt-9"},dt={class:"text-h4 font-weight-semibold mb-1"},it={class:"d-flex align-start"},mt={class:"text-h4 mt-1"},ct={class:"ml-auto"},vt={class:"mt-9"},pt={class:"text-h4 font-weight-semibold mb-1"},ft={class:"d-flex align-start"},ht={class:"text-h4 mt-1"},_t={class:"mt-4"},Vt={class:"mb-1"},$t={class:"d-flex align-start"},yt={class:"text-h4 mt-1"},gt={class:"mt-4"},bt={class:"mb-1"},kt={class:"d-flex align-start"},Ct={class:"text-h4 mt-1"},St={class:"mt-4"},wt={class:"mb-1"},xt={class:"text-h6 d-flex align-center"},Pt={class:"text-h6"},jt={class:"text-h6"},Ut={class:"text-h6"},At={class:"text-h6"},Dt={class:"text-h6"},It={key:0,class:"d-flex align-center"},Mt={class:"text-h6 d-flex align-center"},Ot={class:"text-h6"},Tt={class:"text-h6"},Et={class:"text-h6"},ra=R({__name:"View",setup(j){d(),Q();const l=d({id:null,status:0,service:"",demand_date:null,customer_id:null,demand_id:null,payments:[],services:[],customer:{id:null,firstname:"",lastname:"",email:"",phone:"",is_customer:!1,created_at:null,demands:[],prestations:[]}}),h=q(),x=ce(),_=d({title:D("Détails du prestation")+" "+(l.value.event_type||"")+" "+(l.value.customer||{firstname:""}).firstname+" "+(l.value.customer||{lastname:""}).lastname+" "+(z(l.value.demand_date)||"")}),i=d([{text:D("Dashboard"),disabled:!1,href:"/"},{text:D("Prestations"),disabled:!1,href:"/prestations"},{text:l.value.event_type||"",disabled:!0,href:"#"}]);function u(){_.value={title:D("Prestation")+" "+(l.value.demand.event_type||"")+" ("+(l.value.customer||{firstname:""}).firstname+" "+(l.value.customer||{lastname:""}).lastname+" "+(z(l.value.event_date)||"")+")"},i.value=[{text:D("Dashboard"),disabled:!1,href:"/"},{text:D("Prestations"),disabled:!1,href:"/prestations"},{text:_.value.title,disabled:!0,href:"#"}]}le(()=>{H()});const n=d(!1);d(!1),d(!1),d(!1),d(!1),d(!1),d(!1),d({}),d({}),d(!1),d(10),d(2),d(2),d(!1),d(!1),d(null);const r=d("");d(["primary","secondary","error","success","warning"]),d([{key:"demand_date",order:"DESC"}]),d(0),d({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"demand_date",order:"DESC"}]});const C=d(-1);d({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});const V=d({id:null,service_id:null,name:"",price:0,total:0,quantity:0}),s=d({id:null,prestation_id:null,amount:0});d({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),d(!1),d([{title:"Prestation",align:"start",key:"event_type"},{title:"Date de la prestation",align:"start",key:"demand_date"},{title:"Status",align:"start",key:"status"},{title:"Actions",key:"actions",sortable:!1}]),A(()=>h.prestations.data.filter(c=>c.email.toLowerCase().includes(r.value.toLowerCase())));const f=A(()=>x.params.id);A(()=>l.value.customer.prestations?l.value.customer.prestations.filter(c=>c.id!=l.value.id):[]);const m=A(()=>l.value.services&&l.value.services.length?l.value.services.reduce((c,v)=>(console.log(v.total,c),parseFloat(v.total)+parseFloat(c)),0):0),S=A(()=>l.value.payments&&l.value.payments.length?m.value-l.value.payments.reduce((c,v)=>parseFloat(v.amount)+parseFloat(c),0):m.value);A(()=>C.value===-1?"Nouvel administrateur":"Modifier l’administrateur");function H(){n.value=!0,h.fetchItem(x.params.id).then(c=>{c.data.error||(n.value=!1,l.value=c.data,u())}).catch(c=>{n.value=!1}).then(()=>{n.value=!1})}function E(c){l.value=c}return ve(f,(c,v)=>{c!=v&&H()},{deep:!0}),(c,v)=>{const y=ee("CurrencyEuroIcon");return p(),T(te,null,[n.value?U("",!0):(p(),k(fe,{key:0,title:_.value.title,breadcrumbs:i.value},null,8,["title","breadcrumbs"])),n.value?(p(),k(N,{key:1,justify:"center",align:"center","align-content":"center"},{default:t(()=>[e(w,{cols:"12",justify:"center",align:"center","align-content":"center"},{default:t(()=>[e(pe,{indeterminate:"",color:"primary",size:"150"})]),_:1})]),_:1})):(p(),k(N,{key:2},{default:t(()=>[e(w,{cols:"12",md:"4"},{default:t(()=>[$(a(c.$t("Status :"))+" ",1),e(ae,{rounded:"md",class:"font-weight-bold",color:g(h).statusColor(l.value.status),size:"small",label:""},{default:t(()=>[$(a(g(h).statusText(l.value.status)),1)]),_:1},8,["color"]),l.value.status==g(h).statuses.cancelled?(p(),T("span",st,a(c.$t("Le"))+" "+a(g(z)(l.value.cancelled_date)||""),1)):U("",!0)]),_:1}),e(w,{cols:"12",md:"8",justify:"end","align-content":"end",align:"end"},{default:t(()=>[l.value.status==g(h).statuses.started||l.value.status==g(h).statuses.cancelled?(p(),k(Ne,{key:0,modelValue:l.value,"onUpdate:modelValue":v[0]||(v[0]=b=>l.value=b)},null,8,["modelValue"])):U("",!0),l.value.status==g(h).statuses.validated?(p(),k(at,{key:1,modelValue:l.value,"onUpdate:modelValue":v[1]||(v[1]=b=>l.value=b)},null,8,["modelValue"])):U("",!0),l.value.status!=g(h).statuses.cancelled?(p(),k(Fe,{key:2,modelValue:l.value,"onUpdate:modelValue":v[2]||(v[2]=b=>l.value=b)},null,8,["modelValue"])):U("",!0),e(L,{vertical:""}),e(P,{variant:"elevated",color:"success",class:"ml-2",to:"/customers/"+l.value.customer_id},{default:t(()=>[$(a(c.$t("Voir le Client")),1)]),_:1},8,["to"])]),_:1}),e(w,{cols:"12",md:"3"},{default:t(()=>[e(Xe,{modelValue:l.value,"onUpdate:modelValue":v[3]||(v[3]=b=>l.value=b),"show-demand-info":""},null,8,["modelValue"])]),_:1}),e(w,{cols:"12",md:"3"},{default:t(()=>[e(Ee,{modelValue:l.value,"onUpdate:modelValue":v[4]||(v[4]=b=>l.value=b),"show-demand-info":""},null,8,["modelValue"])]),_:1}),e(w,{cols:"12",md:"6",class:"justify-end align-end"},{default:t(()=>[e(N,{class:"align-end justify-end align-content-end"},{default:t(()=>[e(w,{cols:"12",class:"align-end justify-end align-content-end"},{default:t(()=>[e(N,{class:"align-end justify-end align-content-end"},{default:t(()=>[l.value.status>=g(h).statuses.validated?(p(),k(w,{key:0,cols:"12",md:"6",class:""},{default:t(()=>[e(F,{elevation:"10"},{default:t(()=>[e(O,null,{default:t(()=>[o("div",ot,[o("h2",nt,a(c.$t("Reste à payer")),1),e(M),o("div",ut,[e(P,{color:"primary",icon:"",flat:""},{default:t(()=>[e(y)]),_:1})])]),o("div",rt,[o("h2",dt,a(g(X)(S.value)),1)])]),_:1})]),_:1})]),_:1})):U("",!0),e(w,{cols:"12",md:"6"},{default:t(()=>[e(F,{elevation:"10"},{default:t(()=>[e(O,null,{default:t(()=>[o("div",it,[o("h2",mt,a(c.$t("Montant total")),1),e(M),o("div",ct,[e(P,{color:"primary",icon:"",flat:""},{default:t(()=>[e(y)]),_:1})])]),o("div",vt,[o("h2",pt,a(g(X)(m.value||0)),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(w,{cols:"12",class:"align-end justify-end align-content-end"},{default:t(()=>[e(N,{class:"align-end justify-end align-content-end"},{default:t(()=>[e(w,{class:"h-100",cols:"12"},{default:t(()=>[e(N,null,{default:t(()=>[e(w,{cols:"12",md:"6"},{default:t(()=>[e(F,{elevation:"10",class:"h-100"},{default:t(()=>[e(O,null,{default:t(()=>[o("div",ft,[o("h2",ht,a(c.$t("Note liée à la prestation")),1)]),o("div",_t,[o("p",Vt,a(l.value.comment||c.$t("Aucun note")),1)])]),_:1})]),_:1})]),_:1}),e(w,{cols:"12",md:"6"},{default:t(()=>[e(F,{elevation:"10",class:"h-100"},{default:t(()=>[e(O,null,{default:t(()=>[o("div",$t,[o("h2",yt,a(c.$t("Commentaire")),1),e(lt,{modelValue:l.value,"onUpdate:modelValue":v[5]||(v[5]=b=>l.value=b)},null,8,["modelValue"])]),o("div",gt,[o("p",bt,a(l.value.commentaire||c.$t("Aucun commentaire")),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l.value.status==g(h).statuses.cancelled?(p(),k(w,{key:0,cols:"12"},{default:t(()=>[e(F,{elevation:"10",class:"h-100"},{default:t(()=>[e(O,null,{default:t(()=>[o("div",kt,[o("h2",Ct,a(c.$t("Raison de l'annulation")),1)]),o("div",St,[o("p",wt,a(l.value.cancel_comment||c.$t("Aucun commentaire")),1)])]),_:1})]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(w,{cols:"12",lg:l.value.status>g(h).statuses.started?"6":"12"},{default:t(()=>[e(F,{elevation:"10",class:"overflow-hidden h-100"},{default:t(()=>[e(Z,{class:"py-4 px-6 text-white bg-info"},{default:t(()=>[o("h4",xt,[o("span",null,a(c.$t("Désignation des services attendus")),1),e(M),l.value.status<g(h).statuses.processing?(p(),k(re,{key:0,modelValue:V.value,"onUpdate:modelValue":v[6]||(v[6]=b=>V.value=b),prestation:l.value,"onUpdate:item":E,"button-text":c.$t("Ajouter un service"),title:c.$t("Ajouter un service")},null,8,["modelValue","prestation","button-text","title"])):U("",!0)])]),_:1}),e(O,{class:"pa-6"},{default:t(()=>[e(ne,{class:"month-table"},{default:t(()=>[o("thead",null,[o("tr",null,[o("th",Pt,a(c.$t("Désignation")),1),o("th",jt,a(c.$t("Quantité")),1),o("th",Ut,a(c.$t("Prix unitaire")),1),o("th",At,a(c.$t("Prix total")),1),o("th",Dt,a(c.$t("Actions")),1)])]),o("tbody",null,[(p(!0),T(te,null,oe(l.value.services,(b,I)=>(p(),T("tr",{key:b.id,class:"month-item"},[o("td",null,a(b.name),1),o("td",null,a(b.quantity),1),o("td",null,a(g(X)(b.price)),1),o("td",null,a(g(X)(b.total)),1),o("td",null,[l.value.status<g(h).statuses.processing?(p(),T("div",It,[e(ge,{text:c.$t("Modifier")},{activator:t(({props:B})=>[e(re,{modelValue:l.value.services[I],"onUpdate:modelValue":ie=>l.value.services[I]=ie,prestation:l.value,"onUpdate:item":E,"button-text":c.$t("Modifier le service"),title:c.$t("Modifier le service")},null,8,["modelValue","onUpdate:modelValue","prestation","button-text","title"])]),_:2},1032,["text"]),e(Ye,{modelValue:l.value,"onUpdate:modelValue":v[7]||(v[7]=B=>l.value=B),service:l.value.services[I]},null,8,["modelValue","service"])])):U("",!0)])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["lg"]),l.value.status>g(h).statuses.started?(p(),k(w,{key:0,cols:"12",lg:l.value.status>g(h).statuses.started?"6":"12"},{default:t(()=>[e(F,{elevation:"10",class:"overflow-hidden h-100"},{default:t(()=>[e(Z,{class:"py-4 px-6 text-white bg-info"},{default:t(()=>[o("h4",Mt,[o("span",null,a(c.$t("Paiements")),1),e(M),l.value.status<g(h).statuses.closed?(p(),k(tt,{key:0,modelValue:s.value,"onUpdate:modelValue":v[8]||(v[8]=b=>s.value=b),prestation:l.value,"onUpdate:item":E,"button-text":c.$t("Ajouter un paiement"),title:c.$t("Ajouter un paiement")},null,8,["modelValue","prestation","button-text","title"])):U("",!0)])]),_:1}),e(O,{class:"pa-6"},{default:t(()=>[e(ne,{class:"month-table"},{default:t(()=>[o("thead",null,[o("tr",null,[o("th",Ot,a(c.$t("Mode de paiement")),1),o("th",Tt,a(c.$t("Montant payé")),1),o("th",Et,a(c.$t("Date du paiement")),1)])]),o("tbody",null,[(p(!0),T(te,null,oe(l.value.payments,(b,I)=>(p(),T("tr",{key:b.id},[o("td",null,a(b.payment_method),1),o("td",null,a(b.amount),1),o("td",null,a(g(z)(b.payment_date)),1)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["lg"])):U("",!0)]),_:1}))],64)}}});export{ra as default};
