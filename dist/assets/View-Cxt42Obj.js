import{u as O}from"./demands-D5yKwxBT.js";import{a6 as G,av as R,e as P,r as n,o as i,_ as p,w as e,V as k,n as X,d,t as l,a4 as S,b as t,aM as $,aN as W,h as Y,g as Z,q as ee,c as A,aO as te,a8 as b,a as s,X as z,a5 as q}from"./index-V7uEaUZU.js";import{_ as ae,V as F}from"./BaseBreadcrumb-Bd5V6rJ-.js";import{f as I}from"./formatters-BQuIx1l-.js";import{b as U,c as J,a as C,V as D,d as N}from"./VCard--aoCl2hm.js";import{a as B,V as M}from"./VSpacer-B7D1SjI6.js";import{V as Q}from"./VDialog-DfzC34LR.js";import{_ as le}from"./ValidateDemand.vue_vue_type_script_setup_true_lang-DiX1Y-qg.js";import{f as K}from"./VMenu-D3b5pAl3.js";import{a as E,V as y}from"./VRow-Br7W0t3Z.js";import{V as se}from"./VTextarea-CLEdwDVo.js";import"./Controller-CBpXN6OF.js";import{_ as oe}from"./HallWidget.vue_vue_type_script_setup_true_lang-Dq9EbnaJ.js";import"./VAvatar-CfvEg0QO.js";import"./hall-nTq0h74K.js";import"./VSelect-CNPufMkU.js";import"./VTextField-B2FBaRjP.js";import"./ChangeHall.vue_vue_type_script_setup_true_lang-BGYegvfx.js";import"./VAlert-BfRLhipQ.js";const ne=G({__name:"CancelDemand",props:{modelValue:Object},emits:["update:modelValue"],setup(L,{emit:a}){const T=O(),w=R(),j=L,v=a,f=P({get:()=>j.modelValue,set:_=>v("update:modelValue",_)}),m=n(!1),h=n(!1);function x(){h.value=!0,T.cancelItem(f.value.id).then(_=>{f.value=_.data,m.value=!1,w.showSuccess($("Devis annulé avec succès"))}).then(()=>{h.value=!1})}return(_,r)=>(i(),p(Q,{modelValue:m.value,"onUpdate:modelValue":r[1]||(r[1]=c=>m.value=c),"max-width":"350px"},{activator:e(({props:c})=>[f.value.status==0?(i(),p(k,X({key:0,color:"error",class:"ml-3",variant:"outlined",dark:""},c),{default:e(()=>[d(l(_.$t("Annuler la demande")),1)]),_:2},1040)):S("",!0)]),default:e(()=>[t(C,null,{default:e(()=>[t(U,{class:"text-h5 text-center py-6"},{default:e(()=>[d(l(_.$t("Êtes-vous sûr de vouloir annuller la demande?")),1)]),_:1}),t(J,null,{default:e(()=>[t(B),t(k,{color:"error",variant:"flat",dark:"",onClick:r[0]||(r[0]=c=>m.value=!1)},{default:e(()=>[d(l(_.$t("Annuler")),1)]),_:1}),t(k,{color:"success",variant:"flat",loading:h.value,dark:"",onClick:x},{default:e(()=>[d(l(_.$t("OK")),1)]),_:1},8,["loading"]),t(B)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ue=G({__name:"CommentDemand",props:{modelValue:Object},emits:["update:modelValue"],setup(L,{emit:a}){const T=O(),w=R(),j=L,v=a,f=P({get:()=>j.modelValue,set:r=>v("update:modelValue",r)}),m=n(!1),h=n(!1),x=n(f.value.commentaire||"");P(()=>`${$("Commentaire")}`);function _(){h.value=!0,T.addComment(f.value.id,x.value).then(r=>{f.value=r.data,m.value=!1,w.showSuccess($("Commentaire ajouté avec succès"))}).catch(r=>{h.value=!1,w.showError(r.message)}).then(()=>{h.value=!1})}return(r,c)=>(i(),p(Q,{modelValue:m.value,"onUpdate:modelValue":c[3]||(c[3]=V=>m.value=V),"max-width":"500px"},{activator:e(({props:V})=>[t(k,X({density:"compact",dark:""},V,{variant:"outlined",color:"primary",onClick:c[0]||(c[0]=H=>h.value=!1)}),{default:e(()=>[d(l(!f.value.commentaire||f.value.commentaire.length==0?r.$t("Ajouter"):r.$t("Modifier")),1)]),_:2},1040)]),default:e(()=>[t(C,null,{default:e(()=>[t(U,{class:"text-h5 text-center py-6"},{default:e(()=>[d(l(!f.value.commentaire||f.value.commentaire.length==0?r.$t("Ajouter un commentaire"):r.$t("Modifier le commentaire")),1)]),_:1}),t(K),t(D,null,{default:e(()=>[t(E,null,{default:e(()=>[t(y,{cols:"12"},{default:e(()=>[t(se,{modelValue:x.value,"onUpdate:modelValue":c[1]||(c[1]=V=>x.value=V),placeholder:r.$t("Commentaire"),label:r.$t("Commentaire")},null,8,["modelValue","placeholder","label"])]),_:1})]),_:1})]),_:1}),t(K),t(J,null,{default:e(()=>[t(B),t(k,{color:"error",variant:"flat",dark:"",onClick:c[2]||(c[2]=V=>m.value=!1)},{default:e(()=>[d(l(r.$t("Annuler")),1)]),_:1}),t(k,{color:"success",variant:"flat",loading:h.value,dark:"",onClick:_},{default:e(()=>[d(l(r.$t("Enregistrer")),1)]),_:1},8,["loading"]),t(B)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),re={class:"text-h6"},de={class:"text-subtitle-1 textSecondary mt-3"},ie={class:"text-subtitle-1 textSecondary mt-3"},me={class:"text-subtitle-1 textSecondary mt-3"},ce={class:"text-subtitle-1 textSecondary mt-3"},fe={class:"text-subtitle-1 textSecondary mt-3"},ve={class:"text-h6"},pe={class:"text-subtitle-1 textSecondary mt-3"},he={class:"text-subtitle-1 textSecondary mt-3"},_e={class:"text-subtitle-1 textSecondary mt-3"},ye={class:"text-subtitle-1 textSecondary mt-3"},ge={class:"text-subtitle-1 textSecondary mt-3"},be={class:"text-subtitle-1 textSecondary mt-3"},Ve={class:"text-subtitle-1 textSecondary mt-3"},$e={class:"text-h6"},ke=s("thead",null,[s("tr",null,[s("th",{class:"text-h6"},"ID"),s("th",{class:"text-h6"},"Prestation"),s("th",{class:"text-h6"},"Date de la demande"),s("th",{class:"text-h6"},"Status"),s("th",{class:"text-h6"},"Action")])],-1),xe={class:"text-h6 font-weight-medium text-medium-emphasis"},Ce={class:"text-h6"},we=s("thead",null,[s("tr",null,[s("th",{class:"text-h6"},"ID"),s("th",{class:"text-h6"},"Prestation"),s("th",{class:"text-h6"},"Date de la demande"),s("th",{class:"text-h6"},"Status"),s("th",{class:"text-h6"},"Action")])],-1),Se={class:"text-h6 font-weight-medium text-medium-emphasis"},Ke=G({__name:"View",setup(L){n(),R();const a=n({id:null,status:0,service:"",demand_date:null,customer_id:null,prestation_id:null,customer:{id:null,firstname:"",lastname:"",email:"",phone:"",is_customer:!1,created_at:null,demands:[],prestations:[]}}),T=n({title:$("Détails de la demande")+" "+(a.value.event_type||"")+" "+(a.value.customer||{firstname:""}).firstname+" "+(a.value.customer||{lastname:""}).lastname+" "+(I(a.value.demand_date)||"")}),w=n([{text:$("Dashboard"),disabled:!1,href:"/"},{text:$("Gestion des demandes"),disabled:!1,href:"/demands"},{text:a.value.event_type||"",disabled:!0,href:"#"}]);function j(){T.value={title:$("Détails de la demande")+" "+(a.value.event_type||"")+" ("+(a.value.customer||{firstname:""}).firstname+" "+(a.value.customer||{lastname:""}).lastname+" "+(I(a.value.demand_date)||"")+")"},w.value=[{text:$("Dashboard"),disabled:!1,href:"/"},{text:$("Gestion des demandes"),disabled:!1,href:"/demands"},{text:a.value.event_type||"",disabled:!0,href:"#"}]}const v=O(),f=W();Y(()=>{H()});const m=n(!1);n(!1),n(10);const h=n(2),x=n(2);n(!1),n(!1),n(null);const _=n("");n(["primary","secondary","error","success","warning"]),n([{key:"demand_date",order:"DESC"}]),n(0),n({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"demand_date",order:"DESC"}]});const r=n(-1);n({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),n({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),n(!1),n([{title:"Prénom",align:"start",key:"customer.firstname",sortable:!1},{title:"Nom",align:"start",key:"customer.lastname",sortable:!1},{title:"Email",align:"start",key:"customer.email",sortable:!1},{title:"Téléphone",align:"start",key:"customer.phone",sortable:!1},{title:"Prestation",align:"start",key:"event_type"},{title:"Date de la demande",align:"start",key:"demand_date"},{title:"Status",align:"start",key:"status"},{title:"Actions",key:"actions",sortable:!1}]),P(()=>v.demands.data.filter(o=>o.email.toLowerCase().includes(_.value.toLowerCase())));const c=P(()=>f.params.id),V=P(()=>a.value.customer.demands?a.value.customer.demands.filter(o=>o.id!=a.value.id):[]);P(()=>r.value===-1?"Nouvel administrateur":"Modifier l’administrateur");function H(){m.value=!0,v.fetchItem(f.params.id).then(o=>{o.data.error||(m.value=!1,a.value=o.data,j())}).catch(o=>{m.value=!1}).then(()=>{m.value=!1})}return Z(c,(o,g)=>{o!=g&&H()},{deep:!0}),ee(()=>{h.value>x.value&&(h.value=x.value)}),(o,g)=>(i(),A(z,null,[m.value?S("",!0):(i(),p(ae,{key:0,title:T.value.title,breadcrumbs:w.value},null,8,["title","breadcrumbs"])),m.value?(i(),p(E,{key:1,justify:"center",align:"center","align-content":"center"},{default:e(()=>[t(y,{cols:"12",justify:"center",align:"center","align-content":"center"},{default:e(()=>[t(te,{indeterminate:"",color:"primary",size:"150"})]),_:1})]),_:1})):(i(),p(E,{key:2},{default:e(()=>[t(y,{cols:"12",md:"6"},{default:e(()=>[d(l(o.$t("Status :"))+" ",1),t(M,{rounded:"md",class:"font-weight-bold",color:b(v).statusColor(a.value.status),size:"small",label:""},{default:e(()=>[d(l(b(v).statusText(a.value.status)),1)]),_:1},8,["color"])]),_:1}),t(y,{cols:"12",md:"6",justify:"end","align-content":"end",align:"end"},{default:e(()=>[!a.value.prestation&&a.value.status==b(v).statuses.started?(i(),p(le,{key:0,modelValue:a.value,"onUpdate:modelValue":g[0]||(g[0]=u=>a.value=u)},null,8,["modelValue"])):S("",!0),a.value.prestation&&a.value.prestation.id?(i(),p(k,{key:1,variant:"elevated",color:"primary",to:"/prestations/"+a.value.prestation.id},{default:e(()=>[d(l(o.$t("Voir la prestation liée")),1)]),_:1},8,["to"])):S("",!0),a.value.prestation?S("",!0):(i(),p(ne,{key:2,modelValue:a.value,"onUpdate:modelValue":g[1]||(g[1]=u=>a.value=u)},null,8,["modelValue"]))]),_:1}),t(y,{cols:"12",md:"3"},{default:e(()=>[t(C,{elevation:"10",class:"overflow-hidden h-100"},{default:e(()=>[t(N,{class:"py-4 px-6 text-white bg-primary"},{default:e(()=>[s("h4",re,l(o.$t("Identification du demandeur")),1)]),_:1}),t(D,{class:"pa-6"},{default:e(()=>[s("p",de,l(o.$t("Prénom :"))+" "+l(a.value.customer.firstname||""),1),s("p",ie,l(o.$t("Nom :"))+" "+l(a.value.customer.lastname||""),1),s("p",me,l(o.$t("Email :"))+" "+l(a.value.customer.email||""),1),s("p",ce,l(o.$t("Téléphone :"))+" "+l(a.value.customer.phone||""),1),s("p",fe,[d(l(o.$t("Type :"))+" ",1),a.value.customer&&a.value.customer.is_customer?(i(),p(M,{key:0,color:"success"},{default:e(()=>[d(l(o.$t("Client")),1)]),_:1})):(i(),p(M,{key:1,color:"error"},{default:e(()=>[d(l(o.$t("Prospect")),1)]),_:1}))])]),_:1})]),_:1})]),_:1}),t(y,{cols:"12",md:"3"},{default:e(()=>[t(oe,{modelValue:a.value,"onUpdate:modelValue":g[2]||(g[2]=u=>a.value=u),type:"demand","show-demand-info":""},null,8,["modelValue"])]),_:1}),t(y,{cols:"12",md:"6",class:"justify-end align-end"},{default:e(()=>[t(C,{elevation:"10",class:"overflow-hidden h-100"},{default:e(()=>[t(N,{class:"py-4 px-6 text-white bg-info"},{default:e(()=>[s("h4",ve,l(o.$t("Détails de la demande")),1)]),_:1}),t(D,{class:"pa-6"},{default:e(()=>[t(E,null,{default:e(()=>[t(y,{cols:"12",md:"6",lg:"5"},{default:e(()=>[s("p",pe,l(o.$t("Source :"))+" "+l(a.value.source||""),1),s("p",he,l(o.$t("Type événement :"))+" "+l(a.value.event_type||""),1),s("p",_e,l(o.$t("Date de l'événement :"))+" "+l(b(I)(a.value.event_date)||""),1),s("p",ye,l(o.$t("La réception se déroulera plutôt :"))+" "+l(a.value.reception_period||""),1),s("p",ge,l(o.$t("Heure de réception :"))+" "+l(a.value.reception_start_time||""),1),s("p",be,l(o.$t("Lieu de l'événement :"))+" "+l(a.value.event_location||""),1),s("p",Ve,l(o.$t("Nombre de convives :"))+" "+l(a.value.number_people||""),1)]),_:1}),t(y,{cols:"12",md:"6",lg:"7"},{default:e(()=>[t(C,{flat:"",variant:"outlined",density:"compact"},{default:e(()=>[t(U,null,{default:e(()=>[d(l(o.$t("Description de la demande")),1)]),_:1}),t(D,{innerHTML:(a.value.comment||"").replace(/\n/g,"<br/>")},null,8,["innerHTML"])]),_:1}),t(C,{flat:"",variant:"outlined",class:"mt-4",density:"compact"},{default:e(()=>[t(U,null,{default:e(()=>[d(l(o.$t("Commentaire"))+" ",1),t(ue,{modelValue:a.value,"onUpdate:modelValue":g[3]||(g[3]=u=>a.value=u)},null,8,["modelValue"])]),_:1}),t(D,{innerHTML:(a.value.commentaire||"").replace(/\n/g,"<br/>")},null,8,["innerHTML"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a.value.customer&&V.value?(i(),p(y,{key:0,cols:"12"},{default:e(()=>[t(C,{elevation:"10",class:"overflow-hidden h-100"},{default:e(()=>[t(N,{class:"py-4 px-6 text-white bg-info"},{default:e(()=>[s("h4",$e,l(o.$t("Autre demandes de devis de"))+" "+l(a.value.customer.firstname||"")+" "+l(a.value.customer.lastname||""),1)]),_:1}),t(D,{class:"pa-6"},{default:e(()=>[t(F,{class:"month-table"},{default:e(()=>[ke,s("tbody",null,[(i(!0),A(z,null,q(V.value,u=>(i(),A("tr",{key:u.id,class:"month-item"},[s("td",null,l(u.id),1),s("td",null,[s("h6",xe,l(u.event_type),1)]),s("td",null,l(b(I)(u.demand_date)),1),s("td",null,[t(M,{rounded:"md",class:"font-weight-bold",color:b(v).statusColor(u.status),size:"small",label:""},{default:e(()=>[d(l(b(v).statusText(u.status)),1)]),_:2},1032,["color"])]),s("td",null,[t(k,{variant:"outlined",density:"compact",color:"info",to:"/demands/"+u.id},{default:e(()=>[d(l(o.$t("Voir")),1)]),_:2},1032,["to"])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})):S("",!0),a.value.customer&&a.value.customer.prestations?(i(),p(y,{key:1,cols:"12"},{default:e(()=>[t(C,{elevation:"10",class:"overflow-hidden h-100"},{default:e(()=>[t(N,{class:"py-4 px-6 text-white bg-info"},{default:e(()=>[s("h4",Ce,l(o.$t("Autre prestations de devis de"))+" "+l(a.value.customer.firstname||"")+" "+l(a.value.customer.lastname||""),1)]),_:1}),t(D,{class:"pa-6"},{default:e(()=>[t(F,{class:"month-table"},{default:e(()=>[we,s("tbody",null,[(i(!0),A(z,null,q(a.value.customer.prestations,u=>(i(),A("tr",{key:u.id,class:"month-item"},[s("td",null,l(u.id),1),s("td",null,[s("h6",Se,l(u.demand?u.demand.event_type:""),1)]),s("td",null,l(b(I)(u.demand_date)),1),s("td",null,[t(M,{rounded:"md",class:"font-weight-bold",color:b(v).statusColor(u.status),size:"small",label:""},{default:e(()=>[d(l(b(v).statusText(u.status)),1)]),_:2},1032,["color"])]),s("td",null,[t(k,{variant:"outlined",density:"compact",color:"info",to:"/prestations/"+u.id},{default:e(()=>[d(l(o.$t("Voir")),1)]),_:2},1032,["to"])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1}))],64))}});export{Ke as default};
