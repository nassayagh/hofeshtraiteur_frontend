import{u as ne}from"./customers-BbWto-PZ.js";import{u as $e}from"./eventType-BKpmzL0p.js";import{_ as _e}from"./BaseBreadcrumb-DS9kI36F.js";import{r as le}from"./validators-BPi-vT8z.js";import{a as X}from"./formatters-DCCWVJxZ.js";import{a6 as ue,Z as J,o as I,_ as Ce,w as t,b as e,a as i,t as n,V as c,a8 as _,c as F,a4 as Q,aC as ke,r as o,av as ye,aD as V,h as we,e as N,g as Pe,q as De,n as Z,d as m,X as Ue}from"./index-ylT0eisZ.js";import{F as Se}from"./vee-validate.esm-2htRsGV3.js";import{a as M,V as W,b as se,c as oe}from"./VCard-Cg_Jd00Q.js";import{a as C,V as xe}from"./VSpacer-hLwscu0E.js";import{V as f,a as O}from"./VRow-DFI1sF8L.js";import{V as Ie}from"./VDataTableServer-Cg2s7bAv.js";import{V as Te}from"./VToolbar-DkBFpKy5.js";import{V as y}from"./VTextField-DVzMjkgC.js";import{V as Ae}from"./filter-DDtBre8Z.js";import{V as H}from"./VDialog-lfSc61sJ.js";import{V as je}from"./VLocaleProvider-BgXBUWrl.js";import{V as Ee}from"./VDatePicker-KeNuuVCy.js";import{V as Be}from"./VContainer-CrguUam-.js";import{V as Le}from"./VAlert-BJnu7AA1.js";import{V as re}from"./VTooltip-BZHOMPn_.js";import"./VAvatar-BjZg93_h.js";import"./VMenu-jd6zHLbL.js";import"./VSheet-BBcV-1nU.js";const Ne={class:"d-flex align-start"},Oe={class:"text-h4"},Fe={class:"ml-auto"},Me={class:"mt-2"},ze={class:"text-h4 font-weight-regular"},Re={key:0,class:"text-subtitle-1"},qe={class:"d-flex align-start"},Ge={class:"text-h4"},Ke={class:"ml-auto"},Xe={class:"mt-2"},Ze={class:"text-h4 font-weight-regular"},He={key:0,class:"text-subtitle-1"},Je=ue({__name:"CustomerDashboard",props:{showDescription:{type:Boolean,default:!1}},setup(z){const g=ne();return g.fetchStatistics({}),(h,R)=>{const T=J("UsersGroupIcon");return I(),Ce(O,null,{default:t(()=>[e(f,{class:"h-100",cols:"12",md:"6"},{default:t(()=>[e(M,{elevation:"10",class:"bg-info h-100"},{default:t(()=>[e(W,null,{default:t(()=>[i("div",Ne,[i("h2",Oe,n(h.$t("Prospets")),1),e(C),i("div",Fe,[e(c,{depressed:"",color:"white",class:"btn-custom-sm",small:"",icon:""},{default:t(()=>[e(T,{class:"text-info"})]),_:1})])]),i("div",Me,[i("h2",ze,n(_(g).statistics.prospects||0),1),z.showDescription?(I(),F("span",Re,n(h.$t("Personnes sans prestations")),1)):Q("",!0)])]),_:1})]),_:1})]),_:1}),e(f,{class:"h-100",cols:"12",md:"6"},{default:t(()=>[e(M,{elevation:"10",class:"bg-success h-100"},{default:t(()=>[e(W,null,{default:t(()=>[i("div",qe,[i("h2",Ge,n(h.$t("Clients")),1),e(C),i("div",Ke,[e(c,{depressed:"",color:"white",class:"btn-custom-sm",small:"",icon:""},{default:t(()=>[e(T,{class:"text-success"})]),_:1})])]),i("div",Xe,[i("h2",Ze,n(_(g).statistics.customers||0),1),z.showDescription?(I(),F("span",He,n(h.$t("Personnes avec des prestations")),1)):Q("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})}}}),Qe={class:"text-h5"},We={key:0,class:"mt-2"},Ye=["onClick"],et=["onClick"],tt={class:"d-flex align-center"},Dt=ue({__name:"List",setup(z){const g=ke(),h=o(),R=ye();$e();const T=o({title:"Clients"}),ie=o([{text:V("Dashboard"),disabled:!1,href:"/"},{text:V("Clients"),disabled:!0,href:"#"}]),b=o([]);o([]);const $=ne();we(()=>{ae()});const A=o(!1),w=o(!1);o(!1),o(!1),o(!1),o(""),o(),o(!1);const Y=o(null);o(null),o(null),o(null);const j=o(!1);o();const q=o(100),P=o(2),E=o(2),B=o(0),ee=o(!1),de=o(!1),D=o(!1);o(null);const G=o("");o(["primary","secondary","error","success","warning"]);const k=o([{key:"firstname",order:"asc"}]);o(0);const r=o({search:null,status:null,date:null,event_type:null}),U=o({itemsPerPage:100,rowsPerPage:100,page:1,sortDesc:[!0],sortBy:[{key:"firstname",order:"asc"}]}),L=o(-1),u=o({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),me=o({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),S=o(!1),ce=o([{title:"Prénom",align:"start",key:"firstname"},{title:"Nom",align:"start",key:"lastname"},{title:"Email",align:"start",key:"email"},{title:"Téléphone",align:"start",key:"phone"},{title:"Date de creation",align:"start",key:"created_at"},{title:"Status",align:"start",key:"is_customer"},{title:"Actions",key:"actions",sortable:!1}]),te=N(()=>r.value.date&&r.value.date.length>0?X(r.value.date[0])+" - "+X(r.value.date[r.value.date.length-1]):null);N(()=>$.customers.data.filter(s=>s.email.toLowerCase().includes(G.value.toLowerCase())));function K(s){A.value=!1,L.value=b.value.indexOf(s),u.value=Object.assign({},s),D.value=!0}function fe(s){u.value=s,S.value=!0}function ve(){D.value=!1,setTimeout(()=>{u.value=Object.assign({},me.value),L.value=-1},300)}function pe(s,{setErrors:a}){var p;(p=h.value)==null||p.validate().then(({valid:x})=>{x&&(w.value=!0,$.addItem(u.value).then(l=>{if(l.data.error){a({apiError:l.data.message});return}u.value.id!=null?Object.assign(b.value[L.value],l.data):b.value.unshift(l.data),w.value=!1,D.value=!1,u.value={changePassword:!0},R.showSuccess(V("Client enregistré avec succès")),$.fetchStatistics()}).catch(l=>{w.value=!1,a({apiError:l})}).then(()=>{w.value=!1,a({apiError:null})}))})}function ge(){$.deleteItem(u.value.id);const s=b.value.findIndex(a=>a.id==u.value.id);b.value.splice(s,1),S.value=!1,R.showSuccess(V("Client supprimé avec succès")),$.fetchStatistics()}const Ve=N(()=>L.value===-1?u.value.is_customer?V("Nouvel Client"):V("Nouvel Prospect"):u.value.is_customer?V("Modifier Le Client"):V("Modifier Le Prospect")),he=N(()=>r.value.date&&r.value.date.length?r.value.date.length>1?[g.format(r.value.date[0],"shortDate"),g.format(r.value.date[r.value.date.length-1],"shortDate")]:[g.format(r.value.date[0],"shortDate"),g.format(r.value.date[0],"shortDate")]:null);function ae(){try{clearTimeout(Y.value)}catch{}Y.value=setTimeout(()=>{A.value=!0;let s="firstname",a="asc";console.log(k.value),k.value.length>0&&(s=k.value[0].key,a=k.value[0].order),$.fetchItems({term:G.value,paginate:q.value,current_page:P.value,direction:a,order_by:s,page:U.value.page,per_page:U.value.itemsPerPage,...r.value,date:he.value}).then(p=>{if(p.data){const{data:x,current_page:l,next_page_url:d,total:v,per_page:at,to:lt,last_page:be}=p.data;b.value=x,E.value=be,B.value=v}}).catch(p=>{console.error(p)}).then(()=>{A.value=!1})},1e3)}return Pe([G,U,r],()=>{ae()},{deep:!0}),De(()=>{P.value>E.value&&(P.value=E.value)}),(s,a)=>{const p=J("PencilIcon"),x=J("TrashIcon");return I(),F(Ue,null,[e(_e,{title:`${T.value.title}(${B.value})`,breadcrumbs:ie.value},null,8,["title","breadcrumbs"]),e(O,null,{default:t(()=>[e(f,{cols:"12"},{default:t(()=>[e(Je)]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(Ie,{class:"border rounded-md",headers:ce.value,loading:A.value,items:b.value,"multi-sort":!1,"items-per-page":q.value,"onUpdate:itemsPerPage":a[19]||(a[19]=l=>q.value=l),"items-per-page-text":s.$t("Articles par page"),options:U.value,"onUpdate:options":a[20]||(a[20]=l=>U.value=l),"sort-by":k.value,"onUpdate:sortBy":a[21]||(a[21]=l=>k.value=l),page:P.value,"onUpdate:page":a[22]||(a[22]=l=>P.value=l),"items-length":B.value,"onUpdate:itemsLength":a[23]||(a[23]=l=>B.value=l),"show-select":!1,"loading-text":s.$t("Chargement des éléments"),"no-data-text":s.$t("Pas de données"),"no-results-text":s.$t("Aucun résultat"),onPageCount:a[24]||(a[24]=l=>E.value=l)},{top:t(()=>[e(Te,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:t(()=>[e(O,null,{default:t(()=>[e(f,null,{default:t(()=>[e(y,{density:"compact",modelValue:r.value.search,"onUpdate:modelValue":a[0]||(a[0]=l=>r.value.search=l),placeholder:s.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo"},null,8,["modelValue","placeholder"])]),_:1}),e(f,null,{default:t(()=>[e(Ae,{density:"compact",modelValue:r.value.status,"onUpdate:modelValue":a[1]||(a[1]=l=>r.value.status=l),placeholder:s.$t("Statut"),items:_($).statusesList,"item-value":"id","item-title":"label",clearable:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","items"])]),_:1}),e(f,null,{default:t(()=>[e(H,{ref_key:"dialog",ref:de,modelValue:j.value,"onUpdate:modelValue":a[7]||(a[7]=l=>j.value=l),"return-value":r.value.date,"onUpdate:returnValue":a[8]||(a[8]=l=>r.value.date=l),persistent:"",width:"290px"},{activator:t(({props:l})=>[e(y,Z({modelValue:te.value,"onUpdate:modelValue":a[2]||(a[2]=d=>te.value=d),"prepend-inner-icon":"bx-calendar"},l,{density:"compact",placeholder:s.$t("Date"),"hide-details":"",variant:"solo",clearable:"",readonly:"","onClick:clear":a[3]||(a[3]=d=>r.value.date=null)}),null,16,["modelValue","placeholder"])]),default:t(({isActive:l})=>[e(je,{locale:"fr"},{default:t(()=>[e(Ee,{modelValue:r.value.date,"onUpdate:modelValue":a[6]||(a[6]=d=>r.value.date=d),"hide-header":"",multiple:"range"},{actions:t(()=>[e(c,{color:"primary",onClick:a[4]||(a[4]=d=>j.value=!1)},{default:t(()=>[m(n(s.$t("Annuler")),1)]),_:1}),e(C),e(c,{variant:"elevated",color:"primary",onClick:a[5]||(a[5]=d=>j.value=!1)},{default:t(()=>[m(n(s.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),e(f,{class:"d-flex gap-2 justify-space-between"},{default:t(()=>[e(c,{color:"primary",class:"align-self-end",variant:"flat",onClick:a[9]||(a[9]=l=>K({})),dark:""},{default:t(()=>[m(n(s.$t("Ajouter un Prospect")),1)]),_:1}),e(c,{color:"primary",class:"align-self-end",variant:"flat",onClick:a[10]||(a[10]=l=>K({is_customer:!0})),dark:""},{default:t(()=>[m(n(s.$t("Ajouter un client")),1)]),_:1}),e(H,{modelValue:D.value,"onUpdate:modelValue":a[16]||(a[16]=l=>D.value=l),"max-width":"600px"},{default:t(()=>[e(M,null,{default:t(()=>[e(se,{class:"pa-4 bg-secondary"},{default:t(()=>[i("span",Qe,n(Ve.value),1)]),_:1}),e(_(Se),{ref_key:"refForm",ref:h,modelValue:ee.value,"onUpdate:modelValue":a[15]||(a[15]=l=>ee.value=l),onSubmit:pe},{default:t(({errors:l,isSubmitting:d})=>[e(W,null,{default:t(()=>[e(Be,{class:"px-0"},{default:t(()=>[e(O,null,{default:t(()=>[e(f,{cols:"12",md:"6"},{default:t(()=>[e(y,{modelValue:u.value.firstname,"onUpdate:modelValue":a[11]||(a[11]=v=>u.value.firstname=v),rules:[_(le)],label:s.$t("Prénom")},null,8,["modelValue","rules","label"])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[e(y,{modelValue:u.value.lastname,"onUpdate:modelValue":a[12]||(a[12]=v=>u.value.lastname=v),rules:[_(le)],label:s.$t("Nom")},null,8,["modelValue","rules","label"])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[e(y,{modelValue:u.value.email,"onUpdate:modelValue":a[13]||(a[13]=v=>u.value.email=v),label:s.$t("Email")},null,8,["modelValue","label"])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[e(y,{modelValue:u.value.phone,"onUpdate:modelValue":a[14]||(a[14]=v=>u.value.phone=v),label:s.$t("Téléphone")},null,8,["modelValue","label"])]),_:1})]),_:1}),l.apiError?(I(),F("div",We,[e(Le,{color:"error"},{default:t(()=>[m(n(l.apiError),1)]),_:2},1024)])):Q("",!0)]),_:2},1024)]),_:2},1024),e(oe,null,{default:t(()=>[e(C),e(c,{color:"error",variant:"flat",dark:"",onClick:ve},{default:t(()=>[m(n(s.$t("Annuler")),1)]),_:1}),e(c,{color:"success",variant:"flat",loading:w.value,type:"submit"},{default:t(()=>[m(n(s.$t("Sauvegarder")),1)]),_:1},8,["loading"]),e(C)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(H,{modelValue:S.value,"onUpdate:modelValue":a[18]||(a[18]=l=>S.value=l),"max-width":"500px"},{default:t(()=>[e(M,null,{default:t(()=>[e(se,{class:"text-h5 text-center py-6"},{default:t(()=>[m(n(s.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),e(oe,null,{default:t(()=>[e(C),e(c,{color:"error",variant:"flat",dark:"",onClick:a[17]||(a[17]=l=>S.value=!1)},{default:t(()=>[m(n(s.$t("Annuler")),1)]),_:1}),e(c,{color:"success",variant:"flat",dark:"",onClick:ge},{default:t(()=>[m(n(s.$t("OK")),1)]),_:1}),e(C)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.firstname":t(({item:l})=>[i("span",{class:"cursor-pointer",onClick:d=>s.$router.push("/customers/"+l.id)},n(l.firstname),9,Ye)]),"item.lastname":t(({item:l})=>[i("span",{class:"cursor-pointer",onClick:d=>s.$router.push("/customers/"+l.id)},n(l.lastname),9,et)]),"item.created_at":t(({item:l})=>[m(n(_(X)(l.created_at)),1)]),"item.is_customer":t(({item:l})=>[e(xe,{color:l.is_customer==1?"success":"warning",size:"small",label:""},{default:t(()=>[m(n(l.is_customer==1?s.$t("Client"):s.$t("Prospet")),1)]),_:2},1032,["color"])]),"item.actions":t(({item:l})=>[i("div",tt,[e(c,{density:"compact",color:"primary",variant:"outlined",to:"/customers/"+l.id},{default:t(()=>[m(n(s.$t("Voir")),1)]),_:2},1032,["to"]),e(re,{text:s.$t("Modifier")},{activator:t(({props:d})=>[e(c,Z({icon:"",flat:"",onClick:v=>K(l)},d),{default:t(()=>[e(p,{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1032,["text"]),e(re,{text:s.$t("Supprimer")},{activator:t(({props:d})=>[e(c,Z({icon:"",flat:"",onClick:v=>fe(l)},d),{default:t(()=>[e(x,{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040,["onClick"])]),_:2},1032,["text"])])]),"no-data":t(()=>[i("span",null,n(s.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64)}}});export{Dt as default};
