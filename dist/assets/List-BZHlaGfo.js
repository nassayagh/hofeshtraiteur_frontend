import{u as fe}from"./Controller-BYygQIxl.js";import{u as ge}from"./eventType-FT-aHWGA.js";import{u as he}from"./hall-edCu7j-2.js";import{a6 as ye,aJ as be,r as u,av as Ve,aK as s,aL as _e,h as X,e as w,g as Q,q as ke,o as T,c as N,b as l,w as o,a8 as p,n as we,V as P,d as v,t as n,a4 as j,_ as Pe,a as $e,X as Ce}from"./index-CfYHWYZq.js";import{_ as De}from"./BaseBreadcrumb-BOd56rua.js";import{f as W,a as R}from"./formatters-Dv1Ro_l4.js";import{_ as Y}from"./PrespationDashboard.vue_vue_type_script_setup_true_lang-CtPCaTs4.js";import{_ as xe}from"./ChangeHall.vue_vue_type_script_setup_true_lang-BhatCSZX.js";import"./demands-Xn0lPfC_.js";import{V as c,a as Z}from"./VRow-CdijmP0y.js";import{V as Se}from"./VDataTableServer-BpKvQsrS.js";import{V as Ue}from"./VToolbar-D7EQ9bsE.js";import{V as ee}from"./VTextField-CKZHfJFg.js";import{b as E,c as te}from"./VDialog-WAHa-LM4.js";import{V as Te}from"./VLocaleProvider-krwd3c9g.js";import{V as Ee}from"./VDatePicker-CR1gUYZX.js";import{V as H}from"./VSpacer-DLo5Oi9t.js";import{V as Le,b as Ae,c as Ie}from"./VCard-Dcy8KbWZ.js";import{V as ae}from"./VChip-DtMbUV1S.js";import"./VMenu-BDTGSksr.js";import"./index-I5jEJkIR.js";import"./VAvatar-D4e20FOe.js";import"./VTable-Dvq9ZZlz.js";import"./filter-DXOcWSNv.js";import"./VSheet-8EjTlmWn.js";const Me={key:0,class:"text-error font-weight-bold"},Be={key:0},mt=ye({__name:"List",setup(Ne){const b=be();u();const le=Ve(),se=ge(),oe=he(),i=u({title:""}),f=u([{text:s("Dashboard"),disabled:!1,href:"/"},{text:s("Prestations"),disabled:!0,href:"#"}]),g=u([]),K=u([]),O=u([]),d=fe(),h=_e(),y=u(0);X(()=>{oe.fetchItems({per_page:1e3}).then(a=>{O.value=a.data.data}),G(),M(),me()});const $=u(!1);u(!1);const F=u(null),C=u(!1),L=u(10),_=u(2),D=u(2),x=u(0),re=u(!1),A=u("");u(["primary","secondary","error","success","warning"]);const V=u([{key:"demand_date",order:"DESC"}]);u(0);const r=u({search:null,date:null,event_type:null,status:d.statuses.validated}),k=u({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"demand_date",order:"DESC"}]}),ue=u(-1),q=u({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});u({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});const S=u(!1),U=u([{title:s("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:s("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:s("Email"),align:"start",key:"customer.email",sortable:!1},{title:s("Téléphone"),align:"start",key:"customer.phone",sortable:!1},{title:s("Prestation"),align:"start",key:"event_type"},{title:s("Date de la prestation"),align:"start",key:"event_date"},{title:s("La réception se déroulera plutôt"),key:"reception_period"},{title:s("Heure"),key:"reception_start_time"},{title:s("Lieu"),key:"demand.event_location"},{title:s("Convives"),key:"demand.number_people"},{title:s("En attente de règlement"),align:"start",key:"amount_left",sortable:!1},{title:s("Montant total"),align:"start",key:"services_sum_total",sortable:!1},{title:s("Actions"),key:"actions",sortable:!1}]),I=u([{title:s("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:s("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:s("Email"),align:"start",key:"customer.email",sortable:!1},{title:s("Téléphone"),align:"start",key:"customer.phone",sortable:!1},{title:s("Prestation"),align:"start",key:"event_type"},{title:s("Date de la prestation"),align:"start",key:"event_date"},{title:s("La réception se déroulera plutôt"),key:"reception_period"},{title:s("Heure"),key:"reception_start_time"},{title:s("Lieu"),key:"demand.event_location"},{title:s("Convives"),key:"demand.number_people"},{title:s("Salle"),key:"hall"},{title:s("En attente de règlement"),align:"start",key:"amount_left",sortable:!1},{title:s("Montant total"),align:"start",key:"services_sum_total",sortable:!1},{title:s("Actions"),key:"actions",sortable:!1}]),ne=w(()=>h.params.status),z=w(()=>r.value.date&&r.value.date.length>0?b.format(r.value.date[0],"shortDate")+" - "+b.format(r.value.date[r.value.date.length-1],"shortDate"):null);Q(ne,(a,t)=>{a!=t&&(G(),M())},{deep:!0}),w(()=>d.items.data.filter(a=>a.email.toLowerCase().includes(A.value.toLowerCase())));function ie(){d.deleteItem(q.value.id);const a=g.value.findIndex(t=>t.id==q.value.id);g.value.splice(a,1),S.value=!1,le.showSuccess(s("Utilisateur supprimé avec succès"))}w(()=>ue.value===-1?"Nouvel administrateur":"Modifier l’administrateur");const de=w(()=>r.value.date&&r.value.date.length?r.value.date.length>1?[b.format(r.value.date[0],"shortDate"),b.format(r.value.date[r.value.date.length-1],"shortDate")]:[b.format(r.value.date[0],"shortDate"),b.format(r.value.date[0],"shortDate")]:null);function G(){switch(f.value=[{text:s("Dashboard"),disabled:!1,href:"/"}],g.value=[],x.value=0,U.value=I.value,h.params.status){case"started":i.value={title:s("Prestations en attente de validation")},f.value.push({text:i.value.title,disabled:!0,href:"#"}),y.value=d.statuses.started,U.value=I.value.filter(a=>a.key!="services_sum_total"&&a.key!="amount_left");break;case"validated":i.value={title:s("Prestations validées")},f.value.push({text:i.value.title,disabled:!0,href:"#"}),y.value=d.statuses.validated,U.value=I.value;break;case"processing":i.value={title:s("Prestations en cours")},f.value.push({text:i.value.title,disabled:!0,href:"#"}),y.value=d.statuses.processing;break;case"closed":i.value={title:s("Prestations clôturées")},f.value.push({text:i.value.title,disabled:!0,href:"#"}),y.value=d.statuses.closed;break;case"cancelled":i.value={title:s("Prestations annulées")},f.value.push({text:i.value.title,disabled:!0,href:"#"}),y.value=d.statuses.cancelled;break;default:i.value={title:s("Prestations en attente de validation")},f.value.push({text:i.value.title,disabled:!0,href:"#"}),y.value=d.statuses.started;break}}function M(){try{clearTimeout(F.value)}catch{}F.value=setTimeout(()=>{$.value=!0;let a="id",t="desc";console.log(V.value),V.value.length>0&&(a=V.value[0].key,t=V.value[0].order),d.fetchItems({term:A.value,paginate:L.value,current_page:_.value,status:y.value,direction:t,order_by:a,page:k.value.page,per_page:k.value.itemsPerPage,...r.value,date:de.value}).then(e=>{if(e.data){const{data:m,current_page:B,next_page_url:pe,total:J,per_page:ve,to:je,last_page:ce}=e.data;g.value=m,D.value=ce,x.value=J}}).catch(e=>{console.error(e)}).then(()=>{$.value=!1})},1e3)}function me(){se.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(a=>{if(a.data){const{data:t,current_page:e,next_page_url:m,total:B,per_page:pe,to:J,last_page:ve}=a.data;K.value=t}}).catch(a=>{console.error(a)}).then(()=>{$.value=!1})}return Q([A,k,r],()=>{M()},{deep:!0}),ke(()=>{_.value>D.value&&(_.value=D.value)}),X(()=>{}),(a,t)=>(T(),N(Ce,null,[l(De,{title:i.value.title,breadcrumbs:f.value},null,8,["title","breadcrumbs"]),l(Z,null,{default:o(()=>[l(c,{cols:"12",md:"6"},{default:o(()=>[l(Y,{md:"6","show-validation":p(h).params.status=="started","show-validated":p(h).params.status=="validated","show-processing":p(h).params.status=="processing","show-closed":p(h).params.status=="closed","show-cancelled":p(h).params.status=="cancelled","show-description":""},null,8,["show-validation","show-validated","show-processing","show-closed","show-cancelled"])]),_:1}),l(c,{cols:"12",md:"6"},{default:o(()=>[l(Y,{"show-payments":"","show-description":""})]),_:1}),l(c,{cols:"12"},{default:o(()=>[l(Se,{class:"border rounded-md",headers:U.value,loading:$.value,items:g.value,"multi-sort":!1,"items-per-page":L.value,"onUpdate:itemsPerPage":t[14]||(t[14]=e=>L.value=e),"items-per-page-text":a.$t("Articles par page"),options:k.value,"onUpdate:options":t[15]||(t[15]=e=>k.value=e),"sort-by":V.value,"onUpdate:sortBy":t[16]||(t[16]=e=>V.value=e),page:_.value,"onUpdate:page":t[17]||(t[17]=e=>_.value=e),"items-length":x.value,"onUpdate:itemsLength":t[18]||(t[18]=e=>x.value=e),"show-select":!1,"loading-text":a.$t("Chargement des éléments"),"no-data-text":a.$t("Pas de données"),"no-results-text":a.$t("Aucun résultat"),onPageCount:t[19]||(t[19]=e=>D.value=e)},{top:o(()=>[l(Ue,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:o(()=>[l(Z,null,{default:o(()=>[l(c,null,{default:o(()=>[l(ee,{density:"compact",modelValue:r.value.search,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value.search=e),placeholder:a.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),l(c,null,{default:o(()=>[l(E,{density:"compact",modelValue:r.value.event_type,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value.event_type=e),placeholder:a.$t("Prestation"),items:K.value,"item-value":"name","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),l(c,null,{default:o(()=>[l(E,{density:"compact",modelValue:r.value.hall,"onUpdate:modelValue":t[2]||(t[2]=e=>r.value.hall=e),placeholder:a.$t("Salle"),items:O.value,"item-value":"id","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),l(c,null,{default:o(()=>[l(E,{density:"compact",modelValue:r.value.payment_status,"onUpdate:modelValue":t[3]||(t[3]=e=>r.value.payment_status=e),placeholder:a.$t("Reste à payer"),items:[{id:"waiting",label:a.$t("En attente")},{id:"completed",label:a.$t("Soldé")}],"item-value":"id","item-title":"label","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),l(c,null,{default:o(()=>[l(E,{density:"compact",modelValue:r.value.status,"onUpdate:modelValue":t[4]||(t[4]=e=>r.value.status=e),placeholder:a.$t("Statut"),items:p(d).statusesList,"item-value":"id","item-title":"label",clearable:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","items"])]),_:1}),l(c,null,{default:o(()=>[l(te,{ref_key:"dialog",ref:re,modelValue:C.value,"onUpdate:modelValue":t[10]||(t[10]=e=>C.value=e),"return-value":r.value.date,"onUpdate:returnValue":t[11]||(t[11]=e=>r.value.date=e),persistent:"",width:"290px"},{activator:o(({props:e})=>[l(ee,we({modelValue:z.value,"onUpdate:modelValue":t[5]||(t[5]=m=>z.value=m),"prepend-inner-icon":"bx-calendar",readonly:""},e,{density:"compact",placeholder:a.$t("Date"),"hide-details":"",variant:"solo",flat:"",clearable:"","onClick:clear":t[6]||(t[6]=m=>r.value.date=null)}),null,16,["modelValue","placeholder"])]),default:o(({isActive:e})=>[l(Te,{locale:"fr"},{default:o(()=>[l(Ee,{modelValue:r.value.date,"onUpdate:modelValue":t[9]||(t[9]=m=>r.value.date=m),"hide-header":"",multiple:"range"},{actions:o(()=>[l(P,{color:"primary",onClick:t[7]||(t[7]=m=>C.value=!1)},{default:o(()=>[v(n(a.$t("Annuler")),1)]),_:1}),l(H),l(P,{variant:"elevated",color:"primary",onClick:t[8]||(t[8]=m=>C.value=!1)},{default:o(()=>[v(n(a.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1}),l(te,{modelValue:S.value,"onUpdate:modelValue":t[13]||(t[13]=e=>S.value=e),"max-width":"500px"},{default:o(()=>[l(Le,null,{default:o(()=>[l(Ae,{class:"text-h5 text-center py-6"},{default:o(()=>[v(n(a.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),l(Ie,null,{default:o(()=>[l(H),l(P,{color:"error",variant:"flat",dark:"",onClick:t[12]||(t[12]=e=>S.value=!1)},{default:o(()=>[v(n(a.$t("Annuler")),1)]),_:1}),l(P,{color:"success",variant:"flat",dark:"",onClick:ie},{default:o(()=>[v(n(a.$t("OK")),1)]),_:1}),l(H)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.demand_date":o(({item:e})=>[v(n(p(W)(e.demand_date)),1)]),"item.event_date":o(({item:e})=>[v(n(p(W)(e.event_date)),1)]),"item.amount_left":o(({item:e})=>[Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?(T(),N("span",Me,n(p(R)(Math.max(e.services_sum_total-e.payments_sum_amount,0))),1)):j("",!0)]),"item.services_sum_total":o(({item:e})=>[l(ae,{variant:"tonal",color:Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?"error":"success",class:"font-weight-bold"},{default:o(()=>[v(n(p(R)(e.payments_sum_amount||0))+" / "+n(p(R)(e.services_sum_total||0)),1)]),_:2},1032,["color"])]),"item.status":o(({item:e})=>[l(ae,{color:p(d).statusColor(e.status),size:"small",label:""},{default:o(()=>[v(n(p(d).statusText(e.status)),1)]),_:2},1032,["color"])]),"item.hall":o(({index:e,item:m})=>[m.hall?(T(),N("span",Be,n(m.hall.name),1)):j("",!0),m.hall?j("",!0):(T(),Pe(xe,{key:1,modelValue:g.value[e],"onUpdate:modelValue":B=>g.value[e]=B,"show-demand-info":""},null,8,["modelValue","onUpdate:modelValue"]))]),"item.actions":o(({item:e})=>[l(P,{density:"compact",color:"primary",class:"mx-2",variant:"outlined",to:"/prestations/"+e.id},{default:o(()=>[v(n(a.$t("Voir")),1)]),_:2},1032,["to"])]),"no-data":o(()=>[$e("span",null,n(a.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64))}});export{mt as default};
