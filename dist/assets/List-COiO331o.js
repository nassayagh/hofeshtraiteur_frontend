import{u as ke}from"./Controller-mKaDTZCd.js";import{u as $e}from"./eventType-DLchTHlx.js";import{u as Pe}from"./hall-EocmXO1s.js";import{a6 as Ce,aC as we,r as u,av as De,aD as r,aE as Ue,h as xe,e as b,g as Y,q as Se,Z as Ie,o as h,c as F,b as s,w as a,a8 as y,n as Ae,V as I,d as c,t as i,a as A,ae as ee,af as te,_ as T,a4 as w,$ as Te,X as Le}from"./index-D3DdXZdG.js";import{_ as Me,a as ae}from"./BaseBreadcrumb-DYaFDkdC.js";import{a as L,f as H}from"./formatters-DCCWVJxZ.js";import{_ as Ee}from"./ChangeHall.vue_vue_type_script_setup_true_lang-TC73e8jR.js";import"./EditorMenubar-wHmabMPm.js";import"./demands-BJt2E3Si.js";import{_ as qe,a as je,b as Re}from"./PrestationForm.vue_vue_type_script_setup_true_lang-w2UA99qA.js";import{V as k,a as le}from"./VRow-Bx-LvG9A.js";import{V as ze}from"./VDataTableServer-BNqi7y0T.js";import{V as Be}from"./VToolbar-BCTsoXo1.js";import{V as se}from"./VTextField-DLykypQv.js";import{V as oe}from"./VAutocomplete-D4CQMLo9.js";import{V as re}from"./VDialog-BHPx_cIy.js";import{V as Ne}from"./VLocaleProvider-1LaM3sEL.js";import{V as Oe}from"./VDatePicker-CnZR7dot.js";import{i as K,a as ue,h as Fe,f as He,d as Ke,b as Ge}from"./VSpacer-DdAD-FGi.js";import{a as Xe,b as Ze,c as Je}from"./VCard-1m9q3-_R.js";import{V as ne}from"./VTooltip-Bont2L7V.js";import{V as ie}from"./VAvatar-D6zO78xn.js";import"./paymentMethod-Bk9oicCP.js";import"./customers-C-cc3von.js";import"./validators-BPi-vT8z.js";import"./vee-validate.esm-DezKAZlh.js";import"./VContainer-7XyaLTnU.js";import"./VSheet-D3-APUOP.js";const Qe=["onClick"],We=["onClick"],Ye={key:0,class:"text-error font-weight-bold"},et={key:0},It=Ce({__name:"List",setup(tt){const D=we();u();const de=De(),me=$e(),pe=Pe(),m=u({title:r("Prestations")}),g=u([{text:r("Dashboard"),disabled:!1,href:"/"},{text:r("Prestations"),disabled:!0,href:"#"}]),p=u([]),G=u([]),X=u([]),d=ke(),v=Ue(),_=u(0);xe(()=>{if(v.query.status&&(o.value.status=parseInt(v.query.status||0),o.value.status==-1&&(o.value.status=null)),v.query.date){const l=v.query.date.split(","),t=new Date(l[0]),f=new Date(l[1]);o.value.date=[t,f],o.value.status=null}v.query.hall&&(o.value.hall=[parseInt(v.query.hall||0)],o.value.status=null),v.query.event_type&&(o.value.event_type=[v.query.event_type],o.value.status=null),pe.fetchItems({per_page:1e3}).then(l=>{X.value=l.data.data}),Q(),C(),he()});const M=u(!1);u(!1);const Z=u(null),E=u(!1);u(!1);const z=u(100),U=u(2),q=u(2),x=u(0);u(!1);const ve=u(!1),B=u("");u(["primary","secondary","error","success","warning"]);const $=u([{key:"event_date",order:"ASC"}]);u(0);const o=u({search:null,date:null,event_type:null,status:d.statuses.validated}),S=u({itemsPerPage:100,rowsPerPage:100,page:1,sortDesc:[!0],sortBy:[{key:"event_date",order:"ASC"}]}),ce=u(-1),P=u({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});u({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});const j=u(!1),R=u([{title:r("Act"),key:"actions",sortable:!1},{title:r("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:r("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:r("Email"),align:"start",key:"customer.email",sortable:!1},{title:r("Téléphone"),align:"start",key:"customer.phone",sortable:!1},{title:r("Prest"),align:"start",key:"eventtype.name"},{title:r("Date de la prestation"),align:"start",key:"event_date"},{title:r("La réception se déroulera plutôt"),key:"reception_period"},{title:r("Heure"),key:"reception_start_time"},{title:r("Lieu"),key:"event_location"},{title:r("Convives"),key:"number_people"},{title:r("En attente de règlement"),align:"start",key:"amount_left",sortable:!1},{title:r("Montant total"),align:"start",key:"services_sum_total",sortable:!1}]),N=u([{title:r("Act"),key:"actions",sortable:!1},{title:r("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:r("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:r("Email"),align:"start",key:"customer.email",sortable:!1},{title:r("Tél."),align:"start",key:"customer.phone",sortable:!1},{title:r("Prest."),align:"start",key:"eventtype.name"},{title:r("Date prest."),align:"start",key:"event_date"},{title:r("Moment"),key:"reception_period"},{title:r("Con."),key:"number_people"},{title:r("Salle"),key:"hall"},{title:r("Reste à payer"),align:"start",key:"amount_left",sortable:!1},{title:r("Montant total"),align:"start",key:"services_sum_total",sortable:!1}]),fe=b(()=>v.params.status),J=b(()=>o.value.date&&o.value.date.length>0?L(o.value.date[0])+" - "+L(o.value.date[o.value.date.length-1]):null);Y(fe,(l,t)=>{l!=t&&(Q(),C())},{deep:!0}),b(()=>d.items.data.filter(l=>l.email.toLowerCase().includes(B.value.toLowerCase())));function ye(){d.deleteItem(P.value.id);const l=p.value.findIndex(t=>t.id==P.value.id);p.value.splice(l,1),j.value=!1,de.showSuccess(r("Utilisateur supprimé avec succès"))}u({id:null,prestation_id:null,amount:0}),b(()=>ce.value===-1?"Nouvel administrateur":"Modifier l’administrateur");const ge=b(()=>o.value.date&&o.value.date.length?o.value.date.length>1?[D.format(o.value.date[0],"shortDate"),D.format(o.value.date[o.value.date.length-1],"shortDate")]:[D.format(o.value.date[0],"shortDate"),D.format(o.value.date[0],"shortDate")]:null);function Q(){switch(g.value=[{text:r("Dashboard"),disabled:!1,href:"/"}],p.value=[],x.value=0,R.value=N.value,v.params.status){case"started":m.value={title:r("Prestations en attente de validation")},g.value.push({text:m.value.title,disabled:!0,href:"#"}),_.value=d.statuses.started,R.value=N.value.filter(l=>l.key!="services_sum_total"&&l.key!="amount_left");break;case"validated":m.value={title:r("Prestations validées")},g.value.push({text:m.value.title,disabled:!0,href:"#"}),_.value=d.statuses.validated,R.value=N.value;break;case"processing":m.value={title:r("Prestations en cours")},g.value.push({text:m.value.title,disabled:!0,href:"#"}),_.value=d.statuses.processing;break;case"closed":m.value={title:r("Prestations clôturées")},g.value.push({text:m.value.title,disabled:!0,href:"#"}),_.value=d.statuses.closed;break;case"cancelled":m.value={title:r("Prestations annulées")},g.value.push({text:m.value.title,disabled:!0,href:"#"}),_.value=d.statuses.cancelled;break;default:m.value={title:`${r("Prestations")}`},g.value.push({text:m.value.title,disabled:!0,href:"#"}),_.value=d.statuses.started;break}}function C(){try{clearTimeout(Z.value)}catch{}Z.value=setTimeout(()=>{M.value=!0;let l="id",t="desc";console.log($.value),$.value.length>0&&(l=$.value[0].key,t=$.value[0].order),d.fetchItems({term:B.value,paginate:z.value,current_page:U.value,status:_.value,direction:t,order_by:l,page:S.value.page,per_page:S.value.itemsPerPage,...o.value,date:ge.value}).then(f=>{if(f.data){const{data:e,current_page:n,next_page_url:V,total:W,per_page:_e,to:at,last_page:Ve}=f.data;p.value=e.map(O=>{const be=O.event_date!=null?new Date(O.event_date):null;return{...O,event_date:be}}),q.value=Ve,x.value=W}}).catch(f=>{console.error(f)}).then(()=>{M.value=!1})},1e3)}function he(){me.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(l=>{if(l.data){const{data:t,current_page:f,next_page_url:e,total:n,per_page:V,to:W,last_page:_e}=l.data;G.value=t}}).catch(l=>{console.error(l)}).then(()=>{M.value=!1})}return b(()=>P.value.event_date?D.format(P.value.event_date,"shortDate"):null),b(()=>P.value.event_date?L(P.value.event_date):null),Y([B,S,o],()=>{C()},{deep:!0}),Se(()=>{U.value>q.value&&(U.value=q.value)}),(l,t)=>{const f=Ie("DotsVerticalIcon");return h(),F(Le,null,[s(Me,{title:`${m.value.title}(${x.value})`,breadcrumbs:g.value},null,8,["title","breadcrumbs"]),s(le,null,{default:a(()=>[s(k,{cols:"12"},{default:a(()=>[s(ze,{class:"border rounded-md",density:"compact",headers:R.value,loading:M.value,items:p.value,"multi-sort":!1,"items-per-page":z.value,"onUpdate:itemsPerPage":t[14]||(t[14]=e=>z.value=e),"items-per-page-text":l.$t("Articles par page"),options:S.value,"onUpdate:options":t[15]||(t[15]=e=>S.value=e),"sort-by":$.value,"onUpdate:sortBy":t[16]||(t[16]=e=>$.value=e),page:U.value,"onUpdate:page":t[17]||(t[17]=e=>U.value=e),"items-length":x.value,"onUpdate:itemsLength":t[18]||(t[18]=e=>x.value=e),"show-select":!1,"loading-text":l.$t("Chargement des éléments"),"no-data-text":l.$t("Pas de données"),"no-results-text":l.$t("Aucun résultat"),onPageCount:t[19]||(t[19]=e=>q.value=e)},{top:a(()=>[s(Be,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:a(()=>[s(le,null,{default:a(()=>[s(k,null,{default:a(()=>[s(se,{density:"compact",modelValue:o.value.search,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value.search=e),placeholder:l.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),s(k,null,{default:a(()=>[s(oe,{density:"compact",modelValue:o.value.event_type,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value.event_type=e),placeholder:l.$t("Prestation"),items:G.value,"item-value":"id","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),s(k,null,{default:a(()=>[s(oe,{density:"compact",modelValue:o.value.hall,"onUpdate:modelValue":t[2]||(t[2]=e=>o.value.hall=e),placeholder:l.$t("Salle"),items:X.value,"item-value":"id","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),s(k,null,{default:a(()=>[s(ae,{density:"compact",modelValue:o.value.payment_status,"onUpdate:modelValue":t[3]||(t[3]=e=>o.value.payment_status=e),placeholder:l.$t("Reste à payer"),items:[{id:"waiting",label:l.$t("En attente")},{id:"completed",label:l.$t("Soldé")}],"item-value":"id","item-title":"label","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),s(k,null,{default:a(()=>[s(ae,{density:"compact",modelValue:o.value.status,"onUpdate:modelValue":t[4]||(t[4]=e=>o.value.status=e),placeholder:l.$t("Statut"),items:y(d).statusesList,"item-value":"id","item-title":"label",clearable:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","items"])]),_:1}),s(k,null,{default:a(()=>[s(re,{ref_key:"dialog",ref:ve,modelValue:E.value,"onUpdate:modelValue":t[10]||(t[10]=e=>E.value=e),"return-value":o.value.date,"onUpdate:returnValue":t[11]||(t[11]=e=>o.value.date=e),persistent:"",width:"290px"},{activator:a(({props:e})=>[s(se,Ae({modelValue:J.value,"onUpdate:modelValue":t[5]||(t[5]=n=>J.value=n),"prepend-inner-icon":"bx-calendar",readonly:""},e,{density:"compact",placeholder:l.$t("Date"),"hide-details":"",variant:"solo",flat:"",clearable:"","onClick:clear":t[6]||(t[6]=n=>o.value.date=null)}),null,16,["modelValue","placeholder"])]),default:a(({isActive:e})=>[s(Ne,{locale:"fr"},{default:a(()=>[s(Oe,{modelValue:o.value.date,"onUpdate:modelValue":t[9]||(t[9]=n=>o.value.date=n),"hide-header":"",multiple:"range"},{actions:a(()=>[s(I,{color:"primary",onClick:t[7]||(t[7]=n=>E.value=!1)},{default:a(()=>[c(i(l.$t("Annuler")),1)]),_:1}),s(K),s(I,{variant:"elevated",color:"primary",onClick:t[8]||(t[8]=n=>E.value=!1)},{default:a(()=>[c(i(l.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1}),s(re,{modelValue:j.value,"onUpdate:modelValue":t[13]||(t[13]=e=>j.value=e),"max-width":"500px"},{default:a(()=>[s(Xe,null,{default:a(()=>[s(Ze,{class:"text-h5 text-center py-6"},{default:a(()=>[c(i(l.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),s(Je,null,{default:a(()=>[s(K),s(I,{color:"error",variant:"flat",dark:"",onClick:t[12]||(t[12]=e=>j.value=!1)},{default:a(()=>[c(i(l.$t("Annuler")),1)]),_:1}),s(I,{color:"success",variant:"flat",dark:"",onClick:ye},{default:a(()=>[c(i(l.$t("OK")),1)]),_:1}),s(K)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.customer.firstname":a(({item:e})=>[A("span",{class:"cursor-pointer",onClick:n=>l.$router.push("/prestations/"+e.id)},i(e.customer?e.customer.firstname:""),9,Qe)]),"item.customer.lastname":a(({item:e})=>[A("span",{class:"cursor-pointer",onClick:n=>l.$router.push("/prestations/"+e.id)},i(e.customer?e.customer.lastname:""),9,We)]),"item.customer.email":a(({item:e})=>[s(ne,{text:e.customer.email},{activator:a(({props:n})=>[A("span",ee(te(n)),i(!e.customer||e.customer.email==null||e.customer.email.length<7?e.customer.email:`${e.customer.email.replace(`
`," ").slice(0,6)}...`),17)]),_:2},1032,["text"])]),"item.demand_date":a(({item:e})=>[c(i(y(L)(e.demand_date)),1)]),"item.event_date":a(({item:e})=>[c(i(y(L)(e.event_date)),1)]),"item.eventtype.name":a(({item:e})=>[e.eventtype?(h(),T(ne,{key:0,text:e.eventtype?e.eventtype.name:""},{activator:a(({props:n})=>[A("span",ee(te(n)),i(e.eventtype.name==null||e.eventtype.name.length<10?e.eventtype.name:`${e.eventtype.name.replace(`
`," ").slice(0,9)}...`),17)]),_:2},1032,["text"])):w("",!0)]),"item.amount_left":a(({index:e,item:n})=>[Math.max(n.services_sum_total-n.payments_sum_amount,0)>0?(h(),T(qe,{key:0,prestation:p.value[e],"onUpdate:item":C,"button-text":l.$t("Ajouter un paiement"),title:l.$t("Ajouter un paiement"),variant:"text",density:"compact",classes:"px-1"},{default:a(()=>[Math.max(n.services_sum_total-n.payments_sum_amount,0)>0?(h(),F("span",Ye,i(y(H)(Math.max(n.services_sum_total-n.payments_sum_amount,0))),1)):w("",!0)]),_:2},1032,["prestation","button-text","title"])):w("",!0)]),"item.services_sum_total":a(({item:e})=>[s(ue,{variant:"tonal",density:"compact",small:"",color:Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?"error":"success",class:"font-weight-bold body-text-1 px-1"},{default:a(()=>[c(i(y(H)(e.payments_sum_amount||0))+" / "+i(y(H)(e.services_sum_total||0)),1)]),_:2},1032,["color"])]),"item.status":a(({item:e})=>[s(ue,{color:y(d).statusColor(e.status),size:"small",label:""},{default:a(()=>[c(i(y(d).statusText(e.status)),1)]),_:2},1032,["color"])]),"item.hall":a(({index:e,item:n})=>[n.hall?(h(),F("span",et,i(n.hall.name),1)):w("",!0),n.hall?w("",!0):(h(),T(Ee,{key:1,modelValue:p.value[e],"onUpdate:modelValue":V=>p.value[e]=V,"show-demand-info":""},null,8,["modelValue","onUpdate:modelValue"]))]),"item.actions":a(({index:e,item:n})=>[s(I,{size:"30",icon:"",variant:"flat",class:"grey100"},{default:a(()=>[s(ie,{size:"22"},{default:a(()=>[s(f,{size:"20",color:"grey100"})]),_:1}),s(Fe,{activator:"parent"},{default:a(()=>[s(He,null,{default:a(()=>[s(Ke,{value:"action","hide-details":"","min-height":"38",to:"/prestations/"+n.id},{default:a(()=>[s(Ge,null,{default:a(()=>[s(ie,{size:"20",class:"mr-2"},{default:a(()=>[(h(),T(Te("EyeIcon"),{"stroke-width":"2",size:"20"}))]),_:1}),c(" "+i(l.$t("Voir")),1)]),_:1})]),_:2},1032,["to"]),s(je,{onSaved:C,modelValue:p.value[e],"onUpdate:modelValue":V=>p.value[e]=V,"is-new":!1},null,8,["modelValue","onUpdate:modelValue"]),n.status==y(d).statuses.validated?(h(),T(Re,{key:0,onRefresh:C,modelValue:p.value[e],"onUpdate:modelValue":V=>p.value[e]=V},null,8,["modelValue","onUpdate:modelValue"])):w("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"no-data":a(()=>[A("span",null,i(l.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64)}}});export{It as default};
