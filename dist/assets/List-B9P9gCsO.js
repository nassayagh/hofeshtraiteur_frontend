import{u as pe}from"./customers-DvQGnTxg.js";import{u as ce}from"./eventType-0YfHrhZr.js";import{_ as ge}from"./BaseBreadcrumb-DLYx4N78.js";import{r as Z}from"./validators-BPi-vT8z.js";import{f as Ve}from"./formatters-Dv1Ro_l4.js";import{a6 as be,aJ as Ce,r,av as ye,aK as x,h as ke,e as A,g as he,q as $e,Z as G,o as H,c as Q,b as e,w as l,a8 as D,n as E,V as v,d as i,t as n,a as O,a4 as Pe,X as we}from"./index-DkwRdgHS.js";import{F as De,V as Se}from"./vee-validate.esm-CEBej6tT.js";import{_ as Ue}from"./CustomerDashboard.vue_vue_type_script_setup_true_lang-DgOGxRxw.js";import{V as f,a as B}from"./VRow-DqZu2hjJ.js";import{V as Te}from"./VDataTableServer-DSF-Adyw.js";import{V as Ie}from"./VToolbar-CdAB-ACp.js";import{V as C}from"./VTextField-4vZxFc38.js";import{d as _e}from"./filter-2uO5JHRc.js";import{V as F}from"./VDialog-CXq5mtyx.js";import{V as xe}from"./VLocaleProvider-BJ2soEsb.js";import{V as Ae}from"./VDatePicker-CnD2QNGL.js";import{V as S}from"./VSpacer-yr7dW-s2.js";import{V as W,a as Y,b as Ee,c as ee}from"./VCard-CHYAf1cI.js";import{V as je}from"./VContainer-k8DoeS53.js";import{V as Le}from"./VChip-CdYipKHe.js";import{V as ae}from"./VTooltip-DVopnj7G.js";import"./createSimpleFunctional-BUfBUTNM.js";import"./VTable-2-qK-iWv.js";import"./VDivider-DVIF2Pbn.js";import"./index-DziAIju4.js";import"./VAvatar-D_utZLn9.js";import"./VField-BeJau0qT.js";import"./VMenu-D49WRTb8.js";import"./VSheet-q1al2aD6.js";const Ne={class:"text-h5"},Oe={key:0,class:"mt-2"},Be={class:"d-flex align-center"},ba=be({__name:"List",setup(Fe){const V=Ce(),M=r(),z=ye();ce();const te=r({title:"Clients"}),le=r([{text:x("Dashboard"),disabled:!1,href:"/"},{text:x("Clients"),disabled:!0,href:"#"}]),c=r([]);r([]);const g=pe();ke(()=>{X()});const U=r(!1),y=r(!1);r(!1),r(!1),r(!1),r(""),r(),r(!1);const K=r(null);r(null),r(null),r(null);const T=r(!1);r();const j=r(10),k=r(2),I=r(2),L=r(0),R=r(!1),oe=r(!1),h=r(!1);r(null);const N=r("");r(["primary","secondary","error","success","warning"]);const b=r([{key:"created_at",order:"DESC"}]);r(0);const s=r({search:null,status:null,date:null,event_type:null}),$=r({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"created_at",order:"DESC"}]}),_=r(-1),u=r({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),re=r({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),P=r(!1),se=r([{title:"Prénom",align:"start",key:"firstname"},{title:"Nom",align:"start",key:"lastname"},{title:"Email",align:"start",key:"email"},{title:"Téléphone",align:"start",key:"phone"},{title:"Date de creation",align:"start",key:"created_at"},{title:"Status",align:"start",key:"is_customer"},{title:"Actions",key:"actions",sortable:!1}]),q=A(()=>s.value.date&&s.value.date.length>0?V.format(s.value.date[0],"shortDate")+" - "+V.format(s.value.date[s.value.date.length-1],"shortDate"):null);A(()=>g.customers.data.filter(o=>o.email.toLowerCase().includes(N.value.toLowerCase())));function J(o){U.value=!1,_.value=c.value.indexOf(o),u.value=Object.assign({},o),h.value=!0}function ue(o){u.value=o,P.value=!0}function ne(){h.value=!1,setTimeout(()=>{u.value=Object.assign({},re.value),_.value=-1},300)}function de(o,{setErrors:a}){var p;(p=M.value)==null||p.validate().then(({valid:w})=>{w&&(y.value=!0,g.addItem(u.value).then(t=>{if(t.data.error){a({apiError:t.data.message});return}u.value.id!=null?Object.assign(c.value[_.value],t.data):c.value.unshift(t.data),y.value=!1,h.value=!1,u.value={changePassword:!0},z.showSuccess(x("Client enregistré avec succès")),g.fetchStatistics()}).catch(t=>{y.value=!1,a({apiError:t})}).then(()=>{y.value=!1,a({apiError:null})}))})}function ie(){g.deleteItem(u.value.id);const o=c.value.findIndex(a=>a.id==u.value.id);c.value.splice(o,1),P.value=!1,z.showSuccess(x("Client supprimé avec succès")),g.fetchStatistics()}const me=A(()=>_.value===-1?"Nouvel Client":"Modifier Le Client"),ve=A(()=>s.value.date&&s.value.date.length?s.value.date.length>1?[V.format(s.value.date[0],"shortDate"),V.format(s.value.date[s.value.date.length-1],"shortDate")]:[V.format(s.value.date[0],"shortDate"),V.format(s.value.date[0],"shortDate")]:null);function X(){try{clearTimeout(K.value)}catch{}K.value=setTimeout(()=>{U.value=!0;let o="id",a="desc";console.log(b.value),b.value.length>0&&(o=b.value[0].key,a=b.value[0].order),g.fetchItems({term:N.value,paginate:j.value,current_page:k.value,direction:a,order_by:o,page:$.value.page,per_page:$.value.itemsPerPage,...s.value,date:ve.value}).then(p=>{if(p.data){const{data:w,current_page:t,next_page_url:d,total:m,per_page:Me,to:ze,last_page:fe}=p.data;c.value=w,I.value=fe,L.value=m}}).catch(p=>{console.error(p)}).then(()=>{U.value=!1})},1e3)}return he([N,$,s],()=>{X()},{deep:!0}),$e(()=>{k.value>I.value&&(k.value=I.value)}),(o,a)=>{const p=G("PencilIcon"),w=G("TrashIcon");return H(),Q(we,null,[e(ge,{title:te.value.title,breadcrumbs:le.value},null,8,["title","breadcrumbs"]),e(B,null,{default:l(()=>[e(f,{cols:"12"},{default:l(()=>[e(Ue)]),_:1}),e(f,{cols:"12"},{default:l(()=>[e(Te,{class:"border rounded-md",headers:se.value,loading:U.value,items:c.value,"multi-sort":!1,"items-per-page":j.value,"onUpdate:itemsPerPage":a[18]||(a[18]=t=>j.value=t),"items-per-page-text":o.$t("Articles par page"),options:$.value,"onUpdate:options":a[19]||(a[19]=t=>$.value=t),"sort-by":b.value,"onUpdate:sortBy":a[20]||(a[20]=t=>b.value=t),page:k.value,"onUpdate:page":a[21]||(a[21]=t=>k.value=t),"items-length":L.value,"onUpdate:itemsLength":a[22]||(a[22]=t=>L.value=t),"show-select":!1,"loading-text":o.$t("Chargement des éléments"),"no-data-text":o.$t("Pas de données"),"no-results-text":o.$t("Aucun résultat"),onPageCount:a[23]||(a[23]=t=>I.value=t)},{top:l(()=>[e(Ie,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:l(()=>[e(B,null,{default:l(()=>[e(f,null,{default:l(()=>[e(C,{density:"compact",modelValue:s.value.search,"onUpdate:modelValue":a[0]||(a[0]=t=>s.value.search=t),placeholder:o.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo"},null,8,["modelValue","placeholder"])]),_:1}),e(f,null,{default:l(()=>[e(_e,{density:"compact",modelValue:s.value.status,"onUpdate:modelValue":a[1]||(a[1]=t=>s.value.status=t),placeholder:o.$t("Statut"),items:D(g).statusesList,"item-value":"id","item-title":"label",clearable:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","items"])]),_:1}),e(f,null,{default:l(()=>[e(F,{ref_key:"dialog",ref:oe,modelValue:T.value,"onUpdate:modelValue":a[7]||(a[7]=t=>T.value=t),"return-value":s.value.date,"onUpdate:returnValue":a[8]||(a[8]=t=>s.value.date=t),persistent:"",width:"290px"},{activator:l(({props:t})=>[e(C,E({modelValue:q.value,"onUpdate:modelValue":a[2]||(a[2]=d=>q.value=d),"prepend-inner-icon":"bx-calendar"},t,{density:"compact",placeholder:o.$t("Date"),"hide-details":"",variant:"solo",clearable:"",readonly:"","onClick:clear":a[3]||(a[3]=d=>s.value.date=null)}),null,16,["modelValue","placeholder"])]),default:l(({isActive:t})=>[e(xe,{locale:"fr"},{default:l(()=>[e(Ae,{modelValue:s.value.date,"onUpdate:modelValue":a[6]||(a[6]=d=>s.value.date=d),"hide-header":"",multiple:"range"},{actions:l(()=>[e(v,{color:"primary",onClick:a[4]||(a[4]=d=>T.value=!1)},{default:l(()=>[i(n(o.$t("Annuler")),1)]),_:1}),e(S),e(v,{variant:"elevated",color:"primary",onClick:a[5]||(a[5]=d=>T.value=!1)},{default:l(()=>[i(n(o.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),e(f,{class:""},{default:l(()=>[e(F,{modelValue:h.value,"onUpdate:modelValue":a[15]||(a[15]=t=>h.value=t),"max-width":"600px"},{activator:l(({props:t})=>[e(v,E({color:"primary",class:"align-self-end float-end",variant:"flat",onClick:a[9]||(a[9]=d=>J({})),dark:""},t),{default:l(()=>[i(n(o.$t("Ajouter un client")),1)]),_:2},1040)]),default:l(()=>[e(W,null,{default:l(()=>[e(Y,{class:"pa-4 bg-secondary"},{default:l(()=>[O("span",Ne,n(me.value),1)]),_:1}),e(D(De),{ref_key:"refForm",ref:M,modelValue:R.value,"onUpdate:modelValue":a[14]||(a[14]=t=>R.value=t),onSubmit:de},{default:l(({errors:t,isSubmitting:d})=>[e(Ee,null,{default:l(()=>[e(je,{class:"px-0"},{default:l(()=>[e(B,null,{default:l(()=>[e(f,{cols:"12",md:"6"},{default:l(()=>[e(C,{modelValue:u.value.firstname,"onUpdate:modelValue":a[10]||(a[10]=m=>u.value.firstname=m),rules:[D(Z)],label:o.$t("Prénom")},null,8,["modelValue","rules","label"])]),_:1}),e(f,{cols:"12",md:"6"},{default:l(()=>[e(C,{modelValue:u.value.lastname,"onUpdate:modelValue":a[11]||(a[11]=m=>u.value.lastname=m),rules:[D(Z)],label:o.$t("Nom")},null,8,["modelValue","rules","label"])]),_:1}),e(f,{cols:"12",md:"6"},{default:l(()=>[e(C,{modelValue:u.value.email,"onUpdate:modelValue":a[12]||(a[12]=m=>u.value.email=m),label:o.$t("Email")},null,8,["modelValue","label"])]),_:1}),e(f,{cols:"12",md:"6"},{default:l(()=>[e(C,{modelValue:u.value.phone,"onUpdate:modelValue":a[13]||(a[13]=m=>u.value.phone=m),label:o.$t("Téléphone")},null,8,["modelValue","label"])]),_:1})]),_:1}),t.apiError?(H(),Q("div",Oe,[e(Se,{color:"error"},{default:l(()=>[i(n(t.apiError),1)]),_:2},1024)])):Pe("",!0)]),_:2},1024)]),_:2},1024),e(ee,null,{default:l(()=>[e(S),e(v,{color:"error",variant:"flat",dark:"",onClick:ne},{default:l(()=>[i(n(o.$t("Annuler")),1)]),_:1}),e(v,{color:"success",variant:"flat",loading:y.value,type:"submit"},{default:l(()=>[i(n(o.$t("Sauvegarder")),1)]),_:1},8,["loading"]),e(S)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(F,{modelValue:P.value,"onUpdate:modelValue":a[17]||(a[17]=t=>P.value=t),"max-width":"500px"},{default:l(()=>[e(W,null,{default:l(()=>[e(Y,{class:"text-h5 text-center py-6"},{default:l(()=>[i(n(o.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),e(ee,null,{default:l(()=>[e(S),e(v,{color:"error",variant:"flat",dark:"",onClick:a[16]||(a[16]=t=>P.value=!1)},{default:l(()=>[i(n(o.$t("Annuler")),1)]),_:1}),e(v,{color:"success",variant:"flat",dark:"",onClick:ie},{default:l(()=>[i(n(o.$t("OK")),1)]),_:1}),e(S)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.created_at":l(({item:t})=>[i(n(D(Ve)(t.created_at)),1)]),"item.is_customer":l(({item:t})=>[e(Le,{color:t.is_customer==1?"success":"warning",size:"small",label:""},{default:l(()=>[i(n(t.is_customer==1?o.$t("Client"):o.$t("Prospet")),1)]),_:2},1032,["color"])]),"item.actions":l(({item:t})=>[O("div",Be,[e(v,{density:"compact",color:"primary",variant:"outlined",to:"/customers/"+t.id},{default:l(()=>[i(n(o.$t("Voir")),1)]),_:2},1032,["to"]),e(ae,{text:o.$t("Modifier")},{activator:l(({props:d})=>[e(v,E({icon:"",flat:"",onClick:m=>J(t)},d),{default:l(()=>[e(p,{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1032,["text"]),e(ae,{text:o.$t("Supprimer")},{activator:l(({props:d})=>[e(v,E({icon:"",flat:"",onClick:m=>ue(t)},d),{default:l(()=>[e(w,{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040,["onClick"])]),_:2},1032,["text"])])]),"no-data":l(()=>[O("span",null,n(o.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64)}}});export{ba as default};
