import{u as me}from"./Controller-D0nZj2RG.js";import{u as ve}from"./eventType-ChAjQsQn.js";import{a6 as pe,aJ as ce,r as o,av as fe,aK as n,aM as ge,h as O,e as P,g as F,q as he,o as q,c as z,b as a,w as l,a8 as i,n as G,V as b,d as p,t as u,a4 as Ve,ao as be,a as _e,X as ye}from"./index-C81r1NcD.js";import{_ as ke}from"./BaseBreadcrumb-BNX_ZLDS.js";import{f as H,a as L}from"./formatters-Dv1Ro_l4.js";import{_ as J}from"./PrespationDashboard.vue_vue_type_script_setup_true_lang-Bf4nEPBd.js";import{V as _,a as X}from"./VRow-LnVQZeVc.js";import{V as we}from"./VDataTableServer-BDnlwMfQ.js";import{V as Pe}from"./VToolbar-vYYwGnUU.js";import{V as Q}from"./VTextField-COASF3NZ.js";import{d as xe}from"./filter-DbgC40Fk.js";import{V as W}from"./VDialog-BAqrwTlr.js";import{V as Ce}from"./VLocaleProvider-KJAUFE4f.js";import{V as De}from"./VDatePicker-C1bPu2iR.js";import{V as M}from"./VSpacer-CaBPN8nq.js";import{V as $e,a as Te,c as Se}from"./VCard-zH7iwKHZ.js";import{V as Y}from"./VChip-fNbomLy6.js";import{f as Ue,e as Ie,c as Ae,a as Le}from"./VMenu-DZxHvmL8.js";import"./VTable-KyCGavPT.js";import"./VDivider-BNjX7wz_.js";import"./index-BYHtj8rg.js";import"./VAvatar-D3Y35l93.js";import"./VField-D_aZnNbz.js";import"./createSimpleFunctional-DErgX8pL.js";import"./VSheet-tkHson2O.js";const Me={key:0,class:"text-error font-weight-bold"},dt=pe({__name:"List",setup(Ee){const h=ce();o();const Z=fe(),ee=ve(),d=o({title:""}),c=o([{text:n("Dashboard"),disabled:!1,href:"/"},{text:n("Prestations"),disabled:!0,href:"#"}]),y=o([]),E=o([]),m=me(),f=ge(),g=o(0);O(()=>{R(),A(),re()});const x=o(!1);o(!1);const B=o(null),C=o(!1),S=o(10),k=o(2),D=o(2),$=o(0),te=o(!1),U=o("");o(["primary","secondary","error","success","warning"]);const V=o([{key:"demand_date",order:"DESC"}]);o(0);const r=o({search:null,date:null,event_type:null}),w=o({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"demand_date",order:"DESC"}]}),ae=o(-1),N=o({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});o({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});const T=o(!1),I=o([{title:n("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:n("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:n("Email"),align:"start",key:"customer.email",sortable:!1},{title:n("Téléphone"),align:"start",key:"customer.phone",sortable:!1},{title:n("Prestation"),align:"start",key:"event_type"},{title:n("Date de la prestation"),align:"start",key:"event_date"},{title:n("Heure"),key:"demand.reception_start_time"},{title:n("Lieu"),key:"demand.event_location"},{title:n("Convives"),key:"demand.number_people"},{title:n("En attente de règlement"),align:"start",key:"amount_left",sortable:!1},{title:n("Montant total"),align:"start",key:"services_sum_total",sortable:!1},{title:n("Actions"),key:"actions",sortable:!1}]),le=P(()=>f.params.status),j=P(()=>r.value.date&&r.value.date.length>0?h.format(r.value.date[0],"shortDate")+" - "+h.format(r.value.date[r.value.date.length-1],"shortDate"):null);F(le,(s,t)=>{s!=t&&(R(),A())},{deep:!0}),P(()=>m.items.data.filter(s=>s.email.toLowerCase().includes(U.value.toLowerCase())));function se(){m.deleteItem(N.value.id);const s=y.value.findIndex(t=>t.id==N.value.id);y.value.splice(s,1),T.value=!1,Z.showSuccess(n("Utilisateur supprimé avec succès"))}P(()=>ae.value===-1?"Nouvel administrateur":"Modifier l’administrateur");const oe=P(()=>r.value.date&&r.value.date.length?r.value.date.length>1?[h.format(r.value.date[0],"shortDate"),h.format(r.value.date[r.value.date.length-1],"shortDate")]:[h.format(r.value.date[0],"shortDate"),h.format(r.value.date[0],"shortDate")]:null);function R(){switch(c.value=[{text:n("Dashboard"),disabled:!1,href:"/"}],y.value=[],$.value=0,f.params.status){case"started":d.value={title:n("Prestations en attente de validation")},c.value.push({text:d.value.title,disabled:!0,href:"#"}),g.value=m.statuses.started,I.value=I.value.filter(s=>s.key!="services_sum_total"&&s.key!="amount_left");break;case"validated":d.value={title:n("Prestations validées")},c.value.push({text:d.value.title,disabled:!0,href:"#"}),g.value=m.statuses.validated;break;case"processing":d.value={title:n("Prestations en cours")},c.value.push({text:d.value.title,disabled:!0,href:"#"}),g.value=m.statuses.processing;break;case"closed":d.value={title:n("Prestations clôturées")},c.value.push({text:d.value.title,disabled:!0,href:"#"}),g.value=m.statuses.closed;break;case"cancelled":d.value={title:n("Prestations annulées")},c.value.push({text:d.value.title,disabled:!0,href:"#"}),g.value=m.statuses.cancelled;break;default:d.value={title:n("Prestations en attente de validation")},c.value.push({text:d.value.title,disabled:!0,href:"#"}),g.value=m.statuses.started;break}}function A(){try{clearTimeout(B.value)}catch{}B.value=setTimeout(()=>{x.value=!0;let s="id",t="desc";console.log(V.value),V.value.length>0&&(s=V.value[0].key,t=V.value[0].order),m.fetchItems({term:U.value,paginate:S.value,current_page:k.value,status:g.value,direction:t,order_by:s,page:w.value.page,per_page:w.value.itemsPerPage,...r.value,date:oe.value}).then(e=>{if(e.data){const{data:v,current_page:ne,next_page_url:ue,total:K,per_page:de,to:Be,last_page:ie}=e.data;y.value=v,D.value=ie,$.value=K}}).catch(e=>{console.error(e)}).then(()=>{x.value=!1})},1e3)}function re(){ee.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(s=>{if(s.data){const{data:t,current_page:e,next_page_url:v,total:ne,per_page:ue,to:K,last_page:de}=s.data;E.value=t}}).catch(s=>{console.error(s)}).then(()=>{x.value=!1})}return F([U,w,r],()=>{A()},{deep:!0}),he(()=>{k.value>D.value&&(k.value=D.value)}),O(()=>{}),(s,t)=>(q(),z(ye,null,[a(ke,{title:d.value.title,breadcrumbs:c.value},null,8,["title","breadcrumbs"]),a(X,null,{default:l(()=>[a(_,{cols:"12",md:"6"},{default:l(()=>[a(J,{md:"6","show-validation":i(f).params.status=="started","show-validated":i(f).params.status=="validated","show-processing":i(f).params.status=="processing","show-closed":i(f).params.status=="closed","show-cancelled":i(f).params.status=="cancelled","show-description":""},null,8,["show-validation","show-validated","show-processing","show-closed","show-cancelled"])]),_:1}),a(_,{cols:"12",md:"6"},{default:l(()=>[a(J,{"show-payments":"","show-description":""})]),_:1}),a(_,{cols:"12"},{default:l(()=>[a(we,{class:"border rounded-md",headers:I.value,loading:x.value,items:y.value,"multi-sort":!1,"items-per-page":S.value,"onUpdate:itemsPerPage":t[11]||(t[11]=e=>S.value=e),"items-per-page-text":s.$t("Articles par page"),options:w.value,"onUpdate:options":t[12]||(t[12]=e=>w.value=e),"sort-by":V.value,"onUpdate:sortBy":t[13]||(t[13]=e=>V.value=e),page:k.value,"onUpdate:page":t[14]||(t[14]=e=>k.value=e),"items-length":$.value,"onUpdate:itemsLength":t[15]||(t[15]=e=>$.value=e),"show-select":!1,"loading-text":s.$t("Chargement des éléments"),"no-data-text":s.$t("Pas de données"),"no-results-text":s.$t("Aucun résultat"),onPageCount:t[16]||(t[16]=e=>D.value=e)},{top:l(()=>[a(Pe,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:l(()=>[a(X,null,{default:l(()=>[a(_,null,{default:l(()=>[a(Q,{density:"compact",modelValue:r.value.search,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value.search=e),placeholder:s.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),a(_,null,{default:l(()=>[a(xe,{density:"compact",modelValue:r.value.event_type,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value.event_type=e),placeholder:s.$t("Prestation"),items:E.value,"item-value":"name","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),a(_,null,{default:l(()=>[a(W,{ref_key:"dialog",ref:te,modelValue:C.value,"onUpdate:modelValue":t[7]||(t[7]=e=>C.value=e),"return-value":r.value.date,"onUpdate:returnValue":t[8]||(t[8]=e=>r.value.date=e),persistent:"",width:"290px"},{activator:l(({props:e})=>[a(Q,G({modelValue:j.value,"onUpdate:modelValue":t[2]||(t[2]=v=>j.value=v),"prepend-inner-icon":"bx-calendar",readonly:""},e,{density:"compact",placeholder:s.$t("Date"),"hide-details":"",variant:"solo",flat:"",clearable:"","onClick:clear":t[3]||(t[3]=v=>r.value.date=null)}),null,16,["modelValue","placeholder"])]),default:l(({isActive:e})=>[a(Ce,{locale:"fr"},{default:l(()=>[a(De,{modelValue:r.value.date,"onUpdate:modelValue":t[6]||(t[6]=v=>r.value.date=v),"hide-header":"",multiple:"range"},{actions:l(()=>[a(b,{color:"primary",onClick:t[4]||(t[4]=v=>C.value=!1)},{default:l(()=>[p(u(s.$t("Annuler")),1)]),_:1}),a(M),a(b,{variant:"elevated",color:"primary",onClick:t[5]||(t[5]=v=>C.value=!1)},{default:l(()=>[p(u(s.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1}),a(W,{modelValue:T.value,"onUpdate:modelValue":t[10]||(t[10]=e=>T.value=e),"max-width":"500px"},{default:l(()=>[a($e,null,{default:l(()=>[a(Te,{class:"text-h5 text-center py-6"},{default:l(()=>[p(u(s.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),a(Se,null,{default:l(()=>[a(M),a(b,{color:"error",variant:"flat",dark:"",onClick:t[9]||(t[9]=e=>T.value=!1)},{default:l(()=>[p(u(s.$t("Annuler")),1)]),_:1}),a(b,{color:"success",variant:"flat",dark:"",onClick:se},{default:l(()=>[p(u(s.$t("OK")),1)]),_:1}),a(M)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.demand_date":l(({item:e})=>[p(u(i(H)(e.demand_date)),1)]),"item.event_date":l(({item:e})=>[p(u(i(H)(e.event_date)),1)]),"item.amount_left":l(({item:e})=>[Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?(q(),z("span",Me,u(i(L)(Math.max(e.services_sum_total-e.payments_sum_amount,0))),1)):Ve("",!0)]),"item.services_sum_total":l(({item:e})=>[a(Y,{variant:"tonal",color:Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?"error":"success",class:"font-weight-bold"},{default:l(()=>[p(u(i(L)(e.payments_sum_amount||0))+"/"+u(i(L)(e.services_sum_total||0)),1)]),_:2},1032,["color"])]),"item.status":l(({item:e})=>[a(Y,{color:i(m).statusColor(e.status),size:"small",label:""},{default:l(()=>[p(u(i(m).statusText(e.status)),1)]),_:2},1032,["color"])]),"item.actions":l(({item:e})=>[a(be,{variant:"tonal",color:"primary",class:"text-center bg-primary",density:"compact"},{default:l(()=>[a(b,{to:"/prestations/"+e.id},{default:l(()=>[p(u(s.$t("Prestation")),1)]),_:2},1032,["to"]),a(Ue,{location:s.location},{activator:l(({props:v})=>[a(b,G({icon:"mdi-chevron-down"},v),null,16)]),default:l(()=>[a(Ie,null,{default:l(()=>[a(Ae,{to:"/demands/"+e.demand_id},{default:l(()=>[a(Le,null,{default:l(()=>[p(u(s.$t("Voir la demande")),1)]),_:1})]),_:2},1032,["to"])]),_:2},1024)]),_:2},1032,["location"])]),_:2},1024)]),"no-data":l(()=>[_e("span",null,u(s.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64))}});export{dt as default};
