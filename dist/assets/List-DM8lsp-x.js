import{u as ye}from"./demands-Cf0bF_Ug.js";import{u as ke}from"./eventType-BTUBTk6H.js";import{u as be}from"./customers-DTchVvJV.js";import{u as $e}from"./hall-PzlQrTNG.js";import{_ as Ce}from"./BaseBreadcrumb-Dl6T1RHu.js";import{a as S}from"./formatters-DCCWVJxZ.js";import{a6 as De,aC as Pe,r as o,av as Se,aD as u,h as we,e as h,g as Ue,q as Ie,Z as Te,o as f,c as Z,b as l,w as a,n as Ae,V as w,d as v,t as d,a4 as U,_ as y,a as k,ae as j,af as O,a8 as z,$ as J,X as xe}from"./index-Dc7Ike8u.js";import{_ as ze,a as Le}from"./CancelDemand.vue_vue_type_script_setup_true_lang-DbASTx6-.js";import{_ as Be}from"./ChangeHall.vue_vue_type_script_setup_true_lang-i7JtzJLF.js";import"./Controller-Dbg2-uVy.js";import{_ as Q}from"./DemandForm.vue_vue_type_script_setup_true_lang-CcS_irTA.js";import{V as I,a as W}from"./VRow-tWFirzHC.js";import{V as Ee}from"./VDataTableServer-CRFJKXwG.js";import{V as Ne}from"./VToolbar-Uj8lXUrB.js";import{V as Y}from"./VTextField-O-EI0zfS.js";import{V as Me}from"./VAutocomplete-0fbud2ba.js";import{V as ee}from"./VDialog-DO3ARWLC.js";import{V as je}from"./VLocaleProvider-CZyAvU2J.js";import{V as Oe}from"./VDatePicker-D2H4WpJ5.js";import{i as R,a as Re,h as Fe,f as Ge,d as te,b as ae}from"./VSpacer-PDeYi6bK.js";import{a as Ke,b as qe,c as He}from"./VCard-CFb_XnfA.js";import{V as F}from"./VTooltip-DYW7S7lH.js";import{V as G}from"./VAvatar-C_XwAk5l.js";import"./EditorMenubar-3SRW0kuc.js";import"./validators-BPi-vT8z.js";import"./vee-validate.esm---0wMJE4.js";import"./VContainer-w49dn065.js";import"./VSheet-BKTfejSY.js";const Xe={key:0},Ze=["onClick"],Je=["onClick"],Pt=De({__name:"List",setup(Qe){const b=Pe();o();const le=Se(),oe=ke(),ne=be(),re=$e(),se=o({title:u("Gestion des demandes")}),ue=o([{text:u("Dashboard"),disabled:!1,href:"/"},{text:u("Gestion des demandes"),disabled:!0,href:"#"}]),i=o([]),K=o([]),de=o([]),ie=o([]),g=ye();we(()=>{_(),ge(),Ve(),re.fetchItems({per_page:1e3}).then(n=>{ie.value=n.data.data})}),o(!1);const L=o(!1);o(!1),o(!1),o(!1),o(!1),o(""),o(),o(!1);const q=o(null);o(null),o(null),o(null);const T=o(!1);o(!1),o();const B=o(100),$=o(2),A=o(2),x=o(0);o(!1),o(!1),o(null);const E=o("");o(["primary","secondary","error","success","warning"]);const V=o([{key:"event_date",order:"ASC"}]);o(0),o({total:0,validated:0,unvalidated:0});const s=o({search:null,status:null,date:null,event_type:null}),C=o({itemsPerPage:100,rowsPerPage:100,page:1,sortDesc:[!0],sortBy:[{key:"event_date",order:"ASC"}]}),me=o(-1),p=o({id:null,event_type_id:null,hall_id:null,customer:{}});o({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:"",customer:{}});const D=o(!1),pe=o([{title:"Act",key:"actions",sortable:!1},{title:u("ID"),align:"start",key:"id",sortable:!0},{title:u("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:u("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:u("Email"),align:"start",key:"customer.email",sortable:!1},{title:u("Tél."),align:"start",key:"customer.phone",sortable:!1},{title:u("Prest."),align:"start",key:"eventtype.name"},{title:u("Source"),align:"start",key:"source"},{title:u("Date 'évén"),key:"event_date"},{title:u("Moment"),key:"reception_period"},{title:u("Lieu"),key:"event_location"},{title:u("Salle"),key:"hall.name"},{title:u("Conv"),key:"number_people"}]),H=h(()=>s.value.date&&s.value.date.length>0?S(s.value.date[0])+" - "+S(s.value.date[s.value.date.length-1]):null);h(()=>p.value.event_date?b.format(p.value.event_date,"shortDate"):null),h(()=>p.value.event_date?S(p.value.event_date):null),h(()=>g.demands.data.filter(n=>n.email.toLowerCase().includes(E.value.toLowerCase())));function ve(n,t){p.value=n,D.value=!0}function ce(){g.deleteItem(p.value.id);const n=i.value.findIndex(t=>t.id==p.value.id);i.value.splice(n,1),D.value=!1,le.showSuccess(u("Demande supprimée avec succès")),g.fetchStatistics()}h(()=>me.value===-1?"Nouvelle demande":"Modifier la demande");const fe=h(()=>s.value.date&&s.value.date.length?s.value.date.length>1?[b.format(s.value.date[0],"shortDate"),b.format(s.value.date[s.value.date.length-1],"shortDate")]:[b.format(s.value.date[0],"shortDate"),b.format(s.value.date[0],"shortDate")]:null);function _(){try{clearTimeout(q.value)}catch{}q.value=setTimeout(()=>{L.value=!0;let n="id",t="desc";console.log(V.value),V.value.length>0&&(n=V.value[0].key,t=V.value[0].order),g.fetchItems({term:E.value,paginate:B.value,current_page:$.value,direction:t,order_by:n,page:C.value.page,per_page:C.value.itemsPerPage,...s.value,date:fe.value}).then(c=>{if(c.data){const{data:e,current_page:r,next_page_url:m,total:N,per_page:X,to:P,last_page:_e}=c.data;i.value=e.map(M=>{const he=M.event_date!=null?new Date(M.event_date):null;return{...M,event_date:he}}),A.value=_e,x.value=N}}).catch(c=>{console.error(c)}).then(()=>{L.value=!1})},1e3)}function ge(){oe.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(n=>{if(n.data){const{data:t,current_page:c,next_page_url:e,total:r,per_page:m,to:N,last_page:X}=n.data;K.value=t}}).catch(n=>{console.error(n)}).then(()=>{})}function Ve(){p.value={customer:{}},ne.fetchItems({term:"",paginate:5e3,current_page:1,direction:"asc",order_by:"firstname",page:1,per_page:5e3}).then(n=>{if(n.data){const{data:t,current_page:c,next_page_url:e,total:r,per_page:m,to:N,last_page:X}=n.data;de.value=t.map(P=>({...P,name:P.firstname+" "+P.lastname+" ("+(P.is_customer?u("Client"):u("Prospect"))+")"}))}}).catch(n=>{console.error(n)}).then(()=>{})}return Ue([E,C,s],()=>{_()},{deep:!0}),Ie(()=>{$.value>A.value&&($.value=A.value)}),(n,t)=>{const c=Te("DotsVerticalIcon");return f(),Z(xe,null,[l(Ce,{title:`${se.value.title}(${x.value})`,breadcrumbs:ue.value},null,8,["title","breadcrumbs"]),l(W,null,{default:a(()=>[l(I,{cols:"12"},{default:a(()=>[l(Ee,{class:"border rounded-md",headers:pe.value,loading:L.value,items:i.value,"multi-sort":!1,"items-per-page":B.value,"onUpdate:itemsPerPage":t[12]||(t[12]=e=>B.value=e),"items-per-page-text":n.$t("Articles par page"),options:C.value,"onUpdate:options":t[13]||(t[13]=e=>C.value=e),"sort-by":V.value,"onUpdate:sortBy":t[14]||(t[14]=e=>V.value=e),page:$.value,"onUpdate:page":t[15]||(t[15]=e=>$.value=e),"items-length":x.value,"onUpdate:itemsLength":t[16]||(t[16]=e=>x.value=e),"show-select":!1,"loading-text":n.$t("Chargement des éléments"),"no-data-text":n.$t("Pas de données"),"no-results-text":n.$t("Aucun résultat"),onPageCount:t[17]||(t[17]=e=>A.value=e)},{top:a(()=>[l(Ne,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:a(()=>[l(W,null,{default:a(()=>[l(I,null,{default:a(()=>[l(Y,{density:"compact",modelValue:s.value.search,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value.search=e),placeholder:n.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),l(I,null,{default:a(()=>[l(Me,{density:"compact",modelValue:s.value.event_type_id,"onUpdate:modelValue":t[1]||(t[1]=e=>s.value.event_type_id=e),placeholder:n.$t("Prestation"),label:n.$t("Prestation"),items:K.value,"item-value":"id","item-title":"name",clearable:"",multiple:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","label","items"])]),_:1}),l(I,null,{default:a(()=>[l(ee,{ref:"dialog",modelValue:T.value,"onUpdate:modelValue":t[7]||(t[7]=e=>T.value=e),"return-value":s.value.date,"onUpdate:returnValue":t[8]||(t[8]=e=>s.value.date=e),persistent:"",width:"290px"},{activator:a(({props:e})=>[l(Y,Ae({modelValue:H.value,"onUpdate:modelValue":t[2]||(t[2]=r=>H.value=r),"prepend-inner-icon":"bx-calendar"},e,{density:"compact",placeholder:n.$t("Date"),label:n.$t("Date"),"hide-details":"",variant:"solo",clearable:"",readonly:"","onClick:clear":t[3]||(t[3]=r=>s.value.date=null)}),null,16,["modelValue","placeholder","label"])]),default:a(({isActive:e})=>[l(je,{locale:"fr"},{default:a(()=>[l(Oe,{modelValue:s.value.date,"onUpdate:modelValue":t[6]||(t[6]=r=>s.value.date=r),"hide-header":"",multiple:"range"},{actions:a(()=>[l(w,{color:"primary",onClick:t[4]||(t[4]=r=>T.value=!1)},{default:a(()=>[v(d(n.$t("Annuler")),1)]),_:1}),l(R),l(w,{variant:"elevated",color:"primary",onClick:t[5]||(t[5]=r=>T.value=!1)},{default:a(()=>[v(d(n.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),l(I,{class:""},{default:a(()=>[l(Q,{modelValue:p.value,"onUpdate:modelValue":t[9]||(t[9]=e=>p.value=e),onSaved:_},null,8,["modelValue"])]),_:1})]),_:1}),l(ee,{modelValue:D.value,"onUpdate:modelValue":t[11]||(t[11]=e=>D.value=e),"max-width":"500px"},{default:a(()=>[l(Ke,null,{default:a(()=>[l(qe,{class:"text-h5 text-center py-6"},{default:a(()=>[v(d(n.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),l(He,null,{default:a(()=>[l(R),l(w,{color:"error",variant:"flat",dark:"",onClick:t[10]||(t[10]=e=>D.value=!1)},{default:a(()=>[v(d(n.$t("Annuler")),1)]),_:1}),l(w,{color:"success",variant:"flat",dark:"",onClick:ce},{default:a(()=>[v(d(n.$t("OK")),1)]),_:1}),l(R)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.hall.name":a(({index:e,item:r})=>[r.hall?(f(),Z("span",Xe,d(r.hall.name),1)):U("",!0),r.hall?U("",!0):(f(),y(Be,{key:1,modelValue:i.value[e],"onUpdate:modelValue":m=>i.value[e]=m,"show-demand-info":"",type:"demand"},null,8,["modelValue","onUpdate:modelValue"]))]),"item.customer.firstname":a(({item:e})=>[k("span",{class:"cursor-pointer",onClick:r=>n.$router.push("/demands/"+e.id)},d(e.customer?e.customer.firstname:""),9,Ze)]),"item.customer.lastname":a(({item:e})=>[k("span",{class:"cursor-pointer",onClick:r=>n.$router.push("/demands/"+e.id)},d(e.customer?e.customer.lastname:""),9,Je)]),"item.customer.email":a(({item:e})=>[l(F,{text:e.customer.email},{activator:a(({props:r})=>[k("span",j(O(r)),d(!e.customer||e.customer.email==null||e.customer.email.length<7?e.customer.email:`${e.customer.email.replace(`
`," ").slice(0,6)}...`),17)]),_:2},1032,["text"])]),"item.demand_date":a(({item:e})=>[v(d(z(S)(e.demand_date)),1)]),"item.event_date":a(({item:e})=>[v(d(z(S)(e.event_date)),1)]),"item.event_location":a(({item:e})=>[l(F,{text:e.event_location},{activator:a(({props:r})=>[k("span",j(O(r)),d(!e.event_location||e.event_location.length<10?e.event_location:`${e.event_location.slice(0,9)}...`),17)]),_:2},1032,["text"])]),"item.eventtype":a(({item:e})=>[e.eventtype?(f(),y(F,{key:0,text:e.eventtype?e.eventtype.name:""},{activator:a(({props:r})=>[k("span",j(O(r)),d(!e.eventtype.name||e.eventtype.name.length<10?e.eventtype.name:`${e.eventtype.name.slice(0,9)}...`),17)]),_:2},1032,["text"])):U("",!0)]),"item.status":a(({item:e})=>[l(Re,{color:z(g).statusColor(e.status),size:"small",label:""},{default:a(()=>[v(d(z(g).statusText(e.status)),1)]),_:2},1032,["color"])]),"item.actions":a(({index:e,item:r})=>[l(w,{size:"30",icon:"",variant:"flat",class:"grey100"},{default:a(()=>[l(G,{size:"22"},{default:a(()=>[l(c,{size:"20",color:"grey100"})]),_:1}),l(Fe,{activator:"parent","close-on-content-click":""},{default:a(()=>[l(Ge,null,{default:a(()=>[r.prestation?U("",!0):(f(),y(ze,{key:0,modelValue:i.value[e],"onUpdate:modelValue":m=>i.value[e]=m,onSaved:_},null,8,["modelValue","onUpdate:modelValue"])),l(Q,{modelValue:i.value[e],"onUpdate:modelValue":m=>i.value[e]=m,"is-new":!1,onSaved:_},null,8,["modelValue","onUpdate:modelValue"]),l(te,{value:"action","hide-details":"","min-height":"38",to:"/demands/"+r.id},{default:a(()=>[l(ae,null,{default:a(()=>[l(G,{size:"20",class:"mr-2"},{default:a(()=>[(f(),y(J("EyeIcon"),{"stroke-width":"2",size:"20"}))]),_:1}),v(" "+d(n.$t("Voir")),1)]),_:1})]),_:2},1032,["to"]),l(te,{value:"action","hide-details":"","min-height":"38",onClick:m=>ve(r,e)},{default:a(()=>[l(ae,null,{default:a(()=>[l(G,{size:"20",class:"mr-2"},{default:a(()=>[(f(),y(J("TrashIcon"),{"stroke-width":"2",size:"20"}))]),_:1}),v(" "+d(n.$t("Supprimer")),1)]),_:1})]),_:2},1032,["onClick"]),r.prestation?U("",!0):(f(),y(Le,{key:1,modelValue:i.value[e],"onUpdate:modelValue":m=>i.value[e]=m,onSaved:_},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"no-data":a(()=>[k("span",null,d(n.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64)}}});export{Pt as default};
