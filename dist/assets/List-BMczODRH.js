import{u as re}from"./Controller-DXRe0cIf.js";import{u as oe}from"./eventType-C0e8xVK3.js";import{O as ue,ad as ne,r,aa as ie,ae as u,ag as de,h as R,e as k,g as F,q as me,o as pe,c as ve,b as l,w as s,n as fe,V as h,d as m,t as i,Q as P,a as ce,M as ge}from"./index-CYfILRca.js";import{_ as he}from"./BaseBreadcrumb-DRlD6SE8.js";import{f as Ve,a as K}from"./formatters-Dv1Ro_l4.js";import{V as $,a as q}from"./VRow-PtTG9hte.js";import{V as be}from"./VDataTableServer-B7K8lz9f.js";import{V as ye}from"./VToolbar-BgY2MoTJ.js";import{V as z}from"./VTextField-BvYgUM-Q.js";import{V as ke}from"./VSelect-MSQvVxCU.js";import{V as G}from"./VDialog-6XXdTcm3.js";import{V as Pe}from"./VLocaleProvider-E9yf5xF4.js";import{V as _e}from"./VDatePicker-DTYYhwMx.js";import{V as E}from"./VSpacer-BBf-e-OC.js";import{V as De,a as xe,b as we}from"./VCard-Dnooo6lu.js";import{V as Ce}from"./VChip-wPEPIJH-.js";/* empty css              */import"./VDataTable-ChLcJuzV.js";import"./VCheckboxBtn-B6YJkQsh.js";import"./VSelectionControl-CMu1FWhO.js";import"./VLabel-DiIOZmLy.js";import"./VTable-D9vI0vca.js";import"./filter-DUCWV3-1.js";import"./VDivider-DiuNH7Gl.js";import"./index-CFsFbVMi.js";import"./VAvatar-CjZwGR36.js";/* empty css                   */import"./VField-xHnotgnH.js";import"./VInput-D8bMUpni.js";import"./VList-Bms9krOO.js";import"./ssrBoot-u4_DabEQ.js";import"./createSimpleFunctional-DQFtp_zt.js";import"./dialog-transition-Dvg3ebcB.js";import"./VMenu-BeEIwRV5.js";import"./VSheet-D_19sChg.js";import"./VSlideGroup-D8JjGdTS.js";const pt=ue({__name:"List",setup($e){const c=ne();r();const Q=ie(),H=oe(),n=r({title:""}),p=r([{text:u("Dashboard"),disabled:!1,href:"/"},{text:u("Prestations"),disabled:!0,href:"#"}]),V=r([]),B=r([]),d=re(),S=de(),f=r(0);R(()=>{N(),I(),ee()});const _=r(!1);r(!1);const M=r(null),D=r(!1),U=r(10),b=r(2),x=r(2),w=r(0),J=r(!1),T=r("");r(["primary","secondary","error","success","warning"]);const g=r([{key:"demand_date",order:"DESC"}]);r(0);const o=r({search:null,date:null,event_type:null}),y=r({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"demand_date",order:"DESC"}]}),W=r(-1),j=r({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});r({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});const C=r(!1),A=r([{title:u("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:u("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:u("Email"),align:"start",key:"customer.email",sortable:!1},{title:u("Téléphone"),align:"start",key:"customer.phone",sortable:!1},{title:u("Prestation"),align:"start",key:"event_type"},{title:u("Date de la prestation"),align:"start",key:"demand_date"}]),X=k(()=>S.params.status),L=k(()=>o.value.date&&o.value.date.length>0?c.format(o.value.date[0],"shortDate")+" - "+c.format(o.value.date[o.value.date.length-1],"shortDate"):null);F(X,(a,t)=>{a!=t&&(N(),I())},{deep:!0}),k(()=>d.items.data.filter(a=>a.email.toLowerCase().includes(T.value.toLowerCase())));function Y(){d.deleteItem(j.value.id);const a=V.value.findIndex(t=>t.id==j.value.id);V.value.splice(a,1),C.value=!1,Q.showSuccess(u("Utilisateur supprimé avec succès"))}k(()=>W.value===-1?"Nouvel administrateur":"Modifier l’administrateur");const Z=k(()=>o.value.date&&o.value.date.length?o.value.date.length>1?[c.format(o.value.date[0],"shortDate"),c.format(o.value.date[o.value.date.length-1],"shortDate")]:[c.format(o.value.date[0],"shortDate"),c.format(o.value.date[0],"shortDate")]:null);function N(){switch(p.value=[{text:u("Dashboard"),disabled:!1,href:"/"}],V.value=[],w.value=0,S.params.status){case"started":n.value={title:u("Prestations en attente de validation")},p.value.push({text:n.value.title,disabled:!0,href:"#"}),f.value=d.statuses.started;break;case"validated":n.value={title:u("Prestations validées")},p.value.push({text:n.value.title,disabled:!0,href:"#"}),f.value=d.statuses.validated;break;case"processing":n.value={title:u("Prestations en cours")},p.value.push({text:n.value.title,disabled:!0,href:"#"}),f.value=d.statuses.processing;break;case"closed":n.value={title:u("Prestations clôturées")},p.value.push({text:n.value.title,disabled:!0,href:"#"}),f.value=d.statuses.closed;break;case"cancelled":n.value={title:u("Prestations annulées")},p.value.push({text:n.value.title,disabled:!0,href:"#"}),f.value=d.statuses.cancelled;break;default:n.value={title:u("Prestations en attente de validation")},p.value.push({text:n.value.title,disabled:!0,href:"#"}),f.value=d.statuses.started;break}}function I(){try{clearTimeout(M.value)}catch{}M.value=setTimeout(()=>{_.value=!0;let a="id",t="desc";console.log(g.value),g.value.length>0&&(a=g.value[0].key,t=g.value[0].order),d.fetchItems({term:T.value,paginate:U.value,current_page:b.value,status:f.value,direction:t,order_by:a,page:y.value.page,per_page:y.value.itemsPerPage,...o.value,date:Z.value}).then(e=>{if(e.data){const{data:v,current_page:te,next_page_url:ae,total:O,per_page:le,to:Se,last_page:se}=e.data;V.value=v,x.value=se,w.value=O}}).catch(e=>{console.error(e)}).then(()=>{_.value=!1})},1e3)}function ee(){H.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(a=>{if(a.data){const{data:t,current_page:e,next_page_url:v,total:te,per_page:ae,to:O,last_page:le}=a.data;B.value=t}}).catch(a=>{console.error(a)}).then(()=>{_.value=!1})}return F([T,y,o],()=>{I()},{deep:!0}),me(()=>{b.value>x.value&&(b.value=x.value)}),R(()=>{S.params.status!="started"?A.value.push({title:u("En attente de règlement"),align:"start",key:"amount_left",sortable:!1},{title:u("Montant total"),align:"start",key:"services_sum_total",sortable:!1},{title:u("Actions"),key:"actions",sortable:!1}):A.value.push({title:u("Actions"),key:"actions",sortable:!1})}),(a,t)=>(pe(),ve(ge,null,[l(he,{title:n.value.title,breadcrumbs:p.value},null,8,["title","breadcrumbs"]),l(q,null,{default:s(()=>[l($,{cols:"12"},{default:s(()=>[l(be,{class:"border rounded-md",headers:A.value,loading:_.value,items:V.value,"multi-sort":!1,"items-per-page":U.value,"onUpdate:itemsPerPage":t[10]||(t[10]=e=>U.value=e),"items-per-page-text":a.$t("Articles par page"),options:y.value,"onUpdate:options":t[11]||(t[11]=e=>y.value=e),"sort-by":g.value,"onUpdate:sortBy":t[12]||(t[12]=e=>g.value=e),page:b.value,"onUpdate:page":t[13]||(t[13]=e=>b.value=e),"items-length":w.value,"onUpdate:itemsLength":t[14]||(t[14]=e=>w.value=e),"show-select":!1,"loading-text":a.$t("Chargement des éléments"),"no-data-text":a.$t("Pas de données"),"no-results-text":a.$t("Aucun résultat"),onPageCount:t[15]||(t[15]=e=>x.value=e)},{top:s(()=>[l(ye,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:s(()=>[l(q,null,{default:s(()=>[l($,null,{default:s(()=>[l(z,{density:"compact",modelValue:o.value.search,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value.search=e),placeholder:a.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",flat:""},null,8,["modelValue","placeholder"])]),_:1}),l($,null,{default:s(()=>[l(ke,{density:"compact",modelValue:o.value.event_type,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value.event_type=e),placeholder:a.$t("Prestation"),items:B.value,"item-value":"name","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:""},null,8,["modelValue","placeholder","items"])]),_:1}),l($,null,{default:s(()=>[l(G,{ref_key:"dialog",ref:J,modelValue:D.value,"onUpdate:modelValue":t[6]||(t[6]=e=>D.value=e),"return-value":o.value.date,"onUpdate:returnValue":t[7]||(t[7]=e=>o.value.date=e),persistent:"",width:"290px"},{activator:s(({props:e})=>[l(z,fe({modelValue:L.value,"onUpdate:modelValue":t[2]||(t[2]=v=>L.value=v),"prepend-inner-icon":"bx-calendar",readonly:""},e,{density:"compact",placeholder:a.$t("Date"),"hide-details":"",variant:"solo",flat:""}),null,16,["modelValue","placeholder"])]),default:s(({isActive:e})=>[l(Pe,{locale:"fr"},{default:s(()=>[l(_e,{modelValue:o.value.date,"onUpdate:modelValue":t[5]||(t[5]=v=>o.value.date=v),"hide-header":"",multiple:"range"},{actions:s(()=>[l(h,{color:"primary",onClick:t[3]||(t[3]=v=>D.value=!1)},{default:s(()=>[m(i(a.$t("Annuler")),1)]),_:1}),l(E),l(h,{variant:"elevated",color:"primary",onClick:t[4]||(t[4]=v=>D.value=!1)},{default:s(()=>[m(i(a.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1}),l(G,{modelValue:C.value,"onUpdate:modelValue":t[9]||(t[9]=e=>C.value=e),"max-width":"500px"},{default:s(()=>[l(De,null,{default:s(()=>[l(xe,{class:"text-h5 text-center py-6"},{default:s(()=>[m(i(a.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),l(we,null,{default:s(()=>[l(E),l(h,{color:"error",variant:"flat",dark:"",onClick:t[8]||(t[8]=e=>C.value=!1)},{default:s(()=>[m(i(a.$t("Annuler")),1)]),_:1}),l(h,{color:"success",variant:"flat",dark:"",onClick:Y},{default:s(()=>[m(i(a.$t("OK")),1)]),_:1}),l(E)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.demand_date":s(({item:e})=>[m(i(P(Ve)(e.demand_date)),1)]),"item.amount_left":s(({item:e})=>[m(i(P(K)(Math.max(e.services_sum_total-e.payments_sum_amount,0))),1)]),"item.services_sum_total":s(({item:e})=>[m(i(P(K)(e.services_sum_total||0)),1)]),"item.status":s(({item:e})=>[l(Ce,{color:P(d).statusColor(e.status),size:"small",label:""},{default:s(()=>[m(i(P(d).statusText(e.status)),1)]),_:2},1032,["color"])]),"item.actions":s(({item:e})=>[l(h,{density:"compact",color:"primary",variant:"elevated",to:"/prestations/"+e.id},{default:s(()=>[m(i(a.$t("Détails de la prestation")),1)]),_:2},1032,["to"]),l(h,{density:"compact",color:"info",variant:"outlined",class:"ml-4",to:"/demands/"+e.demand_id},{default:s(()=>[m(i(a.$t("Voir la demande")),1)]),_:2},1032,["to"])]),"no-data":s(()=>[ce("span",null,i(a.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64))}});export{pt as default};
