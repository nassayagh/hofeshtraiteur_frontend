import{u as ie,S as me,a as ve,E as fe}from"./ChangeHall.vue_vue_type_script_setup_true_lang-h69SBAHn.js";import{a6 as ce,av as pe,e as k,r as n,aD as D,h as Ve,Z as Fe,o as b,_ as S,w as t,V as h,n as q,d as f,t as v,a4 as K,b as e,a as x,a8 as y,aC as Le,g as je,q as Me,$ as Oe,c as re,X as He}from"./index-CNZTHq5t.js";import{u as ge}from"./demands-CLtUUq4p.js";import{u as be}from"./hall-Cg2IiCCE.js";import{a as ye}from"./formatters-DCCWVJxZ.js";import{b as _e,V as he,c as $e,a as Ce}from"./VCard-CWezbsqR.js";import{f as ze,c as qe,a as Ke}from"./VMenu-BXWfTztM.js";import{a as ke,V as m}from"./VRow-k8DMinYH.js";import{V as ee}from"./filter-4e52CttE.js";import{a as N}from"./VSpacer-CUh9spyT.js";import{V as ae}from"./VDialog-uIBbRd3F.js";import{u as Re}from"./eventType-CPy5jug2.js";import{u as Xe}from"./customers-p8qYZhdT.js";import"./BaseBreadcrumb-DefIfUFo.js";import{r as de}from"./validators-BPi-vT8z.js";import{F as Ze,V as Ge}from"./vee-validate.esm-tYhHYxfk.js";import{V as Je}from"./VAvatar-CqqZhaip.js";import{V as Qe}from"./VContainer-BJ59NK1a.js";import{V as se}from"./VAutocomplete-z90rHxer.js";import{V as C}from"./VTextField-Cr1fb3fa.js";import{V as We}from"./VLocaleProvider-SD9r4gMZ.js";import{V as Ye}from"./VDatePicker-DjmqHVl4.js";const Ca=ce({__name:"ValidateDemand",props:{modelValue:Object,density:{type:String,default:"default"},comment:{type:String,default:""},icon:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(p,{emit:R}){const $=ge(),P=pe(),X=be(),Z=p,F=R,V=k({get:()=>Z.modelValue,set:i=>F("update:modelValue",i)}),w=n(!1),_=n(!1),I=ie({extensions:[me],content:V.value.commentaire}),U=n(V.value.hall_id),T=n([]),L=k(()=>`${D("Validation de la demande de ")} ${(V.value.customer||{firstname:""}).firstname} ${(V.value.customer||{lastname:""}).lastname} ${ye(V.value.demand_date)||""}`);function j(){var i;_.value=!0,$.validateItem(V.value.id,{comment:(i=I.value)==null?void 0:i.getHTML(),hall:U.value}).then(d=>{V.value=d.data,w.value=!1,P.showSuccess(D("Devis validé avec succès")),F("saved",d.data)}).catch(d=>{_.value=!1,P.showError(d.message)}).then(()=>{_.value=!1})}return Ve(()=>{X.fetchItems({per_page:1e3}).then(i=>{T.value=i.data.data})}),(i,d)=>{const M=Fe("CheckIcon");return b(),S(ae,{modelValue:w.value,"onUpdate:modelValue":d[3]||(d[3]=c=>w.value=c),"max-width":"1000px"},{activator:t(({props:c})=>[V.value.prestation?K("",!0):(b(),S(h,q({key:0,dark:""},c,{flat:"",variant:"elevated",density:p.density,color:"primary",icon:p.icon,onClick:d[0]||(d[0]=te=>_.value=!1)}),{default:t(()=>[f(v(p.icon?"":i.$t("Valider en prestation"))+" ",1),p.icon?(b(),S(M,{key:0,"stroke-width":"1.5",size:"20"})):K("",!0)]),_:2},1040,["density","icon"]))]),default:t(()=>[e(Ce,null,{default:t(()=>[e(_e,{class:"text-h5 text-center py-6"},{default:t(()=>[f(v(i.$t("Êtes-vous sûr de vouloir Valider en prestation?")),1)]),_:1}),e(ze),e(he,null,{default:t(()=>[e(ke,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[f(v(L.value),1)]),_:1}),e(m,{cols:"12"},{default:t(()=>[x("label",null,v(i.$t("Commentaire")),1),e(ve,{editor:y(I)},null,8,["editor"]),e(y(fe),{editor:y(I)},null,8,["editor"])]),_:1}),e(m,{cols:"12"},{default:t(()=>[e(ee,{modelValue:U.value,"onUpdate:modelValue":d[1]||(d[1]=c=>U.value=c),items:T.value,"item-value":"id","item-title":"name",label:i.$t("Salle liée")},null,8,["modelValue","items","label"])]),_:1})]),_:1})]),_:1}),e($e,null,{default:t(()=>[e(N),e(h,{color:"error",variant:"flat",dark:"",onClick:d[2]||(d[2]=c=>w.value=!1)},{default:t(()=>[f(v(i.$t("Annuler")),1)]),_:1}),e(h,{color:"success",variant:"flat",loading:_.value,dark:"",onClick:j},{default:t(()=>[f(v(i.$t("Créer la prestation")),1)]),_:1},8,["loading"]),e(N)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),xe={class:"text-h5"},ea={key:0,class:"mt-2"},ka=ce({__name:"DemandForm",props:{modelValue:Object,isNew:{type:Boolean,default:!0},showCustomer:{type:Boolean,default:!0},title:D("Service"),buttonText:{type:String,default:D("Ajouter une demande")}},emits:["update:modelValue","update:item"],setup(p,{emit:R}){const $=Le(),P=n(),X=pe(),Z=Re(),F=Xe(),V=be(),w=p,_=R,I=n([]),U=n([]),T=n([]),L=n([]),j=ge();Ve(()=>{ne(),Ie(),V.fetchItems({per_page:1e3}).then(l=>{L.value=l.data.data})});const i=n(!1),d=n(!1),M=n(null),c=n(!1),te=n(100),G=n(2),J=n(2),De=n(0),le=n(!1),O=n(!1),oe=n(""),H=n([{key:"event_date",order:"ASC"}]),g=n({search:null,status:null,date:null,event_type:null}),Q=n({itemsPerPage:100,rowsPerPage:100,page:1,sortDesc:[!0],sortBy:[{key:"event_date",order:"ASC"}]});n(-1);const o=k({get:()=>w.modelValue||{id:null,customer:{}},set:l=>_("update:modelValue",l)}),W=ie({extensions:[me],content:o.value.commentaire}),Se=k(()=>o.value.event_date?$.format(o.value.event_date,"shortDate"):null),ue=k(()=>o.value.event_date?ye(o.value.event_date):null);function we(){O.value=!1}function Ue(l,{setErrors:a}){var r;console.log(o.value),(r=P.value)==null||r.validate().then(({valid:E})=>{var u;E&&(d.value=!0,j.addItem({...o.value,event_date:Se.value,commentaire:(u=W.value)==null?void 0:u.getHTML()}).then(s=>{if(s.data.error){a({apiError:s.data.message});return}const A=s.data.event_date!=null?new Date(s.data.event_date):null,z={...s.data,event_date:A};_("saved",z),d.value=!1,O.value=!1,X.showSuccess(D("Demande enregistrée avec succès")),ne()}).catch(s=>{d.value=!1,a({apiError:s})}).then(()=>{d.value=!1,a({apiError:null})}))})}const Te=k(()=>o.value.id==null?"Nouvelle demande":"Modifier la demande"),Ee=k(()=>g.value.date&&g.value.date.length?g.value.date.length>1?[$.format(g.value.date[0],"shortDate"),$.format(g.value.date[g.value.date.length-1],"shortDate")]:[$.format(g.value.date[0],"shortDate"),$.format(g.value.date[0],"shortDate")]:null);function Pe(){try{clearTimeout(M.value)}catch{}M.value=setTimeout(()=>{i.value=!0;let l="id",a="desc";console.log(H.value),H.value.length>0&&(l=H.value[0].key,a=H.value[0].order),j.fetchItems({term:oe.value,paginate:te.value,current_page:G.value,direction:a,order_by:l,page:Q.value.page,per_page:Q.value.itemsPerPage,...g.value,date:Ee.value}).then(r=>{if(r.data){const{data:E,current_page:u,next_page_url:s,total:A,per_page:z,to:B,last_page:Be}=r.data;I.value=E.map(Y=>{const Ne=Y.event_date!=null?new Date(Y.event_date):null;return{...Y,event_date:Ne}}),J.value=Be,De.value=A}}).catch(r=>{console.error(r)}).then(()=>{i.value=!1})},1e3)}function ne(){Z.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(l=>{if(l.data){const{data:a,current_page:r,next_page_url:E,total:u,per_page:s,to:A,last_page:z}=l.data;U.value=a}}).catch(l=>{console.error(l)}).then(()=>{})}function Ie(){F.fetchItems({term:"",paginate:5e3,current_page:1,direction:"asc",order_by:"firstname",page:1,per_page:5e3}).then(l=>{if(l.data){const{data:a,current_page:r,next_page_url:E,total:u,per_page:s,to:A,last_page:z}=l.data;T.value=a.map(B=>({...B,name:B.firstname+" "+B.lastname+" ("+(B.is_customer?D("Client"):D("Prospect"))+")"}))}}).catch(l=>{console.error(l)}).then(()=>{})}je([oe,Q,g],()=>{Pe()},{deep:!0}),Me(()=>{G.value>J.value&&(G.value=J.value)});function Ae(l){if(l){const a=T.value.find(r=>r.id==l);a&&(o.value.customer=a)}}return(l,a)=>(b(),S(ae,{modelValue:O.value,"onUpdate:modelValue":a[18]||(a[18]=r=>O.value=r),"max-width":"1000px"},{activator:t(({props:r})=>[p.isNew?(b(),S(h,q({key:0,color:"primary",class:"align-self-end float-end mx-2",variant:"flat",dark:""},r),{default:t(()=>[f(v(p.buttonText),1)]),_:2},1040)):(b(),S(qe,q({key:1,value:"action","hide-details":"","min-height":"38"},r),{default:t(()=>[e(Ke,null,{default:t(()=>[e(Je,{size:"20",class:"mr-2"},{default:t(()=>[(b(),S(Oe("EditIcon"),{"stroke-width":"2",size:"20"}))]),_:1}),f(" "+v(l.$t("Modifier")),1)]),_:1})]),_:2},1040))]),default:t(()=>[e(Ce,null,{default:t(()=>[e(_e,{class:"pa-4 bg-secondary"},{default:t(()=>[x("span",xe,v(Te.value),1)]),_:1}),e(y(Ze),{ref_key:"refForm",ref:P,modelValue:le.value,"onUpdate:modelValue":a[17]||(a[17]=r=>le.value=r),onSubmit:Ue},{default:t(({errors:r,isSubmitting:E})=>[e(he,null,{default:t(()=>[e(Qe,{class:"px-0"},{default:t(()=>[e(ke,null,{default:t(()=>[p.showCustomer?(b(),re(He,{key:0},[e(m,{cols:"12"},{default:t(()=>[e(se,{modelValue:o.value.customer_id,"onUpdate:modelValue":[a[0]||(a[0]=u=>o.value.customer_id=u),Ae],placeholder:l.$t("Client"),label:l.$t("Client"),items:T.value,"item-value":"id","item-title":"name",clearable:"","hide-details":"",variant:"outlined"},null,8,["modelValue","placeholder","label","items"])]),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(C,{modelValue:o.value.customer.firstname,"onUpdate:modelValue":a[1]||(a[1]=u=>o.value.customer.firstname=u),rules:[y(de)],label:l.$t("Prénom")},null,8,["modelValue","rules","label"])]),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(C,{modelValue:o.value.customer.lastname,"onUpdate:modelValue":a[2]||(a[2]=u=>o.value.customer.lastname=u),rules:[y(de)],label:l.$t("Nom")},null,8,["modelValue","rules","label"])]),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(C,{modelValue:o.value.customer.email,"onUpdate:modelValue":a[3]||(a[3]=u=>o.value.customer.email=u),label:l.$t("Email")},null,8,["modelValue","label"])]),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(C,{modelValue:o.value.customer.phone,"onUpdate:modelValue":a[4]||(a[4]=u=>o.value.customer.phone=u),label:l.$t("Téléphone")},null,8,["modelValue","label"])]),_:1})],64)):K("",!0),e(m,{cols:"12",md:"6"},{default:t(()=>[e(se,{modelValue:o.value.event_type_id,"onUpdate:modelValue":a[5]||(a[5]=u=>o.value.event_type_id=u),placeholder:l.$t("Type d'événement"),items:U.value,"item-value":"id","item-title":"name",clearable:"","hide-details":"",variant:"outlined"},null,8,["modelValue","placeholder","items"])]),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(ae,{ref:"dialogDemandDate",modelValue:c.value,"onUpdate:modelValue":a[11]||(a[11]=u=>c.value=u),"return-value":o.value.event_date,"onUpdate:returnValue":a[12]||(a[12]=u=>o.value.event_date=u),persistent:"",width:"290px"},{activator:t(({props:u})=>[e(C,q({modelValue:ue.value,"onUpdate:modelValue":a[6]||(a[6]=s=>ue.value=s),"prepend-inner-icon":"bx-calendar"},u,{placeholder:l.$t("Date de l'évènement"),"hide-details":"",clearable:"",readonly:"","onClick:clear":a[7]||(a[7]=s=>o.value.event_date=null)}),null,16,["modelValue","placeholder"])]),default:t(({isActive:u})=>[e(We,{locale:"fr"},{default:t(()=>[e(Ye,{modelValue:o.value.event_date,"onUpdate:modelValue":a[10]||(a[10]=s=>o.value.event_date=s),"hide-header":""},{actions:t(()=>[e(h,{color:"primary",onClick:a[8]||(a[8]=s=>c.value=!1)},{default:t(()=>[f(v(l.$t("Annuler")),1)]),_:1}),e(N),e(h,{variant:"elevated",color:"primary",onClick:a[9]||(a[9]=s=>c.value=!1)},{default:t(()=>[f(v(l.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(ee,{modelValue:o.value.reception_period,"onUpdate:modelValue":a[13]||(a[13]=u=>o.value.reception_period=u),"hide-details":"",items:[l.$t("En matiné"),l.$t("Le midi"),l.$t("En soirée")],label:l.$t("La réception se déroulera plutôt"),clearable:""},null,8,["modelValue","items","label"])]),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(C,{modelValue:o.value.reception_start_time,"onUpdate:modelValue":a[14]||(a[14]=u=>o.value.reception_start_time=u),"hide-details":"",label:l.$t("Heure de réception"),clearable:""},null,8,["modelValue","label"])]),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(ee,{modelValue:o.value.hall_id,"onUpdate:modelValue":a[15]||(a[15]=u=>o.value.hall_id=u),items:L.value,"item-value":"id","item-title":"name",label:l.$t("Salle liée")},null,8,["modelValue","items","label"])]),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(C,{modelValue:o.value.number_people,"onUpdate:modelValue":a[16]||(a[16]=u=>o.value.number_people=u),"hide-details":"",type:"number",label:l.$t("Nombre de convives")},null,8,["modelValue","label"])]),_:1}),e(m,{cols:"12"},{default:t(()=>[x("label",null,v(l.$t("Commentaire")),1),e(ve,{editor:y(W)},null,8,["editor"]),e(y(fe),{editor:y(W)},null,8,["editor"])]),_:1})]),_:1}),r.apiError?(b(),re("div",ea,[e(Ge,{color:"error"},{default:t(()=>[f(v(r.apiError),1)]),_:2},1024)])):K("",!0)]),_:2},1024)]),_:2},1024),e($e,null,{default:t(()=>[e(N),e(h,{color:"error",variant:"flat",dark:"",onClick:we},{default:t(()=>[f(v(l.$t("Annuler")),1)]),_:1}),e(h,{color:"success",variant:"flat",loading:d.value,type:"submit"},{default:t(()=>[f(v(l.$t("Sauvegarder")),1)]),_:1},8,["loading"]),e(N)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]))}});export{ka as _,Ca as a};
