import{u as fe}from"./Controller-iziHBG1V.js";import{u as ge}from"./eventType-B786Xc3F.js";import{u as he}from"./hall-yfx4Figx.js";import{a6 as ye,aJ as be,r as n,av as _e,aK as s,aL as Ve,h as X,e as w,g as Q,q as ke,o as T,c as B,b as a,w as o,a8 as v,n as we,V as P,d as p,t as u,a4 as N,_ as Pe,a as Ce,X as De}from"./index-BWIBJZct.js";import{_ as $e}from"./BaseBreadcrumb-C6KRtjca.js";import{f as W,a as j}from"./formatters-Dv1Ro_l4.js";import{_ as Y}from"./PrespationDashboard.vue_vue_type_script_setup_true_lang-pm5KkHPf.js";import{_ as xe}from"./ChangeHall.vue_vue_type_script_setup_true_lang-BdtlPVXO.js";import"./demands-BA_5msbb.js";import{V as f,a as Z}from"./VRow-CHh4798a.js";import{V as Se}from"./VDataTableServer-B5LN4ph3.js";import{V as Ue}from"./VToolbar-Ci_-8d_V.js";import{V as ee}from"./VTextField-Bm736GB1.js";import{b as R,c as te}from"./VDialog-bl4cAYo0.js";import{V as Te}from"./VLocaleProvider-DC2wnU_h.js";import{V as Ae}from"./VDatePicker-BHT4RQHY.js";import{V as H}from"./VSpacer-BS9x1fw_.js";import{V as Ee,b as Ie,c as Le}from"./VCard-C_MBnFgh.js";import{V as ae}from"./VChip-D6GpdyNK.js";import"./VMenu-BA9OMPvi.js";import"./index-CdY55EkP.js";import"./VAvatar-BMjKmOGY.js";import"./VTable-Clq-LsDs.js";import"./filter-YcxaRsB0.js";import"./VSheet-D26IeZ7r.js";const Me={key:0,class:"text-error font-weight-bold"},Be={key:0},mt=ye({__name:"List",setup(Ne){const b=be();n();const le=_e(),se=ge(),oe=he(),i=n({title:""}),c=n([{text:s("Dashboard"),disabled:!1,href:"/"},{text:s("Prestations"),disabled:!0,href:"#"}]),g=n([]),K=n([]),O=n([]),d=fe(),h=Ve(),y=n(0);X(()=>{oe.fetchItems({per_page:1e3}).then(l=>{O.value=l.data.data}),G(),L(),me()});const C=n(!1);n(!1);const F=n(null),D=n(!1),A=n(10),V=n(2),$=n(2),x=n(0),re=n(!1),E=n("");n(["primary","secondary","error","success","warning"]);const _=n([{key:"demand_date",order:"DESC"}]);n(0);const r=n({search:null,date:null,event_type:null,status:d.statuses.validated}),k=n({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"demand_date",order:"DESC"}]}),ne=n(-1),q=n({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});n({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});const S=n(!1),U=n([{title:s("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:s("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:s("Email"),align:"start",key:"customer.email",sortable:!1},{title:s("Téléphone"),align:"start",key:"customer.phone",sortable:!1},{title:s("Prestation"),align:"start",key:"event_type"},{title:s("Date de la prestation"),align:"start",key:"event_date"},{title:s("Heure"),key:"demand.reception_start_time"},{title:s("Lieu"),key:"demand.event_location"},{title:s("Convives"),key:"demand.number_people"},{title:s("En attente de règlement"),align:"start",key:"amount_left",sortable:!1},{title:s("Montant total"),align:"start",key:"services_sum_total",sortable:!1},{title:s("Actions"),key:"actions",sortable:!1}]),I=n([{title:s("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:s("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:s("Email"),align:"start",key:"customer.email",sortable:!1},{title:s("Téléphone"),align:"start",key:"customer.phone",sortable:!1},{title:s("Prestation"),align:"start",key:"event_type"},{title:s("Date de la prestation"),align:"start",key:"event_date"},{title:s("Heure"),key:"demand.reception_start_time"},{title:s("Lieu"),key:"demand.event_location"},{title:s("Convives"),key:"demand.number_people"},{title:s("Salle"),key:"hall"},{title:s("En attente de règlement"),align:"start",key:"amount_left",sortable:!1},{title:s("Montant total"),align:"start",key:"services_sum_total",sortable:!1},{title:s("Actions"),key:"actions",sortable:!1}]),ue=w(()=>h.params.status),z=w(()=>r.value.date&&r.value.date.length>0?b.format(r.value.date[0],"shortDate")+" - "+b.format(r.value.date[r.value.date.length-1],"shortDate"):null);Q(ue,(l,t)=>{l!=t&&(G(),L())},{deep:!0}),w(()=>d.items.data.filter(l=>l.email.toLowerCase().includes(E.value.toLowerCase())));function ie(){d.deleteItem(q.value.id);const l=g.value.findIndex(t=>t.id==q.value.id);g.value.splice(l,1),S.value=!1,le.showSuccess(s("Utilisateur supprimé avec succès"))}w(()=>ne.value===-1?"Nouvel administrateur":"Modifier l’administrateur");const de=w(()=>r.value.date&&r.value.date.length?r.value.date.length>1?[b.format(r.value.date[0],"shortDate"),b.format(r.value.date[r.value.date.length-1],"shortDate")]:[b.format(r.value.date[0],"shortDate"),b.format(r.value.date[0],"shortDate")]:null);function G(){switch(c.value=[{text:s("Dashboard"),disabled:!1,href:"/"}],g.value=[],x.value=0,U.value=I.value,h.params.status){case"started":i.value={title:s("Prestations en attente de validation")},c.value.push({text:i.value.title,disabled:!0,href:"#"}),y.value=d.statuses.started,U.value=I.value.filter(l=>l.key!="services_sum_total"&&l.key!="amount_left");break;case"validated":i.value={title:s("Prestations validées")},c.value.push({text:i.value.title,disabled:!0,href:"#"}),y.value=d.statuses.validated,U.value=I.value;break;case"processing":i.value={title:s("Prestations en cours")},c.value.push({text:i.value.title,disabled:!0,href:"#"}),y.value=d.statuses.processing;break;case"closed":i.value={title:s("Prestations clôturées")},c.value.push({text:i.value.title,disabled:!0,href:"#"}),y.value=d.statuses.closed;break;case"cancelled":i.value={title:s("Prestations annulées")},c.value.push({text:i.value.title,disabled:!0,href:"#"}),y.value=d.statuses.cancelled;break;default:i.value={title:s("Prestations en attente de validation")},c.value.push({text:i.value.title,disabled:!0,href:"#"}),y.value=d.statuses.started;break}}function L(){try{clearTimeout(F.value)}catch{}F.value=setTimeout(()=>{C.value=!0;let l="id",t="desc";console.log(_.value),_.value.length>0&&(l=_.value[0].key,t=_.value[0].order),d.fetchItems({term:E.value,paginate:A.value,current_page:V.value,status:y.value,direction:t,order_by:l,page:k.value.page,per_page:k.value.itemsPerPage,...r.value,date:de.value}).then(e=>{if(e.data){const{data:m,current_page:M,next_page_url:ve,total:J,per_page:pe,to:je,last_page:ce}=e.data;g.value=m,$.value=ce,x.value=J}}).catch(e=>{console.error(e)}).then(()=>{C.value=!1})},1e3)}function me(){se.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(l=>{if(l.data){const{data:t,current_page:e,next_page_url:m,total:M,per_page:ve,to:J,last_page:pe}=l.data;K.value=t}}).catch(l=>{console.error(l)}).then(()=>{C.value=!1})}return Q([E,k,r],()=>{L()},{deep:!0}),ke(()=>{V.value>$.value&&(V.value=$.value)}),X(()=>{}),(l,t)=>(T(),B(De,null,[a($e,{title:i.value.title,breadcrumbs:c.value},null,8,["title","breadcrumbs"]),a(Z,null,{default:o(()=>[a(f,{cols:"12",md:"6"},{default:o(()=>[a(Y,{md:"6","show-validation":v(h).params.status=="started","show-validated":v(h).params.status=="validated","show-processing":v(h).params.status=="processing","show-closed":v(h).params.status=="closed","show-cancelled":v(h).params.status=="cancelled","show-description":""},null,8,["show-validation","show-validated","show-processing","show-closed","show-cancelled"])]),_:1}),a(f,{cols:"12",md:"6"},{default:o(()=>[a(Y,{"show-payments":"","show-description":""})]),_:1}),a(f,{cols:"12"},{default:o(()=>[a(Se,{class:"border rounded-md",headers:U.value,loading:C.value,items:g.value,"multi-sort":!1,"items-per-page":A.value,"onUpdate:itemsPerPage":t[13]||(t[13]=e=>A.value=e),"items-per-page-text":l.$t("Articles par page"),options:k.value,"onUpdate:options":t[14]||(t[14]=e=>k.value=e),"sort-by":_.value,"onUpdate:sortBy":t[15]||(t[15]=e=>_.value=e),page:V.value,"onUpdate:page":t[16]||(t[16]=e=>V.value=e),"items-length":x.value,"onUpdate:itemsLength":t[17]||(t[17]=e=>x.value=e),"show-select":!1,"loading-text":l.$t("Chargement des éléments"),"no-data-text":l.$t("Pas de données"),"no-results-text":l.$t("Aucun résultat"),onPageCount:t[18]||(t[18]=e=>$.value=e)},{top:o(()=>[a(Ue,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:o(()=>[a(Z,null,{default:o(()=>[a(f,null,{default:o(()=>[a(ee,{density:"compact",modelValue:r.value.search,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value.search=e),placeholder:l.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),a(f,null,{default:o(()=>[a(R,{density:"compact",modelValue:r.value.event_type,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value.event_type=e),placeholder:l.$t("Prestation"),items:K.value,"item-value":"name","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),a(f,null,{default:o(()=>[a(R,{density:"compact",modelValue:r.value.hall,"onUpdate:modelValue":t[2]||(t[2]=e=>r.value.hall=e),placeholder:l.$t("Salle"),items:O.value,"item-value":"id","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),a(f,null,{default:o(()=>[a(R,{density:"compact",modelValue:r.value.status,"onUpdate:modelValue":t[3]||(t[3]=e=>r.value.status=e),placeholder:l.$t("Statut"),items:v(d).statusesList,"item-value":"id","item-title":"label",clearable:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","items"])]),_:1}),a(f,null,{default:o(()=>[a(te,{ref_key:"dialog",ref:re,modelValue:D.value,"onUpdate:modelValue":t[9]||(t[9]=e=>D.value=e),"return-value":r.value.date,"onUpdate:returnValue":t[10]||(t[10]=e=>r.value.date=e),persistent:"",width:"290px"},{activator:o(({props:e})=>[a(ee,we({modelValue:z.value,"onUpdate:modelValue":t[4]||(t[4]=m=>z.value=m),"prepend-inner-icon":"bx-calendar",readonly:""},e,{density:"compact",placeholder:l.$t("Date"),"hide-details":"",variant:"solo",flat:"",clearable:"","onClick:clear":t[5]||(t[5]=m=>r.value.date=null)}),null,16,["modelValue","placeholder"])]),default:o(({isActive:e})=>[a(Te,{locale:"fr"},{default:o(()=>[a(Ae,{modelValue:r.value.date,"onUpdate:modelValue":t[8]||(t[8]=m=>r.value.date=m),"hide-header":"",multiple:"range"},{actions:o(()=>[a(P,{color:"primary",onClick:t[6]||(t[6]=m=>D.value=!1)},{default:o(()=>[p(u(l.$t("Annuler")),1)]),_:1}),a(H),a(P,{variant:"elevated",color:"primary",onClick:t[7]||(t[7]=m=>D.value=!1)},{default:o(()=>[p(u(l.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1}),a(te,{modelValue:S.value,"onUpdate:modelValue":t[12]||(t[12]=e=>S.value=e),"max-width":"500px"},{default:o(()=>[a(Ee,null,{default:o(()=>[a(Ie,{class:"text-h5 text-center py-6"},{default:o(()=>[p(u(l.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),a(Le,null,{default:o(()=>[a(H),a(P,{color:"error",variant:"flat",dark:"",onClick:t[11]||(t[11]=e=>S.value=!1)},{default:o(()=>[p(u(l.$t("Annuler")),1)]),_:1}),a(P,{color:"success",variant:"flat",dark:"",onClick:ie},{default:o(()=>[p(u(l.$t("OK")),1)]),_:1}),a(H)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.demand_date":o(({item:e})=>[p(u(v(W)(e.demand_date)),1)]),"item.event_date":o(({item:e})=>[p(u(v(W)(e.event_date)),1)]),"item.amount_left":o(({item:e})=>[Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?(T(),B("span",Me,u(v(j)(Math.max(e.services_sum_total-e.payments_sum_amount,0))),1)):N("",!0)]),"item.services_sum_total":o(({item:e})=>[a(ae,{variant:"tonal",color:Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?"error":"success",class:"font-weight-bold"},{default:o(()=>[p(u(v(j)(e.payments_sum_amount||0))+" / "+u(v(j)(e.services_sum_total||0)),1)]),_:2},1032,["color"])]),"item.status":o(({item:e})=>[a(ae,{color:v(d).statusColor(e.status),size:"small",label:""},{default:o(()=>[p(u(v(d).statusText(e.status)),1)]),_:2},1032,["color"])]),"item.hall":o(({index:e,item:m})=>[m.hall?(T(),B("span",Be,u(m.hall.name),1)):N("",!0),m.hall?N("",!0):(T(),Pe(xe,{key:1,modelValue:g.value[e],"onUpdate:modelValue":M=>g.value[e]=M,"show-demand-info":""},null,8,["modelValue","onUpdate:modelValue"]))]),"item.actions":o(({item:e})=>[a(P,{density:"compact",color:"primary",class:"mx-2",variant:"outlined",to:"/prestations/"+e.id},{default:o(()=>[p(u(l.$t("Voir")),1)]),_:2},1032,["to"])]),"no-data":o(()=>[Ce("span",null,u(l.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64))}});export{mt as default};
