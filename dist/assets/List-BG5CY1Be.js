import{u as pe}from"./customers-DnE7v4St.js";import{u as ce}from"./eventType-FT-aHWGA.js";import{_ as ge}from"./BaseBreadcrumb-BOd56rua.js";import{r as Z}from"./validators-BPi-vT8z.js";import{f as Ve}from"./formatters-Dv1Ro_l4.js";import{a6 as be,aJ as ye,r,av as Ce,aK as c,h as ke,e as A,g as $e,q as he,Z as G,o as H,c as Q,b as e,w as l,a8 as S,n as O,V as v,d as i,t as n,a as B,a4 as Pe,X as we}from"./index-CfYHWYZq.js";import{F as De}from"./vee-validate.esm-DmEq-Hou.js";import{_ as Se}from"./CustomerDashboard.vue_vue_type_script_setup_true_lang-ECRD2hAZ.js";import{V as f,a as F}from"./VRow-CdijmP0y.js";import{V as Ue}from"./VDataTableServer-BpKvQsrS.js";import{V as Te}from"./VToolbar-D7EQ9bsE.js";import{V as C}from"./VTextField-CKZHfJFg.js";import{b as _e,c as M}from"./VDialog-WAHa-LM4.js";import{V as Ie}from"./VLocaleProvider-krwd3c9g.js";import{V as xe}from"./VDatePicker-CR1gUYZX.js";import{V as U}from"./VSpacer-DLo5Oi9t.js";import{V as W,b as Y,a as Ae,c as ee}from"./VCard-Dcy8KbWZ.js";import{V as je}from"./VContainer-DFr06vNG.js";import{V as Ee}from"./VAlert-Dt20aOKY.js";import{V as Le}from"./VChip-DtMbUV1S.js";import{V as ae}from"./VTooltip-DMp6fyz0.js";import"./VTable-Dvq9ZZlz.js";import"./filter-DXOcWSNv.js";import"./VMenu-BDTGSksr.js";import"./index-I5jEJkIR.js";import"./VAvatar-D4e20FOe.js";import"./VSheet-8EjTlmWn.js";const Ne={class:"text-h5"},Oe={key:0,class:"mt-2"},Be={class:"d-flex align-center"},ga=be({__name:"List",setup(Fe){const b=ye(),z=r(),K=Ce();ce();const te=r({title:"Clients"}),le=r([{text:c("Dashboard"),disabled:!1,href:"/"},{text:c("Clients"),disabled:!0,href:"#"}]),g=r([]);r([]);const V=pe();ke(()=>{X()});const T=r(!1),k=r(!1);r(!1),r(!1),r(!1),r(""),r(),r(!1);const R=r(null);r(null),r(null),r(null);const _=r(!1);r();const j=r(10),$=r(2),I=r(2),E=r(0),q=r(!1),oe=r(!1),h=r(!1);r(null);const L=r("");r(["primary","secondary","error","success","warning"]);const y=r([{key:"created_at",order:"DESC"}]);r(0);const s=r({search:null,status:null,date:null,event_type:null}),P=r({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"created_at",order:"DESC"}]}),x=r(-1),u=r({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),re=r({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),w=r(!1),se=r([{title:"Prénom",align:"start",key:"firstname"},{title:"Nom",align:"start",key:"lastname"},{title:"Email",align:"start",key:"email"},{title:"Téléphone",align:"start",key:"phone"},{title:"Date de creation",align:"start",key:"created_at"},{title:"Status",align:"start",key:"is_customer"},{title:"Actions",key:"actions",sortable:!1}]),J=A(()=>s.value.date&&s.value.date.length>0?b.format(s.value.date[0],"shortDate")+" - "+b.format(s.value.date[s.value.date.length-1],"shortDate"):null);A(()=>V.customers.data.filter(o=>o.email.toLowerCase().includes(L.value.toLowerCase())));function N(o){T.value=!1,x.value=g.value.indexOf(o),u.value=Object.assign({},o),h.value=!0}function ue(o){u.value=o,w.value=!0}function ne(){h.value=!1,setTimeout(()=>{u.value=Object.assign({},re.value),x.value=-1},300)}function ie(o,{setErrors:a}){var p;(p=z.value)==null||p.validate().then(({valid:D})=>{D&&(k.value=!0,V.addItem(u.value).then(t=>{if(t.data.error){a({apiError:t.data.message});return}u.value.id!=null?Object.assign(g.value[x.value],t.data):g.value.unshift(t.data),k.value=!1,h.value=!1,u.value={changePassword:!0},K.showSuccess(c("Client enregistré avec succès")),V.fetchStatistics()}).catch(t=>{k.value=!1,a({apiError:t})}).then(()=>{k.value=!1,a({apiError:null})}))})}function de(){V.deleteItem(u.value.id);const o=g.value.findIndex(a=>a.id==u.value.id);g.value.splice(o,1),w.value=!1,K.showSuccess(c("Client supprimé avec succès")),V.fetchStatistics()}const me=A(()=>x.value===-1?u.value.is_customer?c("Nouvel Client"):c("Nouvel Prospect"):u.value.is_customer?c("Modifier Le Client"):c("Modifier Le Prospect")),ve=A(()=>s.value.date&&s.value.date.length?s.value.date.length>1?[b.format(s.value.date[0],"shortDate"),b.format(s.value.date[s.value.date.length-1],"shortDate")]:[b.format(s.value.date[0],"shortDate"),b.format(s.value.date[0],"shortDate")]:null);function X(){try{clearTimeout(R.value)}catch{}R.value=setTimeout(()=>{T.value=!0;let o="id",a="desc";console.log(y.value),y.value.length>0&&(o=y.value[0].key,a=y.value[0].order),V.fetchItems({term:L.value,paginate:j.value,current_page:$.value,direction:a,order_by:o,page:P.value.page,per_page:P.value.itemsPerPage,...s.value,date:ve.value}).then(p=>{if(p.data){const{data:D,current_page:t,next_page_url:d,total:m,per_page:Me,to:ze,last_page:fe}=p.data;g.value=D,I.value=fe,E.value=m}}).catch(p=>{console.error(p)}).then(()=>{T.value=!1})},1e3)}return $e([L,P,s],()=>{X()},{deep:!0}),he(()=>{$.value>I.value&&($.value=I.value)}),(o,a)=>{const p=G("PencilIcon"),D=G("TrashIcon");return H(),Q(we,null,[e(ge,{title:te.value.title,breadcrumbs:le.value},null,8,["title","breadcrumbs"]),e(F,null,{default:l(()=>[e(f,{cols:"12"},{default:l(()=>[e(Se)]),_:1}),e(f,{cols:"12"},{default:l(()=>[e(Ue,{class:"border rounded-md",headers:se.value,loading:T.value,items:g.value,"multi-sort":!1,"items-per-page":j.value,"onUpdate:itemsPerPage":a[19]||(a[19]=t=>j.value=t),"items-per-page-text":o.$t("Articles par page"),options:P.value,"onUpdate:options":a[20]||(a[20]=t=>P.value=t),"sort-by":y.value,"onUpdate:sortBy":a[21]||(a[21]=t=>y.value=t),page:$.value,"onUpdate:page":a[22]||(a[22]=t=>$.value=t),"items-length":E.value,"onUpdate:itemsLength":a[23]||(a[23]=t=>E.value=t),"show-select":!1,"loading-text":o.$t("Chargement des éléments"),"no-data-text":o.$t("Pas de données"),"no-results-text":o.$t("Aucun résultat"),onPageCount:a[24]||(a[24]=t=>I.value=t)},{top:l(()=>[e(Te,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:l(()=>[e(F,null,{default:l(()=>[e(f,null,{default:l(()=>[e(C,{density:"compact",modelValue:s.value.search,"onUpdate:modelValue":a[0]||(a[0]=t=>s.value.search=t),placeholder:o.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo"},null,8,["modelValue","placeholder"])]),_:1}),e(f,null,{default:l(()=>[e(_e,{density:"compact",modelValue:s.value.status,"onUpdate:modelValue":a[1]||(a[1]=t=>s.value.status=t),placeholder:o.$t("Statut"),items:S(V).statusesList,"item-value":"id","item-title":"label",clearable:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","items"])]),_:1}),e(f,null,{default:l(()=>[e(M,{ref_key:"dialog",ref:oe,modelValue:_.value,"onUpdate:modelValue":a[7]||(a[7]=t=>_.value=t),"return-value":s.value.date,"onUpdate:returnValue":a[8]||(a[8]=t=>s.value.date=t),persistent:"",width:"290px"},{activator:l(({props:t})=>[e(C,O({modelValue:J.value,"onUpdate:modelValue":a[2]||(a[2]=d=>J.value=d),"prepend-inner-icon":"bx-calendar"},t,{density:"compact",placeholder:o.$t("Date"),"hide-details":"",variant:"solo",clearable:"",readonly:"","onClick:clear":a[3]||(a[3]=d=>s.value.date=null)}),null,16,["modelValue","placeholder"])]),default:l(({isActive:t})=>[e(Ie,{locale:"fr"},{default:l(()=>[e(xe,{modelValue:s.value.date,"onUpdate:modelValue":a[6]||(a[6]=d=>s.value.date=d),"hide-header":"",multiple:"range"},{actions:l(()=>[e(v,{color:"primary",onClick:a[4]||(a[4]=d=>_.value=!1)},{default:l(()=>[i(n(o.$t("Annuler")),1)]),_:1}),e(U),e(v,{variant:"elevated",color:"primary",onClick:a[5]||(a[5]=d=>_.value=!1)},{default:l(()=>[i(n(o.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),e(f,{class:"d-flex gap-2 justify-space-between"},{default:l(()=>[e(v,{color:"primary",class:"align-self-end",variant:"flat",onClick:a[9]||(a[9]=t=>N({})),dark:""},{default:l(()=>[i(n(o.$t("Ajouter un Prospect")),1)]),_:1}),e(v,{color:"primary",class:"align-self-end",variant:"flat",onClick:a[10]||(a[10]=t=>N({is_customer:!0})),dark:""},{default:l(()=>[i(n(o.$t("Ajouter un client")),1)]),_:1}),e(M,{modelValue:h.value,"onUpdate:modelValue":a[16]||(a[16]=t=>h.value=t),"max-width":"600px"},{default:l(()=>[e(W,null,{default:l(()=>[e(Y,{class:"pa-4 bg-secondary"},{default:l(()=>[B("span",Ne,n(me.value),1)]),_:1}),e(S(De),{ref_key:"refForm",ref:z,modelValue:q.value,"onUpdate:modelValue":a[15]||(a[15]=t=>q.value=t),onSubmit:ie},{default:l(({errors:t,isSubmitting:d})=>[e(Ae,null,{default:l(()=>[e(je,{class:"px-0"},{default:l(()=>[e(F,null,{default:l(()=>[e(f,{cols:"12",md:"6"},{default:l(()=>[e(C,{modelValue:u.value.firstname,"onUpdate:modelValue":a[11]||(a[11]=m=>u.value.firstname=m),rules:[S(Z)],label:o.$t("Prénom")},null,8,["modelValue","rules","label"])]),_:1}),e(f,{cols:"12",md:"6"},{default:l(()=>[e(C,{modelValue:u.value.lastname,"onUpdate:modelValue":a[12]||(a[12]=m=>u.value.lastname=m),rules:[S(Z)],label:o.$t("Nom")},null,8,["modelValue","rules","label"])]),_:1}),e(f,{cols:"12",md:"6"},{default:l(()=>[e(C,{modelValue:u.value.email,"onUpdate:modelValue":a[13]||(a[13]=m=>u.value.email=m),label:o.$t("Email")},null,8,["modelValue","label"])]),_:1}),e(f,{cols:"12",md:"6"},{default:l(()=>[e(C,{modelValue:u.value.phone,"onUpdate:modelValue":a[14]||(a[14]=m=>u.value.phone=m),label:o.$t("Téléphone")},null,8,["modelValue","label"])]),_:1})]),_:1}),t.apiError?(H(),Q("div",Oe,[e(Ee,{color:"error"},{default:l(()=>[i(n(t.apiError),1)]),_:2},1024)])):Pe("",!0)]),_:2},1024)]),_:2},1024),e(ee,null,{default:l(()=>[e(U),e(v,{color:"error",variant:"flat",dark:"",onClick:ne},{default:l(()=>[i(n(o.$t("Annuler")),1)]),_:1}),e(v,{color:"success",variant:"flat",loading:k.value,type:"submit"},{default:l(()=>[i(n(o.$t("Sauvegarder")),1)]),_:1},8,["loading"]),e(U)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(M,{modelValue:w.value,"onUpdate:modelValue":a[18]||(a[18]=t=>w.value=t),"max-width":"500px"},{default:l(()=>[e(W,null,{default:l(()=>[e(Y,{class:"text-h5 text-center py-6"},{default:l(()=>[i(n(o.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),e(ee,null,{default:l(()=>[e(U),e(v,{color:"error",variant:"flat",dark:"",onClick:a[17]||(a[17]=t=>w.value=!1)},{default:l(()=>[i(n(o.$t("Annuler")),1)]),_:1}),e(v,{color:"success",variant:"flat",dark:"",onClick:de},{default:l(()=>[i(n(o.$t("OK")),1)]),_:1}),e(U)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.created_at":l(({item:t})=>[i(n(S(Ve)(t.created_at)),1)]),"item.is_customer":l(({item:t})=>[e(Le,{color:t.is_customer==1?"success":"warning",size:"small",label:""},{default:l(()=>[i(n(t.is_customer==1?o.$t("Client"):o.$t("Prospet")),1)]),_:2},1032,["color"])]),"item.actions":l(({item:t})=>[B("div",Be,[e(v,{density:"compact",color:"primary",variant:"outlined",to:"/customers/"+t.id},{default:l(()=>[i(n(o.$t("Voir")),1)]),_:2},1032,["to"]),e(ae,{text:o.$t("Modifier")},{activator:l(({props:d})=>[e(v,O({icon:"",flat:"",onClick:m=>N(t)},d),{default:l(()=>[e(p,{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1032,["text"]),e(ae,{text:o.$t("Supprimer")},{activator:l(({props:d})=>[e(v,O({icon:"",flat:"",onClick:m=>ue(t)},d),{default:l(()=>[e(D,{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040,["onClick"])]),_:2},1032,["text"])])]),"no-data":l(()=>[B("span",null,n(o.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64)}}});export{ga as default};
