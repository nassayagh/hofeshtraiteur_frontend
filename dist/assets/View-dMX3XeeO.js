import{u as O}from"./demands-Ifpf1VcZ.js";import{a6 as F,av as R,e as T,r,aD as V,o as i,_ as h,w as a,b as t,d as n,t as l,n as X,V as $,a as s,a8 as b,aE as Z,h as ee,g as te,q as ae,c as L,a4 as C,aF as le,X as G,a5 as q,aG as se,aj as oe,ak as ne}from"./index-BXvHIqz6.js";import{_ as ue,V as K}from"./BaseBreadcrumb-D00x8Nkq.js";import{a as M}from"./formatters-DCCWVJxZ.js";import{_ as re,a as de}from"./CancelDemand.vue_vue_type_script_setup_true_lang-DFvxLzbG.js";import{u as ie,S as me,_ as ce,E as fe}from"./EditorMenubar-DsJcyQUr.js";import{b as B,V as D,c as J,a as P,d as U}from"./VCard-CFuAZNZy.js";import{g as H,i as z,a as N}from"./VSpacer-Dc7J-cH2.js";import{a as A,V as g}from"./VRow-DLf60uGt.js";import{V as Q}from"./VDialog-CuLVqVmd.js";import"./Controller-Cyz8Ncp3.js";import{_ as ve}from"./HallWidget.vue_vue_type_script_setup_true_lang-DSeT4KQL.js";import{_ as pe}from"./DemandForm.vue_vue_type_script_setup_true_lang-BOc-Cxz4.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VTextField-DbFfaD61.js";import"./VAvatar-CtXwuwxb.js";import"./hall-Dkog-e3u.js";import"./ChangeHall.vue_vue_type_script_setup_true_lang-CXvPL-LO.js";import"./VAutocomplete-UV3u4eFT.js";import"./vee-validate.esm-CVIOYDwM.js";import"./eventType-DihHx9zG.js";import"./customers-BVKyMdB3.js";import"./validators-BPi-vT8z.js";import"./VContainer-BaULvm2c.js";import"./VLocaleProvider-DxDsVkLi.js";import"./VDatePicker-BSLkzZ8v.js";import"./VSheet-BzPpz1G0.js";const he=F({__name:"CommentDemand",props:{modelValue:Object},emits:["update:modelValue"],setup(x,{emit:e}){const j=O(),k=R(),E=x,f=e,y=T({get:()=>E.modelValue,set:d=>f("update:modelValue",d)}),m=r(!1),v=r(!1);r(y.value.commentaire||"");const S=ie({extensions:[me],content:y.value.commentaire});T(()=>`${V("Commentaire")}`);function p(){var d;v.value=!0,j.addComment(y.value.id,(d=S.value)==null?void 0:d.getHTML()).then(c=>{y.value=c.data,m.value=!1,k.showSuccess(V("Commentaire ajouté avec succès")),f("saved",c.data)}).catch(c=>{v.value=!1,k.showError(c.message)}).then(()=>{v.value=!1})}return(d,c)=>(i(),h(Q,{modelValue:m.value,"onUpdate:modelValue":c[2]||(c[2]=w=>m.value=w),"max-width":"1000px"},{activator:a(({props:w})=>[t($,X({density:"compact",dark:""},w,{variant:"outlined",color:"primary",onClick:c[0]||(c[0]=I=>v.value=!1)}),{default:a(()=>[n(l(!y.value.commentaire||y.value.commentaire.length==0?d.$t("Ajouter"):d.$t("Modifier")),1)]),_:2},1040)]),default:a(()=>[t(P,null,{default:a(()=>[t(B,{class:"text-h5 text-center py-6"},{default:a(()=>[n(l(!y.value.commentaire||y.value.commentaire.length==0?d.$t("Ajouter un commentaire"):d.$t("Modifier le commentaire")),1)]),_:1}),t(H),t(D,null,{default:a(()=>[t(A,null,{default:a(()=>[t(g,{cols:"12"},{default:a(()=>[s("label",null,l(d.$t("Commentaire")),1),t(ce,{editor:b(S)},null,8,["editor"]),t(b(fe),{editor:b(S)},null,8,["editor"])]),_:1})]),_:1})]),_:1}),t(H),t(J,null,{default:a(()=>[t(z),t($,{color:"error",variant:"flat",dark:"",onClick:c[1]||(c[1]=w=>m.value=!1)},{default:a(()=>[n(l(d.$t("Annuler")),1)]),_:1}),t($,{color:"success",variant:"flat",loading:v.value,dark:"",onClick:p},{default:a(()=>[n(l(d.$t("Enregistrer")),1)]),_:1},8,["loading"]),t(z)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ye=F({__name:"DeleteDemand",props:{modelValue:Object},emits:["update:modelValue"],setup(x,{emit:e}){const j=O(),k=R(),E=x,f=e,y=T({get:()=>E.modelValue,set:p=>f("update:modelValue",p)}),m=r(!1),v=r(!1);r(""),T(()=>`${V("Supprimer la demande")}`);function S(){v.value=!0,j.deleteItem(y.value.id).then(p=>{k.showSuccess(V("Demande supprimée avec succès")),f("deleted")}).catch(p=>{v.value=!1,k.showError(p.message)}).then(()=>{v.value=!1})}return(p,d)=>(i(),h(Q,{modelValue:m.value,"onUpdate:modelValue":d[2]||(d[2]=c=>m.value=c),"max-width":"500px"},{activator:a(({props:c})=>[t($,X({class:"mx-2",dark:""},c,{variant:"outlined",color:"red",onClick:d[0]||(d[0]=w=>v.value=!1)}),{default:a(()=>[n(l(p.$t("Supprimer la demande")),1)]),_:2},1040)]),default:a(()=>[t(P,null,{default:a(()=>[t(B,{class:"text-h5 text-center py-6"},{default:a(()=>[n(l(p.$t("Supprimer la demande")),1)]),_:1}),t(H),t(D,null,{default:a(()=>[t(A,null,{default:a(()=>[t(g,{cols:"12",class:"text-center"},{default:a(()=>[n(l(p.$t("Êtes-vous sûr de vouloir Supprimer la demande?")),1)]),_:1})]),_:1})]),_:1}),t(H),t(J,null,{default:a(()=>[t(z),t($,{color:"error",variant:"flat",dark:"",onClick:d[1]||(d[1]=c=>m.value=!1)},{default:a(()=>[n(l(p.$t("Non")),1)]),_:1}),t($,{color:"success",variant:"flat",loading:v.value,dark:"",onClick:S},{default:a(()=>[n(l(p.$t("Oui")),1)]),_:1},8,["loading"]),t(z)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),W=x=>(oe("data-v-4e57b176"),x=x(),ne(),x),ge={class:"text-h6"},be={class:"text-subtitle-1 textSecondary mt-3"},Ve={class:"text-subtitle-1 textSecondary mt-3"},$e={class:"text-subtitle-1 textSecondary mt-3"},xe={class:"text-subtitle-1 textSecondary mt-3"},ke={class:"text-subtitle-1 textSecondary mt-3"},Se={class:"text-h6"},we={class:"text-subtitle-1 textSecondary mt-3"},Ce={class:"text-subtitle-1 textSecondary mt-3"},De={class:"text-subtitle-1 textSecondary mt-3"},Pe={class:"text-subtitle-1 textSecondary mt-3"},Te={class:"text-subtitle-1 textSecondary mt-3"},je={class:"text-subtitle-1 textSecondary mt-3"},Ie={class:"text-subtitle-1 textSecondary mt-3"},Ee={class:"text-subtitle-1 textSecondary mt-3"},Le={class:"text-h6"},Me=W(()=>s("thead",null,[s("tr",null,[s("th",{class:"text-h6"},"ID"),s("th",{class:"text-h6"},"Prestation"),s("th",{class:"text-h6"},"Date de la demande"),s("th",{class:"text-h6"},"Status"),s("th",{class:"text-h6"},"Action")])],-1)),Ne={class:"text-h6 font-weight-medium text-medium-emphasis"},Ae={class:"text-h6"},Ue=W(()=>s("thead",null,[s("tr",null,[s("th",{class:"text-h6"},"ID"),s("th",{class:"text-h6"},"Prestation"),s("th",{class:"text-h6"},"Date de la demande"),s("th",{class:"text-h6"},"Status"),s("th",{class:"text-h6"},"Action")])],-1)),Be={class:"text-h6 font-weight-medium text-medium-emphasis"},He=F({__name:"View",setup(x){r(),R();const e=r({id:null,status:0,service:"",demand_date:null,customer_id:null,prestation_id:null,customer:{id:null,firstname:"",lastname:"",email:"",phone:"",is_customer:!1,created_at:null,demands:[],prestations:[]}}),j=r({title:V("Détails de la demande")+" "+(e.value.eventtype&&e.value.eventtype.name||"")+" "+(e.value.customer||{firstname:""}).firstname+" "+(e.value.customer||{lastname:""}).lastname+" "+(M(e.value.demand_date)||"")}),k=r([{text:V("Dashboard"),disabled:!1,href:"/"},{text:V("Gestion des demandes"),disabled:!1,href:"/demands"},{text:e.value.eventtype?e.value.eventtype.name:"",disabled:!0,href:"#"}]);function E(){j.value={title:V("Détails de la demande")+" "+(e.value.eventtype&&e.value.eventtype.name||"")+" ("+(e.value.customer||{firstname:""}).firstname+" "+(e.value.customer||{lastname:""}).lastname+" "+(M(e.value.demand_date)||"")+")"},k.value=[{text:V("Dashboard"),disabled:!1,href:"/"},{text:V("Gestion des demandes"),disabled:!1,href:"/demands"},{text:e.value.eventtype?e.value.eventtype.name:"",disabled:!0,href:"#"}]}const f=O(),y=Z();ee(()=>{I()});const m=r(!1);r(!1),r(10);const v=r(2),S=r(2);r(!1),r(!1),r(null);const p=r("");r(["primary","secondary","error","success","warning"]),r([{key:"demand_date",order:"DESC"}]),r(0),r({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"demand_date",order:"DESC"}]});const d=r(-1);r({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),r({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),r(!1),r([{title:"Prénom",align:"start",key:"customer.firstname",sortable:!1},{title:"Nom",align:"start",key:"customer.lastname",sortable:!1},{title:"Email",align:"start",key:"customer.email",sortable:!1},{title:"Téléphone",align:"start",key:"customer.phone",sortable:!1},{title:"Prestation",align:"start",key:"eventtype.name"},{title:"Date de la demande",align:"start",key:"demand_date"},{title:"Status",align:"start",key:"status"},{title:"Actions",key:"actions",sortable:!1}]),T(()=>f.demands.data.filter(o=>o.email.toLowerCase().includes(p.value.toLowerCase())));const c=T(()=>y.params.id),w=T(()=>e.value.customer.demands?e.value.customer.demands.filter(o=>o.id!=e.value.id):[]);T(()=>d.value===-1?"Nouvel administrateur":"Modifier l’administrateur");function I(){m.value=!0,f.fetchItem(y.params.id).then(o=>{o.data.error||(m.value=!1,e.value=o.data,E())}).catch(o=>{m.value=!1}).then(()=>{m.value=!1})}te(c,(o,_)=>{o!=_&&I()},{deep:!0}),ae(()=>{v.value>S.value&&(v.value=S.value)});function Y(){se.push("/demands")}return(o,_)=>(i(),L(G,null,[m.value?C("",!0):(i(),h(ue,{key:0,title:j.value.title,breadcrumbs:k.value},null,8,["title","breadcrumbs"])),m.value?(i(),h(A,{key:1,justify:"center",align:"center","align-content":"center"},{default:a(()=>[t(g,{cols:"12",justify:"center",align:"center","align-content":"center"},{default:a(()=>[t(le,{indeterminate:"",color:"primary",size:"150"})]),_:1})]),_:1})):(i(),h(A,{key:2},{default:a(()=>[t(g,{cols:"12",md:"3"},{default:a(()=>[n(l(o.$t("Status :"))+" ",1),t(N,{rounded:"md",class:"font-weight-bold",color:b(f).statusColor(e.value.status),size:"small",label:""},{default:a(()=>[n(l(b(f).statusText(e.value.status)),1)]),_:1},8,["color"])]),_:1}),t(g,{cols:"12",md:"9",justify:"end","align-content":"end",align:"end"},{default:a(()=>[t(ye,{modelValue:e.value,"onUpdate:modelValue":_[0]||(_[0]=u=>e.value=u),onDeleted:Y},null,8,["modelValue"]),m.value?C("",!0):(i(),h(pe,{key:0,modelValue:e.value,"onUpdate:modelValue":_[1]||(_[1]=u=>e.value=u),onSaved:I,"button-text":o.$t("Modifier La Demande")},null,8,["modelValue","button-text"])),!e.value.prestation&&e.value.status==b(f).statuses.started&&!m.value?(i(),h(re,{key:1,modelValue:e.value,"onUpdate:modelValue":_[2]||(_[2]=u=>e.value=u),onSaved:I},null,8,["modelValue"])):C("",!0),e.value.prestation&&e.value.prestation.id?(i(),h($,{key:2,variant:"elevated",color:"primary",to:"/prestations/"+e.value.prestation.id},{default:a(()=>[n(l(o.$t("Voir la prestation liée")),1)]),_:1},8,["to"])):C("",!0),e.value.prestation?C("",!0):(i(),h(de,{key:3,modelValue:e.value,"onUpdate:modelValue":_[3]||(_[3]=u=>e.value=u)},null,8,["modelValue"]))]),_:1}),t(g,{cols:"12",md:"3"},{default:a(()=>[t(P,{elevation:"10",class:"overflow-hidden h-100"},{default:a(()=>[t(U,{class:"py-4 px-6 text-white bg-primary"},{default:a(()=>[s("h4",ge,l(o.$t("Identification du demandeur")),1)]),_:1}),t(D,{class:"pa-6"},{default:a(()=>[s("p",be,[n(l(o.$t("Prénom :"))+" ",1),s("strong",null,l(e.value.customer.firstname||""),1)]),s("p",Ve,[n(l(o.$t("Nom :"))+" ",1),s("strong",null,l(e.value.customer.lastname||""),1)]),s("p",$e,[n(l(o.$t("Email :"))+" ",1),s("strong",null,l(e.value.customer.email||""),1)]),s("p",xe,[n(l(o.$t("Téléphone :"))+" ",1),s("strong",null,l(e.value.customer.phone||""),1)]),s("p",ke,[n(l(o.$t("Type :"))+" ",1),e.value.customer&&e.value.customer.is_customer?(i(),h(N,{key:0,color:"success"},{default:a(()=>[n(l(o.$t("Client")),1)]),_:1})):(i(),h(N,{key:1,color:"error"},{default:a(()=>[n(l(o.$t("Prospect")),1)]),_:1}))])]),_:1})]),_:1})]),_:1}),t(g,{cols:"12",md:"3"},{default:a(()=>[t(ve,{modelValue:e.value,"onUpdate:modelValue":_[4]||(_[4]=u=>e.value=u),type:"demand","show-demand-info":""},null,8,["modelValue"])]),_:1}),t(g,{cols:"12",md:"6",class:"justify-end align-end"},{default:a(()=>[t(P,{elevation:"10",class:"overflow-hidden h-100"},{default:a(()=>[t(U,{class:"py-4 px-6 text-white bg-info"},{default:a(()=>[s("h4",Se,l(o.$t("Détails de la demande")),1)]),_:1}),t(D,{class:"pa-6"},{default:a(()=>[t(A,null,{default:a(()=>[t(g,{cols:"12",md:"6",lg:"5"},{default:a(()=>[s("p",we,[n(l(o.$t("Type événement :"))+" ",1),s("strong",null,l(e.value.eventtype?e.value.eventtype.name:""),1)]),s("p",Ce,[n(l(o.$t("Date de l'événement :"))+" ",1),s("strong",null,l(b(M)(e.value.event_date)||""),1)]),s("p",De,[n(l(o.$t("La réception se déroulera plutôt :"))+" ",1),s("strong",null,l(e.value.reception_period||""),1)]),s("p",Pe,[n(l(o.$t("Heure de réception :"))+" ",1),s("strong",null,l(e.value.reception_start_time||""),1)]),s("p",Te,[n(l(o.$t("Lieu de l'événement :"))+" ",1),s("strong",null,l(e.value.event_location||""),1)]),s("p",je,[n(l(o.$t("Nombre de convives :"))+" ",1),s("strong",null,l(e.value.number_people||""),1)]),s("p",Ie,[n(l(o.$t("Nombre de jours restants :"))+" ",1),s("strong",null,l(e.value.days_left||""),1)]),s("p",Ee,[n(l(o.$t("Source :"))+" ",1),s("strong",null,l(e.value.source||""),1)])]),_:1}),t(g,{cols:"12",md:"6",lg:"7"},{default:a(()=>[t(P,{flat:"",variant:"outlined",density:"compact"},{default:a(()=>[t(B,null,{default:a(()=>[n(l(o.$t("Commentaire client")),1)]),_:1}),t(D,{class:"formatted-text",innerHTML:(e.value.comment||"").replace(/\n/g,"<br/>")},null,8,["innerHTML"])]),_:1})]),_:1}),t(g,{cols:"12"},{default:a(()=>[t(P,{flat:"",variant:"outlined",class:"mt-1",density:"compact"},{default:a(()=>[t(B,null,{default:a(()=>[n(l(o.$t("Commentaire"))+" ",1),m.value?C("",!0):(i(),h(he,{key:0,modelValue:e.value,"onUpdate:modelValue":_[5]||(_[5]=u=>e.value=u),onSaved:I},null,8,["modelValue"]))]),_:1}),t(D,{class:"formatted-text",innerHTML:e.value.commentaire},null,8,["innerHTML"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e.value.customer&&w.value?(i(),h(g,{key:0,cols:"12"},{default:a(()=>[t(P,{elevation:"10",class:"overflow-hidden h-100"},{default:a(()=>[t(U,{class:"py-4 px-6 text-white bg-info"},{default:a(()=>[s("h4",Le,l(o.$t("Autre demandes de devis de"))+" "+l(e.value.customer.firstname||"")+" "+l(e.value.customer.lastname||""),1)]),_:1}),t(D,{class:"pa-6"},{default:a(()=>[t(K,{class:"month-table"},{default:a(()=>[Me,s("tbody",null,[(i(!0),L(G,null,q(w.value,u=>(i(),L("tr",{key:u.id,class:"month-item"},[s("td",null,l(u.id),1),s("td",null,[s("h6",Ne,l(u.eventtype?u.eventtype.name:""),1)]),s("td",null,l(b(M)(u.demand_date)),1),s("td",null,[t(N,{rounded:"md",class:"font-weight-bold",color:b(f).statusColor(u.status),size:"small",label:""},{default:a(()=>[n(l(b(f).statusText(u.status)),1)]),_:2},1032,["color"])]),s("td",null,[t($,{variant:"outlined",density:"compact",color:"info",to:"/demands/"+u.id},{default:a(()=>[n(l(o.$t("Voir")),1)]),_:2},1032,["to"])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})):C("",!0),e.value.customer&&e.value.customer.prestations?(i(),h(g,{key:1,cols:"12"},{default:a(()=>[t(P,{elevation:"10",class:"overflow-hidden h-100"},{default:a(()=>[t(U,{class:"py-4 px-6 text-white bg-info"},{default:a(()=>[s("h4",Ae,l(o.$t("Autre prestations de devis de"))+" "+l(e.value.customer.firstname||"")+" "+l(e.value.customer.lastname||""),1)]),_:1}),t(D,{class:"pa-6"},{default:a(()=>[t(K,{class:"month-table"},{default:a(()=>[Ue,s("tbody",null,[(i(!0),L(G,null,q(e.value.customer.prestations,u=>(i(),L("tr",{key:u.id,class:"month-item"},[s("td",null,l(u.id),1),s("td",null,[s("h6",Be,l(u.eventtype?u.eventtype.name:""),1)]),s("td",null,l(b(M)(u.demand_date)),1),s("td",null,[t(N,{rounded:"md",class:"font-weight-bold",color:b(f).statusColor(u.status),size:"small",label:""},{default:a(()=>[n(l(b(f).statusText(u.status)),1)]),_:2},1032,["color"])]),s("td",null,[t($,{variant:"outlined",density:"compact",color:"info",to:"/prestations/"+u.id},{default:a(()=>[n(l(o.$t("Voir")),1)]),_:2},1032,["to"])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})):C("",!0)]),_:1}))],64))}}),vt=_e(He,[["__scopeId","data-v-4e57b176"]]);export{vt as default};
