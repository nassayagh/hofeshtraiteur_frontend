import{u as Le}from"./demands-DpobMpx-.js";import{u as Ne}from"./eventType-W3-U7vvM.js";import{u as Be}from"./customers-CPz7sF6J.js";import{u as Fe}from"./hall-6_Py5UCg.js";import{_ as Me}from"./BaseBreadcrumb-DD_RNDn1.js";import{r as pe}from"./validators-BPi-vT8z.js";import{a as N}from"./formatters-DCCWVJxZ.js";import{a6 as ze,aC as Re,r as u,av as He,aD as m,h as Ke,e as U,g as qe,q as Ge,Z as Q,o as $,c as W,b as a,w as l,n as P,V as g,d as f,t as i,a as k,a8 as C,_ as w,a4 as S,ae as Y,af as ee,X as Xe}from"./index-vfaWIJ38.js";import{F as Ze}from"./vee-validate.esm-BDkpaunq.js";import{_ as Je}from"./ValidateDemand.vue_vue_type_script_setup_true_lang-D8fLk5LP.js";import{_ as Qe}from"./ChangeHall.vue_vue_type_script_setup_true_lang-CFR4kNQu.js";import{V as v,a as ae}from"./VRow-DB0bchmH.js";import{V as We}from"./VDataTableServer-CGWPCdMx.js";import{V as Ye}from"./VToolbar-C3pfRImm.js";import{V as y}from"./VTextField-UwEl6nLs.js";import{V as te}from"./VSelect-D6rDql6P.js";import{V as K}from"./VDialog-jpzG1fpB.js";import{V as fe}from"./VLocaleProvider-Cg8YGJkN.js";import{V as ce}from"./VDatePicker-BEvJkovq.js";import{a as T,V as ea}from"./VSpacer-CpBwFx-d.js";import{a as Ve,b as ge,V as aa,c as be}from"./VCard-Dhe58XK9.js";import{V as ta}from"./VContainer-BqVxmop8.js";import{V as la}from"./VAutocomplete-Dwgr7uR2.js";import{V as oa}from"./VCombobox-BolKm7z0.js";import{V as na}from"./VTextarea-DOu9X9GA.js";import{V as ra}from"./VAlert-CqyRsDhC.js";import{V as I}from"./VTooltip-D3lJcwfx.js";import"./VMenu-Py4o6uJK.js";import"./VAvatar-k196mq10.js";import"./Controller-CB8LaxSf.js";import"./filter-DZWa3QsX.js";import"./VSheet-DP78ED5j.js";const ua={class:"text-h5"},sa={key:0,class:"mt-2"},da={key:0},ia=["onClick"],ma=["onClick"],va={class:"d-flex align-center"},qa=ze({__name:"List",setup(pa){const A=Re(),le=u(),oe=He(),ye=Ne(),$e=Be(),_e=Fe(),ke=u({title:m("Gestion des demandes")}),he=u([{text:m("Dashboard"),disabled:!1,href:"/"},{text:m("Gestion des demandes"),disabled:!0,href:"#"}]),b=u([]),q=u([]),G=u([]),ne=u([]),_=Le();Ke(()=>{me(),ve(),Ee(),_e.fetchItems({per_page:1e3}).then(o=>{ne.value=o.data.data})}),u(!1);const B=u(!1),E=u(!1);u(!1),u(!1),u(!1),u(""),u(),u(!1);const re=u(null);u(null),u(null),u(null);const F=u(!1),M=u(!1);u();const X=u(100),j=u(2),z=u(2),R=u(0),ue=u(!1),x=u(!1);u(null);const Z=u("");u(["primary","secondary","error","success","warning"]);const D=u([{key:"event_date",order:"ASC"}]);u(0),u({total:0,validated:0,unvalidated:0});const d=u({search:null,status:null,date:null,event_type:null}),O=u({itemsPerPage:100,rowsPerPage:100,page:1,sortDesc:[!0],sortBy:[{key:"event_date",order:"ASC"}]}),H=u(-1),n=u({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),Ce=u({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:"",customer:{}}),L=u(!1),De=u([{title:m("ID"),align:"start",key:"id",sortable:!0},{title:m("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:m("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:m("Email"),align:"start",key:"customer.email",sortable:!1},{title:m("Tél."),align:"start",key:"customer.phone",sortable:!1},{title:m("Prest."),align:"start",key:"eventtype.name"},{title:m("Source"),align:"start",key:"source"},{title:m("Date 'évén"),key:"event_date"},{title:m("Moment"),key:"reception_period"},{title:m("Heure"),key:"reception_start_time"},{title:m("Lieu"),key:"event_location"},{title:m("Salle"),key:"hall.name"},{title:m("Conv"),key:"number_people"},{title:"Actions",key:"actions",sortable:!1}]),se=U(()=>d.value.date&&d.value.date.length>0?N(d.value.date[0])+" - "+N(d.value.date[d.value.date.length-1]):null),Ue=U(()=>n.value.event_date?A.format(n.value.event_date,"shortDate"):null),de=U(()=>n.value.event_date?N(n.value.event_date):null);U(()=>_.demands.data.filter(o=>o.email.toLowerCase().includes(Z.value.toLowerCase())));function ie(o){B.value=!1,H.value=b.value.indexOf(o),n.value=Object.assign({},o),x.value=!0}function Pe(o){n.value=o,L.value=!0}function we(){x.value=!1,setTimeout(()=>{n.value=Object.assign({customer:{}},Ce.value),H.value=-1},300)}function Se(o,{setErrors:e}){var c;(c=le.value)==null||c.validate().then(({valid:h})=>{h&&(E.value=!0,_.addItem({...n.value,event_date:Ue.value}).then(V=>{if(V.data.error){e({apiError:V.data.message});return}const t=V.data.event_date!=null?new Date(V.data.event_date):null,s={...V.data,event_date:t};n.value.id!=null?Object.assign(b.value[H.value],s):b.value.unshift(s),E.value=!1,x.value=!1,n.value={customer:{}},oe.showSuccess(m("Demande enregistrée avec succès")),ve(),_.fetchStatistics()}).catch(V=>{E.value=!1,e({apiError:V})}).then(()=>{E.value=!1,e({apiError:null})}))})}function Te(){_.deleteItem(n.value.id);const o=b.value.findIndex(e=>e.id==n.value.id);b.value.splice(o,1),L.value=!1,oe.showSuccess(m("Demande supprimée avec succès")),_.fetchStatistics()}const Ie=U(()=>H.value===-1?"Nouvelle demande":"Modifier la demande"),Ae=U(()=>d.value.date&&d.value.date.length?d.value.date.length>1?[A.format(d.value.date[0],"shortDate"),A.format(d.value.date[d.value.date.length-1],"shortDate")]:[A.format(d.value.date[0],"shortDate"),A.format(d.value.date[0],"shortDate")]:null);function me(){try{clearTimeout(re.value)}catch{}re.value=setTimeout(()=>{B.value=!0;let o="id",e="desc";console.log(D.value),D.value.length>0&&(o=D.value[0].key,e=D.value[0].order),_.fetchItems({term:Z.value,paginate:X.value,current_page:j.value,direction:e,order_by:o,page:O.value.page,per_page:O.value.itemsPerPage,...d.value,date:Ae.value}).then(c=>{if(c.data){const{data:h,current_page:V,next_page_url:t,total:s,per_page:r,to:p,last_page:xe}=c.data;b.value=h.map(J=>{const Oe=J.event_date!=null?new Date(J.event_date):null;return{...J,event_date:Oe}}),z.value=xe,R.value=s}}).catch(c=>{console.error(c)}).then(()=>{B.value=!1})},1e3)}function ve(){ye.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(o=>{if(o.data){const{data:e,current_page:c,next_page_url:h,total:V,per_page:t,to:s,last_page:r}=o.data;q.value=e}}).catch(o=>{console.error(o)}).then(()=>{})}function Ee(){$e.fetchItems({term:"",paginate:5e3,current_page:1,direction:"asc",order_by:"firstname",page:1,per_page:5e3}).then(o=>{if(o.data){const{data:e,current_page:c,next_page_url:h,total:V,per_page:t,to:s,last_page:r}=o.data;G.value=e.map(p=>({...p,name:p.firstname+" "+p.lastname+" ("+(p.is_customer?m("Client"):m("Prospect"))+")"}))}}).catch(o=>{console.error(o)}).then(()=>{})}qe([Z,O,d],()=>{me()},{deep:!0}),Ge(()=>{j.value>z.value&&(j.value=z.value)});function je(o){if(o){const e=G.value.find(c=>c.id==o);e&&(n.value.customer=e)}}return(o,e)=>{const c=Q("EyeIcon"),h=Q("PencilIcon"),V=Q("TrashIcon");return $(),W(Xe,null,[a(Me,{title:`${ke.value.title}(${R.value})`,breadcrumbs:he.value},null,8,["title","breadcrumbs"]),a(ae,null,{default:l(()=>[a(v,{cols:"12"},{default:l(()=>[a(We,{class:"border rounded-md",headers:De.value,loading:B.value,items:b.value,"multi-sort":!1,"items-per-page":X.value,"onUpdate:itemsPerPage":e[33]||(e[33]=t=>X.value=t),"items-per-page-text":o.$t("Articles par page"),options:O.value,"onUpdate:options":e[34]||(e[34]=t=>O.value=t),"sort-by":D.value,"onUpdate:sortBy":e[35]||(e[35]=t=>D.value=t),page:j.value,"onUpdate:page":e[36]||(e[36]=t=>j.value=t),"items-length":R.value,"onUpdate:itemsLength":e[37]||(e[37]=t=>R.value=t),"show-select":!1,"loading-text":o.$t("Chargement des éléments"),"no-data-text":o.$t("Pas de données"),"no-results-text":o.$t("Aucun résultat"),onPageCount:e[38]||(e[38]=t=>z.value=t)},{top:l(()=>[a(Ye,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:l(()=>[a(ae,null,{default:l(()=>[a(v,null,{default:l(()=>[a(y,{density:"compact",modelValue:d.value.search,"onUpdate:modelValue":e[0]||(e[0]=t=>d.value.search=t),placeholder:o.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),a(v,null,{default:l(()=>[a(te,{density:"compact",modelValue:d.value.event_type_id,"onUpdate:modelValue":e[1]||(e[1]=t=>d.value.event_type_id=t),placeholder:o.$t("Prestation"),label:o.$t("Prestation"),items:q.value,"item-value":"id","item-title":"name",clearable:"",multiple:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","label","items"])]),_:1}),a(v,null,{default:l(()=>[a(K,{ref:"dialog",modelValue:F.value,"onUpdate:modelValue":e[7]||(e[7]=t=>F.value=t),"return-value":d.value.date,"onUpdate:returnValue":e[8]||(e[8]=t=>d.value.date=t),persistent:"",width:"290px"},{activator:l(({props:t})=>[a(y,P({modelValue:se.value,"onUpdate:modelValue":e[2]||(e[2]=s=>se.value=s),"prepend-inner-icon":"bx-calendar"},t,{density:"compact",placeholder:o.$t("Date"),label:o.$t("Date"),"hide-details":"",variant:"solo",clearable:"",readonly:"","onClick:clear":e[3]||(e[3]=s=>d.value.date=null)}),null,16,["modelValue","placeholder","label"])]),default:l(({isActive:t})=>[a(fe,{locale:"fr"},{default:l(()=>[a(ce,{modelValue:d.value.date,"onUpdate:modelValue":e[6]||(e[6]=s=>d.value.date=s),"hide-header":"",multiple:"range"},{actions:l(()=>[a(g,{color:"primary",onClick:e[4]||(e[4]=s=>F.value=!1)},{default:l(()=>[f(i(o.$t("Annuler")),1)]),_:1}),a(T),a(g,{variant:"elevated",color:"primary",onClick:e[5]||(e[5]=s=>F.value=!1)},{default:l(()=>[f(i(o.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),a(v,{class:""},{default:l(()=>[a(K,{modelValue:x.value,"onUpdate:modelValue":e[30]||(e[30]=t=>x.value=t),"max-width":"600px"},{activator:l(({props:t})=>[a(g,P({color:"primary",class:"align-self-end float-end",variant:"flat",onClick:e[9]||(e[9]=s=>ie({customer:{},source:"admin"})),dark:""},t),{default:l(()=>[f(i(o.$t("Ajouter une demande")),1)]),_:2},1040)]),default:l(()=>[a(Ve,null,{default:l(()=>[a(ge,{class:"pa-4 bg-secondary"},{default:l(()=>[k("span",ua,i(Ie.value),1)]),_:1}),a(C(Ze),{ref_key:"refForm",ref:le,modelValue:ue.value,"onUpdate:modelValue":e[29]||(e[29]=t=>ue.value=t),onSubmit:Se},{default:l(({errors:t,isSubmitting:s})=>[a(aa,null,{default:l(()=>[a(ta,{class:"px-0"},{default:l(()=>[a(ae,null,{default:l(()=>[a(v,{cols:"12"},{default:l(()=>[a(la,{modelValue:n.value.customer_id,"onUpdate:modelValue":[e[10]||(e[10]=r=>n.value.customer_id=r),je],placeholder:o.$t("Client"),label:o.$t("Client"),items:G.value,"item-value":"id","item-title":"name",clearable:"","hide-details":"",variant:"outlined"},null,8,["modelValue","placeholder","label","items"])]),_:1}),a(v,{cols:"12",md:"6"},{default:l(()=>[a(y,{modelValue:n.value.customer.firstname,"onUpdate:modelValue":e[11]||(e[11]=r=>n.value.customer.firstname=r),rules:[C(pe)],label:o.$t("Prénom")},null,8,["modelValue","rules","label"])]),_:1}),a(v,{cols:"12",md:"6"},{default:l(()=>[a(y,{modelValue:n.value.customer.lastname,"onUpdate:modelValue":e[12]||(e[12]=r=>n.value.customer.lastname=r),rules:[C(pe)],label:o.$t("Nom")},null,8,["modelValue","rules","label"])]),_:1}),a(v,{cols:"12",md:"6"},{default:l(()=>[a(y,{modelValue:n.value.customer.email,"onUpdate:modelValue":e[13]||(e[13]=r=>n.value.customer.email=r),label:o.$t("Email")},null,8,["modelValue","label"])]),_:1}),a(v,{cols:"12",md:"6"},{default:l(()=>[a(y,{modelValue:n.value.customer.phone,"onUpdate:modelValue":e[14]||(e[14]=r=>n.value.customer.phone=r),label:o.$t("Téléphone")},null,8,["modelValue","label"])]),_:1}),a(v,{cols:"12",md:"6"},{default:l(()=>[a(oa,{modelValue:n.value.event_type_id,"onUpdate:modelValue":e[15]||(e[15]=r=>n.value.event_type_id=r),placeholder:o.$t("Type d'événement"),items:q.value,"item-value":"id","item-title":"name",clearable:"","hide-details":"",variant:"outlined"},null,8,["modelValue","placeholder","items"])]),_:1}),a(v,{cols:"12",md:"6"},{default:l(()=>[a(K,{ref:"dialogDemandDate",modelValue:M.value,"onUpdate:modelValue":e[21]||(e[21]=r=>M.value=r),"return-value":n.value.event_date,"onUpdate:returnValue":e[22]||(e[22]=r=>n.value.event_date=r),persistent:"",width:"290px"},{activator:l(({props:r})=>[a(y,P({modelValue:de.value,"onUpdate:modelValue":e[16]||(e[16]=p=>de.value=p),"prepend-inner-icon":"bx-calendar"},r,{placeholder:o.$t("Date de l'évènement"),"hide-details":"",clearable:"",readonly:"","onClick:clear":e[17]||(e[17]=p=>n.value.event_date=null)}),null,16,["modelValue","placeholder"])]),default:l(({isActive:r})=>[a(fe,{locale:"fr"},{default:l(()=>[a(ce,{modelValue:n.value.event_date,"onUpdate:modelValue":e[20]||(e[20]=p=>n.value.event_date=p),"hide-header":""},{actions:l(()=>[a(g,{color:"primary",onClick:e[18]||(e[18]=p=>M.value=!1)},{default:l(()=>[f(i(o.$t("Annuler")),1)]),_:1}),a(T),a(g,{variant:"elevated",color:"primary",onClick:e[19]||(e[19]=p=>M.value=!1)},{default:l(()=>[f(i(o.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),a(v,{cols:"12",md:"6"},{default:l(()=>[a(te,{modelValue:n.value.reception_period,"onUpdate:modelValue":e[23]||(e[23]=r=>n.value.reception_period=r),"hide-details":"",items:[o.$t("En matiné"),o.$t("Le midi"),o.$t("En soirée")],label:o.$t("La réception se déroulera plutôt"),clearable:""},null,8,["modelValue","items","label"])]),_:1}),a(v,{cols:"12",md:"6"},{default:l(()=>[a(y,{modelValue:n.value.reception_start_time,"onUpdate:modelValue":e[24]||(e[24]=r=>n.value.reception_start_time=r),"hide-details":"",label:o.$t("Heure de réception"),clearable:""},null,8,["modelValue","label"])]),_:1}),n.value.source!="admin"?($(),w(v,{key:0,cols:"12",md:"6"},{default:l(()=>[a(y,{modelValue:n.value.event_location,"onUpdate:modelValue":e[25]||(e[25]=r=>n.value.event_location=r),"hide-details":"",label:o.$t("Lieu de l'événement")},null,8,["modelValue","label"])]),_:1})):($(),w(v,{key:1,cols:"12",md:"6"},{default:l(()=>[a(te,{modelValue:n.value.hall_id,"onUpdate:modelValue":e[26]||(e[26]=r=>n.value.hall_id=r),items:ne.value,"item-value":"id","item-title":"name",label:o.$t("Salle liée")},null,8,["modelValue","items","label"])]),_:1})),a(v,{cols:"12",md:"6"},{default:l(()=>[a(y,{modelValue:n.value.number_people,"onUpdate:modelValue":e[27]||(e[27]=r=>n.value.number_people=r),"hide-details":"",type:"number",label:o.$t("Nombre de convives")},null,8,["modelValue","label"])]),_:1}),a(v,{cols:"12"},{default:l(()=>[a(na,{modelValue:n.value.comment,"onUpdate:modelValue":e[28]||(e[28]=r=>n.value.comment=r),"hide-details":"",label:o.$t("Description de la demande")},null,8,["modelValue","label"])]),_:1})]),_:1}),t.apiError?($(),W("div",sa,[a(ra,{color:"error"},{default:l(()=>[f(i(t.apiError),1)]),_:2},1024)])):S("",!0)]),_:2},1024)]),_:2},1024),a(be,null,{default:l(()=>[a(T),a(g,{color:"error",variant:"flat",dark:"",onClick:we},{default:l(()=>[f(i(o.$t("Annuler")),1)]),_:1}),a(g,{color:"success",variant:"flat",loading:E.value,type:"submit"},{default:l(()=>[f(i(o.$t("Sauvegarder")),1)]),_:1},8,["loading"]),a(T)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(K,{modelValue:L.value,"onUpdate:modelValue":e[32]||(e[32]=t=>L.value=t),"max-width":"500px"},{default:l(()=>[a(Ve,null,{default:l(()=>[a(ge,{class:"text-h5 text-center py-6"},{default:l(()=>[f(i(o.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),a(be,null,{default:l(()=>[a(T),a(g,{color:"error",variant:"flat",dark:"",onClick:e[31]||(e[31]=t=>L.value=!1)},{default:l(()=>[f(i(o.$t("Annuler")),1)]),_:1}),a(g,{color:"success",variant:"flat",dark:"",onClick:Te},{default:l(()=>[f(i(o.$t("OK")),1)]),_:1}),a(T)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.hall.name":l(({index:t,item:s})=>[s.hall?($(),W("span",da,i(s.hall.name),1)):S("",!0),s.hall?S("",!0):($(),w(Qe,{key:1,modelValue:b.value[t],"onUpdate:modelValue":r=>b.value[t]=r,"show-demand-info":"",type:"demand"},null,8,["modelValue","onUpdate:modelValue"]))]),"item.customer.firstname":l(({item:t})=>[k("span",{class:"cursor-pointer",onClick:s=>o.$router.push("/demands/"+t.id)},i(t.customer?t.customer.firstname:""),9,ia)]),"item.customer.lastname":l(({item:t})=>[k("span",{class:"cursor-pointer",onClick:s=>o.$router.push("/demands/"+t.id)},i(t.customer?t.customer.lastname:""),9,ma)]),"item.customer.email":l(({item:t})=>[a(I,{text:t.customer.email},{activator:l(({props:s})=>[k("span",Y(ee(s)),i(!t.customer||t.customer.email==null||t.customer.email.length<7?t.customer.email:`${t.customer.email.replace(`
`," ").slice(0,6)}...`),17)]),_:2},1032,["text"])]),"item.demand_date":l(({item:t})=>[f(i(C(N)(t.demand_date)),1)]),"item.event_date":l(({item:t})=>[f(i(C(N)(t.event_date)),1)]),"item.event_location":l(({item:t})=>[a(I,{text:t.event_location},{activator:l(({props:s})=>[k("span",Y(ee(s)),i(!t.event_location||t.event_location.length<10?t.event_location:`${t.event_location.slice(0,9)}...`),17)]),_:2},1032,["text"])]),"item.eventtype":l(({item:t})=>[t.eventtype?($(),w(I,{key:0,text:t.eventtype?t.eventtype.name:""},{activator:l(({props:s})=>[k("span",Y(ee(s)),i(!t.eventtype.name||t.eventtype.name.length<10?t.eventtype.name:`${t.eventtype.name.slice(0,9)}...`),17)]),_:2},1032,["text"])):S("",!0)]),"item.status":l(({item:t})=>[a(ea,{color:C(_).statusColor(t.status),size:"small",label:""},{default:l(()=>[f(i(C(_).statusText(t.status)),1)]),_:2},1032,["color"])]),"item.actions":l(({index:t,item:s})=>[k("div",va,[s.prestation?S("",!0):($(),w(Je,{key:0,modelValue:b.value[t],"onUpdate:modelValue":r=>b.value[t]=r,icon:!0},null,8,["modelValue","onUpdate:modelValue"])),a(I,{text:o.$t("Voir")},{activator:l(({props:r})=>[a(g,P({icon:"",flat:"",to:"/demands/"+s.id},r),{default:l(()=>[a(c,{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["to"])]),_:2},1032,["text"]),a(I,{text:o.$t("Modifier")},{activator:l(({props:r})=>[a(g,P({icon:"",flat:"",onClick:p=>ie(s)},r),{default:l(()=>[a(h,{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1032,["text"]),s.prestation==null?($(),w(I,{key:1,text:o.$t("Supprimer")},{activator:l(({props:r})=>[a(g,P({icon:"",flat:"",onClick:p=>Pe(s)},r),{default:l(()=>[a(V,{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040,["onClick"])]),_:2},1032,["text"])):S("",!0)])]),"no-data":l(()=>[k("span",null,i(o.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64)}}});export{qa as default};
