import{a9 as ve,aa as x,a6 as fe,r as s,av as pe,aK as N,h as ce,e as O,g as ge,q as Ve,Z as G,o as X,c as Z,b as a,w as r,V as g,n as M,d as V,t as v,a as L,a8 as T,a4 as he,X as be}from"./index-CmHXyYx9.js";import{_ as we}from"./BaseBreadcrumb-DPJCXDT3.js";import{r as q,e as ye}from"./validators-BPi-vT8z.js";import{F as Pe}from"./vee-validate.esm-DOnvsYd8.js";import{s as m}from"./sidebarItem-DT_21Fw0.js";import{V as A,a as H}from"./VRow-DguH7A3U.js";import{V as ke}from"./VDataTableServer-D9AfTYTv.js";import{V as $e,a as Ue}from"./VToolbar-BV8SpjJx.js";import{V as B}from"./VTextField-DW2t7TcW.js";import{a as I}from"./VSpacer-BdbqMcpc.js";import{V as J}from"./VDialog-U6db8KCa.js";import{a as Q,b as W,V as Ce,c as Y}from"./VCard-CT1ap8kE.js";import{V as xe}from"./VContainer-BCt6nyL9.js";import{V as Te}from"./VAutocomplete-DVkS3Oc5.js";import{V as Ae}from"./VAlert-CGgndlKo.js";import{V as ee}from"./VTooltip-C7NxLLFY.js";import"./VSelect-KNoAAS8L.js";import"./VMenu-CnH1YEJZ.js";import"./VAvatar-2B62Bmjy.js";import"./filter-CxFxo8pj.js";const Ie=ve({id:"Authuser",state:()=>({users:{data:[],loading:!1,error:null}}),actions:{async getAll(){this.users.loading=!0,x.get("/users").then(i=>this.users.data=i.data).catch(i=>this.users.error=i)},fetchUsers(i){return x.get("/users",{params:i})},async addUser(i){return new Promise((f,p)=>{x.post("/users",i).then(n=>f(n)).catch(n=>p(n))})},fetchUser(i){return new Promise((f,p)=>{x.get(`/users/${i}`).then(n=>f(n)).catch(n=>p(n))})},deleteUser(i){return new Promise((f,p)=>{x.delete(`/users/${i}`).then(n=>f(n)).catch(n=>p(n))})}}}),Se={class:"text-h5"},_e={key:0,class:"mt-2"},je={class:"d-flex align-center"},ta=fe({__name:"AdminsTable",setup(i){const f=s(),p=pe(),n=s({title:"Gestions des administrateurs"}),ae=s([{text:N("Dashboard"),disabled:!1,href:"/"},{text:N("Administrateurs"),disabled:!0,href:"#"}]),c=s([]),S=Ie();ce(()=>{R()});const h=s(!1),D=s(!1);s(!1),s(!1),s(!1),s(""),s(),s(!1);const z=s(null);s(null),s(null),s(null),s(!1),s();const F=s(100),y=s(2),_=s(2),j=s(0),K=s(!1),P=s(!1);s(null);const k=s("");s(["primary","secondary","error","success","warning"]);const b=s([{key:"name",order:"asc"}]);s(0);const $=s({itemsPerPage:100,rowsPerPage:100,page:1,sortDesc:[!0],sortBy:[{key:"name",order:"desc"}]}),E=s(-1),o=s({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:"",roles:[]}),te=s({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:"",roles:[]}),U=s(!1),le=s([{title:"Nom",align:"start",key:"name"},{title:"Email",key:"email"},{title:"Actions",key:"actions",sortable:!1}]);O(()=>S.users.data.filter(t=>t.email.toLowerCase().includes(k.value.toLowerCase())));const se=O(()=>{const t=[];for(let e=0;e<m.length;e++)if(m[e].children!=null&&m[e].children.length>0){t.push(m[e]);for(let u=0;u<m[e].children.length;u++)m[e].children[u].header||t.push({...m[e].children[u],title:m[e].title+" "+m[e].children[u].title})}else m[e].header||t.push(m[e]);return t});function re(t){h.value=!1,E.value=c.value.indexOf(t),o.value=Object.assign({},{...t,roles:t.roles||[]}),P.value=!0}function oe(t){o.value=t,U.value=!0}function ue(){P.value=!1,setTimeout(()=>{o.value=Object.assign({},te.value),E.value=-1},300)}function ne(t,{setErrors:e}){var u;(u=f.value)==null||u.validate().then(({valid:C})=>{C&&(D.value=!0,S.addUser(o.value).then(l=>{if(l.data.error){e({apiError:l.data.message});return}o.value.id!=null?Object.assign(c.value[E.value],l.data):c.value.unshift(l.data),h.value=!1,P.value=!1,o.value={changePassword:!0},p.showSuccess(N("Utilisateur enregistreé avec succès"))}).catch(l=>{D.value=!1,e({apiError:l})}).then(()=>{D.value=!1,e({apiError:null})}))})}function ie(){S.deleteUser(o.value.id);const t=c.value.findIndex(e=>e.id==o.value.id);c.value.splice(t,1),U.value=!1,p.showSuccess(N("Utilisateur supprimé avec succès"))}const de=O(()=>E.value===-1?"Nouvel administrateur":"Modifier l’administrateur");function R(){try{clearTimeout(z.value)}catch{}z.value=setTimeout(()=>{h.value=!0;let t="id",e="desc";console.log(b.value),b.value.length>0&&(t=b.value[0].key,e=b.value[0].order),S.fetchUsers({term:k.value,paginate:F.value,current_page:y.value,direction:e,order_by:t,page:$.value.page,per_page:$.value.itemsPerPage}).then(u=>{if(u.data){const{data:C,current_page:l,next_page_url:w,total:d,per_page:Ee,to:Ne,last_page:me}=u.data;c.value=C,_.value=me,j.value=d}}).catch(u=>{console.error(u)}).then(()=>{h.value=!1})},1e3)}return ge([k,$],()=>{R()},{deep:!0}),Ve(()=>{y.value>_.value&&(y.value=_.value)}),(t,e)=>{const u=G("PencilIcon"),C=G("TrashIcon");return X(),Z(be,null,[a(we,{title:`${n.value.title}(${j.value})`,breadcrumbs:ae.value},null,8,["title","breadcrumbs"]),a(H,null,{default:r(()=>[a(A,{cols:"12"},{default:r(()=>[a(ke,{class:"border rounded-md",headers:le.value,loading:h.value,items:c.value,"multi-sort":!1,"items-per-page":F.value,"onUpdate:itemsPerPage":e[11]||(e[11]=l=>F.value=l),"items-per-page-text":t.$t("Articles par page"),options:$.value,"onUpdate:options":e[12]||(e[12]=l=>$.value=l),"sort-by":b.value,"onUpdate:sortBy":e[13]||(e[13]=l=>b.value=l),page:y.value,"onUpdate:page":e[14]||(e[14]=l=>y.value=l),"items-length":j.value,"onUpdate:itemsLength":e[15]||(e[15]=l=>j.value=l),"show-select":!1,"loading-text":t.$t("Chargement des éléments"),"no-data-text":t.$t("Pas de données"),"no-results-text":t.$t("Aucun résultat"),onPageCount:e[16]||(e[16]=l=>_.value=l)},{top:r(()=>[a($e,{class:"rounded-t-md",flat:""},{default:r(()=>[a(Ue,null,{default:r(()=>[a(B,{density:"compact",modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=l=>k.value=l),placeholder:t.$t("Rechercher..."),"hide-details":"",variant:"solo"},null,8,["modelValue","placeholder"])]),_:1}),a(I),a(J,{modelValue:P.value,"onUpdate:modelValue":e[8]||(e[8]=l=>P.value=l),"max-width":"550px"},{activator:r(({props:l})=>[a(g,M({color:"primary",variant:"flat",onClick:e[1]||(e[1]=w=>o.value={roles:[]}),dark:""},l),{default:r(()=>[V(v(t.$t("Ajouter un administrateur")),1)]),_:2},1040)]),default:r(()=>[a(Q,null,{default:r(()=>[a(W,{class:"pa-4 bg-secondary"},{default:r(()=>[L("span",Se,v(de.value),1)]),_:1}),a(T(Pe),{ref_key:"refForm",ref:f,modelValue:K.value,"onUpdate:modelValue":e[7]||(e[7]=l=>K.value=l),onSubmit:ne},{default:r(({errors:l,isSubmitting:w})=>[a(Ce,null,{default:r(()=>[a(xe,{class:"px-0"},{default:r(()=>[a(H,null,{default:r(()=>[a(A,{cols:"12"},{default:r(()=>[a(B,{modelValue:o.value.name,"onUpdate:modelValue":e[2]||(e[2]=d=>o.value.name=d),rules:[T(q)],label:t.$t("Nom")},null,8,["modelValue","rules","label"])]),_:1}),a(A,{cols:"12"},{default:r(()=>[a(B,{modelValue:o.value.email,"onUpdate:modelValue":e[3]||(e[3]=d=>o.value.email=d),label:t.$t("Email"),rules:[T(q),T(ye)]},null,8,["modelValue","label","rules"])]),_:1}),a(A,{cols:"12"},{default:r(()=>[a(B,{modelValue:o.value.password,"onUpdate:modelValue":e[4]||(e[4]=d=>o.value.password=d),label:t.$t("Mot de passe"),placeholder:"············","append-inner-icon":o.value.id&&o.value.changePassword?"mdi-eye-off":"mdi-eye",rules:[o.value.id&&o.value.changePassword||!o.value.id?T(q):!0],readonly:!o.value.changePassword,"onClick:appendInner":e[5]||(e[5]=d=>o.value.changePassword=!o.value.changePassword)},null,8,["modelValue","label","append-inner-icon","rules","readonly"])]),_:1}),a(A,{cols:"12"},{default:r(()=>[a(Te,{modelValue:o.value.roles,"onUpdate:modelValue":e[6]||(e[6]=d=>o.value.roles=d),items:se.value,"item-value":"to","item-title":"title",multiple:"",clearable:"",variant:"outlined"},null,8,["modelValue","items"])]),_:1})]),_:1}),l.apiError?(X(),Z("div",_e,[a(Ae,{color:"error"},{default:r(()=>[V(v(l.apiError),1)]),_:2},1024)])):he("",!0)]),_:2},1024)]),_:2},1024),a(Y,null,{default:r(()=>[a(I),a(g,{color:"error",variant:"flat",dark:"",onClick:ue},{default:r(()=>[V(v(t.$t("Annuler")),1)]),_:1}),a(g,{color:"success",variant:"flat",loading:h.value,type:"submit"},{default:r(()=>[V(v(t.$t("Sauvegarder")),1)]),_:1},8,["loading"]),a(I)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),a(J,{modelValue:U.value,"onUpdate:modelValue":e[10]||(e[10]=l=>U.value=l),"max-width":"500px"},{default:r(()=>[a(Q,null,{default:r(()=>[a(W,{class:"text-h5 text-center py-6"},{default:r(()=>[V(v(t.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),a(Y,null,{default:r(()=>[a(I),a(g,{color:"error",variant:"flat",dark:"",onClick:e[9]||(e[9]=l=>U.value=!1)},{default:r(()=>[V(v(t.$t("Annuler")),1)]),_:1}),a(g,{color:"success",variant:"flat",dark:"",onClick:ie},{default:r(()=>[V(v(t.$t("OK")),1)]),_:1}),a(I)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.actions":r(({item:l})=>[L("div",je,[a(ee,{text:t.$t("Modifier")},{activator:r(({props:w})=>[a(g,M({icon:"",flat:"",onClick:d=>re(l)},w),{default:r(()=>[a(u,{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1032,["text"]),a(ee,{text:t.$t("Supprimer")},{activator:r(({props:w})=>[a(g,M({icon:"",flat:"",onClick:d=>oe(l)},w),{default:r(()=>[a(C,{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040,["onClick"])]),_:2},1032,["text"])])]),"no-data":r(()=>[L("span",null,v(t.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64)}}});export{ta as default};
