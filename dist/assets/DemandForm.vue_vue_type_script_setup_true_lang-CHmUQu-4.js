import{E as qe,S as ge}from"./EditorMenubar.vue_vue_type_style_index_0_lang-C4J9iz7N.js";import{s as Re,h as ne,i as he,aG as ze,aH as Ge,a6 as re,r as s,aI as Ke,q as Ve,Y as Je,aJ as ae,aK as Xe,aL as Ye,a8 as y,o as p,c as P,a as j,a3 as Ze,Z as be,_ as $,w as l,X as le,a5 as Qe,n as O,av as ke,e as B,aD as C,V as w,d as b,t as h,a4 as X,b as t,aC as We,g as et,$ as tt}from"./index-qrr1DAJJ.js";import{u as ye}from"./demands-DyV-s4bU.js";import{u as _e}from"./hall-cxke1gTv.js";import{a as Ce}from"./formatters-DCCWVJxZ.js";import{b as Se,V as $e,c as Ae,a as we}from"./VCard-CxTcpius.js";import{f as at,c as lt,a as ot}from"./VMenu-B5A0bEHj.js";import{a as De,V as g}from"./VRow-CQyRA3pe.js";import{V as oe}from"./filter-D9aFNwMX.js";import{a as M}from"./VSpacer-tw-DC6ch.js";import{V as ie}from"./VDialog-CRQCz79p.js";import{u as it}from"./eventType-Br9ZU83i.js";import{u as nt}from"./customers-Dr4Dj7zr.js";import"./BaseBreadcrumb-DALnWbhU.js";import{r as ve}from"./validators-BPi-vT8z.js";import{F as rt}from"./vee-validate.esm-BIglg0-2.js";import{V as st}from"./VAvatar-yP-BgKpL.js";import{V as ut}from"./VContainer-Bp_rKdwa.js";import{V as fe}from"./VAutocomplete-CiWjyYKR.js";import{V as E}from"./VTextField-C0CgDO9d.js";import{V as dt}from"./VLocaleProvider-B0asxUN5.js";import{V as ct}from"./VDatePicker-IBfduAgM.js";import{V as mt}from"./VAlert-CT_1jegC.js";function pe(r){return Ye((e,d)=>({get(){return e(),r},set(u){r=u,requestAnimationFrame(()=>{requestAnimationFrame(()=>{d()})})}}))}class vt extends qe{constructor(e={}){return super(e),this.vueRenderers=ze(new Map),this.contentComponent=null,this.reactiveState=pe(this.view.state),this.reactiveExtensionStorage=pe(this.extensionStorage),this.on("transaction",()=>{this.reactiveState.value=this.view.state,this.reactiveExtensionStorage.value=this.extensionStorage}),Ge(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(e,d){super.registerPlugin(e,d),this.reactiveState.value=this.view.state}unregisterPlugin(e){super.unregisterPlugin(e),this.reactiveState.value=this.view.state}}const Ee=re({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(r){const e=s(),d=Ke();return Ve(()=>{const u=r.editor;u&&u.options.element&&e.value&&Je(()=>{if(!e.value||!u.options.element.firstChild)return;const S=y(e.value);e.value.append(...u.options.element.childNodes),u.contentComponent=d.ctx._,u.setOptions({element:S}),u.createNodeViews()})}),he(()=>{const u=r.editor;if(!u||(u.isDestroyed||u.view.setProps({nodeViews:{}}),u.contentComponent=null,!u.options.element.firstChild))return;const S=document.createElement("div");S.append(...u.options.element.childNodes),u.setOptions({element:S})}),{rootEl:e}},render(){const r=[];return this.editor&&this.editor.vueRenderers.forEach(e=>{const d=ae(Xe,{to:e.teleportElement,key:e.id},ae(e.component,{ref:e.id,...e.props}));r.push(d)}),ae("div",{ref:e=>{this.rootEl=e}},...r)}}),Be=(r={})=>{const e=Re();return ne(()=>{e.value=new vt(r)}),he(()=>{var d;(d=e.value)===null||d===void 0||d.destroy()}),e},ft="/assets/remixicon.symbol-CobMcsGm.svg",pt=["title"],gt={class:"remix"},ht=["xlink:href"],Vt={__name:"EditorMenu",props:{icon:String,title:String,action:Function,isActive:Function},setup(r){return(e,d)=>(p(),P("div",null,[j("div",{class:Ze(["menu-item",{"is-active":r.isActive?r.isActive():null}]),onClick:d[0]||(d[0]=(...u)=>r.action&&r.action(...u)),title:r.title},[(p(),P("svg",gt,[j("use",{"xlink:href":`${y(ft)}#ri-${r.icon}`},null,8,ht)]))],10,pt)]))}},Pe={__name:"EditorMenubar",props:{editor:Object},setup(r){const e=r,d=s([{icon:"bold",title:"Bold",action:()=>e.editor.chain().focus().toggleBold().run(),isActive:()=>e.editor.isActive("bold")},{icon:"italic",title:"Italic",action:()=>e.editor.chain().focus().toggleItalic().run(),isActive:()=>e.editor.isActive("italic")},{icon:"strikethrough",title:"Strike",action:()=>e.editor.chain().focus().toggleStrike().run(),isActive:()=>e.editor.isActive("strike")},{icon:"code-view",title:"Code",action:()=>e.editor.chain().focus().toggleCode().run(),isActive:()=>e.editor.isActive("code")},{icon:"mark-pen-line",title:"Highlight",action:()=>e.editor.chain().focus().toggleHighlight().run(),isActive:()=>e.editor.isActive("highlight")},{type:"divider"},{icon:"h-1",title:"Heading 1",action:()=>e.editor.chain().focus().toggleHeading({level:1}).run(),isActive:()=>e.editor.isActive("heading",{level:1})},{icon:"h-2",title:"Heading 2",action:()=>e.editor.chain().focus().toggleHeading({level:2}).run(),isActive:()=>e.editor.isActive("heading",{level:2})},{icon:"paragraph",title:"Paragraph",action:()=>e.editor.chain().focus().setParagraph().run(),isActive:()=>e.editor.isActive("paragraph")},{icon:"list-unordered",title:"Bullet List",action:()=>e.editor.chain().focus().toggleBulletList().run(),isActive:()=>e.editor.isActive("bulletList")},{icon:"list-ordered",title:"Ordered List",action:()=>e.editor.chain().focus().toggleOrderedList().run(),isActive:()=>e.editor.isActive("orderedList")},{icon:"list-check-2",title:"Task List",action:()=>e.editor.chain().focus().toggleTaskList().run(),isActive:()=>e.editor.isActive("taskList")},{icon:"code-box-line",title:"Code Block",action:()=>e.editor.chain().focus().toggleCodeBlock().run(),isActive:()=>e.editor.isActive("codeBlock")},{type:"divider"},{icon:"double-quotes-l",title:"Blockquote",action:()=>e.editor.chain().focus().toggleBlockquote().run(),isActive:()=>e.editor.isActive("blockquote")},{icon:"separator",title:"Horizontal Rule",action:()=>e.editor.chain().focus().setHorizontalRule().run()},{type:"divider"},{icon:"text-wrap",title:"Hard Break",action:()=>e.editor.chain().focus().setHardBreak().run()},{icon:"format-clear",title:"Clear Format",action:()=>e.editor.chain().focus().clearNodes().unsetAllMarks().run()},{type:"divider"},{icon:"arrow-go-back-line",title:"Undo",action:()=>e.editor.chain().focus().undo().run()},{icon:"arrow-go-forward-line",title:"Redo",action:()=>e.editor.chain().focus().redo().run()}]);return(u,S)=>{const L=be("perfect-scrollbar");return p(),$(L,{class:"d-flex align-center cursor-pointer menuBar"},{default:l(()=>[(p(!0),P(le,null,Qe(d.value,(D,V)=>(p(),P(le,null,[D.type==="divider"?(p(),P("div",{class:"divider",key:`divider${V}`})):(p(),$(Vt,O({key:V},D),null,16))],64))),256))]),_:1})}}},Rt=re({__name:"ValidateDemand",props:{modelValue:Object,density:{type:String,default:"default"},comment:{type:String,default:""},icon:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(r,{emit:e}){const d=ye(),u=ke(),S=_e(),L=r,D=e,V=B({get:()=>L.modelValue,set:f=>D("update:modelValue",f)}),T=s(!1),A=s(!1),H=Be({extensions:[ge],content:V.value.commentaire}),U=s(V.value.hall_id),x=s([]),q=B(()=>`${C("Validation de la demande de ")} ${(V.value.customer||{firstname:""}).firstname} ${(V.value.customer||{lastname:""}).lastname} ${Ce(V.value.demand_date)||""}`);function R(){var f;A.value=!0,d.validateItem(V.value.id,{comment:(f=H.value)==null?void 0:f.getHTML(),hall:U.value}).then(m=>{V.value=m.data,T.value=!1,u.showSuccess(C("Devis validé avec succès")),D("saved",m.data)}).catch(m=>{A.value=!1,u.showError(m.message)}).then(()=>{A.value=!1})}return ne(()=>{S.fetchItems({per_page:1e3}).then(f=>{x.value=f.data.data})}),(f,m)=>{const z=be("CheckIcon");return p(),$(ie,{modelValue:T.value,"onUpdate:modelValue":m[3]||(m[3]=k=>T.value=k),"max-width":"1000px"},{activator:l(({props:k})=>[V.value.prestation?X("",!0):(p(),$(w,O({key:0,dark:""},k,{flat:"",variant:"elevated",density:r.density,color:"primary",icon:r.icon,onClick:m[0]||(m[0]=se=>A.value=!1)}),{default:l(()=>[b(h(r.icon?"":f.$t("Valider en prestation"))+" ",1),r.icon?(p(),$(z,{key:0,"stroke-width":"1.5",size:"20"})):X("",!0)]),_:2},1040,["density","icon"]))]),default:l(()=>[t(we,null,{default:l(()=>[t(Se,{class:"text-h5 text-center py-6"},{default:l(()=>[b(h(f.$t("Êtes-vous sûr de vouloir Valider en prestation?")),1)]),_:1}),t(at),t($e,null,{default:l(()=>[t(De,null,{default:l(()=>[t(g,{cols:"12"},{default:l(()=>[b(h(q.value),1)]),_:1}),t(g,{cols:"12"},{default:l(()=>[j("label",null,h(f.$t("Commentaire")),1),t(Pe,{editor:y(H)},null,8,["editor"]),t(y(Ee),{editor:y(H)},null,8,["editor"])]),_:1}),t(g,{cols:"12"},{default:l(()=>[t(oe,{modelValue:U.value,"onUpdate:modelValue":m[1]||(m[1]=k=>U.value=k),items:x.value,"item-value":"id","item-title":"name",label:f.$t("Salle liée")},null,8,["modelValue","items","label"])]),_:1})]),_:1})]),_:1}),t(Ae,null,{default:l(()=>[t(M),t(w,{color:"error",variant:"flat",dark:"",onClick:m[2]||(m[2]=k=>T.value=!1)},{default:l(()=>[b(h(f.$t("Annuler")),1)]),_:1}),t(w,{color:"success",variant:"flat",loading:A.value,dark:"",onClick:R},{default:l(()=>[b(h(f.$t("Créer la prestation")),1)]),_:1},8,["loading"]),t(M)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),bt={class:"text-h5"},kt={key:0,class:"mt-2"},zt=re({__name:"DemandForm",props:{modelValue:Object,isNew:{type:Boolean,default:!0},showCustomer:{type:Boolean,default:!0},title:C("Service"),buttonText:{type:String,default:C("Ajouter une demande")}},emits:["update:modelValue","update:item"],setup(r,{emit:e}){const d=We(),u=s(),S=ke(),L=it(),D=nt(),V=_e(),T=r,A=e;s({title:C("Gestion des demandes")}),s([{text:C("Dashboard"),disabled:!1,href:"/"},{text:C("Gestion des demandes"),disabled:!0,href:"#"}]);const H=s([]),U=s([]),x=s([]),q=s([]),R=ye();ne(()=>{ee(),me(),Fe(),V.fetchItems({per_page:1e3}).then(o=>{q.value=o.data.data})});const f=s(!1),m=s(!1),z=s(null),k=s(!1),se=s(100),Y=s(2),Z=s(2),Te=s(0),ue=s(!1),G=s(!1),de=s(""),K=s([{key:"event_date",order:"ASC"}]),_=s({search:null,status:null,date:null,event_type:null}),Q=s({itemsPerPage:100,rowsPerPage:100,page:1,sortDesc:[!0],sortBy:[{key:"event_date",order:"ASC"}]}),Ue=s(-1),i=B({get:()=>T.modelValue||{id:null,customer:{}},set:o=>A("update:modelValue",o)}),W=Be({extensions:[ge],content:i.value.commentaire}),xe=B(()=>i.value.event_date?d.format(i.value.event_date,"shortDate"):null),ce=B(()=>i.value.event_date?Ce(i.value.event_date):null);function Ie(){G.value=!1}function Le(o,{setErrors:a}){var c;console.log(i.value),(c=u.value)==null||c.validate().then(({valid:I})=>{var n;I&&(m.value=!0,R.addItem({...i.value,event_date:xe.value,commentaire:(n=W.value)==null?void 0:n.getHTML()}).then(v=>{if(v.data.error){a({apiError:v.data.message});return}const N=v.data.event_date!=null?new Date(v.data.event_date):null,J={...v.data,event_date:N};A("saved",J),m.value=!1,G.value=!1,S.showSuccess(C("Demande enregistrée avec succès")),me(),ee()}).catch(v=>{m.value=!1,a({apiError:v})}).then(()=>{m.value=!1,a({apiError:null})}))})}const He=B(()=>Ue.value===-1?"Nouvelle demande":"Modifier la demande"),Ne=B(()=>_.value.date&&_.value.date.length?_.value.date.length>1?[d.format(_.value.date[0],"shortDate"),d.format(_.value.date[_.value.date.length-1],"shortDate")]:[d.format(_.value.date[0],"shortDate"),d.format(_.value.date[0],"shortDate")]:null);function ee(){try{clearTimeout(z.value)}catch{}z.value=setTimeout(()=>{f.value=!0;let o="id",a="desc";console.log(K.value),K.value.length>0&&(o=K.value[0].key,a=K.value[0].order),R.fetchItems({term:de.value,paginate:se.value,current_page:Y.value,direction:a,order_by:o,page:Q.value.page,per_page:Q.value.itemsPerPage,..._.value,date:Ne.value}).then(c=>{if(c.data){const{data:I,current_page:n,next_page_url:v,total:N,per_page:J,to:F,last_page:Me}=c.data;H.value=I.map(te=>{const je=te.event_date!=null?new Date(te.event_date):null;return{...te,event_date:je}}),Z.value=Me,Te.value=N}}).catch(c=>{console.error(c)}).then(()=>{f.value=!1})},1e3)}function me(){L.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(o=>{if(o.data){const{data:a,current_page:c,next_page_url:I,total:n,per_page:v,to:N,last_page:J}=o.data;U.value=a}}).catch(o=>{console.error(o)}).then(()=>{})}function Fe(){D.fetchItems({term:"",paginate:5e3,current_page:1,direction:"asc",order_by:"firstname",page:1,per_page:5e3}).then(o=>{if(o.data){const{data:a,current_page:c,next_page_url:I,total:n,per_page:v,to:N,last_page:J}=o.data;x.value=a.map(F=>({...F,name:F.firstname+" "+F.lastname+" ("+(F.is_customer?C("Client"):C("Prospect"))+")"}))}}).catch(o=>{console.error(o)}).then(()=>{})}et([de,Q,_],()=>{ee()},{deep:!0}),Ve(()=>{Y.value>Z.value&&(Y.value=Z.value)});function Oe(o){if(o){const a=x.value.find(c=>c.id==o);a&&(i.value.customer=a)}}return(o,a)=>(p(),$(ie,{modelValue:G.value,"onUpdate:modelValue":a[18]||(a[18]=c=>G.value=c),"max-width":"1000px"},{activator:l(({props:c})=>[r.isNew?(p(),$(w,O({key:0,color:"primary",class:"align-self-end float-end mx-2",variant:"flat",dark:""},c),{default:l(()=>[b(h(r.buttonText),1)]),_:2},1040)):(p(),$(lt,O({key:1,value:"action","hide-details":"","min-height":"38"},c),{default:l(()=>[t(ot,null,{default:l(()=>[t(st,{size:"20",class:"mr-2"},{default:l(()=>[(p(),$(tt("EditIcon"),{"stroke-width":"2",size:"20"}))]),_:1}),b(" "+h(o.$t("Modifier")),1)]),_:1})]),_:2},1040))]),default:l(()=>[t(we,null,{default:l(()=>[t(Se,{class:"pa-4 bg-secondary"},{default:l(()=>[j("span",bt,h(He.value),1)]),_:1}),t(y(rt),{ref_key:"refForm",ref:u,modelValue:ue.value,"onUpdate:modelValue":a[17]||(a[17]=c=>ue.value=c),onSubmit:Le},{default:l(({errors:c,isSubmitting:I})=>[t($e,null,{default:l(()=>[t(ut,{class:"px-0"},{default:l(()=>[t(De,null,{default:l(()=>[r.showCustomer?(p(),P(le,{key:0},[t(g,{cols:"12"},{default:l(()=>[t(fe,{modelValue:i.value.customer_id,"onUpdate:modelValue":[a[0]||(a[0]=n=>i.value.customer_id=n),Oe],placeholder:o.$t("Client"),label:o.$t("Client"),items:x.value,"item-value":"id","item-title":"name",clearable:"","hide-details":"",variant:"outlined"},null,8,["modelValue","placeholder","label","items"])]),_:1}),t(g,{cols:"12",md:"6"},{default:l(()=>[t(E,{modelValue:i.value.customer.firstname,"onUpdate:modelValue":a[1]||(a[1]=n=>i.value.customer.firstname=n),rules:[y(ve)],label:o.$t("Prénom")},null,8,["modelValue","rules","label"])]),_:1}),t(g,{cols:"12",md:"6"},{default:l(()=>[t(E,{modelValue:i.value.customer.lastname,"onUpdate:modelValue":a[2]||(a[2]=n=>i.value.customer.lastname=n),rules:[y(ve)],label:o.$t("Nom")},null,8,["modelValue","rules","label"])]),_:1}),t(g,{cols:"12",md:"6"},{default:l(()=>[t(E,{modelValue:i.value.customer.email,"onUpdate:modelValue":a[3]||(a[3]=n=>i.value.customer.email=n),label:o.$t("Email")},null,8,["modelValue","label"])]),_:1}),t(g,{cols:"12",md:"6"},{default:l(()=>[t(E,{modelValue:i.value.customer.phone,"onUpdate:modelValue":a[4]||(a[4]=n=>i.value.customer.phone=n),label:o.$t("Téléphone")},null,8,["modelValue","label"])]),_:1})],64)):X("",!0),t(g,{cols:"12",md:"6"},{default:l(()=>[t(fe,{modelValue:i.value.event_type_id,"onUpdate:modelValue":a[5]||(a[5]=n=>i.value.event_type_id=n),placeholder:o.$t("Type d'événement"),items:U.value,"item-value":"id","item-title":"name",clearable:"","hide-details":"",variant:"outlined"},null,8,["modelValue","placeholder","items"])]),_:1}),t(g,{cols:"12",md:"6"},{default:l(()=>[t(ie,{ref:"dialogDemandDate",modelValue:k.value,"onUpdate:modelValue":a[11]||(a[11]=n=>k.value=n),"return-value":i.value.event_date,"onUpdate:returnValue":a[12]||(a[12]=n=>i.value.event_date=n),persistent:"",width:"290px"},{activator:l(({props:n})=>[t(E,O({modelValue:ce.value,"onUpdate:modelValue":a[6]||(a[6]=v=>ce.value=v),"prepend-inner-icon":"bx-calendar"},n,{placeholder:o.$t("Date de l'évènement"),"hide-details":"",clearable:"",readonly:"","onClick:clear":a[7]||(a[7]=v=>i.value.event_date=null)}),null,16,["modelValue","placeholder"])]),default:l(({isActive:n})=>[t(dt,{locale:"fr"},{default:l(()=>[t(ct,{modelValue:i.value.event_date,"onUpdate:modelValue":a[10]||(a[10]=v=>i.value.event_date=v),"hide-header":""},{actions:l(()=>[t(w,{color:"primary",onClick:a[8]||(a[8]=v=>k.value=!1)},{default:l(()=>[b(h(o.$t("Annuler")),1)]),_:1}),t(M),t(w,{variant:"elevated",color:"primary",onClick:a[9]||(a[9]=v=>k.value=!1)},{default:l(()=>[b(h(o.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),t(g,{cols:"12",md:"6"},{default:l(()=>[t(oe,{modelValue:i.value.reception_period,"onUpdate:modelValue":a[13]||(a[13]=n=>i.value.reception_period=n),"hide-details":"",items:[o.$t("En matiné"),o.$t("Le midi"),o.$t("En soirée")],label:o.$t("La réception se déroulera plutôt"),clearable:""},null,8,["modelValue","items","label"])]),_:1}),t(g,{cols:"12",md:"6"},{default:l(()=>[t(E,{modelValue:i.value.reception_start_time,"onUpdate:modelValue":a[14]||(a[14]=n=>i.value.reception_start_time=n),"hide-details":"",label:o.$t("Heure de réception"),clearable:""},null,8,["modelValue","label"])]),_:1}),t(g,{cols:"12",md:"6"},{default:l(()=>[t(oe,{modelValue:i.value.hall_id,"onUpdate:modelValue":a[15]||(a[15]=n=>i.value.hall_id=n),items:q.value,"item-value":"id","item-title":"name",label:o.$t("Salle liée")},null,8,["modelValue","items","label"])]),_:1}),t(g,{cols:"12",md:"6"},{default:l(()=>[t(E,{modelValue:i.value.number_people,"onUpdate:modelValue":a[16]||(a[16]=n=>i.value.number_people=n),"hide-details":"",type:"number",label:o.$t("Nombre de convives")},null,8,["modelValue","label"])]),_:1}),t(g,{cols:"12"},{default:l(()=>[j("label",null,h(o.$t("Commentaire")),1),t(Pe,{editor:y(W)},null,8,["editor"]),t(y(Ee),{editor:y(W)},null,8,["editor"])]),_:1})]),_:1}),c.apiError?(p(),P("div",kt,[t(mt,{color:"error"},{default:l(()=>[b(h(c.apiError),1)]),_:2},1024)])):X("",!0)]),_:2},1024)]),_:2},1024),t(Ae,null,{default:l(()=>[t(M),t(w,{color:"error",variant:"flat",dark:"",onClick:Ie},{default:l(()=>[b(h(o.$t("Annuler")),1)]),_:1}),t(w,{color:"success",variant:"flat",loading:m.value,type:"submit"},{default:l(()=>[b(h(o.$t("Sauvegarder")),1)]),_:1},8,["loading"]),t(M)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]))}});export{Ee as E,zt as _,Rt as a,Pe as b,Be as u};
