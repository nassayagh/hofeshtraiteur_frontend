import{u as Y}from"./customers-C-cc3von.js";import{u as ee}from"./eventType-DLchTHlx.js";import"./BaseBreadcrumb-DYaFDkdC.js";import{r as I}from"./validators-BPi-vT8z.js";import{a as M}from"./formatters-DCCWVJxZ.js";import{a6 as ae,aD as m,aC as te,r as e,av as le,e as V,h as oe,g as re,q as ue,Z as se,o as h,_ as T,w as l,V as b,n as q,d as y,t as c,b as a,a as ne,a8 as D,c as de,a4 as ie}from"./index-D3DdXZdG.js";import{F as me,V as fe}from"./vee-validate.esm-DezKAZlh.js";import{V as ce}from"./VDialog-BHPx_cIy.js";import{b as ve,V as pe,c as ge,a as Ve}from"./VCard-1m9q3-_R.js";import{V as he}from"./VContainer-7XyaLTnU.js";import{a as be,V as _}from"./VRow-Bx-LvG9A.js";import{V as C}from"./VTextField-DLykypQv.js";import{i as L}from"./VSpacer-DdAD-FGi.js";const ye={class:"text-h5"},_e={key:0,class:"mt-2"},Ae=ae({__name:"CustomerForm",props:{modelValue:Object,isNew:{type:Boolean,default:!0},showCustomer:{type:Boolean,default:!0},title:m("Service"),buttonText:{type:String,default:m("Ajouter")}},emits:["update:modelValue","update:item"],setup(w,{emit:O}){const v=te(),x=e(),E=le();ee();const R=w,N=O,s=V({get:()=>R.modelValue||{id:null,customer:{}},set:r=>N("update:modelValue",r)}),z=e([]);e([]);const B=Y();oe(()=>{A()});const F=e(!1),f=e(!1);e(!1),e(!1),e(!1),e(""),e(),e(!1);const U=e(null);e(null),e(null),e(null),e(!1),e();const Z=e(100),P=e(2),k=e(2),G=e(0),$=e(!1);e(!1);const p=e(!1);e(null);const j=e("");e(["primary","secondary","error","success","warning"]);const g=e([{key:"firstname",order:"asc"}]);e(0);const o=e({search:null,status:null,date:null,event_type:null}),S=e({itemsPerPage:100,rowsPerPage:100,page:1,sortDesc:[!0],sortBy:[{key:"firstname",order:"asc"}]});e(-1),e({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),e(!1),V(()=>o.value.date&&o.value.date.length>0?M(o.value.date[0])+" - "+M(o.value.date[o.value.date.length-1]):null);function H(){p.value=!1}function J(r,{setErrors:t}){var n;(n=x.value)==null||n.validate().then(({valid:u})=>{u&&(f.value=!0,B.addItem(s.value).then(d=>{if(d.data.error){t({apiError:d.data.message}),E.showError(d.data.message);return}f.value=!1,p.value=!1,E.showSuccess(m("Client enregistré avec succès")),N("saved",d.data)}).catch(d=>{f.value=!1,t({apiError:d})}).then(()=>{f.value=!1,t({apiError:null})}))})}const K=V(()=>s.value.id==null?s.value.is_customer?m("Nouvel Client"):m("Nouvel Prospect"):s.value.is_customer?m("Modifier Le Client"):m("Modifier Le Prospect")),Q=V(()=>o.value.date&&o.value.date.length?o.value.date.length>1?[v.format(o.value.date[0],"shortDate"),v.format(o.value.date[o.value.date.length-1],"shortDate")]:[v.format(o.value.date[0],"shortDate"),v.format(o.value.date[0],"shortDate")]:null);function A(){try{clearTimeout(U.value)}catch{}U.value=setTimeout(()=>{F.value=!0;let r="firstname",t="asc";console.log(g.value),g.value.length>0&&(r=g.value[0].key,t=g.value[0].order),B.fetchItems({term:j.value,paginate:Z.value,current_page:P.value,direction:t,order_by:r,page:S.value.page,per_page:S.value.itemsPerPage,...o.value,date:Q.value}).then(n=>{if(n.data){const{data:u,current_page:d,next_page_url:i,total:W,per_page:Ce,to:we,last_page:X}=n.data;z.value=u,k.value=X,G.value=W}}).catch(n=>{console.error(n)}).then(()=>{F.value=!1})},1e3)}return re([j,S,o],()=>{A()},{deep:!0}),ue(()=>{P.value>k.value&&(P.value=k.value)}),(r,t)=>{const n=se("PencilIcon");return h(),T(ce,{modelValue:p.value,"onUpdate:modelValue":t[5]||(t[5]=u=>p.value=u),"max-width":"600px"},{activator:l(({props:u})=>[w.isNew?(h(),T(b,q({key:0,color:"primary",class:"align-self-end float-end mx-2",variant:"flat",dark:""},u),{default:l(()=>[y(c(w.buttonText),1)]),_:2},1040)):(h(),T(b,q({key:1,icon:"",flat:""},u),{default:l(()=>[a(n,{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040))]),default:l(()=>[a(Ve,null,{default:l(()=>[a(ve,{class:"pa-4 bg-info"},{default:l(()=>[ne("span",ye,c(K.value),1)]),_:1}),a(D(me),{ref_key:"refForm",ref:x,modelValue:$.value,"onUpdate:modelValue":t[4]||(t[4]=u=>$.value=u),onSubmit:J},{default:l(({errors:u,isSubmitting:d})=>[a(pe,null,{default:l(()=>[a(he,{class:"px-0"},{default:l(()=>[a(be,null,{default:l(()=>[a(_,{cols:"12",md:"6"},{default:l(()=>[a(C,{modelValue:s.value.firstname,"onUpdate:modelValue":t[0]||(t[0]=i=>s.value.firstname=i),rules:[D(I)],label:r.$t("Prénom")},null,8,["modelValue","rules","label"])]),_:1}),a(_,{cols:"12",md:"6"},{default:l(()=>[a(C,{modelValue:s.value.lastname,"onUpdate:modelValue":t[1]||(t[1]=i=>s.value.lastname=i),rules:[D(I)],label:r.$t("Nom")},null,8,["modelValue","rules","label"])]),_:1}),a(_,{cols:"12",md:"6"},{default:l(()=>[a(C,{modelValue:s.value.email,"onUpdate:modelValue":t[2]||(t[2]=i=>s.value.email=i),label:r.$t("Email")},null,8,["modelValue","label"])]),_:1}),a(_,{cols:"12",md:"6"},{default:l(()=>[a(C,{modelValue:s.value.phone,"onUpdate:modelValue":t[3]||(t[3]=i=>s.value.phone=i),label:r.$t("Téléphone")},null,8,["modelValue","label"])]),_:1})]),_:1}),u.apiError?(h(),de("div",_e,[a(fe,{color:"error"},{default:l(()=>[y(c(u.apiError),1)]),_:2},1024)])):ie("",!0)]),_:2},1024)]),_:2},1024),a(ge,null,{default:l(()=>[a(L),a(b,{color:"error",variant:"flat",dark:"",onClick:H},{default:l(()=>[y(c(r.$t("Annuler")),1)]),_:1}),a(b,{color:"success",variant:"flat",loading:f.value,type:"submit"},{default:l(()=>[y(c(r.$t("Sauvegarder")),1)]),_:1},8,["loading"]),a(L)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])}}});export{Ae as _};
