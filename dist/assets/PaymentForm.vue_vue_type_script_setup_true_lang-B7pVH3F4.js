import{a6 as E,av as O,e as h,r as v,aM as C,h as Z,o as _,_ as I,w as a,b as e,d as m,t as s,n as T,V as g,Z as G,a4 as W,aL as X,g as Y,bm as ee,c as ae}from"./index-DTjzZ6Ee.js";import{u as F}from"./Controller-DD54gxZG.js";import{u as te}from"./hall-BZBPBHYo.js";import{b as B,V as N,c as H,a as L}from"./VCard-BgGdzODY.js";import{f as U}from"./VMenu-DayS87Sl.js";import{a as z,V as M}from"./VRow-DJLGGSVI.js";import{b as le}from"./VSelect-DJNTmByM.js";import{a as b}from"./VSpacer-B3ipnv74.js";import{V as j}from"./VDialog-TPy4lPq7.js";import{u as oe}from"./paymentMethod-CWDXEQoY.js";import{V as ne}from"./VAutocomplete-DswYZNTR.js";import{V as R}from"./VTextField-Bmdo43we.js";import{V as ue}from"./VLocaleProvider-B7--m4tv.js";import{V as re}from"./VDatePicker-BGhMPtSP.js";const be=E({__name:"ChangeHall",props:{modelValue:Object},emits:["update:modelValue"],setup(V,{emit:P}){const D=F(),$=O(),A=te(),S=V,d=P,y=h({get:()=>S.modelValue,set:n=>d("update:modelValue",n)}),f=v(!1),t=v(!1);v("");const u=v(y.value.hall_id||null),i=v([]);h(()=>`${C("Modifier la salle")}`);function k(){t.value=!0,D.changeHall(y.value.id,u.value).then(n=>{y.value=n.data,f.value=!1,$.showSuccess(C("Salle changée avec succès")),d("refresh",n.data)}).catch(n=>{t.value=!1,$.showError(n.message)}).then(()=>{t.value=!1})}return Z(()=>{A.fetchItems({per_page:1e3}).then(n=>{i.value=n.data.data})}),(n,p)=>(_(),I(j,{modelValue:f.value,"onUpdate:modelValue":p[3]||(p[3]=c=>f.value=c),"max-width":"500px"},{activator:a(({props:c})=>[e(g,T({dark:""},c,{variant:"tonal",density:"compact",onClick:p[0]||(p[0]=q=>t.value=!1)}),{default:a(()=>[m(s(n.$t("Modifier")),1)]),_:2},1040)]),default:a(()=>[e(L,null,{default:a(()=>[e(B,{class:"text-h5 text-center py-6"},{default:a(()=>[m(s(n.$t("Modifier la salle")),1)]),_:1}),e(U),e(N,null,{default:a(()=>[e(z,null,{default:a(()=>[e(M,{cols:"12"},{default:a(()=>[e(M,{cols:"12"},{default:a(()=>[e(le,{modelValue:u.value,"onUpdate:modelValue":p[1]||(p[1]=c=>u.value=c),items:i.value,"item-value":"id","item-title":"name",label:n.$t("Salle liée")},null,8,["modelValue","items","label"])]),_:1})]),_:1})]),_:1})]),_:1}),e(U),e(H,null,{default:a(()=>[e(b),e(g,{color:"error",variant:"flat",dark:"",onClick:p[2]||(p[2]=c=>f.value=!1)},{default:a(()=>[m(s(n.$t("Annuller")),1)]),_:1}),e(g,{color:"success",variant:"flat",loading:t.value,dark:"",onClick:k},{default:a(()=>[m(s(n.$t("Enregistrer")),1)]),_:1},8,["loading"]),e(b)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Se=E({__name:"ClosePrestation",props:{modelValue:Object,icon:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(V,{emit:P}){const D=F(),$=O(),A=V,S=P,d=h({get:()=>A.modelValue,set:u=>S("update:modelValue",u)}),y=v(!1),f=v(!1);v(""),h(()=>`${C("Terminer la prestation")}`);function t(){f.value=!0,D.closeItem(d.value.id).then(u=>{d.value=u.data,y.value=!1,$.showSuccess(C("Prestation clôturée avec succès")),S("refresh")}).catch(u=>{f.value=!1,$.showError(u.message)}).then(()=>{f.value=!1})}return(u,i)=>{const k=G("CheckIcon");return _(),I(j,{modelValue:y.value,"onUpdate:modelValue":i[2]||(i[2]=n=>y.value=n),"max-width":"500px"},{activator:a(({props:n})=>[e(g,T({dark:""},n,{variant:"elevated",color:"primary",onClick:i[0]||(i[0]=p=>f.value=!1),icon:V.icon}),{default:a(()=>[m(s(V.icon?"":u.$t("Terminer la prestation"))+" ",1),V.icon?(_(),I(k,{key:0,"stroke-width":"1.5",size:"20"})):W("",!0)]),_:2},1040,["icon"])]),default:a(()=>[e(L,null,{default:a(()=>[e(B,{class:"text-h5 text-center py-6"},{default:a(()=>[m(s(u.$t("Terminer la prestation")),1)]),_:1}),e(U),e(N,null,{default:a(()=>[e(z,null,{default:a(()=>[e(M,{cols:"12",class:"text-center"},{default:a(()=>[m(s(u.$t("Êtes-vous sûr de vouloir terminer la prestation?")),1)]),_:1})]),_:1})]),_:1}),e(U),e(H,null,{default:a(()=>[e(b),e(g,{color:"error",variant:"flat",dark:"",onClick:i[1]||(i[1]=n=>y.value=!1)},{default:a(()=>[m(s(u.$t("Non")),1)]),_:1}),e(g,{color:"success",variant:"flat",loading:f.value,dark:"",onClick:t},{default:a(()=>[m(s(u.$t("Oui")),1)]),_:1},8,["loading"]),e(b)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),se={key:1},we=E({__name:"PaymentForm",props:{modelValue:Object,prestation:Object,title:C("PaymentMethod"),variant:{type:String,default:"elevated"},buttonText:C("Ajouter un paymentMethod")},emits:["update:modelValue","update:item"],setup(V,{emit:P}){const D=F(),$=O(),A=oe(),S=X(),d=V,y=P,f=h({get:()=>d.modelValue,set:o=>y("update:modelValue",o)}),t=v(f.value||{id:null,prestation_id:null,amount:0,payment_date:new Date}),u=v(!1),i=v(!1),k=v(!1),n=v([]);Z(()=>{A.fetchItems({per_page:500}).then(o=>{n.value=o.data.data,console.log(n.value)}),t.value.id||(t.value.amount=c.value)});const p=h(()=>d.prestation.services?d.prestation.services.reduce((o,l)=>(console.log(l.total,o),parseFloat(l.total)+parseFloat(o)),0):0),c=h(()=>d.prestation.payments&&d.prestation.payments.length?p.value-d.prestation.payments.reduce((o,l)=>parseFloat(l.amount)+parseFloat(o),0):p.value);function q(){k.value=!0,D.savePayment(d.prestation.id,t.value).then(o=>{u.value=!1,y("update:item",o.data),$.showSuccess(C("Paiement enregistré avec succès"))}).catch(o=>{k.value=!1,$.showError(o.message)}).then(()=>{k.value=!1})}function J(o){if(console.log(c.value),o){const l=n.value.find(x=>x.id==o);l&&(t.value.payment_method=l.name||null,t.value.id||(t.value.amount=c.value))}}const K=h(()=>t.value.payment_date?S.format(t.value.payment_date,"shortDate"):null);function Q(){k.value=!1,t.value.id||(t.value={payment_date:new Date,amount:c.value})}return Y([d.prestation],o=>{console.log("prestat",o),t.value.id||(t.value.amount=c.value)},{deep:!0}),(o,l)=>{const x=G("EditIcon");return _(),I(j,{modelValue:u.value,"onUpdate:modelValue":l[10]||(l[10]=r=>u.value=r),"max-width":"500px"},{activator:a(({props:r})=>[e(g,T({dark:""},r,{icon:t.value.id!=null,flat:t.value.id!=null,variant:V.variant,color:t.value.id!=null?null:"primary",onClick:Q}),{default:a(()=>[ee(o.$slots,"default",{},()=>[t.value.id?(_(),I(x,{key:0,"stroke-width":"1.5",size:"20",class:"text-primary"})):(_(),ae("span",se,s(V.buttonText),1))])]),_:2},1040,["icon","flat","variant","color"])]),default:a(()=>[e(L,null,{default:a(()=>[e(B,{class:"text-h5 text-center py-6"},{default:a(()=>[m(s(V.title),1)]),_:1}),e(U),e(N,null,{default:a(()=>[e(z,null,{default:a(()=>[e(M,{cols:"12"},{default:a(()=>[e(ne,{modelValue:t.value.payment_method_id,"onUpdate:modelValue":[l[0]||(l[0]=r=>t.value.payment_method_id=r),J],label:o.$t("PaymentMethod"),clearable:"",items:n.value,"item-title":"name","item-value":"id",filled:!1,variant:"outlined",required:""},null,8,["modelValue","label","items"])]),_:1}),e(M,{cols:"12",md:"6"},{default:a(()=>[e(j,{ref:"dialogDemandDate",modelValue:i.value,"onUpdate:modelValue":l[6]||(l[6]=r=>i.value=r),"return-value":t.value.payment_date,"onUpdate:returnValue":l[7]||(l[7]=r=>t.value.payment_date=r),persistent:"",width:"290px"},{activator:a(({props:r})=>[e(R,T({modelValue:K.value,"onUpdate:modelValue":l[1]||(l[1]=w=>K.value=w)},r,{placeholder:o.$t("Date de la demande"),"hide-details":"",clearable:"",readonly:"","onClick:clear":l[2]||(l[2]=w=>t.value.payment_date=null)}),null,16,["modelValue","placeholder"])]),default:a(({isActive:r})=>[e(ue,{locale:"fr"},{default:a(()=>[e(re,{modelValue:t.value.payment_date,"onUpdate:modelValue":l[5]||(l[5]=w=>t.value.payment_date=w),"hide-header":""},{actions:a(()=>[e(g,{color:"primary",onClick:l[3]||(l[3]=w=>i.value=!1)},{default:a(()=>[m(s(o.$t("Annuler")),1)]),_:1}),e(b),e(g,{variant:"elevated",color:"primary",onClick:l[4]||(l[4]=w=>i.value=!1)},{default:a(()=>[m(s(o.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),e(M,{cols:"12",md:"6"},{default:a(()=>[e(R,{min:0,modelValue:t.value.amount,"onUpdate:modelValue":l[8]||(l[8]=r=>t.value.amount=r),type:"number",label:o.$t("Montant")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),e(H,null,{default:a(()=>[e(b),e(g,{color:"error",variant:"flat",dark:"",onClick:l[9]||(l[9]=r=>u.value=!1)},{default:a(()=>[m(s(o.$t("Annuler")),1)]),_:1}),e(g,{color:"success",variant:"flat",loading:k.value,dark:"",onClick:q},{default:a(()=>[m(s(o.$t("Ajouter")),1)]),_:1},8,["loading"]),e(b)]),_:1})]),_:1})]),_:3},8,["modelValue"])}}});export{we as _,be as a,Se as b};
