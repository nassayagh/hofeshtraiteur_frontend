import{a6 as B,av as E,e as g,r as p,aM as b,Z as N,o as h,_ as S,w as t,b as e,d as i,t as d,a4 as Q,n as U,V as f,aL as W,h as X,g as Y,bm as ee,c as ae}from"./index-t8zHg-8F.js";import{u as L}from"./Controller-CwqthIgP.js";import{b as z,V as q,c as K,a as R}from"./VCard-C3p_QfdF.js";import{f as x}from"./VMenu-C7bc1zT4.js";import{a as Z,V as D}from"./VRow-B2iclBpQ.js";import{a as w}from"./VSpacer-sfo9D1j4.js";import{V as j}from"./VDialog-DLp6pEV3.js";import{u as te}from"./paymentMethod-BcZpVx49.js";import{V as le}from"./VAutocomplete-B30NFcM_.js";import{V as O}from"./VTextField-BkuJW4QM.js";import{V as oe}from"./VLocaleProvider-CJgva9-f.js";import{V as ne}from"./VDatePicker-BD_JLIC5.js";const ge=B({__name:"ClosePrestation",props:{modelValue:Object,icon:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(m,{emit:M}){const _=L(),C=E(),A=m,P=M,r=g({get:()=>A.modelValue,set:n=>P("update:modelValue",n)}),c=p(!1),V=p(!1);p(""),g(()=>`${b("Terminer la prestation")}`);function l(){V.value=!0,_.closeItem(r.value.id).then(n=>{r.value=n.data,c.value=!1,C.showSuccess(b("Prestation clôturée avec succès")),P("refresh")}).catch(n=>{V.value=!1,C.showError(n.message)}).then(()=>{V.value=!1})}return(n,s)=>{const y=N("CheckIcon");return h(),S(j,{modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=v=>c.value=v),"max-width":"500px"},{activator:t(({props:v})=>[e(f,U({dark:""},v,{variant:"elevated",color:"primary",onClick:s[0]||(s[0]=T=>V.value=!1),icon:m.icon}),{default:t(()=>[i(d(m.icon?"":n.$t("Terminer la prestation"))+" ",1),m.icon?(h(),S(y,{key:0,"stroke-width":"1.5",size:"20"})):Q("",!0)]),_:2},1040,["icon"])]),default:t(()=>[e(R,null,{default:t(()=>[e(z,{class:"text-h5 text-center py-6"},{default:t(()=>[i(d(n.$t("Terminer la prestation")),1)]),_:1}),e(x),e(q,null,{default:t(()=>[e(Z,null,{default:t(()=>[e(D,{cols:"12",class:"text-center"},{default:t(()=>[i(d(n.$t("Êtes-vous sûr de vouloir terminer la prestation?")),1)]),_:1})]),_:1})]),_:1}),e(x),e(K,null,{default:t(()=>[e(w),e(f,{color:"error",variant:"flat",dark:"",onClick:s[1]||(s[1]=v=>c.value=!1)},{default:t(()=>[i(d(n.$t("Non")),1)]),_:1}),e(f,{color:"success",variant:"flat",loading:V.value,dark:"",onClick:l},{default:t(()=>[i(d(n.$t("Oui")),1)]),_:1},8,["loading"]),e(w)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),ue={key:1},Ce=B({__name:"PaymentForm",props:{modelValue:Object,prestation:Object,title:b("PaymentMethod"),variant:{type:String,default:"elevated"},buttonText:b("Ajouter un paymentMethod")},emits:["update:modelValue","update:item"],setup(m,{emit:M}){const _=L(),C=E(),A=te(),P=W(),r=m,c=M,V=g({get:()=>r.modelValue,set:o=>c("update:modelValue",o)}),l=p(V.value||{id:null,prestation_id:null,amount:0,payment_date:new Date}),n=p(!1),s=p(!1),y=p(!1),v=p([]);X(()=>{A.fetchItems({per_page:500}).then(o=>{v.value=o.data.data,console.log(v.value)}),l.value.id||(l.value.amount=$.value)});const T=g(()=>r.prestation.services?r.prestation.services.reduce((o,a)=>(console.log(a.total,o),parseFloat(a.total)+parseFloat(o)),0):0),$=g(()=>r.prestation.payments&&r.prestation.payments.length?T.value-r.prestation.payments.reduce((o,a)=>parseFloat(a.amount)+parseFloat(o),0):T.value);function G(){y.value=!0,_.savePayment(r.prestation.id,l.value).then(o=>{n.value=!1,c("update:item",o.data),C.showSuccess(b("Paiement enregistré avec succès"))}).catch(o=>{y.value=!1,C.showError(o.message)}).then(()=>{y.value=!1})}function H(o){if(console.log($.value),o){const a=v.value.find(I=>I.id==o);a&&(l.value.payment_method=a.name||null,l.value.id||(l.value.amount=$.value))}}const F=g(()=>l.value.payment_date?P.format(l.value.payment_date,"shortDate"):null);function J(){y.value=!1,l.value.id||(l.value={payment_date:new Date,amount:$.value})}return Y([r.prestation],o=>{console.log("prestat",o),l.value.id||(l.value.amount=$.value)},{deep:!0}),(o,a)=>{const I=N("EditIcon");return h(),S(j,{modelValue:n.value,"onUpdate:modelValue":a[10]||(a[10]=u=>n.value=u),"max-width":"500px"},{activator:t(({props:u})=>[e(f,U({dark:""},u,{icon:l.value.id!=null,flat:l.value.id!=null,variant:m.variant,color:l.value.id!=null?null:"primary",onClick:J}),{default:t(()=>[ee(o.$slots,"default",{},()=>[l.value.id?(h(),S(I,{key:0,"stroke-width":"1.5",size:"20",class:"text-primary"})):(h(),ae("span",ue,d(m.buttonText),1))])]),_:2},1040,["icon","flat","variant","color"])]),default:t(()=>[e(R,null,{default:t(()=>[e(z,{class:"text-h5 text-center py-6"},{default:t(()=>[i(d(m.title),1)]),_:1}),e(x),e(q,null,{default:t(()=>[e(Z,null,{default:t(()=>[e(D,{cols:"12"},{default:t(()=>[e(le,{modelValue:l.value.payment_method_id,"onUpdate:modelValue":[a[0]||(a[0]=u=>l.value.payment_method_id=u),H],label:o.$t("PaymentMethod"),clearable:"",items:v.value,"item-title":"name","item-value":"id",filled:!1,variant:"outlined",required:""},null,8,["modelValue","label","items"])]),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>[e(j,{ref:"dialogDemandDate",modelValue:s.value,"onUpdate:modelValue":a[6]||(a[6]=u=>s.value=u),"return-value":l.value.payment_date,"onUpdate:returnValue":a[7]||(a[7]=u=>l.value.payment_date=u),persistent:"",width:"290px"},{activator:t(({props:u})=>[e(O,U({modelValue:F.value,"onUpdate:modelValue":a[1]||(a[1]=k=>F.value=k)},u,{placeholder:o.$t("Date de la demande"),"hide-details":"",clearable:"",readonly:"","onClick:clear":a[2]||(a[2]=k=>l.value.payment_date=null)}),null,16,["modelValue","placeholder"])]),default:t(({isActive:u})=>[e(oe,{locale:"fr"},{default:t(()=>[e(ne,{modelValue:l.value.payment_date,"onUpdate:modelValue":a[5]||(a[5]=k=>l.value.payment_date=k),"hide-header":""},{actions:t(()=>[e(f,{color:"primary",onClick:a[3]||(a[3]=k=>s.value=!1)},{default:t(()=>[i(d(o.$t("Annuler")),1)]),_:1}),e(w),e(f,{variant:"elevated",color:"primary",onClick:a[4]||(a[4]=k=>s.value=!1)},{default:t(()=>[i(d(o.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>[e(O,{min:0,modelValue:l.value.amount,"onUpdate:modelValue":a[8]||(a[8]=u=>l.value.amount=u),type:"number",label:o.$t("Montant")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),e(K,null,{default:t(()=>[e(w),e(f,{color:"error",variant:"flat",dark:"",onClick:a[9]||(a[9]=u=>n.value=!1)},{default:t(()=>[i(d(o.$t("Annuler")),1)]),_:1}),e(f,{color:"success",variant:"flat",loading:y.value,dark:"",onClick:G},{default:t(()=>[i(d(o.$t("Ajouter")),1)]),_:1},8,["loading"]),e(w)]),_:1})]),_:1})]),_:3},8,["modelValue"])}}});export{Ce as _,ge as a};
