import{u as F}from"./Controller-Ozw5e5LH.js";import{a6 as H,e as U,o as h,_ as C,w as t,b as e,a as s,t as a,d as m,a8 as p,c as O,a4 as I,av as z,r as i,aD as P,n as Q,V as w,h as de,Z as Y,aE as me,g as ce,aF as ve,X as te,a5 as le}from"./index-CTWWqwFB.js";import{_ as pe,V as se}from"./BaseBreadcrumb-BLYW9dWU.js";import{a as N,f as q}from"./formatters-DCCWVJxZ.js";import{a as T,d as J,V as M,b as K,c as W}from"./VCard-C-APrnZS.js";import{a as ae,g as B,i as D}from"./VSpacer-CpXg8B4f.js";import{V as g,a as E}from"./VRow-BmCUl3Bv.js";import{V as ie}from"./VTextarea-Q7RteWR-.js";import{V as X}from"./VDialog-Csg4ZvwQ.js";import{u as fe}from"./service-Dkd21pRE.js";import{V as _e}from"./VAutocomplete-Bu0mSW1P.js";import{V as oe}from"./VTextField-C4Wk-boL.js";import{a as he,b as Ve,_ as ne}from"./PrestationForm.vue_vue_type_script_setup_true_lang-CnlmSvSu.js";import{u as ye,S as $e,_ as ge,E as be}from"./EditorMenubar-BD2GX71P.js";import{_ as ke}from"./HallWidget.vue_vue_type_script_setup_true_lang-_VAD5Qyx.js";import{V as ue}from"./VTooltip-DrUA0_zW.js";import"./VAvatar-DDLJ7Omq.js";import"./paymentMethod-DLUlQrus.js";import"./VLocaleProvider-BMs7zZDk.js";import"./VDatePicker-xaEEPToe.js";import"./VSheet-C1yuEtxl.js";import"./eventType-Con-M3dj.js";import"./customers-DxOFblPC.js";import"./hall-CTRuQ-7s.js";import"./validators-BPi-vT8z.js";import"./vee-validate.esm-fRPIiQPH.js";import"./VContainer-D1Fh9kIV.js";import"./ChangeHall.vue_vue_type_script_setup_true_lang-CMRi_D-P.js";const Ce={class:"text-h6"},Se={class:"text-subtitle-1 textSecondary mt-3"},we={class:"text-subtitle-1 textSecondary mt-3"},xe={class:"text-subtitle-1 textSecondary mt-3"},je={class:"text-subtitle-1 textSecondary mt-3"},Pe={class:"text-subtitle-1 textSecondary mt-3"},Ue={class:"text-subtitle-1 textSecondary mt-3"},De={class:"text-subtitle-1 textSecondary mt-3"},Ae={key:0,class:"text-subtitle-1 textSecondary mt-3"},Te={key:1,class:"text-subtitle-1 textSecondary mt-3"},Ie={class:"text-subtitle-1 textSecondary mt-3"},Me={class:"text-h6"},Ee={class:"text-subtitle-1 textSecondary mt-3"},Oe={class:"text-subtitle-1 textSecondary mt-3"},Ne={class:"text-subtitle-1 textSecondary mt-3"},Le={class:"text-subtitle-1 textSecondary mt-3"},qe={class:"text-subtitle-1 textSecondary mt-3"},Be={class:"text-subtitle-1 textSecondary mt-3"},Fe=H({__name:"CustomerWidget",props:{modelValue:Object,showDemandInfo:Boolean,source:{type:String,default:"SITE"}},emits:["update:modelValue"],setup(j,{emit:l}){const _=F(),S=j,x=l,c=U({get:()=>S.modelValue,set:u=>x("update:modelValue",u)});return(u,n)=>(h(),C(E,null,{default:t(()=>[e(g,{cols:"12"},{default:t(()=>[e(T,{elevation:"10",class:"overflow-hidden h-100"},{default:t(()=>[e(J,{class:"py-4 px-6 text-white bg-info"},{default:t(()=>[s("h4",Ce,a(u.$t("Détails de la prestation")),1)]),_:1}),j.showDemandInfo?(h(),C(M,{key:0,class:"pl-6 pr-6"},{default:t(()=>[s("p",Se,[m(a(u.$t("Type événement :"))+" ",1),s("strong",null,a(c.value.eventtype?c.value.eventtype.name:c.value.event_type||""),1)]),s("p",we,[m(a(u.$t("Date de l'événement :"))+" ",1),s("strong",null,a(p(N)(c.value.event_date)||""),1)]),s("p",xe,[m(a(u.$t("La réception se déroulera plutôt :"))+" ",1),s("strong",null,a(c.value.reception_period||""),1)]),s("p",je,[m(a(u.$t("Heure de réception :"))+" ",1),s("strong",null,a(c.value.reception_start_time||""),1)]),s("p",Pe,[m(a(u.$t("Nombre de convives :"))+" ",1),s("strong",null,a(c.value.number_people||""),1)]),s("p",Ue,[m(a(u.$t("Nombre de jours restants :"))+" ",1),s("strong",null,a(c.value.days_left||""),1)]),s("p",De,[m(a(u.$t("Date de la demande :"))+" ",1),s("strong",null,a(p(N)(c.value.demand_date)||""),1)]),c.value.status>=p(_).statuses.validated?(h(),O("p",Ae,[m(a(u.$t("Date de validation de la demande :"))+" ",1),s("strong",null,a(p(N)(c.value.validated_date)||""),1)])):I("",!0),c.value.status>=p(_).statuses.closed?(h(),O("p",Te,[m(a(u.$t("Date clôture de la prestation :"))+" ",1),s("strong",null,a(p(N)(c.value.closed_date)||""),1)])):I("",!0),s("p",Ie,[m(a(u.$t("Source :"))+" ",1),s("strong",null,a(S.source||""),1)])]),_:1})):I("",!0)]),_:1})]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(T,{elevation:"10",class:"overflow-hidden h-100"},{default:t(()=>[e(J,{class:"py-4 px-6 text-white bg-primary"},{default:t(()=>[s("h4",Me,a(u.$t("Identification du demandeur")),1)]),_:1}),e(M,{class:"pl-6 pr-6"},{default:t(()=>[s("p",Ee,[m(a(u.$t("Prénom :"))+" ",1),s("strong",null,a(c.value.customer.firstname||""),1)]),s("p",Oe,[m(a(u.$t("Nom :"))+" ",1),s("strong",null,a(c.value.customer.lastname||""),1)]),s("p",Ne,[m(a(u.$t("Email :"))+" ",1),s("strong",null,a(c.value.customer.email||""),1)]),s("p",Le,[m(a(u.$t("Téléphone :"))+" ",1),s("strong",null,a(c.value.customer.phone||""),1)]),s("p",qe,[m(a(u.$t("Date d'enregistrement :"))+" ",1),s("strong",null,a(p(N)(c.value.customer.created_at)||""),1)]),s("p",Be,[m(a(u.$t("Type :"))+" ",1),c.value.customer&&c.value.customer.is_customer?(h(),C(ae,{key:0,color:"success"},{default:t(()=>[m(a(u.$t("Client")),1)]),_:1})):(h(),C(ae,{key:1,color:"error"},{default:t(()=>[m(a(u.$t("Prospect")),1)]),_:1}))])]),_:1})]),_:1})]),_:1})]),_:1}))}}),He=H({__name:"CancelPrestation",props:{modelValue:Object},emits:["update:modelValue"],setup(j,{emit:l}){const _=F(),S=z(),x=j,c=l,u=U({get:()=>x.modelValue,set:o=>c("update:modelValue",o)}),n=i(!1),f=i(!1),k=i("");U(()=>`${P("Annuler la prestation")}`);function y(){f.value=!0,_.cancelItem(u.value.id,k.value).then(o=>{u.value=o.data,n.value=!1,S.showSuccess(P("Prestation annulée avec succès"))}).catch(o=>{f.value=!1,S.showError(o.message)}).then(()=>{f.value=!1})}return(o,v)=>(h(),C(X,{modelValue:n.value,"onUpdate:modelValue":v[3]||(v[3]=r=>n.value=r),"max-width":"500px"},{activator:t(({props:r})=>[e(w,Q({class:"ml-2",dark:""},r,{variant:"outlined",color:"primary",onClick:v[0]||(v[0]=b=>f.value=!1)}),{default:t(()=>[m(a(o.$t("Annuler la prestation")),1)]),_:2},1040)]),default:t(()=>[e(T,null,{default:t(()=>[e(K,{class:"text-h5 text-center py-6"},{default:t(()=>[m(a(o.$t("Annuler la prestation")),1)]),_:1}),e(B),e(M,null,{default:t(()=>[e(E,null,{default:t(()=>[e(g,{cols:"12",class:"text-center"},{default:t(()=>[m(a(o.$t("Êtes-vous sûr de vouloir Annuler la prestation?")),1)]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(ie,{modelValue:k.value,"onUpdate:modelValue":v[1]||(v[1]=r=>k.value=r),placeholder:o.$t("Commentaire"),label:o.$t("Commentaire")},null,8,["modelValue","placeholder","label"])]),_:1})]),_:1})]),_:1}),e(B),e(W,null,{default:t(()=>[e(D),e(w,{color:"error",variant:"flat",dark:"",onClick:v[2]||(v[2]=r=>n.value=!1)},{default:t(()=>[m(a(o.$t("Non")),1)]),_:1}),e(w,{color:"success",variant:"flat",loading:f.value,dark:"",onClick:y},{default:t(()=>[m(a(o.$t("Oui")),1)]),_:1},8,["loading"]),e(D)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Re=H({__name:"ValidatePrestation",props:{modelValue:Object},emits:["update:modelValue"],setup(j,{emit:l}){const _=F(),S=z(),x=j,c=l,u=U({get:()=>x.modelValue,set:o=>c("update:modelValue",o)}),n=i(!1),f=i(!1),k=i("");U(()=>`${P("Valider la prestation")}`);function y(){f.value=!0,_.validateItem(u.value.id,k.value).then(o=>{u.value=o.data,n.value=!1,S.showSuccess(P("Prestation validée avec succès"))}).catch(o=>{f.value=!1,S.showError(o.message)}).then(()=>{f.value=!1})}return(o,v)=>(h(),C(X,{modelValue:n.value,"onUpdate:modelValue":v[3]||(v[3]=r=>n.value=r),"max-width":"500px"},{activator:t(({props:r})=>[e(w,Q({dark:""},r,{variant:"elevated",color:"primary",onClick:v[0]||(v[0]=b=>f.value=!1)}),{default:t(()=>[m(a(u.value.status==p(_).statuses.cancelled?o.$t("Rouvrir la prestation"):o.$t("Valider la prestation")),1)]),_:2},1040)]),default:t(()=>[e(T,null,{default:t(()=>[e(K,{class:"text-h5 text-center py-6"},{default:t(()=>[m(a(u.value.status==p(_).statuses.cancelled?o.$t("Rouvrir la prestation"):o.$t("Valider la prestation")),1)]),_:1}),e(B),e(M,null,{default:t(()=>[e(E,null,{default:t(()=>[e(g,{cols:"12",class:"text-center"},{default:t(()=>[m(a(u.value.status==p(_).statuses.cancelled?o.$t("Êtes-vous sûr de vouloir Rouvrir la prestation"):o.$t("Êtes-vous sûr de vouloir Valider la prestation?")),1)]),_:1}),u.value.status==p(_).statuses.cancelled?(h(),C(g,{key:0,cols:"12"},{default:t(()=>[e(ie,{modelValue:k.value,"onUpdate:modelValue":v[1]||(v[1]=r=>k.value=r),placeholder:o.$t("Commentaire"),label:o.$t("Commentaire")},null,8,["modelValue","placeholder","label"])]),_:1})):I("",!0)]),_:1})]),_:1}),e(B),e(W,null,{default:t(()=>[e(D),e(w,{color:"error",variant:"flat",dark:"",onClick:v[2]||(v[2]=r=>n.value=!1)},{default:t(()=>[m(a(o.$t("Non")),1)]),_:1}),e(w,{color:"success",variant:"flat",loading:f.value,dark:"",onClick:y},{default:t(()=>[m(a(o.$t("Oui")),1)]),_:1},8,["loading"]),e(D)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ze={key:1},re=H({__name:"ServiceForm",props:{modelValue:Object,prestation:Object,isNew:{type:Boolean,default:!1},title:P("Service"),buttonText:P("Ajouter un service")},emits:["update:modelValue","update:item"],setup(j,{emit:l}){const _=F(),S=z(),x=fe(),c=j,u=l,n=U({get:()=>c.modelValue,set:r=>u("update:modelValue",r)}),f=i(!1),k=i(!1),y=i([]);de(()=>{x.fetchItems({per_page:500,prestation:c.prestation.id}).then(r=>{y.value=r.data.data,console.log(y.value)})});function o(){k.value=!0,_.saveService(c.prestation.id,n.value).then(r=>{f.value=!1,u("update:item",r.data),c.isNew&&(n.value={}),S.showSuccess(P("Service enregistré avec succès"))}).catch(r=>{k.value=!1,S.showError(r.message)}).then(()=>{k.value=!1})}function v(r){if(console.log("service",r),r){const b=y.value.find(L=>L.name==r);b&&(n.value.quantity=n.value.quantity||1,n.value.service_id=b.id||null,n.value.price=b.price||0,n.value.total=(n.value.quantity||1)*(b.price||0))}}return(r,b)=>{const L=Y("EditIcon");return h(),C(X,{modelValue:f.value,"onUpdate:modelValue":b[5]||(b[5]=A=>f.value=A),"max-width":"500px"},{activator:t(({props:A})=>[e(w,Q({dark:""},A,{icon:n.value.id!=null,flat:n.value.id!=null,variant:"elevated",color:n.value.id!=null?null:"primary",onClick:b[0]||(b[0]=d=>k.value=!1)}),{default:t(()=>[n.value.id?(h(),C(L,{key:0,"stroke-width":"1.5",size:"20",class:"text-primary",density:"compact"})):(h(),O("span",ze,a(j.buttonText),1))]),_:2},1040,["icon","flat","color"])]),default:t(()=>[e(T,null,{default:t(()=>[e(K,{class:"text-h5 text-center py-6"},{default:t(()=>[m(a(j.title),1)]),_:1}),e(B),e(M,null,{default:t(()=>[e(E,null,{default:t(()=>[e(g,{cols:"12"},{default:t(()=>[e(_e,{modelValue:n.value.name,"onUpdate:modelValue":[b[1]||(b[1]=A=>n.value.name=A),v],label:r.$t("Service"),clearable:"",items:y.value,"item-title":"name","item-value":"name",filled:!1,variant:"outlined"},null,8,["modelValue","label","items"])]),_:1}),e(g,{cols:"12",md:"6"},{default:t(()=>[e(oe,{min:1,modelValue:n.value.quantity,"onUpdate:modelValue":b[2]||(b[2]=A=>n.value.quantity=A),type:"number",label:r.$t("Quantité")},null,8,["modelValue","label"])]),_:1}),e(g,{cols:"12",md:"6"},{default:t(()=>[e(oe,{min:0,modelValue:n.value.price,"onUpdate:modelValue":b[3]||(b[3]=A=>n.value.price=A),type:"number",label:r.$t("Prix")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),e(W,null,{default:t(()=>[e(D),e(w,{color:"error",variant:"flat",dark:"",onClick:b[4]||(b[4]=A=>f.value=!1)},{default:t(()=>[m(a(r.$t("Annuler")),1)]),_:1}),e(w,{color:"success",variant:"flat",loading:k.value,dark:"",onClick:o},{default:t(()=>[m(a(r.$t("Ajouter")),1)]),_:1},8,["loading"]),e(D)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Qe=H({__name:"DeleteService",props:{modelValue:Object,service:Object},emits:["update:modelValue"],setup(j,{emit:l}){const _=F(),S=z(),x=j,c=l,u=U({get:()=>x.modelValue,set:y=>c("update:modelValue",y)}),n=i(!1),f=i(!1);function k(){f.value=!0,_.deleteService(u.value.id,x.service.id).then(y=>{u.value=y.data,n.value=!1,S.showSuccess(P("Service supprimé avec succès"))}).then(()=>{n.value=!1,f.value=!1})}return(y,o)=>{const v=Y("TrashIcon");return h(),C(X,{modelValue:n.value,"onUpdate:modelValue":o[2]||(o[2]=r=>n.value=r),"max-width":"350px"},{activator:t(({props:r})=>[e(w,Q({icon:"",flat:"",class:"ml-3",dark:""},r,{onClick:o[0]||(o[0]=b=>f.value=!1)}),{default:t(()=>[e(v,{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040)]),default:t(()=>[e(T,null,{default:t(()=>[e(K,{class:"text-h5 text-center py-6"},{default:t(()=>[m(a(y.$t("Êtes-vous sûr de vouloir supprimer le service?")),1)]),_:1}),e(W,null,{default:t(()=>[e(D),e(w,{color:"error",variant:"flat",dark:"",onClick:o[1]||(o[1]=r=>n.value=!1)},{default:t(()=>[m(a(y.$t("Non")),1)]),_:1}),e(w,{color:"success",variant:"flat",loading:f.value,dark:"",onClick:k},{default:t(()=>[m(a(y.$t("Oui")),1)]),_:1},8,["loading"]),e(D)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Ke=H({__name:"DeletePayment",props:{modelValue:Object,payment:Object},emits:["update:modelValue"],setup(j,{emit:l}){const _=F(),S=z(),x=j,c=l,u=U({get:()=>x.modelValue,set:y=>c("update:modelValue",y)}),n=i(!1),f=i(!1);function k(){f.value=!0,_.deletePayment(x.payment.prestation_id,x.payment.id).then(y=>{u.value=y.data,n.value=!1,S.showSuccess(P("Paiement supprimé avec succès"))}).then(()=>{n.value=!1,f.value=!1})}return(y,o)=>{const v=Y("TrashIcon");return h(),C(X,{modelValue:n.value,"onUpdate:modelValue":o[2]||(o[2]=r=>n.value=r),"max-width":"350px"},{activator:t(({props:r})=>[e(w,Q({icon:"",flat:"",class:"ml-3",dark:""},r,{onClick:o[0]||(o[0]=b=>f.value=!1)}),{default:t(()=>[e(v,{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040)]),default:t(()=>[e(T,null,{default:t(()=>[e(K,{class:"text-h5 text-center py-6"},{default:t(()=>[m(a(y.$t("Êtes-vous sûr de vouloir supprimer le paiement?")),1)]),_:1}),e(W,null,{default:t(()=>[e(D),e(w,{color:"error",variant:"flat",dark:"",onClick:o[1]||(o[1]=r=>n.value=!1)},{default:t(()=>[m(a(y.$t("Non")),1)]),_:1}),e(w,{color:"success",variant:"flat",loading:f.value,dark:"",onClick:k},{default:t(()=>[m(a(y.$t("Oui")),1)]),_:1},8,["loading"]),e(D)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),We=H({__name:"CommentPrestation",props:{modelValue:Object},emits:["update:modelValue"],setup(j,{emit:l}){const _=F(),S=z(),x=j,c=l,u=U({get:()=>x.modelValue,set:o=>c("update:modelValue",o)}),n=i(!1),f=i(!1);i(u.value.comment||"");const k=ye({extensions:[$e],content:u.value.comment});U(()=>`${P("Commentaire")}`);function y(){var o;f.value=!0,_.addComment(u.value.id,(o=k.value)==null?void 0:o.getHTML()).then(v=>{u.value=v.data,n.value=!1,S.showSuccess(P("Commentaire ajouté avec succès")),c("saved",v.data)}).catch(v=>{f.value=!1,S.showError(v.message)}).then(()=>{f.value=!1})}return(o,v)=>(h(),C(X,{modelValue:n.value,"onUpdate:modelValue":v[2]||(v[2]=r=>n.value=r),"max-width":"1000px"},{activator:t(({props:r})=>[e(w,Q({density:"compact",dark:""},r,{variant:"outlined",color:"primary",onClick:v[0]||(v[0]=b=>f.value=!1)}),{default:t(()=>[m(a(!u.value.comment||u.value.comment.length==0?o.$t("Ajouter"):o.$t("Modifier")),1)]),_:2},1040)]),default:t(()=>[e(T,null,{default:t(()=>[e(K,{class:"text-h5 text-center py-6"},{default:t(()=>[m(a(!u.value.comment||u.value.comment.length==0?o.$t("Ajouter un commentaire"):o.$t("Modifier le commentaire")),1)]),_:1}),e(B),e(M,null,{default:t(()=>[e(E,null,{default:t(()=>[e(g,{cols:"12"},{default:t(()=>[s("label",null,a(o.$t("Commentaire")),1),e(ge,{editor:p(k)},null,8,["editor"]),e(p(be),{editor:p(k)},null,8,["editor"])]),_:1})]),_:1})]),_:1}),e(B),e(W,null,{default:t(()=>[e(D),e(w,{color:"error",variant:"flat",dark:"",onClick:v[1]||(v[1]=r=>n.value=!1)},{default:t(()=>[m(a(o.$t("Annuler")),1)]),_:1}),e(w,{color:"success",variant:"flat",loading:f.value,dark:"",onClick:y},{default:t(()=>[m(a(o.$t("Enregistrer")),1)]),_:1},8,["loading"]),e(D)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Xe={key:0,class:"ml-2"},Ze={class:"d-flex align-start"},Ge={class:"text-h4 mt-1"},Je={class:"ml-auto"},Ye={class:"mt-9"},et={class:"text-h4 font-weight-semibold mb-1"},tt={class:"d-flex align-start"},at={class:"text-h4 mt-1"},lt={class:"ml-auto"},st={class:"mt-9"},ot={class:"text-h4 font-weight-semibold mb-1"},nt={class:"d-flex align-start"},ut={class:"text-h4 mt-1"},rt={class:"mt-4"},dt=["innerHTML"],it={class:"d-flex align-start"},mt={class:"text-h4 mt-1"},ct={class:"mt-4"},vt=["innerHTML"],pt={class:"d-flex align-start"},ft={class:"text-h4 mt-1"},_t={class:"mt-4"},ht=["innerHTML"],Vt={class:"text-h6 d-flex align-center"},yt={class:"text-h6"},$t={class:"text-h6"},gt={class:"text-h6"},bt={class:"text-h6"},kt={class:"text-h6"},Ct={class:"d-flex align-center"},St={class:"text-h6 d-flex align-center"},wt={class:"mr-2"},xt={class:"text-h6"},jt={class:"text-h6"},Pt={class:"text-h6"},Ut={class:"text-h6"},oa=H({__name:"View",setup(j){i(),z();const l=i({id:null,status:0,service:"",demand_date:null,customer_id:null,demand_id:null,payments:[],services:[],customer:{id:null,firstname:"",lastname:"",email:"",phone:"",is_customer:!1,created_at:null,demands:[],prestations:[]}}),_=F(),S=me(),x=i({title:P("Détails du prestation")+" "+(l.value.eventtype&&l.value.eventtype.name||"")+" "+(l.value.customer||{firstname:""}).firstname+" "+(l.value.customer||{lastname:""}).lastname+" "+(N(l.value.demand_date)||"")}),c=i([{text:P("Dashboard"),disabled:!1,href:"/"},{text:P("Prestations"),disabled:!1,href:"/prestations"},{text:l.value.eventtype?l.value.eventtype.name:"",disabled:!0,href:"#"}]);function u(){x.value={title:P("Prestation")+" "+(l.value.eventtype&&l.value.eventtype.name||"")+" ("+(l.value.customer||{firstname:""}).firstname+" "+(l.value.customer||{lastname:""}).lastname+" "+(N(l.value.event_date)||"")+")"},c.value=[{text:P("Dashboard"),disabled:!1,href:"/"},{text:P("Prestations"),disabled:!1,href:"/prestations"},{text:x.value.title,disabled:!0,href:"#"}]}de(()=>{L()});const n=i(!1);i(!1),i(!1),i(!1),i(!1),i(!1),i(!1),i({}),i({}),i(!1),i(10),i(2),i(2),i(!1),i(!1),i(null);const f=i("");i(["primary","secondary","error","success","warning"]),i([{key:"demand_date",order:"DESC"}]),i(0),i({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"demand_date",order:"DESC"}]});const k=i(-1);i({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});const y=i({id:null,service_id:null,name:"",price:0,total:0,quantity:0}),o=i({id:null,prestation_id:null,amount:0});i({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""}),i(!1),i([{title:"Prestation",align:"start",key:"eventtype.name"},{title:"Date de la prestation",align:"start",key:"demand_date"},{title:"Status",align:"start",key:"status"},{title:"Actions",key:"actions",sortable:!1}]),U(()=>_.prestations.data.filter(d=>d.email.toLowerCase().includes(f.value.toLowerCase())));const v=U(()=>S.params.id);U(()=>l.value.customer.prestations?l.value.customer.prestations.filter(d=>d.id!=l.value.id):[]);const r=U(()=>l.value.services&&l.value.services.length?l.value.services.reduce((d,V)=>(console.log(V.total,d),parseFloat(V.total)+parseFloat(d)),0):0),b=U(()=>l.value.payments&&l.value.payments.length?r.value-l.value.payments.reduce((d,V)=>parseFloat(V.amount)+parseFloat(d),0):r.value);U(()=>k.value===-1?"Nouvel administrateur":"Modifier l’administrateur");function L(){n.value=!0,_.fetchItem(S.params.id).then(d=>{d.data.error||(n.value=!1,l.value=d.data,l.value.payments=(l.value.payments||[]).map(V=>{const G=V.payment_date!=null?new Date(V.payment_date):null;return{...V,payment_date:G}}),u())}).catch(d=>{n.value=!1}).then(()=>{n.value=!1})}function A(d){l.value=d,y.value={id:null,service_id:null,name:"",price:0,total:0,quantity:0}}return ce(v,(d,V)=>{d!=V&&L()},{deep:!0}),(d,V)=>{const G=Y("CurrencyEuroIcon");return h(),O(te,null,[n.value?I("",!0):(h(),C(pe,{key:0,title:x.value.title,breadcrumbs:c.value},null,8,["title","breadcrumbs"])),n.value?(h(),C(E,{key:1,justify:"center",align:"center","align-content":"center"},{default:t(()=>[e(g,{cols:"12",justify:"center",align:"center","align-content":"center"},{default:t(()=>[e(ve,{indeterminate:"",color:"primary",size:"150"})]),_:1})]),_:1})):(h(),C(E,{key:2},{default:t(()=>[e(g,{cols:"12",md:"2"},{default:t(()=>[m(a(d.$t("Status :"))+" ",1),e(ae,{rounded:"md",class:"font-weight-bold",color:p(_).statusColor(l.value.status),size:"small",label:""},{default:t(()=>[m(a(p(_).statusText(l.value.status)),1)]),_:1},8,["color"]),l.value.status==p(_).statuses.cancelled?(h(),O("span",Xe,a(d.$t("Le"))+" "+a(p(N)(l.value.cancelled_date)||""),1)):I("",!0)]),_:1}),e(g,{cols:"12",md:"10",justify:"end","align-content":"end",align:"end"},{default:t(()=>[!n.value&&(l.value.status==p(_).statuses.started||l.value.status==p(_).statuses.cancelled)?(h(),C(Re,{key:0,modelValue:l.value,"onUpdate:modelValue":V[0]||(V[0]=$=>l.value=$)},null,8,["modelValue"])):I("",!0),n.value?I("",!0):(h(),C(he,{key:1,modelValue:l.value,"onUpdate:modelValue":V[1]||(V[1]=$=>l.value=$),onSaved:L},null,8,["modelValue"])),l.value.status==p(_).statuses.validated?(h(),C(Ve,{key:2,modelValue:l.value,"onUpdate:modelValue":V[2]||(V[2]=$=>l.value=$)},null,8,["modelValue"])):I("",!0),l.value.status!=p(_).statuses.cancelled?(h(),C(He,{key:3,modelValue:l.value,"onUpdate:modelValue":V[3]||(V[3]=$=>l.value=$)},null,8,["modelValue"])):I("",!0),e(B,{vertical:""}),e(w,{variant:"elevated",color:"success",class:"ml-2",to:"/customers/"+l.value.customer_id},{default:t(()=>[m(a(d.$t("Voir le Client")),1)]),_:1},8,["to"])]),_:1}),e(g,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:l.value,"onUpdate:modelValue":V[4]||(V[4]=$=>l.value=$),"show-demand-info":"",source:l.value.source},null,8,["modelValue","source"])]),_:1}),e(g,{cols:"12",md:"3"},{default:t(()=>[e(ke,{modelValue:l.value,"onUpdate:modelValue":V[5]||(V[5]=$=>l.value=$),"show-demand-info":""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"6",class:"justify-end align-end"},{default:t(()=>[e(E,{class:"align-end justify-end align-content-end"},{default:t(()=>[e(g,{cols:"12",class:"align-end justify-end align-content-end"},{default:t(()=>[e(E,{class:"align-end justify-end align-content-end"},{default:t(()=>[l.value.status>=p(_).statuses.validated?(h(),C(g,{key:0,cols:"12",md:"6",class:""},{default:t(()=>[e(T,{elevation:"10"},{default:t(()=>[e(M,null,{default:t(()=>[s("div",Ze,[s("h2",Ge,a(d.$t("Reste à payer")),1),e(D),s("div",Je,[e(w,{color:"primary",icon:"",flat:""},{default:t(()=>[e(G)]),_:1})])]),s("div",Ye,[s("h2",et,a(p(q)(b.value)),1)])]),_:1})]),_:1})]),_:1})):I("",!0),e(g,{cols:"12",md:"6"},{default:t(()=>[e(T,{elevation:"10"},{default:t(()=>[e(M,null,{default:t(()=>[s("div",tt,[s("h2",at,a(d.$t("Montant total")),1),e(D),s("div",lt,[e(w,{color:"primary",icon:"",flat:""},{default:t(()=>[e(G)]),_:1})])]),s("div",st,[s("h2",ot,a(p(q)(l.value.payment_total||0))+"/"+a(p(q)(r.value||0)),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",class:"align-end justify-end align-content-end"},{default:t(()=>[e(E,{class:"align-end justify-end align-content-end"},{default:t(()=>[e(g,{class:"h-100",cols:"12"},{default:t(()=>[e(E,null,{default:t(()=>[e(g,{cols:"12"},{default:t(()=>[e(T,{elevation:"10",class:"h-100"},{default:t(()=>[e(M,null,{default:t(()=>[s("div",nt,[s("h2",ut,a(d.$t("Commentaire")),1),e(We,{modelValue:l.value,"onUpdate:modelValue":V[6]||(V[6]=$=>l.value=$),onSaved:L},null,8,["modelValue"])]),s("div",rt,[s("div",{class:"formatted-text mb-1",innerHTML:l.value.comment||d.$t("Aucun commentaire")},null,8,dt)])]),_:1})]),_:1})]),_:1}),l.value.demand&&l.value.demand.comment?(h(),C(g,{key:0,cols:"12"},{default:t(()=>[e(T,{elevation:"10",class:"h-100"},{default:t(()=>[e(M,null,{default:t(()=>[s("div",it,[s("h2",mt,a(d.$t("Commentaire client")),1)]),s("div",ct,[s("div",{class:"formatted-text mb-1",innerHTML:l.value.demand.comment||d.$t("Aucun commentaire")},null,8,vt)])]),_:1})]),_:1})]),_:1})):I("",!0)]),_:1})]),_:1}),l.value.status==p(_).statuses.cancelled?(h(),C(g,{key:0,cols:"12"},{default:t(()=>[e(T,{elevation:"10",class:"h-100"},{default:t(()=>[e(M,null,{default:t(()=>[s("div",pt,[s("h2",ft,a(d.$t("Raison de l'annulation")),1)]),s("div",_t,[s("div",{class:"mb-1",innerHTML:(l.value.cancel_comment||d.$t("Aucun commentaire")).replace(/\n/g,"<br/>")},null,8,ht)])]),_:1})]),_:1})]),_:1})):I("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",lg:l.value.status>p(_).statuses.started?"6":"12"},{default:t(()=>[e(T,{elevation:"10",class:"overflow-hidden h-100"},{default:t(()=>[e(J,{class:"py-4 px-6 text-white bg-info"},{default:t(()=>[s("h4",Vt,[s("span",null,a(d.$t("Désignation des services attendus")),1),m(" : "+a(l.value.services?l.value.services.length:0)+" - "+a(p(q)(r.value||0))+" ",1),e(D),e(re,{modelValue:y.value,"onUpdate:modelValue":V[7]||(V[7]=$=>y.value=$),prestation:l.value,"is-new":"","onUpdate:item":A,"button-text":d.$t("Ajouter un service"),title:d.$t("Ajouter un service")},null,8,["modelValue","prestation","button-text","title"])])]),_:1}),e(M,{class:"pa-6"},{default:t(()=>[e(se,{class:"month-table"},{default:t(()=>[s("thead",null,[s("tr",null,[s("th",yt,a(d.$t("Désignation")),1),s("th",$t,a(d.$t("Quantité")),1),s("th",gt,a(d.$t("Prix unitaire")),1),s("th",bt,a(d.$t("Prix total")),1),s("th",kt,a(d.$t("Actions")),1)])]),s("tbody",null,[(h(!0),O(te,null,le(l.value.services,($,R)=>(h(),O("tr",{key:$.id,class:"month-item"},[s("td",null,a($.service_name),1),s("td",null,a($.quantity),1),s("td",null,a(p(q)($.price)),1),s("td",null,a(p(q)($.total)),1),s("td",null,[s("div",Ct,[e(ue,{text:d.$t("Modifier")},{activator:t(({props:Z})=>[e(re,{modelValue:l.value.services[R],"onUpdate:modelValue":ee=>l.value.services[R]=ee,prestation:l.value,"onUpdate:item":A,"button-text":d.$t("Modifier le service"),title:d.$t("Modifier le service")},null,8,["modelValue","onUpdate:modelValue","prestation","button-text","title"])]),_:2},1032,["text"]),e(Qe,{modelValue:l.value,"onUpdate:modelValue":V[8]||(V[8]=Z=>l.value=Z),service:l.value.services[R]},null,8,["modelValue","service"])])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["lg"]),l.value.status>p(_).statuses.started?(h(),C(g,{key:0,cols:"12",lg:l.value.status>p(_).statuses.started?"6":"12"},{default:t(()=>[e(T,{elevation:"10",class:"overflow-hidden h-100"},{default:t(()=>[e(J,{class:"py-4 px-6 text-white bg-info"},{default:t(()=>[s("h4",St,[s("span",wt,a(d.$t("Paiements")),1),m(" : "+a(l.value.payments.length)+" - "+a(p(q)(l.value.payment_total||0))+" ",1),e(D),e(ne,{prestation:l.value,"onUpdate:item":A,"button-text":d.$t("Ajouter un paiement"),title:d.$t("Ajouter un paiement")},null,8,["prestation","button-text","title"])])]),_:1}),e(M,{class:"pa-6"},{default:t(()=>[e(se,{class:"month-table"},{default:t(()=>[s("thead",null,[s("tr",null,[s("th",xt,a(d.$t("Mode de paiement")),1),s("th",jt,a(d.$t("Montant payé")),1),s("th",Pt,a(d.$t("Date du paiement")),1),s("th",Ut,a(d.$t("Actions")),1)])]),s("tbody",null,[(h(!0),O(te,null,le(l.value.payments,($,R)=>(h(),O("tr",{key:o.value.id},[s("td",null,a($.payment_method_name||$.payment_method),1),s("td",null,a(p(q)($.amount)),1),s("td",null,a(p(N)($.payment_date)),1),s("td",null,[e(ue,{text:d.$t("Modifier")},{activator:t(({props:Z})=>[e(ne,{modelValue:l.value.payments[R],"onUpdate:modelValue":ee=>l.value.payments[R]=ee,icon:"",prestation:l.value,"onUpdate:item":A,"button-text":d.$t("Modifier le paiement"),title:d.$t("Modifier le paiement")},null,8,["modelValue","onUpdate:modelValue","prestation","button-text","title"])]),_:2},1032,["text"]),e(Ke,{modelValue:l.value,"onUpdate:modelValue":V[9]||(V[9]=Z=>l.value=Z),payment:l.value.payments[R]},null,8,["modelValue","payment"])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["lg"])):I("",!0)]),_:1}))],64)}}});export{oa as default};
