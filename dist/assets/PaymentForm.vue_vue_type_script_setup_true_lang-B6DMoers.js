import{a6 as E,av as O,e as h,r as f,aK as b,h as R,o as C,_ as P,w as a,b as e,d as m,t as s,n as T,V as k,Z,a4 as G,aJ as X,g as Y,bk as ee,c as ae}from"./index-h9IiG_-T.js";import{u as F}from"./Controller-Z-himAVM.js";import{u as te}from"./hall-CNs7vbzt.js";import{b as B,V as N,c as H,a as z}from"./VCard-C9dFD9Yz.js";import{f as U}from"./VMenu-BYBTgcd3.js";import{a as K,V as M}from"./VRow-BEixVOdv.js";import{b as le}from"./VSelect-GKXwlEMC.js";import{a as S}from"./VSpacer-CNgfAsoG.js";import{V as j}from"./VDialog-WGK0BhCE.js";import{u as oe}from"./paymentMethod-ZTtLPp6u.js";import{V as ne}from"./VAutocomplete-BU_ek7jQ.js";import{V as J}from"./VTextField-Cqmmurw0.js";import{V as ue}from"./VLocaleProvider-BkoSRPIy.js";import{V as re}from"./VDatePicker-BtFjP-ik.js";const be=E({__name:"ChangeHall",props:{modelValue:Object},emits:["update:modelValue"],setup(V,{emit:D}){const A=F(),$=O(),I=te(),w=V,d=D,y=h({get:()=>w.modelValue,set:n=>d("update:modelValue",n)}),p=f(!1),t=f(!1);f("");const u=f(y.value.hall_id||null),i=f([]);h(()=>`${b("Modifier la salle")}`);function g(){t.value=!0,A.changeHall(y.value.id,u.value).then(n=>{y.value=n.data,p.value=!1,$.showSuccess(b("Salle changée avec succès")),d("refresh",n.data)}).catch(n=>{t.value=!1,$.showError(n.message)}).then(()=>{t.value=!1})}return R(()=>{I.fetchItems({per_page:1e3}).then(n=>{i.value=n.data.data})}),(n,c)=>(C(),P(j,{modelValue:p.value,"onUpdate:modelValue":c[3]||(c[3]=v=>p.value=v),"max-width":"500px"},{activator:a(({props:v})=>[e(k,T({dark:""},v,{variant:"tonal",density:"compact",onClick:c[0]||(c[0]=L=>t.value=!1)}),{default:a(()=>[m(s(n.$t("Modifier")),1)]),_:2},1040)]),default:a(()=>[e(z,null,{default:a(()=>[e(B,{class:"text-h5 text-center py-6"},{default:a(()=>[m(s(n.$t("Modifier la salle")),1)]),_:1}),e(U),e(N,null,{default:a(()=>[e(K,null,{default:a(()=>[e(M,{cols:"12"},{default:a(()=>[e(M,{cols:"12"},{default:a(()=>[e(le,{modelValue:u.value,"onUpdate:modelValue":c[1]||(c[1]=v=>u.value=v),items:i.value,"item-value":"id","item-title":"name",label:n.$t("Salle liée")},null,8,["modelValue","items","label"])]),_:1})]),_:1})]),_:1})]),_:1}),e(U),e(H,null,{default:a(()=>[e(S),e(k,{color:"error",variant:"flat",dark:"",onClick:c[2]||(c[2]=v=>p.value=!1)},{default:a(()=>[m(s(n.$t("Annuller")),1)]),_:1}),e(k,{color:"success",variant:"flat",loading:t.value,dark:"",onClick:g},{default:a(()=>[m(s(n.$t("Enregistrer")),1)]),_:1},8,["loading"]),e(S)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Se=E({__name:"ClosePrestation",props:{modelValue:Object,icon:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(V,{emit:D}){const A=F(),$=O(),I=V,w=D,d=h({get:()=>I.modelValue,set:u=>w("update:modelValue",u)}),y=f(!1),p=f(!1);f(""),h(()=>`${b("Terminer la prestation")}`);function t(){p.value=!0,A.closeItem(d.value.id).then(u=>{d.value=u.data,y.value=!1,$.showSuccess(b("Prestation clôturée avec succès")),w("refresh")}).catch(u=>{p.value=!1,$.showError(u.message)}).then(()=>{p.value=!1})}return(u,i)=>{const g=Z("CheckIcon");return C(),P(j,{modelValue:y.value,"onUpdate:modelValue":i[2]||(i[2]=n=>y.value=n),"max-width":"500px"},{activator:a(({props:n})=>[e(k,T({dark:""},n,{variant:"elevated",color:"primary",onClick:i[0]||(i[0]=c=>p.value=!1),icon:V.icon}),{default:a(()=>[m(s(V.icon?"":u.$t("Terminer la prestation"))+" ",1),V.icon?(C(),P(g,{key:0,"stroke-width":"1.5",size:"20"})):G("",!0)]),_:2},1040,["icon"])]),default:a(()=>[e(z,null,{default:a(()=>[e(B,{class:"text-h5 text-center py-6"},{default:a(()=>[m(s(u.$t("Terminer la prestation")),1)]),_:1}),e(U),e(N,null,{default:a(()=>[e(K,null,{default:a(()=>[e(M,{cols:"12",class:"text-center"},{default:a(()=>[m(s(u.$t("Êtes-vous sûr de vouloir terminer la prestation?")),1)]),_:1})]),_:1})]),_:1}),e(U),e(H,null,{default:a(()=>[e(S),e(k,{color:"error",variant:"flat",dark:"",onClick:i[1]||(i[1]=n=>y.value=!1)},{default:a(()=>[m(s(u.$t("Non")),1)]),_:1}),e(k,{color:"success",variant:"flat",loading:p.value,dark:"",onClick:t},{default:a(()=>[m(s(u.$t("Oui")),1)]),_:1},8,["loading"]),e(S)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),se={key:1},we=E({__name:"PaymentForm",props:{modelValue:Object,prestation:Object,title:b("PaymentMethod"),variant:{type:String,default:"elevated"},buttonText:b("Ajouter un paymentMethod")},emits:["update:modelValue","update:item"],setup(V,{emit:D}){const A=F(),$=O(),I=oe(),w=X(),d=V,y=D,p=h({get:()=>d.modelValue,set:o=>y("update:modelValue",o)}),t=f(p.value||{id:null,prestation_id:null,amount:0,payment_date:new Date}),u=f(!1),i=f(!1),g=f(!1),n=f([]);R(()=>{I.fetchItems({per_page:500}).then(o=>{n.value=o.data.data,console.log(n.value)}),t.value.id||(t.value.amount=v.value)});const c=h(()=>d.prestation.services?d.prestation.services.reduce((o,l)=>(console.log(l.total,o),parseFloat(l.total)+parseFloat(o)),0):0),v=h(()=>d.prestation.payments&&d.prestation.payments.length?c.value-d.prestation.payments.reduce((o,l)=>parseFloat(l.amount)+parseFloat(o),0):c.value);function L(){g.value=!0,A.savePayment(d.prestation.id,t.value).then(o=>{u.value=!1,y("update:item",o.data),$.showSuccess(b("Paiement enregistré avec succès"))}).catch(o=>{g.value=!1,$.showError(o.message)}).then(()=>{g.value=!1})}function Q(o){if(console.log(v.value),o){const l=n.value.find(x=>x.id==o);l&&(t.value.payment_method=l.name||null,t.value.id||(t.value.amount=v.value))}}const q=h(()=>t.value.payment_date?w.format(t.value.payment_date,"shortDate"):null);function W(){g.value=!1,t.value.id||(t.value={payment_date:new Date,amount:v.value})}return Y([d.prestation],o=>{console.log("prestat",o),t.value.id||(t.value.amount=v.value)},{deep:!0}),(o,l)=>{const x=Z("EditIcon");return C(),P(j,{modelValue:u.value,"onUpdate:modelValue":l[10]||(l[10]=r=>u.value=r),"max-width":"500px"},{activator:a(({props:r})=>[v.value>0?(C(),P(k,T({key:0,dark:""},r,{icon:t.value.id!=null,flat:t.value.id!=null,variant:V.variant,color:t.value.id!=null?null:"primary",onClick:W}),{default:a(()=>[ee(o.$slots,"default",{},()=>[t.value.id?(C(),P(x,{key:0,"stroke-width":"1.5",size:"20",class:"text-primary"})):(C(),ae("span",se,s(V.buttonText),1))])]),_:2},1040,["icon","flat","variant","color"])):G("",!0)]),default:a(()=>[e(z,null,{default:a(()=>[e(B,{class:"text-h5 text-center py-6"},{default:a(()=>[m(s(V.title),1)]),_:1}),e(U),e(N,null,{default:a(()=>[e(K,null,{default:a(()=>[e(M,{cols:"12"},{default:a(()=>[e(ne,{modelValue:t.value.payment_method_id,"onUpdate:modelValue":[l[0]||(l[0]=r=>t.value.payment_method_id=r),Q],label:o.$t("PaymentMethod"),clearable:"",items:n.value,"item-title":"name","item-value":"id",filled:!1,variant:"outlined",required:""},null,8,["modelValue","label","items"])]),_:1}),e(M,{cols:"12",md:"6"},{default:a(()=>[e(j,{ref:"dialogDemandDate",modelValue:i.value,"onUpdate:modelValue":l[6]||(l[6]=r=>i.value=r),"return-value":t.value.payment_date,"onUpdate:returnValue":l[7]||(l[7]=r=>t.value.payment_date=r),persistent:"",width:"290px"},{activator:a(({props:r})=>[e(J,T({modelValue:q.value,"onUpdate:modelValue":l[1]||(l[1]=_=>q.value=_)},r,{placeholder:o.$t("Date de la demande"),"hide-details":"",clearable:"",readonly:"","onClick:clear":l[2]||(l[2]=_=>t.value.payment_date=null)}),null,16,["modelValue","placeholder"])]),default:a(({isActive:r})=>[e(ue,{locale:"fr"},{default:a(()=>[e(re,{modelValue:t.value.payment_date,"onUpdate:modelValue":l[5]||(l[5]=_=>t.value.payment_date=_),"hide-header":""},{actions:a(()=>[e(k,{color:"primary",onClick:l[3]||(l[3]=_=>i.value=!1)},{default:a(()=>[m(s(o.$t("Annuler")),1)]),_:1}),e(S),e(k,{variant:"elevated",color:"primary",onClick:l[4]||(l[4]=_=>i.value=!1)},{default:a(()=>[m(s(o.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),e(M,{cols:"12",md:"6"},{default:a(()=>[e(J,{min:0,modelValue:t.value.amount,"onUpdate:modelValue":l[8]||(l[8]=r=>t.value.amount=r),type:"number",label:o.$t("Montant")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),e(H,null,{default:a(()=>[e(S),e(k,{color:"error",variant:"flat",dark:"",onClick:l[9]||(l[9]=r=>u.value=!1)},{default:a(()=>[m(s(o.$t("Annuler")),1)]),_:1}),e(k,{color:"success",variant:"flat",loading:g.value,dark:"",onClick:L},{default:a(()=>[m(s(o.$t("Ajouter")),1)]),_:1},8,["loading"]),e(S)]),_:1})]),_:1})]),_:3},8,["modelValue"])}}});export{we as _,be as a,Se as b};
