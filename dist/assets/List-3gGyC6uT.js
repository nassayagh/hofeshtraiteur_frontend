import{u as ve}from"./Controller-CFZJqAPW.js";import{u as pe}from"./eventType-DgzgBPPE.js";import{a6 as ce,aJ as fe,r,av as ge,aK as o,aM as he,h as O,e as P,g as F,q as ye,o as G,c as H,b as a,w as l,a8 as d,n as q,V as _,d as p,t as u,a4 as _e,aV as be,a as Ve,X as ke}from"./index-BvY_KK37.js";import{_ as we}from"./BaseBreadcrumb-JNe3vVIz.js";import{f as z,a as A}from"./formatters-Dv1Ro_l4.js";import{_ as J}from"./PrespationDashboard.vue_vue_type_script_setup_true_lang-BMevx4DH.js";import{V as b,a as X}from"./VRow-JhaKRwKT.js";import{V as Pe}from"./VDataTableServer-DKeMzeTI.js";import{V as xe}from"./VToolbar-C786uZEY.js";import{V as Q}from"./VTextField-DAGXS_38.js";import{d as Ce}from"./filter-CHRhSiFW.js";import{V as W}from"./VDialog-DbF35l8A.js";import{V as De}from"./VLocaleProvider-D1cRPeqR.js";import{V as $e}from"./VDatePicker-D5eDenAf.js";import{V as E}from"./VSpacer-DqSppLhG.js";import{V as Te,a as Se,c as Ue}from"./VCard-CybzrX-U.js";import{V as Y}from"./VChip-IrrnVGjy.js";import{f as Ie,e as Ae,c as Ee,a as Le}from"./VMenu-DosEEGXR.js";import"./VTable-BZFnbZpH.js";import"./VDivider-sdFwO9MC.js";import"./index-BDsYnmIN.js";import"./VAvatar-DuZ43bJv.js";import"./VField-SpXY9yFp.js";import"./createSimpleFunctional-AOvs76Pa.js";import"./VSheet-BKnmH7kZ.js";const Me={key:0,class:"text-error font-weight-bold"},dt=ce({__name:"List",setup(Be){const h=fe();r();const Z=ge(),ee=pe(),i=r({title:""}),c=r([{text:o("Dashboard"),disabled:!1,href:"/"},{text:o("Prestations"),disabled:!0,href:"#"}]),V=r([]),L=r([]),m=ve(),f=he(),g=r(0);O(()=>{R(),I(),ne()});const x=r(!1);r(!1);const M=r(null),C=r(!1),S=r(10),k=r(2),D=r(2),$=r(0),te=r(!1),U=r("");r(["primary","secondary","error","success","warning"]);const y=r([{key:"demand_date",order:"DESC"}]);r(0);const n=r({search:null,date:null,event_type:null}),w=r({itemsPerPage:10,rowsPerPage:10,page:1,sortDesc:[!0],sortBy:[{key:"demand_date",order:"DESC"}]}),ae=r(-1),B=r({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});r({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:""});const T=r(!1),N=r([{title:o("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:o("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:o("Email"),align:"start",key:"customer.email",sortable:!1},{title:o("Téléphone"),align:"start",key:"customer.phone",sortable:!1},{title:o("Prestation"),align:"start",key:"event_type"},{title:o("Date de la prestation"),align:"start",key:"event_date"},{title:o("Heure"),key:"demand.reception_start_time"},{title:o("Lieu"),key:"demand.event_location"},{title:o("Convives"),key:"demand.number_people"},{title:o("En attente de règlement"),align:"start",key:"amount_left",sortable:!1},{title:o("Montant total"),align:"start",key:"services_sum_total",sortable:!1},{title:o("Actions"),key:"actions",sortable:!1}]),le=r([{title:o("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:o("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:o("Email"),align:"start",key:"customer.email",sortable:!1},{title:o("Téléphone"),align:"start",key:"customer.phone",sortable:!1},{title:o("Prestation"),align:"start",key:"event_type"},{title:o("Date de la prestation"),align:"start",key:"event_date"},{title:o("Heure"),key:"demand.reception_start_time"},{title:o("Lieu"),key:"demand.event_location"},{title:o("Convives"),key:"demand.number_people"},{title:o("En attente de règlement"),align:"start",key:"amount_left",sortable:!1},{title:o("Montant total"),align:"start",key:"services_sum_total",sortable:!1},{title:o("Actions"),key:"actions",sortable:!1}]),se=P(()=>f.params.status),j=P(()=>n.value.date&&n.value.date.length>0?h.format(n.value.date[0],"shortDate")+" - "+h.format(n.value.date[n.value.date.length-1],"shortDate"):null);F(se,(s,t)=>{s!=t&&(R(),I())},{deep:!0}),P(()=>m.items.data.filter(s=>s.email.toLowerCase().includes(U.value.toLowerCase())));function oe(){m.deleteItem(B.value.id);const s=V.value.findIndex(t=>t.id==B.value.id);V.value.splice(s,1),T.value=!1,Z.showSuccess(o("Utilisateur supprimé avec succès"))}P(()=>ae.value===-1?"Nouvel administrateur":"Modifier l’administrateur");const re=P(()=>n.value.date&&n.value.date.length?n.value.date.length>1?[h.format(n.value.date[0],"shortDate"),h.format(n.value.date[n.value.date.length-1],"shortDate")]:[h.format(n.value.date[0],"shortDate"),h.format(n.value.date[0],"shortDate")]:null);function R(){switch(c.value=[{text:o("Dashboard"),disabled:!1,href:"/"}],V.value=[],$.value=0,f.params.status){case"started":i.value={title:o("Prestations en attente de validation")},c.value.push({text:i.value.title,disabled:!0,href:"#"}),g.value=m.statuses.started,N.value=le.value.filter(s=>s.key!="services_sum_total"&&s.key!="amount_left");break;case"validated":i.value={title:o("Prestations validées")},c.value.push({text:i.value.title,disabled:!0,href:"#"}),g.value=m.statuses.validated;break;case"processing":i.value={title:o("Prestations en cours")},c.value.push({text:i.value.title,disabled:!0,href:"#"}),g.value=m.statuses.processing;break;case"closed":i.value={title:o("Prestations clôturées")},c.value.push({text:i.value.title,disabled:!0,href:"#"}),g.value=m.statuses.closed;break;case"cancelled":i.value={title:o("Prestations annulées")},c.value.push({text:i.value.title,disabled:!0,href:"#"}),g.value=m.statuses.cancelled;break;default:i.value={title:o("Prestations en attente de validation")},c.value.push({text:i.value.title,disabled:!0,href:"#"}),g.value=m.statuses.started;break}}function I(){try{clearTimeout(M.value)}catch{}M.value=setTimeout(()=>{x.value=!0;let s="id",t="desc";console.log(y.value),y.value.length>0&&(s=y.value[0].key,t=y.value[0].order),m.fetchItems({term:U.value,paginate:S.value,current_page:k.value,status:g.value,direction:t,order_by:s,page:w.value.page,per_page:w.value.itemsPerPage,...n.value,date:re.value}).then(e=>{if(e.data){const{data:v,current_page:ue,next_page_url:ie,total:K,per_page:de,to:Ne,last_page:me}=e.data;V.value=v,D.value=me,$.value=K}}).catch(e=>{console.error(e)}).then(()=>{x.value=!1})},1e3)}function ne(){ee.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(s=>{if(s.data){const{data:t,current_page:e,next_page_url:v,total:ue,per_page:ie,to:K,last_page:de}=s.data;L.value=t}}).catch(s=>{console.error(s)}).then(()=>{x.value=!1})}return F([U,w,n],()=>{I()},{deep:!0}),ye(()=>{k.value>D.value&&(k.value=D.value)}),O(()=>{}),(s,t)=>(G(),H(ke,null,[a(we,{title:i.value.title,breadcrumbs:c.value},null,8,["title","breadcrumbs"]),a(X,null,{default:l(()=>[a(b,{cols:"12",md:"6"},{default:l(()=>[a(J,{md:"6","show-validation":d(f).params.status=="started","show-validated":d(f).params.status=="validated","show-processing":d(f).params.status=="processing","show-closed":d(f).params.status=="closed","show-cancelled":d(f).params.status=="cancelled","show-description":""},null,8,["show-validation","show-validated","show-processing","show-closed","show-cancelled"])]),_:1}),a(b,{cols:"12",md:"6"},{default:l(()=>[a(J,{"show-payments":"","show-description":""})]),_:1}),a(b,{cols:"12"},{default:l(()=>[a(Pe,{class:"border rounded-md",headers:N.value,loading:x.value,items:V.value,"multi-sort":!1,"items-per-page":S.value,"onUpdate:itemsPerPage":t[11]||(t[11]=e=>S.value=e),"items-per-page-text":s.$t("Articles par page"),options:w.value,"onUpdate:options":t[12]||(t[12]=e=>w.value=e),"sort-by":y.value,"onUpdate:sortBy":t[13]||(t[13]=e=>y.value=e),page:k.value,"onUpdate:page":t[14]||(t[14]=e=>k.value=e),"items-length":$.value,"onUpdate:itemsLength":t[15]||(t[15]=e=>$.value=e),"show-select":!1,"loading-text":s.$t("Chargement des éléments"),"no-data-text":s.$t("Pas de données"),"no-results-text":s.$t("Aucun résultat"),onPageCount:t[16]||(t[16]=e=>D.value=e)},{top:l(()=>[a(xe,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:l(()=>[a(X,null,{default:l(()=>[a(b,null,{default:l(()=>[a(Q,{density:"compact",modelValue:n.value.search,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value.search=e),placeholder:s.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),a(b,null,{default:l(()=>[a(Ce,{density:"compact",modelValue:n.value.event_type,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value.event_type=e),placeholder:s.$t("Prestation"),items:L.value,"item-value":"name","item-title":"name",multiple:"","hide-details":"",variant:"solo",flat:"",clearable:""},null,8,["modelValue","placeholder","items"])]),_:1}),a(b,null,{default:l(()=>[a(W,{ref_key:"dialog",ref:te,modelValue:C.value,"onUpdate:modelValue":t[7]||(t[7]=e=>C.value=e),"return-value":n.value.date,"onUpdate:returnValue":t[8]||(t[8]=e=>n.value.date=e),persistent:"",width:"290px"},{activator:l(({props:e})=>[a(Q,q({modelValue:j.value,"onUpdate:modelValue":t[2]||(t[2]=v=>j.value=v),"prepend-inner-icon":"bx-calendar",readonly:""},e,{density:"compact",placeholder:s.$t("Date"),"hide-details":"",variant:"solo",flat:"",clearable:"","onClick:clear":t[3]||(t[3]=v=>n.value.date=null)}),null,16,["modelValue","placeholder"])]),default:l(({isActive:e})=>[a(De,{locale:"fr"},{default:l(()=>[a($e,{modelValue:n.value.date,"onUpdate:modelValue":t[6]||(t[6]=v=>n.value.date=v),"hide-header":"",multiple:"range"},{actions:l(()=>[a(_,{color:"primary",onClick:t[4]||(t[4]=v=>C.value=!1)},{default:l(()=>[p(u(s.$t("Annuler")),1)]),_:1}),a(E),a(_,{variant:"elevated",color:"primary",onClick:t[5]||(t[5]=v=>C.value=!1)},{default:l(()=>[p(u(s.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1}),a(W,{modelValue:T.value,"onUpdate:modelValue":t[10]||(t[10]=e=>T.value=e),"max-width":"500px"},{default:l(()=>[a(Te,null,{default:l(()=>[a(Se,{class:"text-h5 text-center py-6"},{default:l(()=>[p(u(s.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),a(Ue,null,{default:l(()=>[a(E),a(_,{color:"error",variant:"flat",dark:"",onClick:t[9]||(t[9]=e=>T.value=!1)},{default:l(()=>[p(u(s.$t("Annuler")),1)]),_:1}),a(_,{color:"success",variant:"flat",dark:"",onClick:oe},{default:l(()=>[p(u(s.$t("OK")),1)]),_:1}),a(E)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.demand_date":l(({item:e})=>[p(u(d(z)(e.demand_date)),1)]),"item.event_date":l(({item:e})=>[p(u(d(z)(e.event_date)),1)]),"item.amount_left":l(({item:e})=>[Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?(G(),H("span",Me,u(d(A)(Math.max(e.services_sum_total-e.payments_sum_amount,0))),1)):_e("",!0)]),"item.services_sum_total":l(({item:e})=>[a(Y,{variant:"tonal",color:Math.max(e.services_sum_total-e.payments_sum_amount,0)>0?"error":"success",class:"font-weight-bold"},{default:l(()=>[p(u(d(A)(e.payments_sum_amount||0))+" / "+u(d(A)(e.services_sum_total||0)),1)]),_:2},1032,["color"])]),"item.status":l(({item:e})=>[a(Y,{color:d(m).statusColor(e.status),size:"small",label:""},{default:l(()=>[p(u(d(m).statusText(e.status)),1)]),_:2},1032,["color"])]),"item.actions":l(({item:e})=>[a(be,{"base-color":"primaruy",variant:"elevated",color:"primary",class:"text-center",density:"compact"},{default:l(()=>[a(_,{to:"/prestations/"+e.id},{default:l(()=>[p(u(s.$t("Prestation")),1)]),_:2},1032,["to"]),a(Ie,{location:s.location},{activator:l(({props:v})=>[a(_,q({icon:"mdi-chevron-down"},v),null,16)]),default:l(()=>[a(Ae,null,{default:l(()=>[a(Ee,{to:"/demands/"+e.demand_id},{default:l(()=>[a(Le,null,{default:l(()=>[p(u(s.$t("Voir la demande")),1)]),_:1})]),_:2},1032,["to"])]),_:2},1024)]),_:2},1032,["location"])]),_:2},1024)]),"no-data":l(()=>[Ve("span",null,u(s.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64))}});export{dt as default};
