import{u as ye}from"./demands-DBDWXmGq.js";import{u as be}from"./eventType-Con-M3dj.js";import{u as ke}from"./customers-DxOFblPC.js";import{u as $e}from"./hall-CTRuQ-7s.js";import{_ as Ce,a as De}from"./BaseBreadcrumb-BLYW9dWU.js";import{a as U}from"./formatters-DCCWVJxZ.js";import{a6 as Se,aC as Pe,r as n,av as Ue,aD as u,h as we,e as h,g as Ie,q as Te,Z as Ae,o as f,c as Z,b as l,w as a,a8 as w,n as Le,V as I,d as v,t as d,a4 as T,_ as y,a as b,ae as j,af as O,$ as J,X as ze}from"./index-CTWWqwFB.js";import{_ as xe,a as Be}from"./CancelDemand.vue_vue_type_script_setup_true_lang-D0bR13AN.js";import{_ as Ee}from"./ChangeHall.vue_vue_type_script_setup_true_lang-CMRi_D-P.js";import"./Controller-Ozw5e5LH.js";import{_ as Q}from"./DemandForm.vue_vue_type_script_setup_true_lang-8YJkPX7J.js";import{V as k,a as W}from"./VRow-BmCUl3Bv.js";import{V as Ne}from"./VDataTableServer-BRTWA4M4.js";import{V as Me}from"./VToolbar-NGepkY2W.js";import{V as Y}from"./VTextField-C4Wk-boL.js";import{V as je}from"./VAutocomplete-Bu0mSW1P.js";import{V as ee}from"./VDialog-Csg4ZvwQ.js";import{V as Oe}from"./VLocaleProvider-BMs7zZDk.js";import{V as Re}from"./VDatePicker-xaEEPToe.js";import{i as R,a as Fe,h as Ge,f as Ke,d as te,b as ae}from"./VSpacer-CpXg8B4f.js";import{a as qe,b as He,c as Xe}from"./VCard-C-APrnZS.js";import{V as F}from"./VTooltip-DrUA0_zW.js";import{V as G}from"./VAvatar-DDLJ7Omq.js";import"./EditorMenubar-BD2GX71P.js";import"./validators-BPi-vT8z.js";import"./vee-validate.esm-fRPIiQPH.js";import"./VContainer-D1Fh9kIV.js";import"./VSheet-C1yuEtxl.js";const Ze={key:0},Je=["onClick"],Qe=["onClick"],Pt=Se({__name:"List",setup(We){const $=Pe();n();const le=Ue(),oe=be(),ne=ke(),se=$e(),re=n({title:u("Gestion des demandes")}),ue=n([{text:u("Dashboard"),disabled:!1,href:"/"},{text:u("Gestion des demandes"),disabled:!0,href:"#"}]),i=n([]),K=n([]),de=n([]),ie=n([]),g=ye();we(()=>{_(),ge(),Ve(),se.fetchItems({per_page:1e3}).then(o=>{ie.value=o.data.data})}),n(!1);const x=n(!1);n(!1),n(!1),n(!1),n(!1),n(""),n(),n(!1);const q=n(null);n(null),n(null),n(null);const A=n(!1);n(!1),n();const B=n(100),C=n(2),L=n(2),z=n(0);n(!1),n(!1),n(null);const E=n("");n(["primary","secondary","error","success","warning"]);const V=n([{key:"event_date",order:"ASC"}]);n(0),n({total:0,validated:0,unvalidated:0});const s=n({search:null,status:0,date:null,event_type:null}),D=n({itemsPerPage:100,rowsPerPage:100,page:1,sortDesc:[!0],sortBy:[{key:"event_date",order:"ASC"}]}),me=n(-1),p=n({id:null,event_type_id:null,hall_id:null,customer:{}});n({id:null,avatar:"1.jpg",name:"",email:"",password:"",changePassword:!0,jdate:"",role:"",rolestatus:"",customer:{}});const S=n(!1),pe=n([{title:"Act",key:"actions",sortable:!1},{title:u("ID"),align:"start",key:"id",sortable:!0},{title:u("Prénom"),align:"start",key:"customer.firstname",sortable:!1},{title:u("Nom"),align:"start",key:"customer.lastname",sortable:!1},{title:u("Email"),align:"start",key:"customer.email",sortable:!1},{title:u("Tél."),align:"start",key:"customer.phone",sortable:!1},{title:u("Prest."),align:"start",key:"eventtype.name"},{title:u("Statut"),align:"start",key:"status"},{title:u("Source"),align:"start",key:"source"},{title:u("Date 'évén"),key:"event_date"},{title:u("Moment"),key:"reception_period"},{title:u("Lieu"),key:"event_location"},{title:u("Salle"),key:"hall.name"},{title:u("Conv"),key:"number_people"}]),H=h(()=>s.value.date&&s.value.date.length>0?U(s.value.date[0])+" - "+U(s.value.date[s.value.date.length-1]):null);h(()=>p.value.event_date?$.format(p.value.event_date,"shortDate"):null),h(()=>p.value.event_date?U(p.value.event_date):null),h(()=>g.demands.data.filter(o=>o.email.toLowerCase().includes(E.value.toLowerCase())));function ve(o,t){p.value=o,S.value=!0}function ce(){g.deleteItem(p.value.id);const o=i.value.findIndex(t=>t.id==p.value.id);i.value.splice(o,1),S.value=!1,le.showSuccess(u("Demande supprimée avec succès")),g.fetchStatistics()}h(()=>me.value===-1?"Nouvelle demande":"Modifier la demande");const fe=h(()=>s.value.date&&s.value.date.length?s.value.date.length>1?[$.format(s.value.date[0],"shortDate"),$.format(s.value.date[s.value.date.length-1],"shortDate")]:[$.format(s.value.date[0],"shortDate"),$.format(s.value.date[0],"shortDate")]:null);function _(){try{clearTimeout(q.value)}catch{}q.value=setTimeout(()=>{x.value=!0;let o="id",t="desc";console.log(V.value),V.value.length>0&&(o=V.value[0].key,t=V.value[0].order),g.fetchItems({term:E.value,paginate:B.value,current_page:C.value,direction:t,order_by:o,page:D.value.page,per_page:D.value.itemsPerPage,...s.value,date:fe.value}).then(c=>{if(c.data){const{data:e,current_page:r,next_page_url:m,total:N,per_page:X,to:P,last_page:_e}=c.data;i.value=e.map(M=>{const he=M.event_date!=null?new Date(M.event_date):null;return{...M,event_date:he}}),L.value=_e,z.value=N}}).catch(c=>{console.error(c)}).then(()=>{x.value=!1})},1e3)}function ge(){oe.fetchItems({term:"",paginate:500,current_page:1,direction:"asc",order_by:"name",page:1,per_page:500}).then(o=>{if(o.data){const{data:t,current_page:c,next_page_url:e,total:r,per_page:m,to:N,last_page:X}=o.data;K.value=t}}).catch(o=>{console.error(o)}).then(()=>{})}function Ve(){p.value={customer:{}},ne.fetchItems({term:"",paginate:5e3,current_page:1,direction:"asc",order_by:"firstname",page:1,per_page:5e3}).then(o=>{if(o.data){const{data:t,current_page:c,next_page_url:e,total:r,per_page:m,to:N,last_page:X}=o.data;de.value=t.map(P=>({...P,name:P.firstname+" "+P.lastname+" ("+(P.is_customer?u("Client"):u("Prospect"))+")"}))}}).catch(o=>{console.error(o)}).then(()=>{})}return Ie([E,D,s],()=>{_()},{deep:!0}),Te(()=>{C.value>L.value&&(C.value=L.value)}),(o,t)=>{const c=Ae("DotsVerticalIcon");return f(),Z(ze,null,[l(Ce,{title:`${re.value.title}(${z.value})`,breadcrumbs:ue.value},null,8,["title","breadcrumbs"]),l(W,null,{default:a(()=>[l(k,{cols:"12"},{default:a(()=>[l(Ne,{class:"border rounded-md",headers:pe.value,loading:x.value,items:i.value,"multi-sort":!1,"items-per-page":B.value,"onUpdate:itemsPerPage":t[13]||(t[13]=e=>B.value=e),"items-per-page-text":o.$t("Articles par page"),options:D.value,"onUpdate:options":t[14]||(t[14]=e=>D.value=e),"sort-by":V.value,"onUpdate:sortBy":t[15]||(t[15]=e=>V.value=e),page:C.value,"onUpdate:page":t[16]||(t[16]=e=>C.value=e),"items-length":z.value,"onUpdate:itemsLength":t[17]||(t[17]=e=>z.value=e),"show-select":!1,"loading-text":o.$t("Chargement des éléments"),"no-data-text":o.$t("Pas de données"),"no-results-text":o.$t("Aucun résultat"),onPageCount:t[18]||(t[18]=e=>L.value=e)},{top:a(()=>[l(Me,{class:"rounded-t-md pl-2 pr-2",flat:""},{default:a(()=>[l(W,null,{default:a(()=>[l(k,null,{default:a(()=>[l(Y,{density:"compact",modelValue:s.value.search,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value.search=e),placeholder:o.$t("Rechercher prénom, nom, email, téléphone..."),"hide-details":"",variant:"solo",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),l(k,null,{default:a(()=>[l(je,{density:"compact",modelValue:s.value.event_type_id,"onUpdate:modelValue":t[1]||(t[1]=e=>s.value.event_type_id=e),placeholder:o.$t("Prestation"),label:o.$t("Prestation"),items:K.value,"item-value":"id","item-title":"name",clearable:"",multiple:"","hide-details":"",variant:"solo"},null,8,["modelValue","placeholder","label","items"])]),_:1}),l(k,null,{default:a(()=>[l(De,{density:"compact",modelValue:s.value.status,"onUpdate:modelValue":t[2]||(t[2]=e=>s.value.status=e),placeholder:o.$t("Statut"),items:w(g).statusesList,"item-value":"id","item-title":"label",clearable:"","hide-details":"",variant:"solo",multiple:""},null,8,["modelValue","placeholder","items"])]),_:1}),l(k,null,{default:a(()=>[l(ee,{ref:"dialog",modelValue:A.value,"onUpdate:modelValue":t[8]||(t[8]=e=>A.value=e),"return-value":s.value.date,"onUpdate:returnValue":t[9]||(t[9]=e=>s.value.date=e),persistent:"",width:"290px"},{activator:a(({props:e})=>[l(Y,Le({modelValue:H.value,"onUpdate:modelValue":t[3]||(t[3]=r=>H.value=r),"prepend-inner-icon":"bx-calendar"},e,{density:"compact",placeholder:o.$t("Date"),label:o.$t("Date"),"hide-details":"",variant:"solo",clearable:"",readonly:"","onClick:clear":t[4]||(t[4]=r=>s.value.date=null)}),null,16,["modelValue","placeholder","label"])]),default:a(({isActive:e})=>[l(Oe,{locale:"fr"},{default:a(()=>[l(Re,{modelValue:s.value.date,"onUpdate:modelValue":t[7]||(t[7]=r=>s.value.date=r),"hide-header":"",multiple:"range"},{actions:a(()=>[l(I,{color:"primary",onClick:t[5]||(t[5]=r=>A.value=!1)},{default:a(()=>[v(d(o.$t("Annuler")),1)]),_:1}),l(R),l(I,{variant:"elevated",color:"primary",onClick:t[6]||(t[6]=r=>A.value=!1)},{default:a(()=>[v(d(o.$t("OK")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","return-value"])]),_:1}),l(k,{class:""},{default:a(()=>[l(Q,{modelValue:p.value,"onUpdate:modelValue":t[10]||(t[10]=e=>p.value=e),onSaved:_},null,8,["modelValue"])]),_:1})]),_:1}),l(ee,{modelValue:S.value,"onUpdate:modelValue":t[12]||(t[12]=e=>S.value=e),"max-width":"500px"},{default:a(()=>[l(qe,null,{default:a(()=>[l(He,{class:"text-h5 text-center py-6"},{default:a(()=>[v(d(o.$t("Êtes-vous sûr de vouloir supprimer cet élément ?")),1)]),_:1}),l(Xe,null,{default:a(()=>[l(R),l(I,{color:"error",variant:"flat",dark:"",onClick:t[11]||(t[11]=e=>S.value=!1)},{default:a(()=>[v(d(o.$t("Annuler")),1)]),_:1}),l(I,{color:"success",variant:"flat",dark:"",onClick:ce},{default:a(()=>[v(d(o.$t("OK")),1)]),_:1}),l(R)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.hall.name":a(({index:e,item:r})=>[r.hall?(f(),Z("span",Ze,d(r.hall.name),1)):T("",!0),r.hall?T("",!0):(f(),y(Ee,{key:1,modelValue:i.value[e],"onUpdate:modelValue":m=>i.value[e]=m,"show-demand-info":"",type:"demand"},null,8,["modelValue","onUpdate:modelValue"]))]),"item.customer.firstname":a(({item:e})=>[b("span",{class:"cursor-pointer",onClick:r=>o.$router.push("/demands/"+e.id)},d(e.customer?e.customer.firstname:""),9,Je)]),"item.customer.lastname":a(({item:e})=>[b("span",{class:"cursor-pointer",onClick:r=>o.$router.push("/demands/"+e.id)},d(e.customer?e.customer.lastname:""),9,Qe)]),"item.customer.email":a(({item:e})=>[l(F,{text:e.customer.email},{activator:a(({props:r})=>[b("span",j(O(r)),d(!e.customer||e.customer.email==null||e.customer.email.length<7?e.customer.email:`${e.customer.email.replace(`
`," ").slice(0,6)}...`),17)]),_:2},1032,["text"])]),"item.demand_date":a(({item:e})=>[v(d(w(U)(e.demand_date)),1)]),"item.event_date":a(({item:e})=>[v(d(w(U)(e.event_date)),1)]),"item.event_location":a(({item:e})=>[l(F,{text:e.event_location},{activator:a(({props:r})=>[b("span",j(O(r)),d(!e.event_location||e.event_location.length<10?e.event_location:`${e.event_location.slice(0,9)}...`),17)]),_:2},1032,["text"])]),"item.eventtype":a(({item:e})=>[e.eventtype?(f(),y(F,{key:0,text:e.eventtype?e.eventtype.name:""},{activator:a(({props:r})=>[b("span",j(O(r)),d(!e.eventtype.name||e.eventtype.name.length<10?e.eventtype.name:`${e.eventtype.name.slice(0,9)}...`),17)]),_:2},1032,["text"])):T("",!0)]),"item.status":a(({item:e})=>[l(Fe,{color:w(g).statusColor(e.status),size:"small",label:""},{default:a(()=>[v(d(w(g).statusText(e.status)),1)]),_:2},1032,["color"])]),"item.actions":a(({index:e,item:r})=>[l(I,{size:"30",icon:"",variant:"flat",class:"grey100"},{default:a(()=>[l(G,{size:"22"},{default:a(()=>[l(c,{size:"20",color:"grey100"})]),_:1}),l(Ge,{activator:"parent","close-on-content-click":""},{default:a(()=>[l(Ke,null,{default:a(()=>[r.prestation?T("",!0):(f(),y(xe,{key:0,modelValue:i.value[e],"onUpdate:modelValue":m=>i.value[e]=m,onSaved:_},null,8,["modelValue","onUpdate:modelValue"])),l(Q,{modelValue:i.value[e],"onUpdate:modelValue":m=>i.value[e]=m,"is-new":!1,onSaved:_},null,8,["modelValue","onUpdate:modelValue"]),l(te,{value:"action","hide-details":"","min-height":"38",to:"/demands/"+r.id},{default:a(()=>[l(ae,null,{default:a(()=>[l(G,{size:"20",class:"mr-2"},{default:a(()=>[(f(),y(J("EyeIcon"),{"stroke-width":"2",size:"20"}))]),_:1}),v(" "+d(o.$t("Voir")),1)]),_:1})]),_:2},1032,["to"]),l(te,{value:"action","hide-details":"","min-height":"38",onClick:m=>ve(r,e)},{default:a(()=>[l(ae,null,{default:a(()=>[l(G,{size:"20",class:"mr-2"},{default:a(()=>[(f(),y(J("TrashIcon"),{"stroke-width":"2",size:"20"}))]),_:1}),v(" "+d(o.$t("Supprimer")),1)]),_:1})]),_:2},1032,["onClick"]),r.prestation?T("",!0):(f(),y(Be,{key:1,modelValue:i.value[e],"onUpdate:modelValue":m=>i.value[e]=m,onSaved:_},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"no-data":a(()=>[b("span",null,d(o.$t("Aucune donnée disponible")),1)]),_:1},8,["headers","loading","items","items-per-page","items-per-page-text","options","sort-by","page","items-length","loading-text","no-data-text","no-results-text"])]),_:1})]),_:1})],64)}}});export{Pt as default};
